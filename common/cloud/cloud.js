!function(e,t){for(var r in t)e[r]=t[r]}(window,function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=69)}([function(e,t,r){"use strict";r.r(t),r.d(t,"__extends",function(){return i}),r.d(t,"__assign",function(){return o}),r.d(t,"__rest",function(){return a}),r.d(t,"__decorate",function(){return s}),r.d(t,"__param",function(){return u}),r.d(t,"__metadata",function(){return c}),r.d(t,"__awaiter",function(){return l}),r.d(t,"__generator",function(){return f}),r.d(t,"__createBinding",function(){return d}),r.d(t,"__exportStar",function(){return _}),r.d(t,"__values",function(){return p}),r.d(t,"__read",function(){return h}),r.d(t,"__spread",function(){return E}),r.d(t,"__spreadArrays",function(){return g}),r.d(t,"__spreadArray",function(){return m}),r.d(t,"__await",function(){return S}),r.d(t,"__asyncGenerator",function(){return v}),r.d(t,"__asyncDelegator",function(){return y}),r.d(t,"__asyncValues",function(){return T}),r.d(t,"__makeTemplateObject",function(){return A}),r.d(t,"__importStar",function(){return O}),r.d(t,"__importDefault",function(){return I}),r.d(t,"__classPrivateFieldGet",function(){return R}),r.d(t,"__classPrivateFieldSet",function(){return N});
    /*! *****************************************************************************
    Copyright (c) Microsoft Corporation.
    
    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.
    
    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
    var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){Object.defineProperty(this,"constructor",{value:e})}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var o=function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function a(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}function s(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function u(e,t){return function(r,n){t(r,n,e)}}function c(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function l(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):function(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(a,s)}u((n=n.apply(e,t||[])).next())})}function f(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var d=Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]};function _(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||d(t,e,r)}function p(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function h(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function E(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(h(arguments[t]));return e}function g(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n}function m(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e}function S(e){return this instanceof S?(this.v=e,this):new S(e)}function v(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),o=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(e){i[e]&&(n[e]=function(t){return new Promise(function(r,n){o.push([e,t,r,n])>1||s(e,t)})})}function s(e,t){try{!function(e){e.value instanceof S?Promise.resolve(e.value.v).then(u,c):l(o[0][2],e)}(i[e](t))}catch(e){l(o[0][3],e)}}function u(e){s("next",e)}function c(e){s("throw",e)}function l(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function y(e){var t,r;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:S(e[n](t)),done:"return"===n}:i?i(t):t}:i}}function T(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=p(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,i){(function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)})(n,i,(t=e[r](t)).done,t.value)})}}}function A(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var C=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function O(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&d(t,e,r);return C(t,e),t}function I(e){return e&&e.__esModule?e:{default:e}}function R(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function N(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isPlainObject=t.isInternalObject=t.isRegExp=t.isDate=t.isArray=t.isFunction=t.isPromise=t.isNumber=t.isString=t.isObject=t.getType=void 0,t.getType=function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},t.isObject=function(e){return"object"===t.getType(e)},t.isString=function(e){return"string"===t.getType(e)},t.isNumber=function(e){return"number"===t.getType(e)},t.isPromise=function(e){return"promise"===t.getType(e)},t.isFunction=function(e){return"function"==typeof e},t.isArray=function(e){return Array.isArray(e)},t.isDate=function(e){return"date"===t.getType(e)},t.isRegExp=function(e){return"regexp"===t.getType(e)},t.isInternalObject=function(e){return e&&"symbol"===t.getType(e._internalType)},t.isPlainObject=function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isCancelledError=t.CancelledError=t.isTimeoutError=t.TimeoutError=t.isGenericError=t.toSDKError=t.returnAsFinalCloudSDKError=t.returnAsCloudSDKError=t.isSDKError=t.CloudSDKError=void 0;var n=r(0),i=r(1),o=r(5),a=function(e){function t(t){var r=e.call(this,t.errMsg)||this;return r.errCode=-1,Object.defineProperties(r,{message:{get:function(){return"errCode: "+this.errCode+" "+(o.ERR_CODE[this.errCode]||"")+" | errMsg: "+this.errMsg},set:function(e){this.errMsg=e}}}),r.errCode=t.errCode||-1,r.errMsg=t.errMsg,r}return n.__extends(t,e),Object.defineProperty(t.prototype,"message",{get:function(){return"errCode: "+this.errCode+" | errMsg: "+this.errMsg},set:function(e){this.errMsg=e},enumerable:!1,configurable:!0}),t}(Error);function s(e){return e&&e instanceof Error&&i.isString(e.errMsg)}function u(e,t){if(e){if(s(e))return e;var r,n=t+":fail ";if(e instanceof Error)e.message=""+n+e.message,e.stack=e.stack?e.stack.slice(0,7)+n+e.stack.slice(7):e.stack,(r=e).errCode=-1;else if("string"==typeof e)(r=new Error(""+n+e)).errCode=-1;else{var i=e.errMsg||"";(r=new Error(t+":fail "+e.errCode+" "+(o.ERR_CODE[e.errCode]||"")+". "+i)).errCode=e.errCode||-1}return r.errMsg=r.message+"",r}var a=new Error(t+":fail");return a.errCode=-1,a.errMsg=a.message+"",a}t.CloudSDKError=a,t.isSDKError=s,t.returnAsCloudSDKError=function(e,t){if(void 0===t&&(t=""),e){if(s(e))return t&&(e.errMsg+="; "+t),e;var r=e?e.errCode:void 0,n=(e&&e.errMsg||e.toString()||"unknown error")+"; "+t;return new a({errCode:r,errMsg:n})}return new a({errMsg:t})},t.returnAsFinalCloudSDKError=function(e,t){return u(e,t)},t.toSDKError=u,t.isGenericError=function(e){return e.generic};var c=function(e){function t(t,r){var n=e.call(this,t)||this;return n.type="timeout",n.generic=!0,n.payload=r,n}return n.__extends(t,e),t}(Error);t.TimeoutError=c,t.isTimeoutError=function(e){return"timeout"===e.type};var l=function(e){function t(t,r){var n=e.call(this,t)||this;return n.type="cancelled",n.generic=!0,n.payload=r,n}return n.__extends(t,e),t}(Error);t.CancelledError=l,t.isCancelledError=function(e){return"cancelled"===e.type}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.assertObjectNotEmpty=t.assertStringLength=t.assertRequiredParam=t.assertType=t.validType=void 0;var n=r(1),i=r(2),o=r(5);function a(e,t,r){void 0===r&&(r="parameter");var i=function e(t,r,i){var o=n.getType(t),a=n.getType(r);if("string"===a)return o!==r?i+" should be "+r+" instead of "+o+";":"";if(o!==a)return i+" should be "+a+" instead of "+o+"; ";var s="";switch(o){case"object":for(var u in r)s+=e(t[u],r[u],i+"."+u);break;case"array":for(var c=0;c<r.length;c++)s+=e(t[c],r[c],i+"["+c+"]")}return s}(e,t,r);return{passed:!i,reason:i}}t.validType=a,t.assertType=function(e,t,r,n){void 0===r&&(r="parameter"),void 0===n&&(n=i.CloudSDKError);var s=a(e,t,r);if(!s.passed)throw new n({errCode:o.ERR_CODE.SDK_API_PARAMETER_TYPE_ERROR,errMsg:s.reason})},t.assertRequiredParam=function(e,t,r,n){if(void 0===n&&(n=i.CloudSDKError),void 0===e||null===e)throw new n({errCode:o.ERR_CODE.SDK_API_PARAMETER_ERROR,errMsg:"parameter "+t+" of function "+r+" must be provided"})},t.assertStringLength=function(e){var t=e.name,r=e.input,n=e.max,a=e.maxWording,s=void 0===a?"":a,u=e.ErrorClass,c=void 0===u?i.CloudSDKError:u;if(r.length>n)throw new c({errCode:o.ERR_CODE.SDK_API_PARAMETER_ERROR,errMsg:t+" size must be less than "+(s||n)})},t.assertObjectNotEmpty=function(e){var t=e.target,r=e.name,n=e.ErrorClass,a=void 0===n?i.CloudSDKError:n;if(0===Object.keys(t).length)throw new a({errCode:o.ERR_CODE.SDK_API_PARAMETER_ERROR,errMsg:r+" must not be empty"})}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.setDefaultSDK=t.setSDK=t.getSDK=void 0;var r,n=new WeakMap;function i(){return r||("undefined"!=typeof __appServiceSDK__?__appServiceSDK__:void 0)}t.getSDK=function(e){if(!e)return i();var t=n.get(e);return t&&t||i()},t.setSDK=function(e,t){n.set(e,t)},t.setDefaultSDK=function(e){r=e}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ERR_CODE=void 0,t.ERR_CODE={"-1":"",UNKNOWN_ERROR:-1,"-401001":"api permission denied",SDK_API_PERMISSION_DENIED:-401001,"-401002":"api parameter error",SDK_API_PARAMETER_ERROR:-401002,"-401003":"api parameter type error",SDK_API_PARAMETER_TYPE_ERROR:-401003,"-402001":"circular reference detected",SDK_DATABASE_CIRCULAR_REFERENCE:-402001,"-402002":"realtime listener init watch fail",SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:-402002,"-402003":"realtime listener reconnect ws fail",SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WS_FAIL:-402003,"-402004":"realtime listener rebuild watch fail",SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL:-402004,"-402005":"realtime listener close watch fail",SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL:-402005,"-402006":"realtime listener receive server error msg",SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG:-402006,"-402007":"realtime listener receive invalid server data",SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA:-402007,"-402008":"realtime listener websocket connection error",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR:-402008,"-402009":"realtime listener websocket connection closed",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED:-402009,"-402010":"realtime listener check last fail",SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL:-402010,"-402011":"realtime listener unexpected fatal error",SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR:-402011,"-402012":"realtime listener init ws fail",SDK_DATABASE_REALTIME_LISTENER_INIT_WS_FAIL:-402012,"-403001":"max upload file size exceeded",SDK_STORAGE_EXCEED_MAX_UPLOAD_SIZE:-403001,"-403002":"internal server error: empty upload url",SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_UPLOAD_URL:-403002,"-403003":"internal server error: empty download url",SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_DOWNLOAD_URL:-403003,"-404001":"empty call result",SDK_FUNCTIONS_EMPTY_CALL_RESULT:-404001,"-404002":"empty event id",SDK_FUNCTIONS_EMPTY_EVENT_ID:-404002,"-404003":"empty poll url",SDK_FUNCTIONS_EMPTY_POLL_URL:-404003,"-404004":"empty poll result json",SDK_FUNCTIONS_EMPTY_POLL_RESULT_JSON:-404004,"-404005":"exceed max poll retry",SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY:-404005,"-404006":"empty poll result base resp",SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP:-404006,"-404007":"poll result base resp ret abnormal",SDK_FUNCTIONS_POLL_RESULT_BASE_RESP_RET_ABNORMAL:-404007,"-404008":"poll result status code error",SDK_FUNCTIONS_POLL_RESULT_STATUS_CODE_ERROR:-404008,"-404009":"poll error",SDK_FUNCTIONS_POLL_ERROR:-404009,"-404010":"result expired",SDK_FUNCTIONS_POLL_RESULT_EXPIRED:-404010,"-404011":"cloud function execution error",SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR:-404011,"-404012":"polling exceed max timeout retry",SDK_FUNCTIONS_EXCEED_MAX_TIMEOUT_POLL_RETRY:-404012,"-404013":"polling exceed max system error retry",SDK_FUNCTIONS_EXCEED_MAX_SYSTEM_ERROR_POLL_RETRY:-404013,"-405001":"empty call result",SDK_CONTAINER_EMPTY_CALL_RESULT:-405001,"-405002":"empty event id",SDK_CONTAINER_EMPTY_EVENT_ID:-405002,"-405003":"empty poll url",SDK_CONTAINER_EMPTY_POLL_URL:-405003,"-405004":"empty poll result json",SDK_CONTAINER_EMPTY_POLL_RESULT_JSON:-405004,"-405005":"exceed max poll retry",SDK_CONTAINER_EXCEED_MAX_POLL_RETRY:-405005,"-405006":"empty poll result base resp",SDK_CONTAINER_EMPTY_POLL_RESULT_BASE_RESP:-405006,"-405007":"poll result base resp ret abnormal",SDK_CONTAINER_POLL_RESULT_BASE_RESP_RET_ABNORMAL:-405007,"-405008":"poll result status code error",SDK_CONTAINER_POLL_RESULT_STATUS_CODE_ERROR:-405008,"-405009":"poll error",SDK_CONTAINER_POLL_ERROR:-405009,"-405010":"result expired",SDK_CONTAINER_POLL_RESULT_EXPIRED:-405010,"-405012":"polling exceed max timeout retry",SDK_CONTAINER_EXCEED_MAX_TIMEOUT_POLL_RETRY:-405012,"-405013":"polling exceed max system error retry",SDK_CONTAINER_EXCEED_MAX_SYSTEM_ERROR_POLL_RETRY:-405013,"-405014":"cannot download result (cdn)",SDK_CONTAINER_DOWNLOAD_RESULT_FROM_CDN_FAIL:-405014,"-601001":"system error",WX_SYSTEM_ERROR:-601001,"-601002":"system args error",WX_SYSTEM_ARGS_ERROR:-601002,"-601003":"system network error",WX_SYSTEM_NETWORK_ERROR:-601003,"-601004":"api permission denied",WX_API_PERMISSION_DENIED:-601004,"-601005":"invalid cloudID",WX_INVALID_CLOUDID:-601005,"-601006":"cloudID expired",WX_CLOUDID_EXPIRED:-601006,"-601007":"cloudID and calling user does not match",WX_CLOUDID_USER_NOT_MATCH:-601007,"-601008":"server-side request timedout",WX_SERVER_REQUEST_TIMEOUT:-601008,"-601009":"missing mobile phone",WX_MISSING_MOBILE_PHONE:-601009,"-601010":"no write permission",WX_NO_WRITE_PERMISSION:-601010,"-601011":"no privilege permission",WX_NO_PRIVILEGE_PERMISSION:-601011,"-601012":"unauthorized env",WX_UNAUTHORIZED_ENV:-601012,"-601013":"no multiend permission",WX_NO_MULTIEND_PERMISSION:-601013,"-601015":"access denied (cloudfunction cloudbase_auth returns empty errCode)",WX_CLOUDBASE_AUTH_RETURN_EMPTY_ERRCODE:-601015,"-601016":"missing env auth info",WX_MISSING_ENV_AUTH_INFO:-601016,"-601017":"access denied (cloudbase_auth returns non-zero errCode)",WX_CLOUDBASE_AUTH_RETURN_NON_ZERO_ERRCODE:-601017,"-602018":"unauthorized API",WX_UNAUTHORIZED_API:-601018,"-602001":"database query result size exceed limit (1MB)",WX_DATABASE_QUERY_SIZE_EXCEED_LIMIT:-602001,"-604001":"cloudfunction result size exceed limit (1MB)",WX_CLOUDFUNCTION_RESULT_SIZE_EXCEED_LIMIT:-604001,"-501001":"resource system error",TCB_RESOURCE_SYSTEM_ERROR:-501001,"-501002":"resource server timeout",TCB_RESOURCE_SERVER_TIMEOUT:-501002,"-501003":"exceed request limit",TCB_EXCEED_REQUEST_LIMIT:-501003,"-501004":"exceed concurrent request limit",TCB_EXCEED_CONCURRENT_REQUEST_LIMIT:-501004,"-501005":"invalid env",TCB_INVALID_ENV:-501005,"-501006":"invalid common parameters",TCB_INVALID_COMMON_PARAM:-501006,"-501007":"invalid parameters",TCB_INVALID_PARAM:-501007,"-501008":"invalid request source",TCB_INVALID_REQUEST_SOURCE:-501008,"-501009":"resource not initialized",TCB_RESOURCE_NOT_INITIALIZED:-501009,"-501010":"tencentcloud key signature verification fail",TCB_KEY_SIGNATURE_VERIFICATION_FAIL:-501010,"-501011":"invalid env status",TCB_INVALID_ENV_STATUS:-501011,"-501012":"invalid api name",TCB_INVALID_API_NAME:-501012,"-501013":"request data size exceeds limit (5M)",TCB_REQ_DATA_EXCEED_LIMIT_5M:-501013,"-501014":"upload file size exceeds limit (5M)",TCB_UPLOAD_FILE_SIZE_EXCEED_LIMIT_5M:-501014,"-501023":"permission denied",TCB_PERMISSION_DENIED:-501023,"-502001":"database request fail",TCB_DB_REQUEST_FAIL:-502001,"-502002":"database invalid command",TCB_DB_INVALID_COMMAND:-502002,"-502003":"database permission denied",TCB_DB_PERMISSION_DENIED:-502003,"-502004":"database exceed collection limit",TCB_DB_EXCEED_COLLECTION_LIMIT:-502004,"-502005":"database collection not exists",TCB_DB_COLLECTION_NOT_EXISTS:-502005,"-503001":"storage request fail",TCB_STORAGE_REQUEST_FAIL:-503001,"-503002":"storage permission denied",TCB_STORAGE_PERMISSION_DENIED:-503002,"-503003":"storage file not exists",TCB_STORAGE_FILE_NOT_EXISTS:-503003,"-503004":"storage invalid sign parameter",TCB_STORAGE_INVALID_SIGN_PARAM:-503004,"-504001":"functions request fail",TCB_FUNCTIONS_REQUEST_FAIL:-504001,"-504002":"functions execute fail",TCB_FUNCTIONS_EXEC_FAIL:-504002}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.socketOnMessageSamplePicker=t.wrapTiming=t.reportMMData=t.setReportToken=t.reportIDKey=t.reportAPISpeed=t.init=void 0;var n=r(0),i=r(25),o=r(4),a=r(76),s=r(26),u=r(8),c=r(1),l=!1,f=[],d=Date.now(),_=Date.now(),p="unknown";u.default.onReady(function(){d=Date.now(),_=Date.now()}),t.init=function(){if(!l)try{var e=o.getSDK();e.wx.onAppShow&&e.wx.onAppShow(function(){_=Date.now()}),e.wx.getNetworkType({success:function(e){p=e.networkType},complete:function(){l=!0,E()}}),e.wx.onNetworkStatusChange(function(e){l||(l=!0,E()),p=e.networkType})}catch(e){0}};var h,E=function(){var e,t;try{for(var r=n.__values(f),i=r.next();!i.done;i=r.next()){var o=i.value;try{o()}catch(e){0}}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}f=[]};t.reportAPISpeed=function(e){setTimeout(function(){var r;try{if(!function(e){return!(e.tunnelStartTime&&e.tunnelEndTime&&e.tunnelEndTime<e.tunnelStartTime||!(e.apiStartTime&&e.apiEndTime&&e.apiEndTime>e.apiStartTime))}(e))return;if(!l&&f.length<100)return void f.push(t.reportAPISpeed.bind(null,e));var n=Date.now(),o=e.apiEndTime-e.apiStartTime,a=e.tunnelEndTime?e.tunnelEndTime-e.tunnelStartTime:0,s=[0,e.apiName,o,a,(e.pollStartTime&&e.pollEndTime&&e.pollEndTime>e.pollStartTime?e.pollEndTime-e.pollStartTime:0)||0,p,e.tunnelTimeNoCSNetCost?o-e.tunnelTimeNoCSNetCost:0,e.tunnelTimeNoCSNetCost?a-e.tunnelTimeNoCSNetCost:0,e.funcExecTime?e.funcExecTime:0,null!==(r=e.channelType)&&void 0!==r?r:0,e.funcName||"",n-d,n-_];i.default.fake?t.reportMMData(16588,6,s.join(",")):i.default.reportKeyValue({key:"CloudReport",value:s.join(","),force:!0})}catch(e){}})},t.reportIDKey=function(e,t,r,n){i.default.reportIDKeyDirectly({id:e,key:t,force:r,immediately:n})},t.setReportToken=function(e){return h=e};var g=[];t.reportMMData=function(e,t,r){g.push({log_id:e,version:t,user_log_list:r}),h&&m()};var m=a.default(function(){o.getSDK()._requestSkipCheckDomain({url:"https://servicewechat.com/wxa-qbase/report?token="+h,method:"POST",header:{},enableHttp2:!0,dataType:"json",data:JSON.stringify({report_info_list:g}),success:function(e){for(var t in e.header)"x-wx-system-error"===t.toLocaleLowerCase()&&"85104"===e.header[t]&&s.ServiceEndpoint.invalidateService("container")}}),g=[],s.keepAlive()},3e4);t.wrapTiming=function(e,r){var i=c.isFunction(e);function o(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(r.samplePicker&&!r.samplePicker.next())return i?e.apply(this,t):e;var o=Date.now(),s=!0;try{if(r.condition&&r.condition.emptyKey&&r.timing[r.startKey])return i?e.apply(this,t):e;var u=void 0;if(i){var l=e.apply(this,t);if(!c.isPromise(l))return s=!1,l;u=l}else u=e;return u.then(function(){return a(o)}).catch(function(){return a(o)}),u}catch(e){throw s=!1,e}finally{s||a(o)}}function a(e){r.timing[r.startKey]=e,r.timing[r.endKey]=Date.now(),r.autoReport&&t.reportAPISpeed(n.__assign(n.__assign({},r.timing),{apiName:r.autoReport}))}return i?o:o()};t.socketOnMessageSamplePicker=function(e,t){return function(){var r,i;return n.__generator(this,function(n){switch(n.label){case 0:r=function(){return parseInt(Math.round(2*Math.random()*e),10)},i=t?0:r(),n.label=1;case 1:return i>0?(i--,[4,!1]):[3,3];case 2:return n.sent(),[3,5];case 3:return i=r(),[4,!0];case 4:n.sent(),n.label=5;case 5:return[3,1];case 6:return[2]}})}}(10,!0)()},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SYMBOL_REGEXP=t.SYMBOL_SERVER_DATE=t.SYMBOL_GEO_MULTIPOLYGON=t.SYMBOL_GEO_MULTILINESTRING=t.SYMBOL_GEO_MULTIPOINT=t.SYMBOL_GEO_POLYGON=t.SYMBOL_GEO_LINESTRING=t.SYMBOL_GEO_POINT=t.SYMBOL_PROJECT_COMMAND=t.SYMBOL_AGGREGATE_COMMAND=t.SYMBOL_LOGIC_COMMAND=t.SYMBOL_QUERY_COMMAND=t.SYMBOL_UPDATE_COMMAND=t.SYMBOL_AGGREGATE_PIPELINE_STAGE=t.SYMBOL_AGGREGATE_PIPELINE=t.SYMBOL_AGGREGATE=t.SYMBOL_UNSET_FIELD_NAME=void 0,t.SYMBOL_UNSET_FIELD_NAME=Symbol.for("UNSET_FIELD_NAME"),t.SYMBOL_AGGREGATE=Symbol.for("AGGREGATE"),t.SYMBOL_AGGREGATE_PIPELINE=Symbol.for("AGGREGATE_PIPELINE"),t.SYMBOL_AGGREGATE_PIPELINE_STAGE=Symbol.for("AGGREGATE_PIPELINE_STAGE"),t.SYMBOL_UPDATE_COMMAND=Symbol.for("UPDATE_COMMAND"),t.SYMBOL_QUERY_COMMAND=Symbol.for("QUERY_COMMAND"),t.SYMBOL_LOGIC_COMMAND=Symbol.for("LOGIC_COMMAND"),t.SYMBOL_AGGREGATE_COMMAND=Symbol.for("AGGREGATE_COMMAND"),t.SYMBOL_PROJECT_COMMAND=Symbol.for("PROJECT_COMMAND"),t.SYMBOL_GEO_POINT=Symbol.for("GEO_POINT"),t.SYMBOL_GEO_LINESTRING=Symbol.for("GEO_LINESTRING"),t.SYMBOL_GEO_POLYGON=Symbol.for("GEO_POLYGON"),t.SYMBOL_GEO_MULTIPOINT=Symbol.for("GEO_MULTIPOINT"),t.SYMBOL_GEO_MULTILINESTRING=Symbol.for("GEO_MULTILINESTRING"),t.SYMBOL_GEO_MULTIPOLYGON=Symbol.for("GEO_MULTIPOLYGON"),t.SYMBOL_SERVER_DATE=Symbol.for("SERVER_DATE"),t.SYMBOL_REGEXP=Symbol.for("REGEXP")},function(e,t,r){(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.isMac=t.isWindows=t.isMINA=t.isDevTools=void 0;var i,o=r(0);try{__wxConfig.platform,i=o.__assign({},__wxConfig),__wxConfig.onReady(function(){i=Object.assign(i,__wxConfig)})}catch(t){i={platform:"ios",appLaunchInfo:{mode:""},onReady:function(e){setTimeout(function(){e()})}},e.env.TEST&&(n.__wxConfig=i)}t.default=i,t.isDevTools=function(){return"devtools"===i.platform},t.isMINA=function(){return"mina"===i.platform},t.isWindows=function(){return"windows"===i.platform},t.isMac=function(){return"mac"===i.platform}}).call(this,r(22),r(13))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.hasAPICallback=t.invokeFailCompleteCallbacks=t.invokeSuccessCompleteCallbacks=t.invokeCompleteCallback=t.invokeFailCallback=t.invokeSuccessCallback=void 0;var n=r(1),i=r(24);function o(e,t,r){t.success&&n.isFunction(t.success)&&i.wrapWithTryCatch(t.success,"at api "+e+" success callback function;")(r)}function a(e,t,r){t.fail&&n.isFunction(t.fail)&&i.wrapWithTryCatch(t.fail,"at api "+e+" fail callback function;")(r)}function s(e,t,r){t.complete&&n.isFunction(t.complete)&&i.wrapWithTryCatch(t.complete,"at api "+e+" complete callback function;")(r)}t.invokeSuccessCallback=o,t.invokeFailCallback=a,t.invokeCompleteCallback=s,t.invokeSuccessCompleteCallbacks=function(e,t,r){o(e,t,r),s(e,t,r)},t.invokeFailCompleteCallbacks=function(e,t,r){a(e,t,r),s(e,t,r)},t.hasAPICallback=function(e){return e&&(e.success||e.fail||e.complete)}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.apiFailMsg=t.apiCancelMsg=t.apiSuccessMsg=void 0,t.apiSuccessMsg=function(e){return e+":ok"},t.apiCancelMsg=function(e,t){return e+":cancel "+t},t.apiFailMsg=function(e,t){return e+":fail "+t}},function(e,t,r){(function(e){var n=this;Object.defineProperty(t,"__esModule",{value:!0}),t.stringToUtf8Array=t.stringToArrayBuffer=t.arrayBufferToString=t.base64ToArrayBuffer=t.arrayBufferToBase64=t.encodeWithDecode=t.tryDecodeURIComponent=t.tryJSONParse=t.privateGetBackgroundFetchData=t.getSystemInfo=t.offAppVisibilityChange=t.onAppVisibilityChange=t.onceNetworkOnline=t.throwErrorIfNetworkOffline=t.getNetworkStatus=t.getWXVersion=t.autoCount=t.nextLoop=t.sleep=t._wxConsole=void 0;var i=r(0),o=r(4),a=r(6);t._wxConsole="undefined"!=typeof wxConsole?wxConsole:void 0,t.sleep=function(e){return void 0===e&&(e=0),new Promise(function(t){return setTimeout(t,e)})},t.nextLoop=function(){return new Promise(function(t){return e(t)})};var s,u={};t.autoCount=function(e){return void 0===e&&(e="any"),u[e]||(u[e]=0),u[e]++},t.getWXVersion=function(){var e,t,r=o.getSDK().wx;if(r&&r.version){e=r.version.version,t=r.version.updateTime;var n=r.version.updateTime.match(/^(\d+)\.(\d+)\.(\d+)/);return{version:e,updateTime:t,updateDateInDashes:n?n[1]+"-"+n[2]+"-"+n[3]:"unknown"}}return{version:"unknown",updateTime:"unknown",updateDateInDashes:"unknown"}};var c=!1,l=[];t.getNetworkStatus=function(){return new Promise(function(e,t){if(s)e(s);else{0;try{o.getSDK().wx.getNetworkType({success:function(t){s={networkType:t.networkType,isConnected:"none"!==t.networkType},e(s),c||(o.getSDK().wx.onNetworkStatusChange(function(e){if(s.networkType=e.networkType,s.isConnected=e.isConnected,e.isConnected&&l.length)for(;l.length;)try{l.shift()()}catch(e){}}),c=!0)},fail:t})}catch(e){t(e)}}})},t.throwErrorIfNetworkOffline=function(){return new Promise(function(e,r){return i.__awaiter(n,void 0,void 0,function(){return i.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,t.getNetworkStatus()];case 1:return n.sent().isConnected?e():r("network offline"),[3,3];case 2:return n.sent(),e(),[3,3];case 3:return[2]}})})})},t.onceNetworkOnline=function(){return new Promise(function(e){s&&s.isConnected?e():l.push(e)})};var f,d=!1,_=new Set;t.onAppVisibilityChange=function(e){o.getSDK().wx.onAppShow&&(d||(function(){var e=o.getSDK().wx;e.onAppShow&&e.onAppHide&&(e.onAppShow(function(){var e,t;"visible";try{for(var r=i.__values(_),n=r.next();!n.done;n=r.next()){var o=n.value;try{o("show")}catch(e){}}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}),e.onAppHide(function(){var e,t;"hidden";try{for(var r=i.__values(_),n=r.next();!n.done;n=r.next()){var o=n.value;try{o("hide")}catch(e){}}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}))}(),d=!0),_.size>50&&_.clear(),_.add(e))},t.offAppVisibilityChange=function(e){_.delete(e)},t.getSystemInfo=function(){if(f)return f;var e=o.getSDK().wx;return f=e.getSystemInfoSync()};var p,h=!1,E=void 0;function g(e){try{return decodeURIComponent(e)}catch(t){return e}}t.privateGetBackgroundFetchData=function(e,r){return void 0===e&&(e=500),void 0===r&&(r={}),i.__awaiter(this,void 0,void 0,function(){var n,s;return i.__generator(this,function(i){switch(i.label){case 0:return o.getSDK().private_getBackgroundFetchData?r.pluginId?[2]:E?[2,E]:p?[2,p.then(function(){return E})]:h?[2]:(h=!0,n=Date.now(),[4,p=Promise.race([t.sleep(e).then(function(){return{error:"bg fetch timeout"}}),new Promise(function(e,t){o.getSDK().private_getBackgroundFetchData({fetchType:0,success:function(t){try{(E=JSON.parse(t.fetchedData)).expiresTs=E.timestamp+1e3*E.expires_in,e(E),a.reportAPISpeed({apiName:"private_getBackgroundFetchData",apiStartTime:n,apiEndTime:Date.now()})}catch(t){e({error:t})}},fail:function(t){e({error:t})}})})])]):[2];case 1:return s=i.sent(),p=void 0,null===t._wxConsole||void 0===t._wxConsole||t._wxConsole.log("wrap_private_getBackgroundFetchData",JSON.stringify(s)),s.error?[2,void 0]:[2,s]}})})},t.tryJSONParse=function(e){try{return JSON.parse(e)}catch(t){return e}},t.tryDecodeURIComponent=g,t.encodeWithDecode=function(e){return encodeURIComponent(g(e))};var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function S(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t.push(n):n<2048?t.push(192|n>>6,128|63&n):n<55296||n>=57344?t.push(224|n>>12,128|n>>6&63,128|63&n):(r++,n=65536+((1023&n)<<10|1023&e.charCodeAt(r)),t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return new Uint8Array(t)}t.arrayBufferToBase64=function(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return function(e){for(var t=String(e),r="",n=void 0,i=void 0,o=0,a=m;t.charAt(0|o)||(a="=",o%1);r+=a.charAt(63&n>>8-o%1*8)){if((i=t.charCodeAt(o+=.75))>255)throw new Error('"btoa" failed');n=n<<8|i}return r}(t)},t.base64ToArrayBuffer=function(e){for(var t=function(e){var t=String(e).replace(/=+$/,""),r="";if(t.length%4==1)throw new Error('"atob" failed');for(var n=0,i=void 0,o=void 0,a=0;o=t.charAt(a++);~o&&(i=n%4?64*i+o:o,n++%4)?r+=String.fromCharCode(255&i>>(-2*n&6)):0)o=m.indexOf(o);return r}(e),r=t.length,n=new Uint8Array(r),i=0;i<r;i++)n[i]=t.charCodeAt(i);return n.buffer},t.arrayBufferToString=function(e){return v(new Uint8Array(e))},t.stringToArrayBuffer=function(e){return S(e).buffer},t.stringToUtf8Array=S;var v=function(){var e=new Array(128),t=String.fromCodePoint||String.fromCharCode,r=[];return function(n){var i,o,a=n.length;r.length=0;for(var s=0;s<a;)(o=n[s++])<=127?i=o:o<=223?i=(31&o)<<6|63&n[s++]:o<=239?i=(15&o)<<12|(63&n[s++])<<6|63&n[s++]:String.fromCodePoint?i=(7&o)<<18|(63&n[s++])<<12|(63&n[s++])<<6|63&n[s++]:(i=63,s+=3),r.push(e[i]||(e[i]=t(i)));return r.join("")}}()}).call(this,r(77).setImmediate)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.shallowClone=void 0;var n=r(0),i=r(1);t.shallowClone=function(e,t){if(void 0===t&&(t=!1),t)return function(e){switch(i.getType(e)){case"object":return n.__assign({},e);case"array":return e.slice();case"number":return e instanceof Number?new Number(e):e;case"string":return e instanceof String?new String(e):e;case"boolean":return e instanceof Boolean?new Boolean(e):e;case"date":return new e.constructor(+e);case"map":return new Map(e);case"set":return new Set(e);default:return e}}(e);if(i.isPlainObject(e))return n.__assign({},e);switch(i.getType(e)){case"object":return e;case"array":return e.slice();default:return e}}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";(function(e){var n=t;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function o(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&i(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=r(81),n.base64=r(82),n.EventEmitter=r(83),n.float=r(84),n.inquire=r(85),n.utf8=r(86),n.pool=r(87),n.LongBits=r(88),n.isNode=Boolean(void 0!==e&&e&&e.process&&e.process.versions&&e.process.versions.node),n.global=n.isNode&&e||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||globalThis,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=o,n.ProtocolError=o("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}).call(this,r(13))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.deserialize=t.toJSONSerializable=t.stringifyReplacer=t.serialize=void 0;var n=r(0),i=r(2),o=r(5),a=r(1);function s(e){switch(a.getType(e)){case"object":return function e(t){var r=t;var n=u(r);if(r!==n)return n;for(var i in r){var o=r[i],c=a.getType(o);switch(c){case"object":var l=u(o);r[i]=l!==o?l:e(r[i]);break;case"array":var l=s(o);l!==o&&(r[i]=l);break;default:continue}}return r}(e);case"array":return e.map(s);default:return e}}function u(e){for(var t in e)switch(t){case"type":switch(e.type){case"Buffer":if(a.isArray(e.data)&&a.isNumber(e.data[0]))try{return new Uint8Array(e.data).buffer}catch(t){return e}}}return e}t.serialize=function(e,t){return JSON.stringify(e,function(e,r){if(t&&t.has(r))return t.get(r);switch(a.getType(r)){case"arraybuffer":var i=new Uint8Array(r);return{type:"Buffer",data:n.__spread(i)}}return r})},t.stringifyReplacer=function(e,t){switch(a.getType(t)){case"arraybuffer":var r=new Uint8Array(t);return{type:"Buffer",data:n.__spread(r)}}return t},t.toJSONSerializable=function e(t,r){if(void 0===r&&(r="data"),null!==t&&void 0!==t){if(!0===t||!1===t)return t;switch(a.getType(t)){case"number":if(isFinite(t))return t;break;case"string":return t;case"array":return t.map(function(t,n){return e(t,r+"["+n+"]")});case"object":var s={};for(var u in t)t.hasOwnProperty(u)&&(s[u]=e(t[u],r+"."+u));return s;case"arraybuffer":var c=new Uint8Array(t);return{type:"Buffer",data:n.__spread(c)}}if("function"==typeof t)return t;!function(e){throw new i.CloudSDKError({errCode:o.ERR_CODE.SDK_API_PARAMETER_TYPE_ERROR,errMsg:e+" is not JSON-serializable"})}(r)}},t.deserialize=function(e){return s(JSON.parse(e))}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.formatHeader=t.callbackFailComplete=t.callbackSuccessComplete=void 0,t.callbackSuccessComplete=function(e,t){e.success&&e.success(t),e.complete&&e.complete(t),e.success=void 0,e.complete=void 0},t.callbackFailComplete=function(e,t){e.fail&&e.fail(t),e.complete&&e.complete(t),e.fail=void 0,e.complete=void 0},t.formatHeader=function(e){var t={};return e.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(function(e){var r=e.split(": "),n=r.shift(),i=r.join(": ");t[n]=i}),t}},function(e,t,r){(function(e,r){var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a=!1;function s(){a=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,r=e.length;t<r;++t)n[t]=e[t],i[e.charCodeAt(t)]=t;i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63}function u(e){return n[e>>18&63]+n[e>>12&63]+n[e>>6&63]+n[63&e]}function c(e,t,r){for(var n,i=[],o=t;o<r;o+=3)n=(e[o]<<16)+(e[o+1]<<8)+e[o+2],i.push(u(n));return i.join("")}function l(e){var t;a||s();for(var r=e.length,i=r%3,o="",u=[],l=0,f=r-i;l<f;l+=16383)u.push(c(e,l,l+16383>f?f:l+16383));return 1===i?(t=e[r-1],o+=n[t>>2],o+=n[t<<4&63],o+="=="):2===i&&(t=(e[r-2]<<8)+e[r-1],o+=n[t>>10],o+=n[t>>4&63],o+=n[t<<2&63],o+="="),u.push(o),u.join("")}function f(e,t,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,c=u>>1,l=-7,f=r?i-1:0,d=r?-1:1,_=e[t+f];for(f+=d,o=_&(1<<-l)-1,_>>=-l,l+=s;l>0;o=256*o+e[t+f],f+=d,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;l>0;a=256*a+e[t+f],f+=d,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(_?-1:1);a+=Math.pow(2,n),o-=c}return(_?-1:1)*a*Math.pow(2,o-n)}function d(e,t,r,n,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,_=n?0:o-1,p=n?1:-1,h=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+f>=1?d/u:d*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(t*u-1)*Math.pow(2,i),a+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;e[r+_]=255&s,_+=p,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[r+_]=255&a,_+=p,a/=256,c-=8);e[r+_-p]|=128*h}var _={}.toString,p=Array.isArray||function(e){return"[object Array]"==_.call(e)};m.TYPED_ARRAY_SUPPORT=void 0===e.TYPED_ARRAY_SUPPORT||e.TYPED_ARRAY_SUPPORT;var h=E();function E(){return m.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function g(e,t){if(E()<t)throw new RangeError("Invalid typed array length");return m.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=m.prototype:(null===e&&(e=new m(t)),e.length=t),e}function m(e,t,r){if(!(m.TYPED_ARRAY_SUPPORT||this instanceof m))return new m(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return y(this,e)}return S(this,e,t,r)}function S(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);m.TYPED_ARRAY_SUPPORT?(e=t).__proto__=m.prototype:e=T(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!m.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|O(t,r),i=(e=g(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(C(t)){var r=0|A(t.length);return 0===(e=g(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?g(e,0):T(e,t);if("Buffer"===t.type&&p(t.data))return T(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function v(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function y(e,t){if(v(t),e=g(e,t<0?0:0|A(t)),!m.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function T(e,t){var r=t.length<0?0:0|A(t.length);e=g(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function A(e){if(e>=E())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+E().toString(16)+" bytes");return 0|e}function C(e){return!(null==e||!e._isBuffer)}function O(e,t){if(C(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return Q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return $(e).length;default:if(n)return Q(e).length;t=(""+t).toLowerCase(),n=!0}}function I(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function R(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=m.from(t,n)),C(t))return 0===t.length?-1:N(e,t,r,n,i);if("number"==typeof t)return t&=255,m.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):N(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function N(e,t,r,n,i){var o,a=1,s=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=r;o<s;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(r+u>s&&(r=s-u),o=r;o>=0;o--){for(var f=!0,d=0;d<u;d++)if(c(e,o+d)!==c(t,d)){f=!1;break}if(f)return o}return-1}function w(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[r+a]=s}return a}function b(e,t,r,n){return Z(Q(t,e.length-r),e,r,n)}function D(e,t,r,n){return Z(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function L(e,t,r,n){return D(e,t,r,n)}function M(e,t,r,n){return Z($(t),e,r,n)}function P(e,t,r,n){return Z(function(e,t){for(var r,n,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)r=e.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function U(e,t,r){return 0===t&&r===e.length?l(e):l(e.slice(t,r))}function B(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,s,u,c=e[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=r)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(u=(15&c)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=f}return function(e){var t=e.length;if(t<=x)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=x));return r}(n)}m.poolSize=8192,m._augment=function(e){return e.__proto__=m.prototype,e},m.from=function(e,t,r){return S(null,e,t,r)},m.TYPED_ARRAY_SUPPORT&&(m.prototype.__proto__=Uint8Array.prototype,m.__proto__=Uint8Array),m.alloc=function(e,t,r){return function(e,t,r,n){return v(t),t<=0?g(e,t):void 0!==r?"string"==typeof n?g(e,t).fill(r,n):g(e,t).fill(r):g(e,t)}(null,e,t,r)},m.allocUnsafe=function(e){return y(null,e)},m.allocUnsafeSlow=function(e){return y(null,e)},m.isBuffer=ee,m.compare=function(e,t){if(!C(e)||!C(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},m.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},m.concat=function(e,t){if(!p(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return m.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=m.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!C(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},m.byteLength=O,m.prototype._isBuffer=!0,m.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)I(this,t,t+1);return this},m.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)I(this,t,t+3),I(this,t+1,t+2);return this},m.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)I(this,t,t+7),I(this,t+1,t+6),I(this,t+2,t+5),I(this,t+3,t+4);return this},m.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?B(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return q(this,t,r);case"utf8":case"utf-8":return B(this,t,r);case"ascii":return k(this,t,r);case"latin1":case"binary":return G(this,t,r);case"base64":return U(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},m.prototype.equals=function(e){if(!C(e))throw new TypeError("Argument must be a Buffer");return this===e||0===m.compare(this,e)},m.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},m.prototype.compare=function(e,t,r,n,i){if(!C(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var o=i-n,a=r-t,s=Math.min(o,a),u=this.slice(n,i),c=e.slice(t,r),l=0;l<s;++l)if(u[l]!==c[l]){o=u[l],a=c[l];break}return o<a?-1:a<o?1:0},m.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},m.prototype.indexOf=function(e,t,r){return R(this,e,t,r,!0)},m.prototype.lastIndexOf=function(e,t,r){return R(this,e,t,r,!1)},m.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return w(this,e,t,r);case"utf8":case"utf-8":return b(this,e,t,r);case"ascii":return D(this,e,t,r);case"latin1":case"binary":return L(this,e,t,r);case"base64":return M(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},m.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var x=4096;function k(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function G(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function q(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=z(e[o]);return i}function F(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function W(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function j(e,t,r,n,i,o){if(!C(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function K(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function Y(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function H(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function V(e,t,r,n,i){return i||H(e,0,r,4),d(e,t,r,n,23,4),r+4}function J(e,t,r,n,i){return i||H(e,0,r,8),d(e,t,r,n,52,8),r+8}m.prototype.slice=function(e,t){var r,n=this.length;if(e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),m.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=m.prototype;else{var i=t-e;r=new m(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},m.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||W(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},m.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||W(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},m.prototype.readUInt8=function(e,t){return t||W(e,1,this.length),this[e]},m.prototype.readUInt16LE=function(e,t){return t||W(e,2,this.length),this[e]|this[e+1]<<8},m.prototype.readUInt16BE=function(e,t){return t||W(e,2,this.length),this[e]<<8|this[e+1]},m.prototype.readUInt32LE=function(e,t){return t||W(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},m.prototype.readUInt32BE=function(e,t){return t||W(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},m.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||W(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},m.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||W(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},m.prototype.readInt8=function(e,t){return t||W(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},m.prototype.readInt16LE=function(e,t){t||W(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},m.prototype.readInt16BE=function(e,t){t||W(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},m.prototype.readInt32LE=function(e,t){return t||W(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},m.prototype.readInt32BE=function(e,t){return t||W(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},m.prototype.readFloatLE=function(e,t){return t||W(e,4,this.length),f(this,e,!0,23,4)},m.prototype.readFloatBE=function(e,t){return t||W(e,4,this.length),f(this,e,!1,23,4)},m.prototype.readDoubleLE=function(e,t){return t||W(e,8,this.length),f(this,e,!0,52,8)},m.prototype.readDoubleBE=function(e,t){return t||W(e,8,this.length),f(this,e,!1,52,8)},m.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||j(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},m.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||j(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},m.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||j(this,e,t,1,255,0),m.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},m.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||j(this,e,t,2,65535,0),m.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):K(this,e,t,!0),t+2},m.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||j(this,e,t,2,65535,0),m.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):K(this,e,t,!1),t+2},m.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||j(this,e,t,4,4294967295,0),m.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Y(this,e,t,!0),t+4},m.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||j(this,e,t,4,4294967295,0),m.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Y(this,e,t,!1),t+4},m.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);j(this,e,t,r,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},m.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);j(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},m.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||j(this,e,t,1,127,-128),m.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},m.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||j(this,e,t,2,32767,-32768),m.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):K(this,e,t,!0),t+2},m.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||j(this,e,t,2,32767,-32768),m.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):K(this,e,t,!1),t+2},m.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||j(this,e,t,4,2147483647,-2147483648),m.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Y(this,e,t,!0),t+4},m.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||j(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),m.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Y(this,e,t,!1),t+4},m.prototype.writeFloatLE=function(e,t,r){return V(this,e,t,!0,r)},m.prototype.writeFloatBE=function(e,t,r){return V(this,e,t,!1,r)},m.prototype.writeDoubleLE=function(e,t,r){return J(this,e,t,!0,r)},m.prototype.writeDoubleBE=function(e,t,r){return J(this,e,t,!1,r)},m.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!m.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},m.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!m.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var a=C(e)?e:Q(new m(e,n).toString()),s=a.length;for(o=0;o<r-t;++o)this[o+t]=a[o%s]}return this};var X=/[^+\/0-9A-Za-z-_]/g;function z(e){return e<16?"0"+e.toString(16):e.toString(16)}function Q(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function $(e){return function(e){var t,r,n,u,c,l;a||s();var f=e.length;if(f%4>0)throw new Error("Invalid string. Length must be a multiple of 4");c="="===e[f-2]?2:"="===e[f-1]?1:0,l=new o(3*f/4-c),n=c>0?f-4:f;var d=0;for(t=0,r=0;t<n;t+=4,r+=3)u=i[e.charCodeAt(t)]<<18|i[e.charCodeAt(t+1)]<<12|i[e.charCodeAt(t+2)]<<6|i[e.charCodeAt(t+3)],l[d++]=u>>16&255,l[d++]=u>>8&255,l[d++]=255&u;return 2===c?(u=i[e.charCodeAt(t)]<<2|i[e.charCodeAt(t+1)]>>4,l[d++]=255&u):1===c&&(u=i[e.charCodeAt(t)]<<10|i[e.charCodeAt(t+1)]<<4|i[e.charCodeAt(t+2)]>>2,l[d++]=u>>8&255,l[d++]=255&u),l}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(X,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Z(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function ee(e){return null!=e&&(!!e._isBuffer||te(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&te(e.slice(0,0))}(e))}function te(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var re=Object.freeze({INSPECT_MAX_BYTES:50,kMaxLength:h,Buffer:m,SlowBuffer:function(e){return+e!=e&&(e=0),m.alloc(+e)},isBuffer:ee});Map;var ne=function(){function e(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function t(e){return!0===(e&&e.__isLong__)}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0}),e.isLong=t;var r={},n={};function i(e,t){var i,o,s;return t?(s=0<=(e>>>=0)&&e<256)&&(o=n[e])?o:(i=a(e,(0|e)<0?-1:0,!0),s&&(n[e]=i),i):(s=-128<=(e|=0)&&e<128)&&(o=r[e])?o:(i=a(e,e<0?-1:0,!1),s&&(r[e]=i),i)}function o(e,t){if(isNaN(e))return t?h:p;if(t){if(e<0)return h;if(e>=f)return v}else{if(e<=-d)return y;if(e+1>=d)return S}return e<0?o(-e,t).neg():a(e%l|0,e/l|0,t)}function a(t,r,n){return new e(t,r,n)}e.fromInt=i,e.fromNumber=o,e.fromBits=a;var s=Math.pow;function u(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return p;if("number"==typeof t?(r=t,t=!1):t=!!t,(r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return u(e.substring(1),t,r).neg();for(var i=o(s(r,8)),a=p,c=0;c<e.length;c+=8){var l=Math.min(8,e.length-c),f=parseInt(e.substring(c,c+l),r);if(l<8){var d=o(s(r,l));a=a.mul(d).add(o(f))}else a=(a=a.mul(i)).add(o(f))}return a.unsigned=t,a}function c(e,t){return"number"==typeof e?o(e,t):"string"==typeof e?u(e,t):a(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}e.fromString=u,e.fromValue=c;var l=4294967296,f=l*l,d=f/2,_=i(1<<24),p=i(0);e.ZERO=p;var h=i(0,!0);e.UZERO=h;var E=i(1);e.ONE=E;var g=i(1,!0);e.UONE=g;var m=i(-1);e.NEG_ONE=m;var S=a(-1,2147483647,!1);e.MAX_VALUE=S;var v=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=v;var y=a(0,-2147483648,!1);e.MIN_VALUE=y;var T=e.prototype;return T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*l+(this.low>>>0):this.high*l+(this.low>>>0)},T.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(y)){var t=o(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=o(s(e,6),this.unsigned),a=this,u="";;){var c=a.div(i),l=(a.sub(c.mul(i)).toInt()>>>0).toString(e);if((a=c).isZero())return l+u;for(;l.length<6;)l="0"+l;u=""+l+u}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(y)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},T.isZero=function(){return 0===this.high&&0===this.low},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(e){return t(e)||(e=c(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},T.eq=T.equals,T.notEquals=function(e){return!this.eq(e)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(e){return this.comp(e)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(e){return this.comp(e)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(e){return this.comp(e)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(e){return this.comp(e)>=0},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(e){if(t(e)||(e=c(e)),this.eq(e))return 0;var r=this.isNegative(),n=e.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(y)?y:this.not().add(E)},T.neg=T.negate,T.add=function(e){t(e)||(e=c(e));var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,s=e.high>>>16,u=65535&e.high,l=e.low>>>16,f=0,d=0,_=0,p=0;return _+=(p+=o+(65535&e.low))>>>16,d+=(_+=i+l)>>>16,f+=(d+=n+u)>>>16,f+=r+s,a((_&=65535)<<16|(p&=65535),(f&=65535)<<16|(d&=65535),this.unsigned)},T.subtract=function(e){return t(e)||(e=c(e)),this.add(e.neg())},T.sub=T.subtract,T.multiply=function(e){if(this.isZero())return p;if(t(e)||(e=c(e)),e.isZero())return p;if(this.eq(y))return e.isOdd()?y:p;if(e.eq(y))return this.isOdd()?y:p;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(_)&&e.lt(_))return o(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,s=65535&this.low,u=e.high>>>16,l=65535&e.high,f=e.low>>>16,d=65535&e.low,h=0,E=0,g=0,m=0;return g+=(m+=s*d)>>>16,E+=(g+=i*d)>>>16,g&=65535,E+=(g+=s*f)>>>16,h+=(E+=n*d)>>>16,E&=65535,h+=(E+=i*f)>>>16,E&=65535,h+=(E+=s*l)>>>16,h+=r*d+n*f+i*l+s*u,a((g&=65535)<<16|(m&=65535),(h&=65535)<<16|(E&=65535),this.unsigned)},T.mul=T.multiply,T.divide=function(e){if(t(e)||(e=c(e)),e.isZero())throw Error("division by zero");var r,n,i;if(this.isZero())return this.unsigned?h:p;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return h;if(e.gt(this.shru(1)))return g;i=h}else{if(this.eq(y))return e.eq(E)||e.eq(m)?y:e.eq(y)?E:(r=this.shr(1).div(e).shl(1)).eq(p)?e.isNegative()?E:m:(n=this.sub(e.mul(r)),i=r.add(n.div(e)));else if(e.eq(y))return this.unsigned?h:p;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=p}for(n=this;n.gte(e);){r=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),u=a<=48?1:s(2,a-48),l=o(r),f=l.mul(e);f.isNegative()||f.gt(n);)f=(l=o(r-=u,this.unsigned)).mul(e);l.isZero()&&(l=E),i=i.add(l),n=n.sub(f)}return i},T.div=T.divide,T.modulo=function(e){return t(e)||(e=c(e)),this.sub(this.div(e).mul(e))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return a(~this.low,~this.high,this.unsigned)},T.and=function(e){return t(e)||(e=c(e)),a(this.low&e.low,this.high&e.high,this.unsigned)},T.or=function(e){return t(e)||(e=c(e)),a(this.low|e.low,this.high|e.high,this.unsigned)},T.xor=function(e){return t(e)||(e=c(e)),a(this.low^e.low,this.high^e.high,this.unsigned)},T.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?a(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):a(0,this.low<<e-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?a(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):a(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(e){if(t(e)&&(e=e.toInt()),0===(e&=63))return this;var r=this.high;return e<32?a(this.low>>>e|r<<32-e,r>>>e,this.unsigned):a(32===e?r:r>>>e-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},T.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},T.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},e.fromBytes=function(t,r,n){return n?e.fromBytesLE(t,r):e.fromBytesBE(t,r)},e.fromBytesLE=function(t,r){return new e(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,r)},e.fromBytesBE=function(t,r){return new e(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],r)},e.prototype.toExtendedJSON=function(e){return e&&e.relaxed?this.toNumber():{$numberLong:this.toString()}},e.fromExtendedJSON=function(t,r){var n=e.fromString(t.$numberLong);return r&&r.relaxed?n.toNumber():n},Object.defineProperty(e.prototype,"_bsontype",{value:"Long"}),e}();function ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ae(e,t,r){return t&&oe(e.prototype,t),r&&oe(e,r),e}var se=function(){function e(t){ie(this,e),t instanceof Number&&(t=t.valueOf()),this.value=t}return ae(e,[{key:"valueOf",value:function(){return this.value}},{key:"toJSON",value:function(){return this.value}},{key:"toExtendedJSON",value:function(e){return e&&(e.legacy||e.relaxed&&isFinite(this.value))?this.value:{$numberDouble:this.value.toString()}}}],[{key:"fromExtendedJSON",value:function(t,r){return r&&r.relaxed?parseFloat(t.$numberDouble):new e(parseFloat(t.$numberDouble))}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"Double"}),e}();function ue(e){return(ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t){return!t||"object"!==ue(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function le(e){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fe(e,t){return(fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var de=function(e){function t(e,r){return ie(this,t),ce(ne.isLong(e)?ce(this,le(t).call(this,e.low,e.high,!0)):ce(this,le(t).call(this,e,r,!0)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fe(e,t)}(t,ne),ae(t,[{key:"toJSON",value:function(){return{$timestamp:this.toString()}}},{key:"toExtendedJSON",value:function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}}}],[{key:"fromInt",value:function(e){return new t(ne.fromInt(e,!0))}},{key:"fromNumber",value:function(e){return new t(ne.fromNumber(e,!0))}},{key:"fromBits",value:function(e,r){return new t(e,r)}},{key:"fromString",value:function(e,r){return new t(ne.fromString(e,r,!0))}},{key:"fromExtendedJSON",value:function(e){return new t(e.$timestamp.i,e.$timestamp.t)}}]),Object.defineProperty(t.prototype,"_bsontype",{value:"Timestamp"}),t.MAX_VALUE=t.MAX_UNSIGNED_VALUE,t}(),_e={};function pe(e){for(var t=new Uint8Array(e),r=0;r<e;++r)t[r]=Math.floor(256*Math.random());return t}var he={normalizedFunctionString:function(e){return e.toString().replace("function(","function (")},randomBytes:function(){var e=pe;if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues)e=function(e){return window.crypto.getRandomValues(new Uint8Array(e))};else{try{e=_e.randomBytes}catch(e){}null==e&&(e=pe)}return e}()};new Date;var Ee=function(){function e(e,t){var r={seen:[],stylize:me};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),Ae(t)?r.showHidden=t:t&&Pe(r,t),Re(r.showHidden)&&(r.showHidden=!1),Re(r.depth)&&(r.depth=2),Re(r.colors)&&(r.colors=!1),Re(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=ge),Se(r,e,r.depth)}return e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e}();function ge(e,t){var r=Ee.styles[t];return r?"["+Ee.colors[r][0]+"m"+e+"["+Ee.colors[r][1]+"m":e}function me(e,t){return e}function Se(e,t,r){if(e.customInspect&&t&&Le(t.inspect)&&t.inspect!==Ee&&(!t.constructor||t.constructor.prototype!==t)){var n=t.inspect(r,e);return Ie(n)||(n=Se(e,n,r)),n}var i=function(e,t){if(Re(t))return e.stylize("undefined","undefined");if(Ie(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(Oe(t))return e.stylize(""+t,"number");if(Ae(t))return e.stylize(""+t,"boolean");if(Ce(t))return e.stylize("null","null")}(e,t);if(i)return i;var o=Object.keys(t),a=function(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),De(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return ve(t);if(0===o.length){if(Le(t)){var s=t.name?": "+t.name:"";return e.stylize("[Function"+s+"]","special")}if(Ne(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(be(t))return e.stylize(Date.prototype.toString.call(t),"date");if(De(t))return ve(t)}var u,c="",l=!1,f=["{","}"];(Te(t)&&(l=!0,f=["[","]"]),Le(t))&&(c=" [Function"+(t.name?": "+t.name:"")+"]");return Ne(t)&&(c=" "+RegExp.prototype.toString.call(t)),be(t)&&(c=" "+Date.prototype.toUTCString.call(t)),De(t)&&(c=" "+ve(t)),0!==o.length||l&&0!=t.length?r<0?Ne(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),u=l?function(e,t,r,n,i){for(var o=[],a=0,s=t.length;a<s;++a)Ue(t,String(a))?o.push(ye(e,t,r,n,String(a),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(ye(e,t,r,n,i,!0))}),o}(e,t,r,a,o):o.map(function(n){return ye(e,t,r,a,n,l)}),e.seen.pop(),function(e,t,r){if(e.reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(u,c,f)):f[0]+c+f[1]}function ve(e){return"["+Error.prototype.toString.call(e)+"]"}function ye(e,t,r,n,i,o){var a,s,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),Ue(n,i)||(a="["+i+"]"),s||(e.seen.indexOf(u.value)<0?(s=Ce(r)?Se(e,u.value,null):Se(e,u.value,r-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),Re(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function Te(e){return Array.isArray(e)}function Ae(e){return"boolean"==typeof e}function Ce(e){return null===e}function Oe(e){return"number"==typeof e}function Ie(e){return"string"==typeof e}function Re(e){return void 0===e}function Ne(e){return we(e)&&"[object RegExp]"===Me(e)}function we(e){return"object"===ue(e)&&null!==e}function be(e){return we(e)&&"[object Date]"===Me(e)}function De(e){return we(e)&&("[object Error]"===Me(e)||e instanceof Error)}function Le(e){return"function"==typeof e}function Me(e){return Object.prototype.toString.call(e)}function Pe(e,t){if(!t||!we(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}function Ue(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var Be=Ee,xe=function t(r,n){if(Re(e.process))return function(){return t(r,n).apply(this,arguments)};var i=!1;return function(){return i||(console.error(n),i=!0),r.apply(this,arguments)}},ke=(()=>re.Buffer)(),Ge=xe,qe=(0,he.randomBytes)(5),Fe=new RegExp("^[0-9a-fA-F]{24}$"),We=function(){var e=!1;try{ke&&ke.from&&(e=!0)}catch(t){e=!1}return e}(),je=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<=15?"0":"")+t.toString(16);return e}(),Ke=function(){for(var e=[],t=0;t<10;)e[48+t]=t++;for(;t<16;)e[55+t]=e[87+t]=t++;return e}(),Ye=ke;function He(e,t){var r=e[t];return new TypeError('ObjectId string "'.concat(e,'" contains invalid character "').concat(r,'" with character code (').concat(e.charCodeAt(t),"). All character codes for a non-hex string must be less than 256."))}var Ve=function(){function e(t){if(ie(this,e),t instanceof e)return t;if(null==t||"number"==typeof t)return this.id=e.generate(t),void(e.cacheHexString&&(this.__id=this.toString("hex")));var r=e.isValid(t);if(!r&&null!=t)throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(r&&"string"==typeof t&&24===t.length&&We)return new e(ke.from(t,"hex"));if(r&&"string"==typeof t&&24===t.length)return e.createFromHexString(t);if(null==t||12!==t.length){if(null!=t&&t.toHexString)return e.createFromHexString(t.toHexString());throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}this.id=t,e.cacheHexString&&(this.__id=this.toString("hex"))}return ae(e,[{key:"toHexString",value:function(){if(e.cacheHexString&&this.__id)return this.__id;var t="";if(!this.id||!this.id.length)throw new TypeError("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id instanceof Ye)return t=function(e){return e.toString("hex")}(this.id),e.cacheHexString&&(this.__id=t),t;for(var r=0;r<this.id.length;r++){var n=je[this.id.charCodeAt(r)];if("string"!=typeof n)throw He(this.id,r);t+=n}return e.cacheHexString&&(this.__id=t),t}},{key:"toString",value:function(e){return this.id&&this.id.copy?this.id.toString("string"==typeof e?e:"hex"):this.toHexString()}},{key:"toJSON",value:function(){return this.toHexString()}},{key:"equals",value:function(t){return t instanceof e?this.toString()===t.toString():"string"==typeof t&&e.isValid(t)&&12===t.length&&this.id instanceof Ye?t===this.id.toString("binary"):"string"==typeof t&&e.isValid(t)&&24===t.length?t.toLowerCase()===this.toHexString():"string"==typeof t&&e.isValid(t)&&12===t.length?t===this.id:!(null==t||!(t instanceof e||t.toHexString))&&t.toHexString()===this.toHexString()}},{key:"getTimestamp",value:function(){var e=new Date,t=this.id.readUInt32BE(0);return e.setTime(1e3*Math.floor(t)),e}},{key:"toExtendedJSON",value:function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}}}],[{key:"getInc",value:function(){return e.index=(e.index+1)%16777215}},{key:"generate",value:function(t){"number"!=typeof t&&(t=~~(Date.now()/1e3));var r=e.getInc(),n=ke.alloc(12);return n[3]=255&t,n[2]=t>>8&255,n[1]=t>>16&255,n[0]=t>>24&255,n[4]=qe[0],n[5]=qe[1],n[6]=qe[2],n[7]=qe[3],n[8]=qe[4],n[11]=255&r,n[10]=r>>8&255,n[9]=r>>16&255,n}},{key:"createPk",value:function(){return new e}},{key:"createFromTime",value:function(t){var r=ke.from([0,0,0,0,0,0,0,0,0,0,0,0]);return r[3]=255&t,r[2]=t>>8&255,r[1]=t>>16&255,r[0]=t>>24&255,new e(r)}},{key:"createFromHexString",value:function(t){if(void 0===t||null!=t&&24!==t.length)throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(We)return new e(ke.from(t,"hex"));for(var r=new Ye(12),n=0,i=0;i<24;)r[n++]=Ke[t.charCodeAt(i++)]<<4|Ke[t.charCodeAt(i++)];return new e(r)}},{key:"isValid",value:function(t){return null!=t&&("number"==typeof t||("string"==typeof t?12===t.length||24===t.length&&Fe.test(t):t instanceof e||(t instanceof Ye&&12===t.length||!!t.toHexString&&(12===t.id.length||24===t.id.length&&Fe.test(t.id)))))}},{key:"fromExtendedJSON",value:function(t){return new e(t.$oid)}}]),e.get_inc=Ge(function(){return e.getInc()},"Please use the static `ObjectId.getInc()` instead"),e.prototype.get_inc=Ge(function(){return e.getInc()},"Please use the static `ObjectId.getInc()` instead"),e.prototype.getInc=Ge(function(){return e.getInc()},"Please use the static `ObjectId.getInc()` instead"),e.prototype.generate=Ge(function(t){return e.generate(t)},"Please use the static `ObjectId.generate(time)` instead"),Object.defineProperty(e.prototype,"generationTime",{enumerable:!0,get:function(){return this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24},set:function(e){this.id[3]=255&e,this.id[2]=e>>8&255,this.id[1]=e>>16&255,this.id[0]=e>>24&255}}),e.prototype[Be.custom||"inspect"]=e.prototype.toString,e.index=~~(16777215*Math.random()),Object.defineProperty(e.prototype,"_bsontype",{value:"ObjectID"}),e}();var Je=function(){function e(t,r){ie(this,e),this.pattern=t||"",this.options=r?function(e){return e.split("").sort().join("")}(r):"";for(var n=0;n<this.options.length;n++)if("i"!==this.options[n]&&"m"!==this.options[n]&&"x"!==this.options[n]&&"l"!==this.options[n]&&"s"!==this.options[n]&&"u"!==this.options[n])throw new Error("The regular expression option [".concat(this.options[n],"] is not supported"))}return ae(e,[{key:"toExtendedJSON",value:function(e){return(e=e||{}).legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}}}],[{key:"parseOptions",value:function(e){return e?e.split("").sort().join(""):""}},{key:"fromExtendedJSON",value:function(t){return t.$regex?"BSONRegExp"===t.$regex._bsontype?t:new e(t.$regex,e.parseOptions(t.$options)):new e(t.$regularExpression.pattern,e.parseOptions(t.$regularExpression.options))}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"BSONRegExp"}),e}(),Xe=function(){function e(t){ie(this,e),this.value=t}return ae(e,[{key:"valueOf",value:function(){return this.value}},{key:"toString",value:function(){return this.value}},{key:"inspect",value:function(){return this.value}},{key:"toJSON",value:function(){return this.value}},{key:"toExtendedJSON",value:function(){return{$symbol:this.value}}}],[{key:"fromExtendedJSON",value:function(t){return new e(t.$symbol)}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"Symbol"}),e}(),ze=function(){function e(t){ie(this,e),t instanceof Number&&(t=t.valueOf()),this.value=t}return ae(e,[{key:"valueOf",value:function(){return this.value}},{key:"toJSON",value:function(){return this.value}},{key:"toExtendedJSON",value:function(e){return e&&(e.relaxed||e.legacy)?this.value:{$numberInt:this.value.toString()}}}],[{key:"fromExtendedJSON",value:function(t,r){return r&&r.relaxed?parseInt(t.$numberInt,10):new e(t.$numberInt)}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"Int32"}),e}(),Qe=function(){function e(t,r){ie(this,e),this.code=t,this.scope=r}return ae(e,[{key:"toJSON",value:function(){return{scope:this.scope,code:this.code}}},{key:"toExtendedJSON",value:function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}}}],[{key:"fromExtendedJSON",value:function(t){return new e(t.$code,t.$scope)}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"Code"}),e}(),$e=(()=>re.Buffer)(),Ze=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,et=/^(\+|-)?(Infinity|inf)$/i,tt=/^(\+|-)?NaN$/i,rt=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),nt=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),it=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),ot=/^([-+])?(\d+)?$/;function at(e){return!isNaN(parseInt(e,10))}function st(e){var t=ne.fromNumber(1e9),r=ne.fromNumber(0);if(!(e.parts[0]||e.parts[1]||e.parts[2]||e.parts[3]))return{quotient:e,rem:r};for(var n=0;n<=3;n++)r=(r=r.shiftLeft(32)).add(new ne(e.parts[n],0)),e.parts[n]=r.div(t).low,r=r.modulo(t);return{quotient:e,rem:r}}function ut(e,t){throw new TypeError('"'.concat(e,'" is not a valid Decimal128 string - ').concat(t))}var ct=function(){function e(e){this.bytes=e}e.fromString=function(t){var r,n=!1,i=!1,o=!1,a=0,s=0,u=0,c=0,l=0,f=[0],d=0,_=0,p=0,h=0,E=0,g=0,m=[0,0],S=[0,0],v=0;if(t.length>=7e3)throw new TypeError(t+" not a valid Decimal128 string");var y=t.match(Ze),T=t.match(et),A=t.match(tt);if(!y&&!T&&!A||0===t.length)throw new TypeError(t+" not a valid Decimal128 string");if(y){var C=y[2],O=y[4],I=y[5],R=y[6];O&&void 0===R&&ut(t,"missing exponent power"),O&&void 0===C&&ut(t,"missing exponent base"),void 0===O&&(I||R)&&ut(t,"missing e before exponent")}if("+"!==t[v]&&"-"!==t[v]||(n="-"===t[v++]),!at(t[v])&&"."!==t[v]){if("i"===t[v]||"I"===t[v])return new e($e.from(n?nt:it));if("N"===t[v])return new e($e.from(rt))}for(;at(t[v])||"."===t[v];)"."!==t[v]?(d<34&&("0"!==t[v]||o)&&(o||(l=s),o=!0,f[_++]=parseInt(t[v],10),d+=1),o&&(u+=1),i&&(c+=1),s+=1,v+=1):(i&&ut(t,"contains multiple periods"),i=!0,v+=1);if(i&&!s)throw new TypeError(t+" not a valid Decimal128 string");if("e"===t[v]||"E"===t[v]){var N=t.substr(++v).match(ot);if(!N||!N[2])return new e($e.from(rt));E=parseInt(N[0],10),v+=N[0].length}if(t[v])return new e($e.from(rt));if(p=0,d){if(h=d-1,1!==(a=u))for(;"0"===t[l+a-1];)a-=1}else p=0,h=0,f[0]=0,u=1,d=1,a=0;for(E<=c&&c-E>16384?E=-6176:E-=c;E>6111;){if((h+=1)-p>34){if(f.join("").match(/^0+$/)){E=6111;break}ut(t,"overflow")}E-=1}for(;E<-6176||d<u;){if(0===h&&a<d){E=-6176,a=0;break}if(d<u?u-=1:h-=1,E<6111)E+=1;else{if(f.join("").match(/^0+$/)){E=6111;break}ut(t,"overflow")}}if(h-p+1<a){var w=s;i&&(l+=1,w+=1),n&&(l+=1,w+=1);var b=parseInt(t[l+h+1],10),D=0;if(b>=5&&(D=1,5===b))for(D=f[h]%2==1,g=l+h+2;g<w;g++)if(parseInt(t[g],10)){D=1;break}if(D)for(var L=h;L>=0;L--)if(++f[L]>9&&(f[L]=0,0===L)){if(!(E<6111))return new e($e.from(n?nt:it));E+=1,f[L]=1}}if(m=ne.fromNumber(0),S=ne.fromNumber(0),0===a)m=ne.fromNumber(0),S=ne.fromNumber(0);else if(h-p<17){var M=p;for(S=ne.fromNumber(f[M++]),m=new ne(0,0);M<=h;M++)S=(S=S.multiply(ne.fromNumber(10))).add(ne.fromNumber(f[M]))}else{var P=p;for(m=ne.fromNumber(f[P++]);P<=h-17;P++)m=(m=m.multiply(ne.fromNumber(10))).add(ne.fromNumber(f[P]));for(S=ne.fromNumber(f[P++]);P<=h;P++)S=(S=S.multiply(ne.fromNumber(10))).add(ne.fromNumber(f[P]))}var U=function(e,t){if(!e&&!t)return{high:ne.fromNumber(0),low:ne.fromNumber(0)};var r=e.shiftRightUnsigned(32),n=new ne(e.getLowBits(),0),i=t.shiftRightUnsigned(32),o=new ne(t.getLowBits(),0),a=r.multiply(i),s=r.multiply(o),u=n.multiply(i),c=n.multiply(o);return a=a.add(s.shiftRightUnsigned(32)),s=new ne(s.getLowBits(),0).add(u).add(c.shiftRightUnsigned(32)),{high:a=a.add(s.shiftRightUnsigned(32)),low:c=s.shiftLeft(32).add(new ne(c.getLowBits(),0))}}(m,ne.fromString("100000000000000000"));U.low=U.low.add(S),function(e,t){var r=e.high>>>0,n=t.high>>>0;return r<n||r===n&&e.low>>>0<t.low>>>0}(U.low,S)&&(U.high=U.high.add(ne.fromNumber(1))),r=E+6176;var B={low:ne.fromNumber(0),high:ne.fromNumber(0)};U.high.shiftRightUnsigned(49).and(ne.fromNumber(1)).equals(ne.fromNumber(1))?(B.high=B.high.or(ne.fromNumber(3).shiftLeft(61)),B.high=B.high.or(ne.fromNumber(r).and(ne.fromNumber(16383).shiftLeft(47))),B.high=B.high.or(U.high.and(ne.fromNumber(0x7fffffffffff)))):(B.high=B.high.or(ne.fromNumber(16383&r).shiftLeft(49)),B.high=B.high.or(U.high.and(ne.fromNumber(562949953421311)))),B.low=U.low,n&&(B.high=B.high.or(ne.fromString("9223372036854775808")));var x=$e.alloc(16);return v=0,x[v++]=255&B.low.low,x[v++]=B.low.low>>8&255,x[v++]=B.low.low>>16&255,x[v++]=B.low.low>>24&255,x[v++]=255&B.low.high,x[v++]=B.low.high>>8&255,x[v++]=B.low.high>>16&255,x[v++]=B.low.high>>24&255,x[v++]=255&B.high.low,x[v++]=B.high.low>>8&255,x[v++]=B.high.low>>16&255,x[v++]=B.high.low>>24&255,x[v++]=255&B.high.high,x[v++]=B.high.high>>8&255,x[v++]=B.high.high>>16&255,x[v++]=B.high.high>>24&255,new e(x)};return e.prototype.toString=function(){for(var e,t,r,n,i,o,a=0,s=new Array(36),u=0;u<s.length;u++)s[u]=0;var c,l,f,d,_,p=0,h=!1,E={parts:new Array(4)},g=[];p=0;var m=this.bytes;if(n=m[p++]|m[p++]<<8|m[p++]<<16|m[p++]<<24,r=m[p++]|m[p++]<<8|m[p++]<<16|m[p++]<<24,t=m[p++]|m[p++]<<8|m[p++]<<16|m[p++]<<24,e=m[p++]|m[p++]<<8|m[p++]<<16|m[p++]<<24,p=0,{low:new ne(n,r),high:new ne(t,e)}.high.lessThan(ne.ZERO)&&g.push("-"),(i=e>>26&31)>>3==3){if(30===i)return g.join("")+"Infinity";if(31===i)return"NaN";o=e>>15&16383,f=8+(e>>14&1)}else f=e>>14&7,o=e>>17&16383;if(c=o-6176,E.parts[0]=(16383&e)+((15&f)<<14),E.parts[1]=t,E.parts[2]=r,E.parts[3]=n,0===E.parts[0]&&0===E.parts[1]&&0===E.parts[2]&&0===E.parts[3])h=!0;else for(_=3;_>=0;_--){var S=0,v=st(E);if(E=v.quotient,S=v.rem.low)for(d=8;d>=0;d--)s[9*_+d]=S%10,S=Math.floor(S/10)}if(h)a=1,s[p]=0;else for(a=36;!s[p];)a-=1,p+=1;if((l=a-1+c)>=34||l<=-7||c>0){if(a>34)return g.push(0),c>0?g.push("E+"+c):c<0&&g.push("E"+c),g.join("");g.push(s[p++]),(a-=1)&&g.push(".");for(var y=0;y<a;y++)g.push(s[p++]);g.push("E"),l>0?g.push("+"+l):g.push(l)}else if(c>=0)for(var T=0;T<a;T++)g.push(s[p++]);else{var A=a+c;if(A>0)for(var C=0;C<A;C++)g.push(s[p++]);else g.push("0");for(g.push(".");A++<0;)g.push("0");for(var O=0;O<a-Math.max(A-1,0);O++)g.push(s[p++])}return g.join("")},e.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},e.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},e.fromExtendedJSON=function(t){return e.fromString(t.$numberDecimal)},Object.defineProperty(e.prototype,"_bsontype",{value:"Decimal128"}),e}(),lt=function(){function e(){ie(this,e)}return ae(e,[{key:"toExtendedJSON",value:function(){return{$minKey:1}}}],[{key:"fromExtendedJSON",value:function(){return new e}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"MinKey"}),e}(),ft=function(){function e(){ie(this,e)}return ae(e,[{key:"toExtendedJSON",value:function(){return{$maxKey:1}}}],[{key:"fromExtendedJSON",value:function(){return new e}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"MaxKey"}),e}(),dt=function(){function e(t,r,n,i){ie(this,e);var o=t.split(".");2===o.length&&(n=o.shift(),t=o.shift()),this.collection=t,this.oid=r,this.db=n,this.fields=i||{}}return ae(e,[{key:"toJSON",value:function(){var e=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return null!=this.db&&(e.$db=this.db),e}},{key:"toExtendedJSON",value:function(e){e=e||{};var t={$ref:this.collection,$id:this.oid};return e.legacy?t:(this.db&&(t.$db=this.db),t=Object.assign(t,this.fields))}}],[{key:"fromExtendedJSON",value:function(t){var r=Object.assign({},t);return["$ref","$id","$db"].forEach(function(e){return delete r[e]}),new e(t.$ref,t.$id,t.$db,r)}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"DBRef"}),Object.defineProperty(e.prototype,"namespace",{get:function(){return this.collection},set:function(e){this.collection=e},configurable:!1}),e}(),_t=(()=>re.Buffer)(),pt=function(){function e(r,n){if(ie(this,e),!(null==r||"string"==typeof r||_t.isBuffer(r)||r instanceof Uint8Array||Array.isArray(r)))throw new TypeError("only String, Buffer, Uint8Array or Array accepted");if(this.sub_type=null==n?t:n,this.position=0,null==r||r instanceof Number)void 0!==_t?this.buffer=_t.alloc(e.BUFFER_SIZE):"undefined"!=typeof Uint8Array?this.buffer=new Uint8Array(new ArrayBuffer(e.BUFFER_SIZE)):this.buffer=new Array(e.BUFFER_SIZE);else{if("string"==typeof r)if(void 0!==_t)this.buffer=_t.from(r);else{if("undefined"==typeof Uint8Array&&!Array.isArray(r))throw new TypeError("only String, Buffer, Uint8Array or Array accepted");this.buffer=function(e){for(var t="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(e.length)):new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(r)}else this.buffer=r;this.position=r.length}}ae(e,[{key:"put",value:function(t){if(null!=t.length&&"number"!=typeof t&&1!==t.length)throw new TypeError("only accepts single character String, Uint8Array or Array");if("number"!=typeof t&&t<0||t>255)throw new TypeError("only accepts number in a valid unsigned byte range 0-255");var n=null;if(n="string"==typeof t?t.charCodeAt(0):null!=t.length?t[0]:t,this.buffer.length>this.position)this.buffer[this.position++]=n;else if(void 0!==_t&&_t.isBuffer(this.buffer)){var i=_t.alloc(e.BUFFER_SIZE+this.buffer.length);this.buffer.copy(i,0,0,this.buffer.length),this.buffer=i,this.buffer[this.position++]=n}else{var o=null;o=r(this.buffer)?new Uint8Array(new ArrayBuffer(e.BUFFER_SIZE+this.buffer.length)):new Array(e.BUFFER_SIZE+this.buffer.length);for(var a=0;a<this.buffer.length;a++)o[a]=this.buffer[a];this.buffer=o,this.buffer[this.position++]=n}}},{key:"write",value:function(e,t){if(t="number"==typeof t?t:this.position,this.buffer.length<t+e.length){var n=null;if(void 0!==_t&&_t.isBuffer(this.buffer))n=_t.alloc(this.buffer.length+e.length),this.buffer.copy(n,0,0,this.buffer.length);else if(r(this.buffer)){n=new Uint8Array(new ArrayBuffer(this.buffer.length+e.length));for(var i=0;i<this.position;i++)n[i]=this.buffer[i]}this.buffer=n}if(void 0!==_t&&_t.isBuffer(e)&&_t.isBuffer(this.buffer))e.copy(this.buffer,t,0,e.length),this.position=t+e.length>this.position?t+e.length:this.position;else if(void 0!==_t&&"string"==typeof e&&_t.isBuffer(this.buffer))this.buffer.write(e,t,"binary"),this.position=t+e.length>this.position?t+e.length:this.position;else if(r(e)||Array.isArray(e)&&"string"!=typeof e){for(var o=0;o<e.length;o++)this.buffer[t++]=e[o];this.position=t>this.position?t:this.position}else if("string"==typeof e){for(var a=0;a<e.length;a++)this.buffer[t++]=e.charCodeAt(a);this.position=t>this.position?t:this.position}}},{key:"read",value:function(e,t){if(t=t&&t>0?t:this.position,this.buffer.slice)return this.buffer.slice(e,e+t);for(var r="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(t)):new Array(t),n=0;n<t;n++)r[n]=this.buffer[e++];return r}},{key:"value",value:function(e){if((e=null!=e&&e)&&void 0!==_t&&_t.isBuffer(this.buffer)&&this.buffer.length===this.position)return this.buffer;if(void 0!==_t&&_t.isBuffer(this.buffer))return e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(e){if(null!=this.buffer.slice)return this.buffer.slice(0,this.position);for(var t=r(this.buffer)?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),n=0;n<this.position;n++)t[n]=this.buffer[n];return t}return function(e,t,r){for(var n="",i=t;i<r;i++)n+=String.fromCharCode(e[i]);return n}(this.buffer,0,this.position)}},{key:"length",value:function(){return this.position}},{key:"toJSON",value:function(){return null!=this.buffer?this.buffer.toString("base64"):""}},{key:"toString",value:function(e){return null!=this.buffer?this.buffer.slice(0,this.position).toString(e):""}},{key:"toExtendedJSON",value:function(e){e=e||{};var t=_t.isBuffer(this.buffer)?this.buffer.toString("base64"):_t.from(this.buffer).toString("base64"),r=Number(this.sub_type).toString(16);return e.legacy?{$binary:t,$type:1===r.length?"0"+r:r}:{$binary:{base64:t,subType:1===r.length?"0"+r:r}}}}],[{key:"fromExtendedJSON",value:function(t,r){var n,i;return(r=r||{}).legacy?(i=t.$type?parseInt(t.$type,16):0,n=_t.from(t.$binary,"base64")):(i=t.$binary.subType?parseInt(t.$binary.subType,16):0,n=_t.from(t.$binary.base64,"base64")),new e(n,i)}}]);var t=0;function r(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)}return e.BUFFER_SIZE=256,e.SUBTYPE_DEFAULT=0,e.SUBTYPE_FUNCTION=1,e.SUBTYPE_BYTE_ARRAY=2,e.SUBTYPE_UUID_OLD=3,e.SUBTYPE_UUID=4,e.SUBTYPE_MD5=5,e.SUBTYPE_USER_DEFINED=128,Object.defineProperty(e.prototype,"_bsontype",{value:"Binary"}),e}(),ht={BSON_INT32_MAX:2147483647,BSON_INT32_MIN:-2147483648,BSON_INT64_MAX:Math.pow(2,63)-1,BSON_INT64_MIN:-Math.pow(2,63),JS_INT_MAX:9007199254740992,JS_INT_MIN:-9007199254740992,BSON_DATA_NUMBER:1,BSON_DATA_STRING:2,BSON_DATA_OBJECT:3,BSON_DATA_ARRAY:4,BSON_DATA_BINARY:5,BSON_DATA_UNDEFINED:6,BSON_DATA_OID:7,BSON_DATA_BOOLEAN:8,BSON_DATA_DATE:9,BSON_DATA_NULL:10,BSON_DATA_REGEXP:11,BSON_DATA_DBPOINTER:12,BSON_DATA_CODE:13,BSON_DATA_SYMBOL:14,BSON_DATA_CODE_W_SCOPE:15,BSON_DATA_INT:16,BSON_DATA_TIMESTAMP:17,BSON_DATA_LONG:18,BSON_DATA_DECIMAL128:19,BSON_DATA_MIN_KEY:255,BSON_DATA_MAX_KEY:127,BSON_BINARY_SUBTYPE_DEFAULT:0,BSON_BINARY_SUBTYPE_FUNCTION:1,BSON_BINARY_SUBTYPE_BYTE_ARRAY:2,BSON_BINARY_SUBTYPE_UUID:3,BSON_BINARY_SUBTYPE_MD5:4,BSON_BINARY_SUBTYPE_USER_DEFINED:128},Et={$oid:Ve,$binary:pt,$symbol:Xe,$numberInt:ze,$numberDecimal:ct,$numberDouble:se,$numberLong:ne,$minKey:lt,$maxKey:ft,$regex:Je,$regularExpression:Je,$timestamp:de};function gt(e,t){var r=this;return"boolean"==typeof(t=Object.assign({},{relaxed:!0,legacy:!1},t)).relaxed&&(t.strict=!t.relaxed),"boolean"==typeof t.strict&&(t.relaxed=!t.strict),JSON.parse(e,function(e,n){return function e(t,r,n,i){if("number"==typeof n){if(i.relaxed||i.legacy)return n;if(Math.floor(n)===n){if(n>=St&&n<=mt)return new ze(n);if(n>=yt&&n<=vt)return new ne.fromNumber(n)}return new se(n)}if(null==n||"object"!==ue(n))return n;if(n.$undefined)return null;for(var o=Object.keys(n).filter(function(e){return e.startsWith("$")&&null!=n[e]}),a=0;a<o.length;a++){var s=Et[o[a]];if(s)return s.fromExtendedJSON(n,i)}if(null!=n.$date){var u=n.$date,c=new Date;return i.legacy?"number"==typeof u?c.setTime(u):"string"==typeof u&&c.setTime(Date.parse(u)):"string"==typeof u?c.setTime(Date.parse(u)):ne.isLong(u)?c.setTime(u.toNumber()):"number"==typeof u&&i.relaxed&&c.setTime(u),c}if(null!=n.$code){var l=Object.assign({},n);return n.$scope&&(l.$scope=e(t,null,n.$scope)),Qe.fromExtendedJSON(n)}if(null!=n.$ref||null!=n.$dbPointer){var f=n.$ref?n:n.$dbPointer;if(f instanceof dt)return f;var d=!0;if(Object.keys(f).filter(function(e){return e.startsWith("$")}).forEach(function(e){-1===["$ref","$id","$db"].indexOf(e)&&(d=!1)}),d)return dt.fromExtendedJSON(f)}return n}(r,0,n,t)})}var mt=2147483647,St=-2147483648,vt=0x8000000000000000,yt=-0x8000000000000000;function Tt(e,t,r,n){null!=r&&"object"===ue(r)&&(n=r,r=0),null==t||"object"!==ue(t)||Array.isArray(t)||(n=t,t=null,r=0),n=Object.assign({},{relaxed:!0,legacy:!1},n);var i=Array.isArray(e)?At(e,n):Rt(e,n);return JSON.stringify(i,t,r)}function At(e,t){return e.map(function(e){return Ot(e,t)})}function Ct(e){var t=e.toISOString();return 0!==e.getUTCMilliseconds()?t:t.slice(0,-5)+"Z"}function Ot(e,t){if(Array.isArray(e))return At(e,t);if(void 0===e)return null;if(e instanceof Date){var r=e.getTime(),n=r>-1&&r<2534023188e5;return t.legacy?t.relaxed&&n?{$date:e.getTime()}:{$date:Ct(e)}:t.relaxed&&n?{$date:Ct(e)}:{$date:{$numberLong:e.getTime().toString()}}}if("number"==typeof e&&!t.relaxed){if(Math.floor(e)===e){var i=e>=yt&&e<=vt;if(e>=St&&e<=mt)return{$numberInt:e.toString()};if(i)return{$numberLong:e.toString()}}return{$numberDouble:e.toString()}}if(e instanceof RegExp){var o=e.flags;return void 0===o&&(o=e.toString().match(/[gimuy]*$/)[0]),new Je(e.source,o).toExtendedJSON(t)}return null!=e&&"object"===ue(e)?Rt(e,t):e}var It={Binary:function(e){return new pt(e.value(),e.subtype)},Code:function(e){return new Qe(e.code,e.scope)},DBRef:function(e){return new dt(e.collection||e.namespace,e.oid,e.db,e.fields)},Decimal128:function(e){return new ct(e.bytes)},Double:function(e){return new se(e.value)},Int32:function(e){return new ze(e.value)},Long:function(e){return ne.fromBits(null!=e.low?e.low:e.low_,null!=e.low?e.high:e.high_,null!=e.low?e.unsigned:e.unsigned_)},MaxKey:function(){return new ft},MinKey:function(){return new lt},ObjectID:function(e){return new Ve(e)},ObjectId:function(e){return new Ve(e)},BSONRegExp:function(e){return new Je(e.pattern,e.options)},Symbol:function(e){return new Xe(e.value)},Timestamp:function(e){return de.fromBits(e.low,e.high)}};function Rt(e,t){if(null==e||"object"!==ue(e))throw new Error("not an object instance");var r=e._bsontype;if(void 0===r){var n={};for(var i in e)n[i]=Ot(e[i],t);return n}if("string"==typeof r){var o=e;if("function"!=typeof o.toExtendedJSON){var a=It[r];if(!a)throw new TypeError("Unrecognized or invalid _bsontype: "+r);o=a(o)}return"Code"===r&&o.scope?o=new Qe(o.code,Ot(o.scope,t)):"DBRef"===r&&o.oid&&(o=new dt(o.collection,Ot(o.oid,t),o.db,o.fields)),o.toExtendedJSON(t)}throw new Error("_bsontype must be a string, but was: "+ue(r))}var Nt={parse:gt,deserialize:function(e,t){return t=t||{},gt(JSON.stringify(e),t)},serialize:function(e,t){return t=t||{},JSON.parse(Tt(e,t))},stringify:Tt};ht.JS_INT_MAX,ht.JS_INT_MIN;t.EJSON=Nt}).call(this,r(13),r(43).Buffer)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.decodeInternalDataType=t.encodeInternalDataType=t.isConversionRequired=t.mergeConditionAfterEncode=t.flattenObject=t.flattenQueryObject=void 0;var n=r(0),i=r(2),o=r(5),a=r(1),s=r(131);function u(e,t,r,s){var c=n.__assign({},e);for(var l in e)if(!/^\$/.test(l)){var f=e[l];if(f&&a.isObject(f)&&!t(f)){if(s.indexOf(f)>-1)throw new i.CloudSDKError({errCode:o.ERR_CODE.SDK_DATABASE_CIRCULAR_REFERENCE,errMsg:"Cannot convert circular structure to JSON"});var d=u(f,t,n.__spread(r,[l]),n.__spread(s,[f]));c[l]=d;var _=!1;for(var p in d)/^\$/.test(p)?_=!0:(c[l+"."+p]=d[p],delete c[l][p]);_||delete c[l]}}return c}function c(e){return a.isInternalObject(e)||a.isDate(e)||a.isRegExp(e)}t.flattenQueryObject=function(e){return u(e,c,[],[e])},t.flattenObject=function(e){return u(e,function(e){return!1},[],[e])},t.mergeConditionAfterEncode=function(e,t,r){for(var n in t[r]||delete e[r],t)e[n]?a.isArray(e[n])?e[n].push(t[n]):a.isObject(e[n])?a.isObject(t[n])?Object.assign(e[n],t[n]):(console.warn("unmergable condition, query is object but condition is "+a.getType(t)+", can only overwrite",t,r),e[n]=t[n]):(console.warn("to-merge query is of type "+a.getType(e)+", can only overwrite",e,t,r),e[n]=t[n]):e[n]=t[n]},t.isConversionRequired=c,t.encodeInternalDataType=function(e){return s.serialize(e)},t.decodeInternalDataType=function(e){return s.deserialize(e)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isMultiPolygonCoordinates=t.isPolygonCoordinates=t.isMultiLineStringCoordinates=t.isLineStringCoordinates=t.isMultiPointCoordinates=t.isPointCoordinates=t.isGeoJSONMultiPolygon=t.isGeoJSONPolygon=t.isGeoJSONMultiLineString=t.isGeoJSONLineString=t.isGeoJSONMultiPoint=t.isGeoJSONPoint=t.toGeoJSONMultiPolygon=t.toGeoJSONPolygon=t.toGeoJSONMultiLineString=t.toGeoJSONLineString=t.toGeoJSONMultiPoint=t.toGeoJSONPoint=t.toMultiPolygon=t.toPolygon=t.toMultiLineString=t.toLineString=t.toMultiPoint=t.toPoint=t.fromGeoJSON=void 0;var n=r(59),i=r(1),o=r(2);function a(e){return n.Point(e.coordinates[0],e.coordinates[1])}function s(e){return n.MultiPoint(e.coordinates.map(function(e){return n.Point(e[0],e[1])}))}function u(e){return n.LineString(e.coordinates.map(function(e){return n.Point(e[0],e[1])}))}function c(e){return n.MultiLineString(e.coordinates.map(function(e){return n.LineString(e.map(function(e){return n.Point(e[0],e[1])}))}))}function l(e){return n.Polygon(e.coordinates.map(function(e){return n.LineString(e.map(function(e){return n.Point(e[0],e[1])}))}))}function f(e){return n.MultiPolygon(e.coordinates.map(function(e){return n.Polygon(e.map(function(e){return n.LineString(e.map(function(e){return n.Point(e[0],e[1])}))}))}))}function d(e){return i.isArray(e)&&i.isNumber(e[0])&&i.isNumber(e[1])}function _(e){return i.isArray(e)&&e.every(d)}function p(e){return _(e)}function h(e){return i.isArray(e)&&e.every(p)}function E(e){return h(e)}function g(e){return i.isArray(e)&&e.every(E)}t.fromGeoJSON=function(e){switch(e.type){case"Point":return a(e);case"MultiPoint":return s(e);case"LineString":return u(e);case"MultiLineString":return c(e);case"Polygon":return l(e);case"MultiPolygon":return f(e);default:throw new o.CloudSDKError({errCode:-1,errMsg:"Invalid GeoJSON input"})}},t.toPoint=a,t.toMultiPoint=s,t.toLineString=u,t.toMultiLineString=c,t.toPolygon=l,t.toMultiPolygon=f,t.toGeoJSONPoint=function(e){return{type:"Point",coordinates:[e.longitude,e.latitude]}},t.toGeoJSONMultiPoint=function(e){return{type:"MultiPoint",coordinates:e.points.map(function(e){return[e.longitude,e.latitude]})}},t.toGeoJSONLineString=function(e){return{type:"LineString",coordinates:e.points.map(function(e){return[e.longitude,e.latitude]})}},t.toGeoJSONMultiLineString=function(e){return{type:"MultiLineString",coordinates:e.lines.map(function(e){return e.points.map(function(e){return[e.longitude,e.latitude]})})}},t.toGeoJSONPolygon=function(e){return{type:"Polygon",coordinates:e.lines.map(function(e){return e.points.map(function(e){return[e.longitude,e.latitude]})})}},t.toGeoJSONMultiPolygon=function(e){return{type:"MultiPolygon",coordinates:e.polygons.map(function(e){return e.lines.map(function(e){return e.points.map(function(e){return[e.longitude,e.latitude]})})})}},t.isGeoJSONPoint=function(e){return i.isObject(e)&&d(e.coordinates)},t.isGeoJSONMultiPoint=function(e){return i.isObject(e)&&_(e.coordinates)},t.isGeoJSONLineString=function(e){return i.isObject(e)&&p(e.coordinates)},t.isGeoJSONMultiLineString=function(e){return i.isObject(e)&&h(e.coordinates)},t.isGeoJSONPolygon=function(e){return i.isObject(e)&&E(e.coordinates)},t.isGeoJSONMultiPolygon=function(e){return i.isObject(e)&&g(e.coordinates)},t.isPointCoordinates=d,t.isMultiPointCoordinates=_,t.isLineStringCoordinates=p,t.isMultiLineStringCoordinates=h,t.isPolygonCoordinates=E,t.isMultiPolygonCoordinates=g},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getRealtimeConnectionSignature=t.runAggregate=t.countDocument=t.setDocument=t.updateDocument=t.queryDocument=t.removeDocument=t.addDocument=t.ORDER_DIRECTION=t._ID_TYPE=t.QUERY_TYPE=void 0;var n,i,o=r(0),a=r(3),s=r(1),u=r(8);!function(e){e[e.WHERE=0]="WHERE",e[e.DOC=1]="DOC"}(n=t.QUERY_TYPE||(t.QUERY_TYPE={})),function(e){e[e.STRING=1]="STRING",e[e.NUMBER=2]="NUMBER"}(i=t._ID_TYPE||(t._ID_TYPE={})),function(e){e[e.ASC=0]="ASC",e[e.DESC=1]="DESC"}(t.ORDER_DIRECTION||(t.ORDER_DIRECTION={})),t.addDocument=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,r,n,s,u,c,l,f,d,_;return o.__generator(this,function(o){switch(o.label){case 0:return t=e.env,r=e.collectionName,n=e.data,s=e.instanceContext,u=e.timing,c=JSON.stringify(n),a.assertStringLength({input:c,max:s.serviceContext.appConfig.docSizeLimit,name:"record",maxWording:(s.serviceContext.appConfig.docSizeLimit/1024).toFixed(0)+" KB"}),l={collection_name:r,data:c},f=JSON.stringify(l),u.tunnelStartTime=+new Date,[4,s.serviceContext.request({apiName:"tcbapi_db_adddocument",serviceName:s.serviceContext.name,serializedReqData:f,requireDataNotEmpty:!0,env:t||s.serviceContext.env})];case 1:return d=o.sent(),u.tunnelEndTime=+new Date,_=d.data,u.tunnelTimeNoCSNetCost=_.baseresponse.stat.qbase_cost_time,[2,{_id:_._id_type===i.NUMBER?_._id_number:_._id}]}})})},t.removeDocument=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,i,a,s,c,l,f,d,_,p,h;return o.__generator(this,function(o){switch(o.label){case 0:return t=e.collectionName,i=e.query,a=e.options,s=e.instanceContext,c=e.timing,l=e.env,f=u.isDevTools()?e.explain:void 0,d=a&&a.multi,_=JSON.stringify({collection_name:t,query:JSON.stringify(i),multi:d,query_type:d?n.WHERE:n.DOC,explain:f}),c.tunnelStartTime=+new Date,[4,s.serviceContext.request({apiName:"tcbapi_db_deletedocument",serviceName:s.serviceContext.name,serializedReqData:_,requireDataNotEmpty:!0,env:l||s.serviceContext.env})];case 1:return p=o.sent(),c.tunnelEndTime=+new Date,f?[2,r(17).EJSON.deserialize(p.data)]:(h=p.data,c.tunnelTimeNoCSNetCost=h.baseresponse.stat.qbase_cost_time,[2,{removed:h.deleted}])}})})},t.queryDocument=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,n,i,a,s,c,l,f,d,_,p,h,E,g;return o.__generator(this,function(o){switch(o.label){case 0:return t=e.env,n=e.collectionName,i=e.query,a=e.options,s=void 0===a?{}:a,c=e.instanceContext,l=e.timing,f=e.queryType,d=u.isDevTools()?e.explain:void 0,_={collection_name:n,query:JSON.stringify(i),query_type:f,explain:d},s.offset&&(_.offset=s.offset),s.limit&&(_.limit=s.limit),s.order&&(_.order=s.order),s.projection&&(_.projection=JSON.stringify(s.projection)),p=JSON.stringify(_),l.tunnelStartTime=+new Date,[4,c.serviceContext.request({apiName:"tcbapi_db_querydocument",serviceName:c.serviceContext.name,serializedReqData:p,requireDataNotEmpty:!0,env:t||c.serviceContext.env})];case 1:return h=o.sent(),l.tunnelEndTime=+new Date,d?[2,r(17).EJSON.deserialize(h.data)]:(E=h.data,l.tunnelTimeNoCSNetCost=E.baseresponse.stat.qbase_cost_time,g=E.data_list?JSON.parse(E.data_list):[],[2,{list:g=c.engine.Decoder.decode(g),offset:E.offset,limit:E.limit,total:E.total}])}})})},t.updateDocument=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,n,i,s,c,l,f,d,_,p,h,E,g,m,S;return o.__generator(this,function(o){switch(o.label){case 0:return t=e.env,n=e.collectionName,i=e.query,s=e.data,c=e.options,l=void 0===c?{}:c,f=e.instanceContext,d=e.timing,_=e.queryType,p=u.isDevTools()?e.explain:void 0,h=JSON.stringify(s),a.assertStringLength({input:h,max:f.serviceContext.appConfig.docSizeLimit,name:"update expression",maxWording:(f.serviceContext.appConfig.docSizeLimit/1024).toFixed(0)+" KB"}),(E={collection_name:n,query:JSON.stringify(i),data:h,query_type:_,explain:p}).multi=!1!==l.multi,E.merge=!1!==l.merge,l.upsert&&(E.upsert=l.upsert),g=JSON.stringify(E),d.tunnelStartTime=+new Date,[4,f.serviceContext.request({apiName:"tcbapi_db_updatedocument",serviceName:f.serviceContext.name,serializedReqData:g,requireDataNotEmpty:!0,env:t||f.serviceContext.env})];case 1:return m=o.sent(),d.tunnelEndTime=+new Date,p?[2,r(17).EJSON.deserialize(m.data)]:(S=m.data,d.tunnelTimeNoCSNetCost=S.baseresponse.stat.qbase_cost_time,[2,{updated:S.updated}])}})})},t.setDocument=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,r,n,u,c,l,f,d,_,p,h,E;return o.__generator(this,function(o){switch(o.label){case 0:return t=e.env,r=e.collectionName,n=e._id,u=e.data,e.options,c=e.instanceContext,l=e.timing,f=JSON.stringify(u),a.assertStringLength({input:f,max:c.serviceContext.appConfig.docSizeLimit,name:"record",maxWording:(c.serviceContext.appConfig.docSizeLimit/1024).toFixed(0)+" KB"}),d=s.isNumber(n),_={collection_name:r,_id_type:d?i.NUMBER:i.STRING,data:f},d?_._id_number=n:_._id=n,p=JSON.stringify(_),l.tunnelStartTime=+new Date,[4,c.serviceContext.request({apiName:"tcbapi_db_setdocument",serviceName:c.serviceContext.name,serializedReqData:p,requireDataNotEmpty:!0,env:t||c.serviceContext.env})];case 1:return h=o.sent(),l.tunnelEndTime=+new Date,E=h.data,l.tunnelTimeNoCSNetCost=E.baseresponse.stat.qbase_cost_time,[2,{_id:E._id_type===i.NUMBER?E._id_number:E._id,updated:E._id?0:1,created:E._id?1:0}]}})})},t.countDocument=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,i,a,s,c,l,f,d,_,p;return o.__generator(this,function(o){switch(o.label){case 0:return t=e.env,i=e.collectionName,a=e.query,s=e.instanceContext,c=e.timing,l=u.isDevTools()?e.explain:void 0,f={collection_name:i,query:JSON.stringify(a),query_type:n.WHERE,explain:l},d=JSON.stringify(f),c.tunnelStartTime=+new Date,[4,s.serviceContext.request({apiName:"tcbapi_db_countdocument",serviceName:s.serviceContext.name,serializedReqData:d,requireDataNotEmpty:!0,env:t||s.serviceContext.env})];case 1:return _=o.sent(),c.tunnelEndTime=+new Date,l?[2,r(17).EJSON.deserialize(_.data)]:(p=_.data,c.tunnelTimeNoCSNetCost=p.baseresponse.stat.qbase_cost_time,[2,{total:p.total}])}})})},t.runAggregate=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,n,i,a,s,c,l,f,d,_,p;return o.__generator(this,function(o){switch(o.label){case 0:return t=e.env,n=e.collectionName,i=e.stages,a=e.instanceContext,s=e.timing,c=u.isDevTools()?e.explain:void 0,l={collection_name:n,stages:i.map(function(e){for(var t in e)return{stage_key:t,stage_value:JSON.stringify(e[t])};throw new Error("empty encoded stage ("+JSON.stringify(e)+")")}),explain:c},f=JSON.stringify(l),s.tunnelStartTime=+new Date,[4,a.serviceContext.request({apiName:"tcbapi_db_aggregate",serviceName:a.serviceContext.name,serializedReqData:f,requireDataNotEmpty:!0,env:t||a.serviceContext.env})];case 1:return d=o.sent(),s.tunnelEndTime=+new Date,c?[2,r(17).EJSON.deserialize(d.data)]:(_=d.data,s.tunnelTimeNoCSNetCost=_.baseresponse.stat.qbase_cost_time,p=r(17).EJSON,[2,{list:JSON.parse(_.list).map(function(e){return p.parse(e)})}])}})})},t.getRealtimeConnectionSignature=function(e,t){return o.__awaiter(this,void 0,void 0,function(){var r,n;return o.__generator(this,function(i){switch(i.label){case 0:return[4,e.request({apiName:"tcbapi_db_get_realtime_connection",env:t||e.env,serviceName:e.name,serializedReqData:JSON.stringify({}),requireDataNotEmpty:!0})];case 1:return r=i.sent(),[2,{envId:(n=r.data).env_id,secretVersion:n.secret_version,signStr:n.sign_str,wsUrl:n.ws_url}]}})})}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.aggregateOperatorToString=t.operatorToString=t.AggregateOperatorMap=t.OperatorMap=void 0;var n=r(34),i=r(28),o=r(35),a=r(29);for(var s in t.OperatorMap={},t.AggregateOperatorMap={},n.QUERY_COMMANDS_LITERAL)t.OperatorMap[n.QUERY_COMMANDS_LITERAL[s]]="$"+n.QUERY_COMMANDS_LITERAL[s];for(var s in i.LOGIC_COMMANDS_LITERAL)t.OperatorMap[i.LOGIC_COMMANDS_LITERAL[s]]="$"+i.LOGIC_COMMANDS_LITERAL[s];for(var s in o.UPDATE_COMMANDS_LITERAL)t.OperatorMap[o.UPDATE_COMMANDS_LITERAL[s]]="$"+o.UPDATE_COMMANDS_LITERAL[s];for(var s in a.AGGREGATE_COMMANDS_LITERAL)t.AggregateOperatorMap[a.AGGREGATE_COMMANDS_LITERAL[s]]="$"+a.AGGREGATE_COMMANDS_LITERAL[s];t.OperatorMap[n.QUERY_COMMANDS_LITERAL.NEQ]="$ne",t.OperatorMap[o.UPDATE_COMMANDS_LITERAL.REMOVE]="$unset",t.OperatorMap[o.UPDATE_COMMANDS_LITERAL.SHIFT]="$pop",t.OperatorMap[o.UPDATE_COMMANDS_LITERAL.UNSHIFT]="$push",t.OperatorMap[n.QUERY_COMMANDS_LITERAL.GEO_NEAR]="$nearSphere",t.OperatorMap[n.QUERY_COMMANDS_LITERAL.GEO_WITHIN]="$geoWithin",t.OperatorMap[n.QUERY_COMMANDS_LITERAL.GEO_INTERSECTS]="$geoIntersects",t.operatorToString=function(e){return t.OperatorMap[e]||"$"+e.toLowerCase()},t.aggregateOperatorToString=function(e){return t.AggregateOperatorMap[e]||"$"+e.toLowerCase()}},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u,c=[],l=!1,f=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&_())}function _(){if(!l){var e=s(d);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function h(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new p(e,t)),1!==c.length||l||s(_)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=h,i.addListener=h,i.once=h,i.off=h,i.removeListener=h,i.removeAllListeners=h,i.emit=h,i.prependListener=h,i.prependOnceListener=h,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.API_NAME_V2=t.API_NAME=t.ResultStatus=t.SlowCallScene=t.SlowCallAction=void 0;var n=r(0),i=r(9),o=r(3),a=r(2),s=r(24),u=r(12),c=r(6),l=r(97),f=r(98),d=r(99),_=r(15),p=r(31),h=r(47),E=r(8);!function(e){e[e.CALL=1]="CALL",e[e.POLL=2]="POLL"}(t.SlowCallAction||(t.SlowCallAction={})),function(e){e[e.INITIATE_CALL=1]="INITIATE_CALL",e[e.NORMAL_POLL_RETRY=2]="NORMAL_POLL_RETRY",e[e.SYSTEM_ERROR_RETRY=3]="SYSTEM_ERROR_RETRY",e[e.TIMEOUT_RETRY=4]="TIMEOUT_RETRY"}(t.SlowCallScene||(t.SlowCallScene={})),function(e){e[e.PENDING=0]="PENDING",e[e.DONE=1]="DONE",e[e.TIMEOUT=2]="TIMEOUT"}(t.ResultStatus||(t.ResultStatus={})),t.API_NAME="cloud.callFunction",t.API_NAME_V2="cloud.callFunction_real_v2",t.default=function(e){var r,g,m;return function(e){var r=+new Date;o.assertType(e,"object");var n=u.shallowClone(e);return n.data||(n.data={}),n.context={tunnelTimeNoCSNetCost:0,funcName:e.name},n.context.apiStartTime=r,i.hasAPICallback(n)?function(e){s.wrapParamCallbacksWithTryCatch({apiName:t.API_NAME,param:e}),S(e).then(function(r){i.invokeSuccessCompleteCallbacks(t.API_NAME,e,r)}).catch(function(r){i.invokeFailCompleteCallbacks(t.API_NAME,e,r)})}(n):S(n)};function S(i){return n.__awaiter(this,void 0,void 0,function(){function s(){return 1===i.version}var u,S,v;return n.__generator(this,function(y){switch(y.label){case 0:return y.trys.push([0,5,6,7]),function(e){o.assertType(e,{name:"string"}),e.data&&o.assertType(e.data,"object"),e.config&&e.config.env&&o.assertType(e.config.env,"string")}(i),i.cdnMapPromise=p.collect(i.data),u=void 0,u=s()?(r||(r=f.default(e)),r)(i):(g||(g=d.default(e)),g)(i),E.isDevTools()&&(S=Date.now(),h.autoDevtoolsNetworkLog(u,function(){var t;return{url:"wx.cloud.callFunction."+i.name,headers:{Env:e.isInstance?e.env:(null===(t=i.config)||void 0===t?void 0:t.env)||e.env},reqBody:_.serialize(i.data),timestampMs:S,console:e.debug}})),[4,u];case 1:return[2,y.sent()];case 2:return[4,(m||(m=l.default(e)),m)(i)];case 3:return[2,y.sent()];case 4:return[3,7];case 5:throw v=y.sent(),a.returnAsFinalCloudSDKError(v,t.API_NAME);case 6:return c.reportAPISpeed(n.__assign(n.__assign({},i.context),{apiEndTime:+new Date,apiName:s()?t.API_NAME:t.API_NAME_V2})),[7];case 7:return[2]}})})}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.wrapParamCallbacksWithTryCatch=t.wrapWithTryCatch=t.tryCatch=void 0;var n=r(2),i=r(1),o=r(25);function a(e,t){void 0===t&&(t="");try{return e()}catch(e){if(n.isSDKError(e))return e.errMsg+=t,e;var r=(e?e.toString():"")+t;return new n.CloudSDKError({errMsg:r})}}t.tryCatch=a,t.wrapWithTryCatch=function(e,t){return void 0===t&&(t=""),function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return a(function(){return e.apply(e,r)},t)}},t.wrapParamCallbacksWithTryCatch=function(e){var t=e.param;t&&(t.success&&i.isFunction(t.success)&&(t.success=o.default.surroundThirdByTryCatch(t.success,"at api "+e.apiName+" success callback function")),t.fail&&i.isFunction(t.fail)&&(t.fail=o.default.surroundThirdByTryCatch(t.fail,"at api "+e.apiName+" fail callback function")),t.complete&&i.isFunction(t.complete)&&(t.complete=o.default.surroundThirdByTryCatch(t.complete,"at api "+e.apiName+" complete callback function")))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(24),o={fake:!0,surroundThirdByTryCatch:function(e,t){return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return i.tryCatch(function(){try{return e.apply(e,r)}catch(r){throw console.error(JSON.stringify(r)+"; "+t+"\n"+r.stack),console.error(e.toString()),r}},t)}},reportIDKey:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},reportIDKeyDirectly:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},reportKeyValue:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}},a=!1,s=10;function u(){try{return a?Reporter:s<=0?n:(s--,Reporter.surroundThirdByTryCatch,n=Reporter,a=!0,n)}catch(e){return n=o}}t.default={surroundThirdByTryCatch:function(e,t){return u().surroundThirdByTryCatch(e,t)},reportIDKey:function(e){return u().reportIDKey(e)},reportIDKeyDirectly:function(e){return u().reportIDKeyDirectly(e)},reportKeyValue:function(e){return u().reportKeyValue(e)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.keepAlive=t.getCloudServiceURL=t.ServiceEndpoint=void 0;var n=r(0),i=r(38),o=r(164),a=r(4),s=r(6),u=r(6),c=r(11),l=/https:\/\/servicewechat\.com/,f={},d={},_={},p=Math.random()+"_"+Date.now(),h="servicewechat.com",E=!1,g=function(){function e(e){this.identifiers=e}return e.prototype.setMetaData=function(e){this._meta=e},e.prototype.setTunnelRequest=function(e){this._tunnelRequest=e},e.prototype.getEndpointSync=function(e){var t=f[e];if("container"===e){if((null===t||void 0===t?void 0:t.url)&&(null===t||void 0===t?void 0:t.expiresTs)&&Date.now()<t.expiresTs)return t;this.getEndpoint(e)}},e.prototype.getEndpoint=function(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(r){return t=f[e],"container"===e?(null===t||void 0===t?void 0:t.url)&&(null===t||void 0===t?void 0:t.expiresTs)&&Date.now()<t.expiresTs?[2,t]:[2,this.refreshContainerServiceEndpoint()]:[2,null]})})},e.prototype.refreshContainerServiceEndpoint=function(){return n.__awaiter(this,void 0,void 0,function(){var e=this;return n.__generator(this,function(r){return d.container?[2,d.container]:(clearTimeout(_.container),d.container=new Promise(function(r,o){return n.__awaiter(e,void 0,void 0,function(){var e,u,l,g,v,y,T,A,C,O,I,R,N,w,b=this;return n.__generator(this,function(D){switch(D.label){case 0:return!a.getSDK().private_getBackgroundFetchData||E?[3,2]:(E=!0,[4,c.privateGetBackgroundFetchData(500,this.identifiers)]);case 1:if((e=D.sent())&&e.expiresTs>Date.now()&&e.url_info)return f.container={url:(null===(I=e.url_info)||void 0===I?void 0:I.cloudrun_url)?e.url_info.cloudrun_url+"?token="+e.token:"https://"+e.domain+"/wxa-qbase/container_service?token="+e.token,cloudServiceUrl:(null===(R=e.url_info)||void 0===R?void 0:R.cloudbase_url)?e.url_info.cloudbase_url+"?token="+e.token:void 0,domain:e.domain||"servicewechat.com",token:e.token,http:!0,key:e.key,timestamp:e.timestamp,expiresTs:e.expiresTs},r(f.container),[2];D.label=2;case 2:u=[],l=0,D.label=3;case 3:if(!(l<3))return[3,11];D.label=4;case 4:return D.trys.push([4,9,,10]),g=Date.now(),v=c.getSystemInfo(),this._tunnelRequest?[4,this._tunnelRequest({apiName:"tcbapi_get_service_info",serializedReqData:JSON.stringify({client_random:p,system:v.system,wx_app_version:v.version})})]:[3,6];case 5:return y=D.sent(),[3,8];case 6:return[4,i.default({apiName:"qbase_commapi",data:{qbase_api_name:"tcbapi_get_service_info",qbase_req:JSON.stringify({client_random:p,system:v.system,wx_app_version:v.version}),qbase_options:{},qbase_meta:this._meta,cli_req_id:+new Date+"_"+Math.random()}})];case 7:y=D.sent(),D.label=8;case 8:return T=y.data,Date.now()-g>1e3*T.expires_in?(u.push("result already expired (startTs "+g+" resultTs "+Date.now()+")"),[3,10]):(A=Date.now()+1e3*T.expires_in-(Date.now()-g),C=T.domain||"servicewechat.com",f.container={url:(null===(N=T.url_info)||void 0===N?void 0:N.cloudrun_url)?T.url_info.cloudrun_url+"?token="+T.token:"https://"+C+"/wxa-qbase/container_service?token="+T.token,cloudServiceUrl:(null===(w=T.url_info)||void 0===w?void 0:w.cloudbase_url)?T.url_info.cloudbase_url+"?token="+T.token:void 0,domain:C,token:T.token,http:T.http,key:T.key,timestamp:T.timestamp,ip:T.ip,vip:T.vip,expiresTs:A},r(f.container),delete d.container,s.setReportToken(T.token),h=f.container.domain||"servicewechat.com",function(){var e;n.__awaiter(this,void 0,void 0,function(){var r,i,o=this;return n.__generator(this,function(s){return m?[2]:(m=!0,(r=function(){m&&setTimeout(function(){return n.__awaiter(o,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return[4,t.keepAlive()];case 1:return e.sent(),r(),[2]}})})},2e4)})(),S||(S=!0,i=a.getSDK(),(null===(e=i.wx)||void 0===e?void 0:e.onAppHide)&&i.wx.onAppHide(function(){m=!1})),[2,t.keepAlive()])})})}(),clearTimeout(_.container),_.container=setTimeout(function(){b.refreshContainerServiceEndpoint()},.8*(A-Date.now())),[2]);case 9:return O=D.sent(),u.push(O+""),[3,10];case 10:return l++,[3,3];case 11:return o("get container service endpoints errors: "+u.join("\n")),delete d.container,[2]}})})}),[2,d.container])})})},e.invalidateService=function(e){delete f[e]},e}();t.ServiceEndpoint=g,t.getCloudServiceURL=function(e){var t=f.container;if(t&&t.cloudServiceUrl)return e.rdm?t.cloudServiceUrl.replace(l,"https://wxardm.weixin.qq.com"):t.cloudServiceUrl};var m=!1,S=!1,v=0;t.keepAlive=o.default(function(){return new Promise(function(e){var t=Date.now(),r=!/^\d+/.test(h);a.getSDK()._requestSkipCheckDomain({url:(r?"https":"http")+"://"+h+"/wxa-qbase/keepalive",header:r?{}:{host:"servicewechat.com"},method:"GET",dataType:"text",enableHttp2:r,success:function(){e(),v++%4==0&&u.reportMMData(22990,1,["privateHttpKeepAlive",h,t,Date.now(),Date.now()-t].join(","))},fail:function(){e()}})})},2e4)},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SYMBOL_CDN=t.SYMBOL_CLOUD_ID=void 0,t.SYMBOL_CLOUD_ID=Symbol.for("CLOUD_ID"),t.SYMBOL_CDN=Symbol("CDN")},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isKnownLogicCommand=t.isLogicCommand=t.LogicCommmand=t.logicCommandsSet=t.LOGIC_COMMANDS_LITERAL=void 0;var n,i=r(0),o=r(7),a=r(3),s=r(1);!function(e){e.AND="and",e.OR="or",e.NOT="not",e.NOR="nor"}(n=t.LOGIC_COMMANDS_LITERAL||(t.LOGIC_COMMANDS_LITERAL={}));var u=[n.AND,n.OR,n.NOT,n.NOR];t.logicCommandsSet=new Set(u);var c=function(){function e(e,t,r){this._internalType=o.SYMBOL_LOGIC_COMMAND,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=r||o.SYMBOL_UNSET_FIELD_NAME}return e.prototype._setFieldName=function(t){var r=this.operands.map(function(e){return e===n.AND||e===n.OR?e._setFieldName(t):e});return new e(this.operator,r,t)},e.prototype.and=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];a.assertRequiredParam(arguments[0],"expressions","and");var o=s.isArray(arguments[0])?arguments[0]:Array.from(arguments);return new e(n.AND,i.__spread([this],o),this.fieldName)},e.prototype.or=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];a.assertRequiredParam(arguments[0],"expressions","or");var o=s.isArray(arguments[0])?arguments[0]:Array.from(arguments);return new e(n.OR,i.__spread([this],o),this.fieldName)},e.prototype.nor=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];a.assertRequiredParam(arguments[0],"expressions","nor");var o=s.isArray(arguments[0])?arguments[0]:Array.from(arguments);return new e(n.NOR,i.__spread([this],o),this.fieldName)},e.prototype.not=function(t){return a.assertRequiredParam(t,"expression","not"),new e(n.NOT,[t],this.fieldName)},e.prototype.toJSON=function(){},e}();function l(e){return e&&e instanceof c&&e._internalType===o.SYMBOL_LOGIC_COMMAND}t.LogicCommmand=c,t.isLogicCommand=l,t.isKnownLogicCommand=function(e){return l(e)&&t.logicCommandsSet.has(e.operator)},t.default=c},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isKnownAggregateCommand=t.isAggregateCommand=t.AggregateCommand=t.ZIP=t.YEAR=t.WEEK=t.TYPE=t.TRUNC=t.TRIM=t.TOUPPER=t.TOLOWER=t.TOSTRING=t.TOOBJECTID=t.TOLONG=t.TOINT=t.TODOUBLE=t.TODECIMAL=t.TODATE=t.TOBOOL=t.SWITCH=t.SUM=t.SUBTRACT=t.SUBSTRCP=t.SUBSTRBYTES=t.SUBSTR=t.STRLENCP=t.STRLENBYTES=t.STRCASECMP=t.STDDEVSAMP=t.STDDEVPOP=t.SQRT=t.SPLIT=t.SLICE=t.SIZE=t.SETUNION=t.SETISSUBSET=t.SETINTERSECTION=t.SETEQUALS=t.SETDIFFERENCE=t.SECOND=t.RTRIM=t.REVERSEARRAY=t.REDUCE=t.RANGE=t.PUSH=t.POW=t.OR=t.OBJECTTOARRAY=t.NOT=t.NEQ=t.MULTIPLY=t.MONTH=t.MOD=t.MINUTE=t.MILLISECOND=t.MIN=t.META=t.MERGEOBJECTS=t.MAX=t.MAP=t.LTRIM=t.LTE=t.LT=t.LOG10=t.LOG=t.LN=t.LITERAL=t.LET=t.LAST=t.ISOWEEKYEAR=t.ISOWEEK=t.ISODAYOFWEEK=t.ISARRAY=t.INDEXOFCP=t.INDEXOFBYTES=t.INDEXOFARRAY=t.IN=t.IFNULL=t.HOUR=t.GTE=t.GT=t.FLOOR=t.FIRST=t.FILTER=t.EXP=t.EQ=t.DIVIDE=t.DAYOFYEAR=t.DAYOFWEEK=t.DAYOFMONTH=t.DATETOSTRING=t.DATEFROMSTRING=t.DATETOPARTS=t.DATEFROMPARTS=t.CONVERT=t.COND=t.CONCATARRAYS=t.CONCAT=t.CMP=t.CEIL=t.AVG=t.ARRAYTOOBJECT=t.ARRAYELEMAT=t.ANYELEMENTTRUE=t.AND=t.ALLELEMENTSTRUE=t.ADDTOSET=t.ADD=t.ABS=t.AGGREGATE_COMMANDS_LITERAL=void 0;var n,i=r(7);!function(e){e.ABS="abs",e.ADD="add",e.ADDTOSET="addToSet",e.ALLELEMENTSTRUE="allElementsTrue",e.AND="and",e.ANYELEMENTTRUE="anyElementTrue",e.ARRAYELEMAT="arrayElemAt",e.ARRAYTOOBJECT="arrayToObject",e.AVG="avg",e.CEIL="ceil",e.CMP="cmp",e.CONCAT="concat",e.CONCATARRAYS="concatArrays",e.COND="cond",e.CONVERT="convert",e.DATEFROMPARTS="dateFromParts",e.DATETOPARTS="dateToParts",e.DATEFROMSTRING="dateFromString",e.DATETOSTRING="dateToString",e.DAYOFMONTH="dayOfMonth",e.DAYOFWEEK="dayOfWeek",e.DAYOFYEAR="dayOfYear",e.DIVIDE="divide",e.EQ="eq",e.EXP="exp",e.FILTER="filter",e.FIRST="first",e.FLOOR="floor",e.GT="gt",e.GTE="gte",e.HOUR="hour",e.IFNULL="ifNull",e.IN="in",e.INDEXOFARRAY="indexOfArray",e.INDEXOFBYTES="indexOfBytes",e.INDEXOFCP="indexOfCP",e.ISARRAY="isArray",e.ISODAYOFWEEK="isoDayOfWeek",e.ISOWEEK="isoWeek",e.ISOWEEKYEAR="isoWeekYear",e.LAST="last",e.LET="let",e.LITERAL="literal",e.LN="ln",e.LOG="log",e.LOG10="log10",e.LT="lt",e.LTE="lte",e.LTRIM="ltrim",e.MAP="map",e.MAX="max",e.MERGEOBJECTS="mergeObjects",e.META="meta",e.MIN="min",e.MILLISECOND="millisecond",e.MINUTE="minute",e.MOD="mod",e.MONTH="month",e.MULTIPLY="multiply",e.NEQ="ne",e.NOT="not",e.OBJECTTOARRAY="objectToArray",e.OR="or",e.POW="pow",e.PUSH="push",e.RANGE="range",e.REDUCE="reduce",e.REVERSEARRAY="reverseArray",e.RTRIM="rtrim",e.SECOND="second",e.SETDIFFERENCE="setDifference",e.SETEQUALS="setEquals",e.SETINTERSECTION="setIntersection",e.SETISSUBSET="setIsSubset",e.SETUNION="setUnion",e.SIZE="size",e.SLICE="slice",e.SPLIT="split",e.SQRT="sqrt",e.STDDEVPOP="stdDevPop",e.STDDEVSAMP="stdDevSamp",e.STRCASECMP="strcasecmp",e.STRLENBYTES="strLenBytes",e.STRLENCP="strLenCP",e.SUBSTR="substr",e.SUBSTRBYTES="substrBytes",e.SUBSTRCP="substrCP",e.SUBTRACT="subtract",e.SUM="sum",e.SWITCH="switch",e.TOBOOL="toBool",e.TODATE="toDate",e.TODECIMAL="toDecimal",e.TODOUBLE="toDouble",e.TOINT="toInt",e.TOLONG="toLong",e.TOOBJECTID="toObjectId",e.TOSTRING="toString",e.TOLOWER="toLower",e.TOUPPER="toUpper",e.TRIM="trim",e.TRUNC="trunc",e.TYPE="type",e.WEEK="week",e.YEAR="year",e.ZIP="zip"}(n=t.AGGREGATE_COMMANDS_LITERAL||(t.AGGREGATE_COMMANDS_LITERAL={})),t.ABS=n.ABS,t.ADD=n.ADD,t.ADDTOSET=n.ADDTOSET,t.ALLELEMENTSTRUE=n.ALLELEMENTSTRUE,t.AND=n.AND,t.ANYELEMENTTRUE=n.ANYELEMENTTRUE,t.ARRAYELEMAT=n.ARRAYELEMAT,t.ARRAYTOOBJECT=n.ARRAYTOOBJECT,t.AVG=n.AVG,t.CEIL=n.CEIL,t.CMP=n.CMP,t.CONCAT=n.CONCAT,t.CONCATARRAYS=n.CONCATARRAYS,t.COND=n.COND,t.CONVERT=n.CONVERT,t.DATEFROMPARTS=n.DATEFROMPARTS,t.DATETOPARTS=n.DATETOPARTS,t.DATEFROMSTRING=n.DATEFROMSTRING,t.DATETOSTRING=n.DATETOSTRING,t.DAYOFMONTH=n.DAYOFMONTH,t.DAYOFWEEK=n.DAYOFWEEK,t.DAYOFYEAR=n.DAYOFYEAR,t.DIVIDE=n.DIVIDE,t.EQ=n.EQ,t.EXP=n.EXP,t.FILTER=n.FILTER,t.FIRST=n.FIRST,t.FLOOR=n.FLOOR,t.GT=n.GT,t.GTE=n.GTE,t.HOUR=n.HOUR,t.IFNULL=n.IFNULL,t.IN=n.IN,t.INDEXOFARRAY=n.INDEXOFARRAY,t.INDEXOFBYTES=n.INDEXOFBYTES,t.INDEXOFCP=n.INDEXOFCP,t.ISARRAY=n.ISARRAY,t.ISODAYOFWEEK=n.ISODAYOFWEEK,t.ISOWEEK=n.ISOWEEK,t.ISOWEEKYEAR=n.ISOWEEKYEAR,t.LAST=n.LAST,t.LET=n.LET,t.LITERAL=n.LITERAL,t.LN=n.LN,t.LOG=n.LOG,t.LOG10=n.LOG10,t.LT=n.LT,t.LTE=n.LTE,t.LTRIM=n.LTRIM,t.MAP=n.MAP,t.MAX=n.MAX,t.MERGEOBJECTS=n.MERGEOBJECTS,t.META=n.META,t.MIN=n.MIN,t.MILLISECOND=n.MILLISECOND,t.MINUTE=n.MINUTE,t.MOD=n.MOD,t.MONTH=n.MONTH,t.MULTIPLY=n.MULTIPLY,t.NEQ=n.NEQ,t.NOT=n.NOT,t.OBJECTTOARRAY=n.OBJECTTOARRAY,t.OR=n.OR,t.POW=n.POW,t.PUSH=n.PUSH,t.RANGE=n.RANGE,t.REDUCE=n.REDUCE,t.REVERSEARRAY=n.REVERSEARRAY,t.RTRIM=n.RTRIM,t.SECOND=n.SECOND,t.SETDIFFERENCE=n.SETDIFFERENCE,t.SETEQUALS=n.SETEQUALS,t.SETINTERSECTION=n.SETINTERSECTION,t.SETISSUBSET=n.SETISSUBSET,t.SETUNION=n.SETUNION,t.SIZE=n.SIZE,t.SLICE=n.SLICE,t.SPLIT=n.SPLIT,t.SQRT=n.SQRT,t.STDDEVPOP=n.STDDEVPOP,t.STDDEVSAMP=n.STDDEVSAMP,t.STRCASECMP=n.STRCASECMP,t.STRLENBYTES=n.STRLENBYTES,t.STRLENCP=n.STRLENCP,t.SUBSTR=n.SUBSTR,t.SUBSTRBYTES=n.SUBSTRBYTES,t.SUBSTRCP=n.SUBSTRCP,t.SUBTRACT=n.SUBTRACT,t.SUM=n.SUM,t.SWITCH=n.SWITCH,t.TOBOOL=n.TOBOOL,t.TODATE=n.TODATE,t.TODECIMAL=n.TODECIMAL,t.TODOUBLE=n.TODOUBLE,t.TOINT=n.TOINT,t.TOLONG=n.TOLONG,t.TOOBJECTID=n.TOOBJECTID,t.TOSTRING=n.TOSTRING,t.TOLOWER=n.TOLOWER,t.TOUPPER=n.TOUPPER,t.TRIM=n.TRIM,t.TRUNC=n.TRUNC,t.TYPE=n.TYPE,t.WEEK=n.WEEK,t.YEAR=n.YEAR,t.ZIP=n.ZIP;var o=function(){function e(e,t,r){this._internalType=i.SYMBOL_AGGREGATE_COMMAND,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=r||i.SYMBOL_UNSET_FIELD_NAME}return e.prototype._setFieldName=function(t){return new e(this.operator,this.operands,t)},e}();function a(e){return e&&e instanceof o&&e._internalType===i.SYMBOL_AGGREGATE_COMMAND}t.AggregateCommand=o,t.isAggregateCommand=a,t.isKnownAggregateCommand=function(e){return a(e)&&e.operator.toUpperCase()in n},t.default=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isPipelineStage=t.isPipeline=t.isAggregate=t.Pipeline=t.getAggregateClass=void 0;var n=r(0),i=r(7),o=r(9),a=r(10),s=r(2),u=r(6),c=r(20),l=r(8);t.getAggregateClass=function(e){return function(t){function r(e,r){var n=t.call(this,r)||this;return n._internalType=i.SYMBOL_AGGREGATE,n.collection=e,n}return n.__extends(r,t),r.prototype.pushStage=function(e,t){return new r(this.collection,n.__spread(this._stages,[new f(e,t)]))},r.prototype.end=function(t){var r=this;void 0===t&&(t={});var i="collection.aggregate",f={apiStartTime:+new Date};var d=o.hasAPICallback(t),_=new Promise(function(o,d){return n.__awaiter(r,void 0,void 0,function(){var _,p;return n.__generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,3,4]),[4,c.runAggregate({env:e.database.config.env,collectionName:r.collection.collectionName,stages:e.engine.AggregateSerializer.encodeStages(r._stages),instanceContext:e,timing:f,explain:t.explain})];case 1:return _=h.sent(),t.explain&&l.isDevTools()?[2,o(_)]:(o({list:_.list,errMsg:a.apiSuccessMsg(i)}),[3,4]);case 2:return p=h.sent(),d(s.returnAsFinalCloudSDKError(p,i)),[3,4];case 3:return u.reportAPISpeed(n.__assign(n.__assign({},f),{apiEndTime:+new Date,apiName:"cloud.db."+i})),[7];case 4:return[2]}})})});if(!d)return _;_.then(function(e){o.invokeSuccessCompleteCallbacks(i,t,e)}).catch(function(e){o.invokeFailCompleteCallbacks(i,t,e)})},r}(d)};var f=function(){return function(e,t){this._internalType=i.SYMBOL_AGGREGATE_PIPELINE_STAGE,this.stage=e,this.val=t}}(),d=function(){function e(e){this._internalType=i.SYMBOL_AGGREGATE_PIPELINE,this._stages=e}return e.prototype.pushStage=function(t,r){return new e(n.__spread(this._stages,[new f(t,r)]))},e.prototype.addFields=function(e){return this.pushStage("addFields",e)},e.prototype.bucket=function(e){return this.pushStage("bucket",e)},e.prototype.bucketAuto=function(e){return this.pushStage("bucketAuto",e)},e.prototype.collStats=function(e){return this.pushStage("collStats",e)},e.prototype.count=function(e){return this.pushStage("count",e)},e.prototype.facet=function(e){return this.pushStage("facet",e)},e.prototype.geoNear=function(e){return this.pushStage("geoNear",e)},e.prototype.graphLookup=function(e){return this.pushStage("graphLookup",e)},e.prototype.group=function(e){return this.pushStage("group",e)},e.prototype.indexStats=function(){return this.pushStage("indexStats",{})},e.prototype.limit=function(e){return this.pushStage("limit",e)},e.prototype.lookup=function(e){return this.pushStage("lookup",e)},e.prototype.match=function(e){return this.pushStage("match",e)},e.prototype.out=function(e){return this.pushStage("out",e)},e.prototype.project=function(e){return this.pushStage("project",e)},e.prototype.redact=function(e){return this.pushStage("redact",e)},e.prototype.replaceRoot=function(e){return this.pushStage("replaceRoot",e)},e.prototype.sample=function(e){return this.pushStage("sample",e)},e.prototype.skip=function(e){return this.pushStage("skip",e)},e.prototype.sort=function(e){return this.pushStage("sort",e)},e.prototype.sortByCount=function(e){return this.pushStage("sortByCount",e)},e.prototype.unwind=function(e){return this.pushStage("unwind",e)},e.prototype.end=function(){},e}(),_=function(e){function t(t,r){void 0===r&&(r=!1);var n=e.call(this,t)||this;return n._sealed=r,n}return n.__extends(t,e),t.prototype.pushStage=function(e,r){if(this._sealed)throw new Error("pushing new stage is not allowed after calling 'done()'");return new t(n.__spread(this._stages,[new f(e,r)]))},t.prototype.done=function(){return new t(this._stages,!0)},t}(d);t.Pipeline=_,t.isAggregate=function(e){return e&&e._internalType===i.SYMBOL_AGGREGATE},t.isPipeline=function(e){return e&&e._internalType===i.SYMBOL_AGGREGATE_PIPELINE},t.isPipelineStage=function(e){return e&&e._internalType===i.SYMBOL_AGGREGATE_PIPELINE_STAGE}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.uploadToCommonCDN=t.populateAndSerialize=t.collect=void 0;var n=r(0),i=r(27),o=r(1),a=r(4);function s(e){var t=new WeakMap,r=[];if(e&&(JSON.stringify(e,function(e,n){return n&&n._internalType===i.SYMBOL_CDN?void r.push(new Promise(function(e,r){var i={appType:301,fileType:20303,fileKey:"file_"+Math.random()},a=n;switch(o.getType(a.target)){case"object":if(!a.target.filePath)throw new Error("filePath must be provided");i.filePath=a.target.filePath;break;default:i.fileData=a.target}e(u(i).then(function(e){t.set(n,e.fileUrl)}))})):n}),r.length))return Promise.all(r).then(function(){return t})}function u(e){return new Promise(function(t,r){var i=n.__assign(n.__assign({},e),{appType:e.appType||301,fileType:e.fileType||20303,fileKey:e.fileKey||"file_"+Math.random()});a.getSDK().uploadToCommonCDN(n.__assign(n.__assign({},i),{success:t,fail:r}))})}t.collect=s,t.populateAndSerialize=function(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(r){switch(r.label){case 0:return e?[4,s(e)]:[3,2];case 1:return t=r.sent(),[2,JSON.stringify(e,function(e,r){return r&&r.symbol===i.SYMBOL_CDN&&(null===t||void 0===t?void 0:t.has(r))?t.get(r):r})];case 2:return[2,JSON.stringify(e)]}})})},t.uploadToCommonCDN=u},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);r(50),n.__exportStar(r(50),t),n.__exportStar(r(52),t),n.__exportStar(r(33),t),n.__exportStar(r(53),t)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getBoundAuthRequest=t.sendRequest=t.request=void 0;var n=r(0),i=r(16),o=r(51);function a(e){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(r){return[2,new Promise(function(r,i){0===e.url.indexOf("/")&&(e.url=e.identityless?"https://servicewechat.com/wxa-qbase"+e.url:location.protocol+"//"+location.host+"/__wx__"+e.url);var a=t.request(n.__assign(n.__assign({},e),{dataType:"json",data:JSON.stringify(e.json),success:function(e){if(200===e.statusCode){var t=e.data;t.base_resp?0===t.base_resp.ret?r(e):i(o.getSDKError(t.base_resp.ret,"errCode "+t.base_resp.ret+". body "+JSON.stringify(e.data))):i(o.getSDKError(-104,"[system error] lack of base_resp. body "+JSON.stringify(e.data)))}else i(o.getSDKError(-103,"statusCode "+e.statusCode+" body "+JSON.stringify(e.data)))},fail:function(e){i(e)}}));e.onRequestTaskReady&&a&&e.onRequestTaskReady(a)})]})})}t.request=function(e){var t=e.url,r=e.data,n=e.dataType,o=e.header,a=e.responseType,s=e.method||"POST",u=new XMLHttpRequest;u.withCredentials=!0,u.responseType=a||"text",u.timeout=6e4,u.open(s,t,!0),u.onreadystatechange=function(){if(4===u.readyState){u.onreadystatechange=null;var t=u.status;if(0===t);else{var r={errMsg:"request:ok",header:i.formatHeader(u),statusCode:t};if(r.data="arraybuffer"===a?u.response:u.responseText,"json"===n)try{r.data=JSON.parse(r.data)}catch(t){return r.errMsg="request:fail JSON parse response body error: "+t,void i.callbackFailComplete(e,r)}i.callbackSuccessComplete(e,r)}}},u.onerror=function(t){i.callbackFailComplete(e,{errMsg:"request:fail "+u.status+" "+u.statusText+" "+t})},u.ontimeout=function(){i.callbackFailComplete(e,{errMsg:"request:fail timeout"})},u.onabort=function(){i.callbackFailComplete(e,{errMsg:"request:fail abort"})};var c=o||{};for(var l in c["Content-Type"]||"json"!==n||(c["Content-Type"]="application/json"),c)if(c.hasOwnProperty(l))try{u.setRequestHeader(l,c[l])}catch(t){return void i.callbackFailComplete(e,{errMsg:"request:fail Failed to execute 'setRequestHeader' â€¦XMLHttpRequest': Value is not a valid ByteString."})}try{u.send(r)}catch(t){i.callbackFailComplete(e,{errMsg:"request:fail "+t})}return{abort:function(){try{u.abort(),i.callbackSuccessComplete(e,{errMsg:"request:ok"})}catch(t){i.callbackFailComplete(e,{errMsg:"request:fail abort"})}}}},t.sendRequest=a,t.getBoundAuthRequest=function(e){return function t(r){var i=this;return new Promise(function(s,u){return n.__awaiter(i,void 0,void 0,function(){var i,c,l,f,d,_,p,h;return n.__generator(this,function(E){switch(E.label){case 0:i=null===(p=r.addAuth)||void 0===p||p,c=null!==(h=r.maxAuthRetry)&&void 0!==h?h:1,E.label=1;case 1:return E.trys.push([1,3,,4]),l=n.__assign({},r.json),!e.instanceOptions.identityless&&i&&(f=e.authStorage,l.access_token=f.getItem("access_token")),[4,a(n.__assign(n.__assign({},r),{json:l,identityless:e.instanceOptions.identityless}))];case 2:return d=E.sent(),s(d),[3,4];case 3:switch((_=E.sent()).errCode){case o.CGI_ERROR_CODE.INVALID_CREDENTIAL:case o.CGI_ERROR_CODE.EXPIRED_ACCESS_TOKEN:if(i&&c>0)return s(e.webRefreshToken().then(function(){return t(n.__assign(n.__assign({},r),{maxAuthRetry:c-1}))})),[2]}return u(_),[3,4];case 4:return[2]}})})})}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isComparisonCommand=t.isKnownQueryCommand=t.isQueryCommand=t.QueryCommmand=t.queryCommandsSet=t.QUERY_COMMANDS_LITERAL=void 0;var n,i=r(0),o=r(28),a=r(7),s=r(3);!function(e){e.EQ="eq",e.NEQ="neq",e.GT="gt",e.GTE="gte",e.LT="lt",e.LTE="lte",e.IN="in",e.NIN="nin",e.GEO_NEAR="geoNear",e.GEO_WITHIN="geoWithin",e.GEO_INTERSECTS="geoIntersects",e.EXISTS="exists",e.MOD="mod",e.ALL="all",e.ELEM_MATCH="elemMatch",e.SIZE="size",e.EXPR="expr"}(n=t.QUERY_COMMANDS_LITERAL||(t.QUERY_COMMANDS_LITERAL={}));var u=[n.EQ,n.NEQ,n.GT,n.GTE,n.LT,n.LTE,n.IN,n.NIN,n.GEO_NEAR,n.GEO_WITHIN,n.GEO_INTERSECTS,n.EXISTS,n.MOD,n.ALL,n.ELEM_MATCH,n.SIZE];t.queryCommandsSet=new Set(u);new Set(i.__spread(t.queryCommandsSet,o.logicCommandsSet));var c=function(e){function t(t,r,n){var i=e.call(this,t,r,n)||this;return i.operator=t,i._internalType=a.SYMBOL_QUERY_COMMAND,i}return i.__extends(t,e),t.prototype._setFieldName=function(e){return new t(this.operator,this.operands,e)},t.prototype.eq=function(e){var r=new t(n.EQ,[e],this.fieldName);return this.and(r)},t.prototype.neq=function(e){var r=new t(n.NEQ,[e],this.fieldName);return this.and(r)},t.prototype.gt=function(e){var r=new t(n.GT,[e],this.fieldName);return this.and(r)},t.prototype.gte=function(e){var r=new t(n.GTE,[e],this.fieldName);return this.and(r)},t.prototype.lt=function(e){var r=new t(n.LT,[e],this.fieldName);return this.and(r)},t.prototype.lte=function(e){var r=new t(n.LTE,[e],this.fieldName);return this.and(r)},t.prototype.in=function(e){s.assertType(e,"array");var r=new t(n.IN,e,this.fieldName);return this.and(r)},t.prototype.nin=function(e){s.assertType(e,"array");var r=new t(n.NIN,e,this.fieldName);return this.and(r)},t.prototype.geoNear=function(e){var r=new t(n.GEO_NEAR,[e],this.fieldName);return this.and(r)},t.prototype.geoWithin=function(e){var r=new t(n.GEO_WITHIN,[e],this.fieldName);return this.and(r)},t.prototype.geoIntersects=function(e){var r=new t(n.GEO_INTERSECTS,[e],this.fieldName);return this.and(r)},t.prototype.exists=function(e){var r=new t(n.EXISTS,[e],this.fieldName);return this.and(r)},t.prototype.mod=function(e,r){var i=new t(n.MOD,[e,r],this.fieldName);return this.and(i)},t.prototype.all=function(e){var r=new t(n.ALL,e,this.fieldName);return this.and(r)},t.prototype.elemMatch=function(e){var r=new t(n.ELEM_MATCH,[e],this.fieldName);return this.and(r)},t.prototype.size=function(e){var r=new t(n.SIZE,[e],this.fieldName);return this.and(r)},t}(o.LogicCommmand);function l(e){return e&&e instanceof c&&e._internalType===a.SYMBOL_QUERY_COMMAND}t.QueryCommmand=c,t.isQueryCommand=l,t.isKnownQueryCommand=function(e){return l(e)&&t.queryCommandsSet.has(e.operator)},t.isComparisonCommand=function(e){return l(e)},t.default=c},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isKnownUpdateCommand=t.isUpdateCommand=t.UpdateCommand=t.updateCommandsSet=t.UPDATE_COMMANDS_LITERAL=void 0;var n,i=r(7);!function(e){e.SET="set",e.REMOVE="remove",e.INC="inc",e.MUL="mul",e.MIN="min",e.MAX="max",e.RENAME="rename",e.BIT="bit",e.PUSH="push",e.POP="pop",e.SHIFT="shift",e.UNSHIFT="unshift",e.ADD_TO_SET="addToSet",e.PULL="pull",e.PULL_ALL="pullAll"}(n=t.UPDATE_COMMANDS_LITERAL||(t.UPDATE_COMMANDS_LITERAL={})),t.updateCommandsSet=new Set([n.SET,n.REMOVE,n.INC,n.MUL,n.MIN,n.MAX,n.RENAME,n.BIT,n.PUSH,n.POP,n.SHIFT,n.UNSHIFT,n.ADD_TO_SET,n.PULL,n.PULL_ALL]);var o=function(){function e(e,t,r){this._internalType=i.SYMBOL_UPDATE_COMMAND,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=r||i.SYMBOL_UNSET_FIELD_NAME}return e.prototype._setFieldName=function(t){return new e(this.operator,this.operands,t)},e.prototype.toJSON=function(){},e}();function a(e){return e&&e instanceof o&&e._internalType===i.SYMBOL_UPDATE_COMMAND}t.UpdateCommand=o,t.isUpdateCommand=a,t.isKnownUpdateCommand=function(e){return a(e)&&t.updateCommandsSet.has(e.operator)},t.default=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.encode=t.QuerySerializer=void 0;var n=r(0),i=r(1),o=r(28),a=r(34),s=r(21),u=r(18),c=r(66),l=r(30),f=r(29),d=function(){function e(){}return e.encode=function(e){return t.encode(e)},e}();t.QuerySerializer=d,t.encode=function(e){return o.isLogicCommand(e)?p(e):a.isQueryCommand(e)?h(e):l.isPipeline(e)||f.isAggregateCommand(e)||l.isPipelineStage(e)?c.AggregateSerializer.encode(e):i.isObject(e)?_(e):u.encodeInternalDataType(e)};var _=function(e){var r,n=u.flattenQueryObject(e),i=[],c=((r={})[o.LOGIC_COMMANDS_LITERAL.OR]=0,r[o.LOGIC_COMMANDS_LITERAL.NOR]=0,r[o.LOGIC_COMMANDS_LITERAL.AND]=0,r[o.LOGIC_COMMANDS_LITERAL.NOT]=0,r),l=function(e){var r,l,f,d,_,E=n[e];if(o.isLogicCommand(E))switch(E.operator){case o.LOGIC_COMMANDS_LITERAL.OR:case o.LOGIC_COMMANDS_LITERAL.NOR:case o.LOGIC_COMMANDS_LITERAL.AND:c[E.operator]++,i.push(((r={})[s.operatorToString(E.operator)]=E.operands.map(function(r){var n;return t.encode(((n={})[e]=r,n))}),r));break;case o.LOGIC_COMMANDS_LITERAL.NOT:var g=E.operands[0];if(o.isLogicCommand(g))switch(g.operator){case o.LOGIC_COMMANDS_LITERAL.AND:c[o.LOGIC_COMMANDS_LITERAL.OR]++,i.push(p(new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.OR,g.operands.map(function(t){var r;return(r={})[e]=new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.NOT,[t]),r}))));break;case o.LOGIC_COMMANDS_LITERAL.OR:c[o.LOGIC_COMMANDS_LITERAL.NOR]++,i.push(p(new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.NOR,g.operands.map(function(t){var r;return(r={})[e]=t,r}))));break;case o.LOGIC_COMMANDS_LITERAL.NOR:c[o.LOGIC_COMMANDS_LITERAL.OR]++,i.push(p(new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.OR,g.operands.map(function(t){var r;return(r={})[e]=t,r}))));break;case o.LOGIC_COMMANDS_LITERAL.NOT:i.push(t.encode(((l={})[e]=g.operands[0],l)))}else i.push(((f={})[e]=p(E),f))}else a.isQueryCommand(E)?i.push(((d={})[e]=h(E),d)):i.push(((_={})[e]=u.encodeInternalDataType(E),_))};for(var f in n)l(f);return E(i)},p=function(e){var r,i,u,c,l,f;switch(e.operator){case o.LOGIC_COMMANDS_LITERAL.AND:if(e.operands.every(function(e){return a.isQueryCommand(e)})){var d={};try{for(var _=n.__values(e.operands),p=_.next();!p.done;p=_.next()){var E=p.value;Object.assign(d,h(E))}}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=_.return)&&i.call(_)}finally{if(r)throw r.error}}return d}var g=s.operatorToString(e.operator),m=e.operands.map(t.encode);return(u={})[g]=m,u;case o.LOGIC_COMMANDS_LITERAL.OR:case o.LOGIC_COMMANDS_LITERAL.NOR:g=s.operatorToString(e.operator),m=e.operands.map(t.encode);return(c={})[g]=m,c;case o.LOGIC_COMMANDS_LITERAL.NOT:g=s.operatorToString(e.operator),E=e.operands[0];return(l={})[g]=t.encode(E),l;default:g=s.operatorToString(e.operator),m=e.operands.map(t.encode);return(f={})[g]=m,f}},h=function(e){var r,n,i,o,c,l,f,d,_=s.operatorToString(e.operator);switch(e.operator){case a.QUERY_COMMANDS_LITERAL.EQ:case a.QUERY_COMMANDS_LITERAL.NEQ:case a.QUERY_COMMANDS_LITERAL.LT:case a.QUERY_COMMANDS_LITERAL.LTE:case a.QUERY_COMMANDS_LITERAL.GT:case a.QUERY_COMMANDS_LITERAL.GTE:case a.QUERY_COMMANDS_LITERAL.EXISTS:case a.QUERY_COMMANDS_LITERAL.SIZE:return(r={})[_]=u.encodeInternalDataType(e.operands[0]),r;case a.QUERY_COMMANDS_LITERAL.IN:case a.QUERY_COMMANDS_LITERAL.NIN:case a.QUERY_COMMANDS_LITERAL.MOD:return(n={})[_]=u.encodeInternalDataType(e.operands),n;case a.QUERY_COMMANDS_LITERAL.ALL:return(i={})[_]=e.operands.map(t.encode),i;case a.QUERY_COMMANDS_LITERAL.ELEM_MATCH:case a.QUERY_COMMANDS_LITERAL.EXPR:return(o={})[_]=t.encode(e.operands[0]),o;case a.QUERY_COMMANDS_LITERAL.GEO_NEAR:return(c={})[_]={$geometry:u.encodeInternalDataType(e.operands[0].geometry),$maxDistance:e.operands[0].maxDistance,$minDistance:e.operands[0].minDistance},c;case a.QUERY_COMMANDS_LITERAL.GEO_WITHIN:var p={};return e.operands[0].geometry&&(p.$geometry=u.encodeInternalDataType(e.operands[0].geometry)),e.operands[0].centerSphere&&(p.$centerSphere=u.encodeInternalDataType(e.operands[0].centerSphere)),(l={})[_]=p,l;case a.QUERY_COMMANDS_LITERAL.GEO_INTERSECTS:return(f={})[_]={$geometry:u.encodeInternalDataType(e.operands[0].geometry)},f;default:return(d={})[_]=e.operands.length>1?e.operands.map(t.encode):t.encode(e.operands[0]),d}},E=function(e){var t,r,i,o,a={$and:0,$or:0,$nor:0};try{for(var s=n.__values(e),u=s.next();!u.done;u=s.next()){(p=u.value).$and&&a.$and++,p.$or&&a.$or++,p.$nor&&a.$nor++}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}var c=a.$and>1||a.$or>1||a.$nor>1,l=!1,f={};try{for(var d=n.__values(e),_=d.next();!_.done;_=d.next()){var p=_.value;for(var h in p){var E=p[h];c?l?f.$and.push(p):"$and"===h||"$or"===h||"$nor"===h?(l=!0,f.$and=[p]):f[h]=E:f[h]=E}}}catch(e){i={error:e}}finally{try{_&&!_.done&&(o=d.return)&&o.call(d)}finally{if(i)throw i.error}}return f}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.uploadToCommonCDN=t.CDN=t.CDNObjectSymbol=void 0;var n=r(0),i=r(4);t.CDNObjectSymbol=Symbol("CDN");var o=function(){return function(e){this.symbol=t.CDNObjectSymbol,this.options=e}}();t.CDN=o,t.uploadToCommonCDN=function(e,t){return new Promise(function(r,o){(t||i.getSDK()).uploadToCommonCDN(n.__assign(n.__assign({},e),{success:r,fail:o}))})}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.stdPrivateProtocol=t.getBoundTunnelRequest=t.constructTunnelReq=t.tunnel=void 0;var n=r(0),i=r(2),o=r(4),a=r(11),s=r(79),u=r(26),c=a._wxConsole,l=new Set(["tcbapi_init","tcbapi_get_service_info"]),f=new(function(){function e(){this._running=0,this._onIdleCallbacks=[]}return Object.defineProperty(e.prototype,"running",{get:function(){return this._running},enumerable:!1,configurable:!0}),e.prototype.incrementRunning=function(e){void 0===e&&(e=1),this._running+=e,this._idleTriggerTimer&&clearTimeout(this._idleTriggerTimer)},e.prototype.decrementRunning=function(e){var t=this;void 0===e&&(e=1),this._running-=e,this._running<0&&(this._running=0),this._running<=0&&this._onIdleCallbacks.length&&(this._idleTriggerTimer=setTimeout(function(){if(t._idleTriggerTimer=null,t._onIdleCallbacks.length){var e=t._onIdleCallbacks.shift();e&&e()}},50))},e.prototype.onceIdle=function(e){this._running>0?this._onIdleCallbacks.push(e):e()},e}());function d(e,t){var r=this;if(void 0===t&&(t={}),t.fireOnIdle&&f.running>0)return new Promise(function(i,o){f.onceIdle(function(){return n.__awaiter(r,void 0,void 0,function(){var r,a;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,d(e,t)];case 1:return r=n.sent(),i(r),[3,3];case 2:return a=n.sent(),o(a),[3,3];case 3:return[2]}})})})});if(t.onFire)try{t.onFire()}catch(e){}return new Promise(function(r,a){var s,u,c,l,d;f.incrementRunning(),o.getSDK((e.cloud||t.cloud||{}).identifiers).invokeOperateWXData({appid:null===(u=null===(s=e.cloud)||void 0===s?void 0:s.instanceOptions)||void 0===u?void 0:u.resourceAppid,accessToken:null===(l=null===(c=e.cloud)||void 0===c?void 0:c.authStorage)||void 0===l?void 0:l.getItem("access_token"),webRequest:null===(d=e.cloud)||void 0===d?void 0:d.webRequest,apiName:e.apiName||"qbase_commapi",reqData:e.data,requestInQueue:!1,success:function(e){!e.data&&e.rawData&&(e.data=JSON.parse(e.rawData));var o=n.__assign(n.__assign({},e),{data:e.data});if(e.data)try{var s=e.data;if(s.baseresponse&&0!==s.baseresponse.errcode){var u=new i.CloudSDKError({errCode:s.baseresponse.errcode,errMsg:s.baseresponse.errmsg});return void a(u)}o=n.__assign(n.__assign({},e),{data:s})}catch(e){u=new i.CloudSDKError({errMsg:e&&e.toString()});return void a(u)}else if(t&&t.requireDataNotEmpty){u=new i.CloudSDKError({errCode:e.errCode,errMsg:"error empty internal server response, "+e.errMsg});return void a(u)}r(o)},fail:function(e){if(e&&e.errMsg)if(e.errMsg.includes("invalid scope")){var t="invalid scope æ²¡æœ‰æƒé™ï¼Œè¯·å…ˆå¼€é€šäº‘æœåŠ¡";(e=new Error(t)).errMsg=t,e.operateWXDataFail=!0}else{t=e.errMsg.replace(/^operateWXData:fail /,"");(e=new Error(t)).errMsg=t,e.operateWXDataFail=!0}a(e)},complete:function(){e.complete&&e.complete.apply(null,arguments),f.decrementRunning()}})})}function _(e,t){return n.__awaiter(this,void 0,void 0,function(){var i,l,f,d,_,p,h,E,g,m,S;return n.__generator(this,function(v){switch(v.label){case 0:return(l=e.serviceEndpoint.getEndpointSync("container"))?[3,2]:[4,e.serviceEndpoint.getEndpoint("container")];case 1:l=v.sent(),v.label=2;case 2:if(!(i=l).cloudServiceUrl)throw{errCode:-9998,errMsg:"cloudServiceUrl not found"};return null===c||void 0===c||c.info("cloud stdpriv begin",t),f=o.getSDK(e.identifiers),d={"X-WX-ENCRYPTION-VERSION":2,"X-WX-ENCRYPTION-TIMESTAMP":i.timestamp+"","X-WX-COMPRESSION":"snappy","X-WX-LIB-BUILD-TS":1656295447274,"X-WX-RESPONSE-CONTENT-ACCEPT-ENCODING":"JSON","Content-Type":"application/octet-stream"},_=s.QBaseApiData.encode(t).finish(),d["X-WX-REQUEST-CONTENT-ENCODING"]="PB",p=r(42),h=p.compress(_),E=r(44),g=new Uint8Array(a.base64ToArrayBuffer(i.key)),m=E.AES_CBC.encrypt(h,g,void 0,g),S=u.getCloudServiceURL({rdm:e.getConfig().rdm}),[2,new Promise(function(e,t){f._requestSkipCheckDomain({url:S,method:"POST",header:d,data:m.buffer,dataType:"arraybuffer",responseType:"arraybuffer",enableHttp2:!0,success:function(r){try{for(var n in null===c||void 0===c||c.info("res",r),r.header)if("x-nws-log-uuid"===n.toLowerCase()&&(null===c||void 0===c||c.log("[cloud.callContainer] x-nws-log-uuid "+r.header[n])),"x-wx-system-error"===n.toLowerCase()){var i=Number(r.header[n]);return 85104===i&&u.ServiceEndpoint.invalidateService("container"),void t(new Error("wx system error. code: "+i))}if(200===r.statusCode){var o=r.data,s=E.AES_CBC.decrypt(new Uint8Array(o),g,void 0,g);for(var l in null===c||void 0===c||c.info("decrypt done"),r.header){if("x-wx-compression"===l.toLowerCase()&&"snappy"===r.header[l]&&(s=p.uncompress(s)),"x-wx-server-timing"===l.toLowerCase())(r.header[l]||"").split(",").length}var f=JSON.parse(a.arrayBufferToString(s));e({errCode:0,errMsg:"",data:f,profile:r.profile,channelType:1})}else t({errCode:-9999,errMsg:"system conn status not 200"})}catch(e){t(new Error("error while processing internal response "+e))}},fail:function(e){t(n.__assign(n.__assign({},e),{errCode:-9999,errMsg:e.errMsg}))}})})]}})})}t.tunnel=d,t.constructTunnelReq=function(e){var t=e.cloud;return{apiName:"qbase_commapi",data:{qbase_api_name:e.apiName,qbase_req:e.serializedReqData,qbase_options:{env:e.env},qbase_meta:t.getMetaData(),cli_req_id:+new Date+"_"+Math.random()},cloud:t}},t.getBoundTunnelRequest=function(e){var t=e.cloud;return function(e){return n.__awaiter(this,void 0,void 0,function(){var r,i;return n.__generator(this,function(o){switch(o.label){case 0:return r=t.isInstance?n.__assign(n.__assign({},t.instanceOptions),{appid:t.instanceOptions.resourceAppid,env:t.instanceOptions.resourceEnv}):n.__assign(n.__assign({},e),{env:e.env}),i={qbase_api_name:e.apiName,qbase_req:e.serializedReqData,qbase_options:r,qbase_meta:t.getMetaData(),cli_req_id:+new Date+"_"+Math.random()},!e.stdpriv||l.has(e.apiName)?[3,2]:[4,_(t,i).catch(function(e){if(e&&(-9999===e.errCode||-9998===e.errCode))return d({apiName:"qbase_commapi",data:i,cloud:t}).then(function(t){return n.__assign(n.__assign({},t),{channelType:-9998===e.errCode?0:2})});throw e})];case 1:return[2,o.sent()];case 2:return[2,d({apiName:"qbase_commapi",data:i,cloud:t})]}})})}},t.stdPrivateProtocol=_,t.default=d},function(e,t,r){"use strict";e.exports=r(80)},function(e,t,r){"use strict";e.exports=l;var n,i=r(14),o=i.LongBits,a=i.base64,s=i.utf8;function u(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function c(){}function l(){this.len=0,this.head=new u(c,0,0),this.tail=this.head,this.states=null}var f=function(){return i.Buffer?function(){return(l.create=function(){return new n})()}:function(){return new l}};function d(e,t,r){t[r]=255&e}function _(e,t){this.len=e,this.next=void 0,this.val=t}function p(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function h(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}l.create=f(),l.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(l.alloc=i.pool(l.alloc,i.Array.prototype.subarray)),l.prototype._push=function(e,t,r){return this.tail=this.tail.next=new u(e,t,r),this.len+=t,this},_.prototype=Object.create(u.prototype),_.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},l.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new _((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},l.prototype.int32=function(e){return e<0?this._push(p,10,o.fromNumber(e)):this.uint32(e)},l.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},l.prototype.uint64=function(e){var t=o.from(e);return this._push(p,t.length(),t)},l.prototype.int64=l.prototype.uint64,l.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(p,t.length(),t)},l.prototype.bool=function(e){return this._push(d,1,e?1:0)},l.prototype.fixed32=function(e){return this._push(h,4,e>>>0)},l.prototype.sfixed32=l.prototype.fixed32,l.prototype.fixed64=function(e){var t=o.from(e);return this._push(h,4,t.lo)._push(h,4,t.hi)},l.prototype.sfixed64=l.prototype.fixed64,l.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},l.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var E=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};l.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(d,1,0);if(i.isString(e)){var r=l.alloc(t=a.length(e));a.decode(e,r,0),e=r}return this.uint32(t)._push(E,t,e)},l.prototype.string=function(e){var t=s.length(e);return t?this.uint32(t)._push(s.write,t,e):this._push(d,1,0)},l.prototype.fork=function(){return this.states=new function(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}(this),this.head=this.tail=new u(c,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(c,0,0),this.len=0),this},l.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},l.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},l._configure=function(e){n=e,l.create=f(),n._configure()}},function(e,t,r){"use strict";e.exports=u;var n,i=r(14),o=i.LongBits,a=i.utf8;function s(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function u(e){this.buf=e,this.pos=0,this.len=e.length}var c="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new u(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new u(e);throw Error("illegal buffer")},l=function(){return i.Buffer?function(e){return(u.create=function(e){return i.Buffer.isBuffer(e)?new n(e):c(e)})(e)}:c};function f(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw s(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw s(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function _(){if(this.pos+8>this.len)throw s(this,8);return new o(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}u.create=l(),u.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,u.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return e}}(),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return d(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|d(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},u.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},u.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw s(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},u.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},u.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw s(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},u._configure=function(e){n=e,u.create=l(),n._configure();var t=i.Long?"toLong":"toNumber";i.merge(u.prototype,{int64:function(){return f.call(this)[t](!1)},uint64:function(){return f.call(this)[t](!0)},sint64:function(){return f.call(this).zzDecode()[t](!1)},fixed64:function(){return _.call(this)[t](!0)},sfixed64:function(){return _.call(this)[t](!1)}})}},function(e,t,r){(function(t,r){var n,i={};!function e(t,r,i){function o(s,u){if(!r[s]){if(!t[s]){if(!u&&("function"==typeof n&&n))return n(s,!0);if(a)return a(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return o(r||e)},l,l.exports,e,t,r,i)}return r[s].exports}for(var a="function"==typeof n&&n,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,r){i.uncompress=e("./index").uncompress,i.compress=e("./index").compress},{"./index":2}],2:[function(e,n,i){"use strict";function o(){return"object"==typeof t&&"object"==typeof t.versions&&void 0!==t.versions.node}function a(e){return e instanceof Uint8Array&&(!o()||!r.isBuffer(e))}function s(e){return e instanceof ArrayBuffer}function u(e){return!!o()&&r.isBuffer(e)}var c=e("./snappy_decompressor").SnappyDecompressor,l=e("./snappy_compressor").SnappyCompressor,f="Argument compressed must be type of ArrayBuffer, Buffer, or Uint8Array";i.uncompress=function(e){if(!a(e)&&!s(e)&&!u(e))throw new TypeError(f);var t=!1,n=!1;a(e)?t=!0:s(e)&&(n=!0,e=new Uint8Array(e));var i,o,l=new c(e),d=l.readUncompressedLength();if(-1===d)throw new Error("Invalid Snappy bitstream");if(t){if(i=new Uint8Array(d),!l.uncompressToBuffer(i))throw new Error("Invalid Snappy bitstream")}else if(n){if(i=new ArrayBuffer(d),o=new Uint8Array(i),!l.uncompressToBuffer(o))throw new Error("Invalid Snappy bitstream")}else if(i=r.alloc(d),!l.uncompressToBuffer(i))throw new Error("Invalid Snappy bitstream");return i},i.compress=function(e){if(!a(e)&&!s(e)&&!u(e))throw new TypeError(f);var t=!1,n=!1;a(e)?t=!0:s(e)&&(n=!0,e=new Uint8Array(e));var i,o,c,d=new l(e),_=d.maxCompressedLength();return t?(i=new Uint8Array(_),c=d.compressToBuffer(i)):n?(i=new ArrayBuffer(_),o=new Uint8Array(i),c=d.compressToBuffer(o)):(i=r.alloc(_),c=d.compressToBuffer(i)),i.slice(0,c)}},{"./snappy_compressor":3,"./snappy_decompressor":4}],3:[function(e,t,r){"use strict";function n(e,t){return 506832829*e>>>t}function i(e,t){return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)}function o(e,t,r){return e[t]===e[r]&&e[t+1]===e[r+1]&&e[t+2]===e[r+2]&&e[t+3]===e[r+3]}function a(e,t,r,n,i){return r<=60?(n[i]=r-1<<2,i+=1):r<256?(n[i]=240,n[i+1]=r-1,i+=2):(n[i]=244,n[i+1]=r-1&255,n[i+2]=r-1>>>8,i+=3),function(e,t,r,n,i){var o;for(o=0;o<i;o++)r[n+o]=e[t+o]}(e,t,n,i,r),i+r}function s(e,t,r,n){return n<12&&r<2048?(e[t]=1+(n-4<<2)+(r>>>8<<5),e[t+1]=255&r,t+2):(e[t]=2+(n-1<<2),e[t+1]=255&r,e[t+2]=r>>>8,t+3)}function u(e,t,r,n){for(;n>=68;)t=s(e,t,r,64),n-=64;return n>64&&(t=s(e,t,r,60),n-=60),s(e,t,r,n)}function c(e,t,r,s,c){for(var l=1;1<<l<=r&&l<=f;)l+=1;var _=32-(l-=1);void 0===d[l]&&(d[l]=new Uint16Array(1<<l));var p,h=d[l];for(p=0;p<h.length;p++)h[p]=0;var E,g,m,S,v,y,T,A,C,O,I=t+r,R=t,N=t,w=!0;if(r>=15)for(E=I-15,m=n(i(e,t+=1),_);w;){y=32,S=t;do{if(g=m,T=y>>>5,y+=1,S=(t=S)+T,t>E){w=!1;break}m=n(i(e,S),_),v=R+h[g],h[g]=t-R}while(!o(e,t,v));if(!w)break;c=a(e,N,t-N,s,c);do{for(A=t,C=4;t+C<I&&e[t+C]===e[v+C];)C+=1;if(t+=C,c=u(s,c,A-v,C),N=t,t>=E){w=!1;break}h[n(i(e,t-1),_)]=t-1-R,v=R+h[O=n(i(e,t),_)],h[O]=t-R}while(o(e,t,v));if(!w)break;m=n(i(e,t+=1),_)}return N<I&&(c=a(e,N,I-N,s,c)),c}function l(e){this.array=e}var f=14,d=new Array(f+1);l.prototype.maxCompressedLength=function(){var e=this.array.length;return 32+e+Math.floor(e/6)},l.prototype.compressToBuffer=function(e){var t,r=this.array,n=r.length,i=0,o=0;for(o=function(e,t,r){do{t[r]=127&e,(e>>>=7)>0&&(t[r]+=128),r+=1}while(e>0);return r}(n,e,o);i<n;)o=c(r,i,t=Math.min(n-i,65536),e,o),i+=t;return o},r.SnappyCompressor=l},{}],4:[function(e,t,r){"use strict";function n(e,t,r,n,i){var o;for(o=0;o<i;o++)r[n+o]=e[t+o]}function i(e,t,r,n){var i;for(i=0;i<n;i++)e[t+i]=e[t-r+i]}function o(e){this.array=e,this.pos=0}var a=[0,255,65535,16777215,4294967295];o.prototype.readUncompressedLength=function(){for(var e,t,r=0,n=0;n<32&&this.pos<this.array.length;){if(e=this.array[this.pos],this.pos+=1,(t=127&e)<<n>>>n!==t)return-1;if(r|=t<<n,e<128)return r;n+=7}return-1},o.prototype.uncompressToBuffer=function(e){for(var t,r,o,s,u=this.array,c=u.length,l=this.pos,f=0;l<u.length;)if(t=u[l],l+=1,0==(3&t)){if((r=1+(t>>>2))>60){if(l+3>=c)return!1;o=r-60,r=1+((r=u[l]+(u[l+1]<<8)+(u[l+2]<<16)+(u[l+3]<<24))&a[o]),l+=o}if(l+r>c)return!1;n(u,l,e,f,r),l+=r,f+=r}else{switch(3&t){case 1:r=4+(t>>>2&7),s=u[l]+(t>>>5<<8),l+=1;break;case 2:if(l+1>=c)return!1;r=1+(t>>>2),s=u[l]+(u[l+1]<<8),l+=2;break;case 3:if(l+3>=c)return!1;r=1+(t>>>2),s=u[l]+(u[l+1]<<8)+(u[l+2]<<16)+(u[l+3]<<24),l+=4}if(0===s||s>f)return!1;i(e,f,s,r),f+=r}return!0},r.SnappyDecompressor=o},{}]},{},[1]),e.exports=i}).call(this,r(22),r(43).Buffer)},function(e,t,r){"use strict";(function(e){
    /*!
     * The buffer module from node.js, for the browser.
     *
     * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
     * @license  MIT
     */
    var n=r(94),i=r(95),o=r(96);function a(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return f(this,e)}return c(this,e,t,r)}function c(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=d(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(t,r),i=(e=s(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(u.isBuffer(t)){var r=0|_(t.length);return 0===(e=s(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?s(e,0):d(e,t);if("Buffer"===t.type&&o(t.data))return d(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function f(e,t){if(l(t),e=s(e,t<0?0:0|_(t)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function d(e,t){var r=t.length<0?0:0|_(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function _(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function p(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return F(e).length;default:if(n)return q(e).length;t=(""+t).toLowerCase(),n=!0}}function h(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function E(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:g(e,t,r,n,i);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):g(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function g(e,t,r,n,i){var o,a=1,s=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=r;o<s;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(r+u>s&&(r=s-u),o=r;o>=0;o--){for(var f=!0,d=0;d<u;d++)if(c(e,o+d)!==c(t,d)){f=!1;break}if(f)return o}return-1}function m(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[r+a]=s}return a}function S(e,t,r,n){return W(q(t,e.length-r),e,r,n)}function v(e,t,r,n){return W(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function y(e,t,r,n){return v(e,t,r,n)}function T(e,t,r,n){return W(F(t),e,r,n)}function A(e,t,r,n){return W(function(e,t){for(var r,n,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)r=e.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function C(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function O(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,s,u,c=e[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=r)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(u=(15&c)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=f}return function(e){var t=e.length;if(t<=I)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=I));return r}(n)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,r){return c(null,e,t,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,r){return function(e,t,r,n){return l(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}(null,e,t,r)},u.allocUnsafe=function(e){return f(null,e)},u.allocUnsafeSlow=function(e){return f(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=u.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(!u.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i),i+=a.length}return n},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)h(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)h(this,t,t+3),h(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)h(this,t,t+7),h(this,t+1,t+6),h(this,t+2,t+5),h(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?O(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return w(this,t,r);case"utf8":case"utf-8":return O(this,t,r);case"ascii":return R(this,t,r);case"latin1":case"binary":return N(this,t,r);case"base64":return C(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,r,n,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var o=i-n,a=r-t,s=Math.min(o,a),c=this.slice(n,i),l=e.slice(t,r),f=0;f<s;++f)if(c[f]!==l[f]){o=c[f],a=l[f];break}return o<a?-1:a<o?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return E(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return E(this,e,t,r,!1)},u.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return m(this,e,t,r);case"utf8":case"utf-8":return S(this,e,t,r);case"ascii":return v(this,e,t,r);case"latin1":case"binary":return y(this,e,t,r);case"base64":return T(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;function R(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function N(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function w(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=G(e[o]);return i}function b(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function D(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,r,n,i,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function M(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function P(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function U(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function B(e,t,r,n,o){return o||U(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function x(e,t,r,n,o){return o||U(e,0,r,8),i.write(e,t,r,n,52,8),r+8}u.prototype.slice=function(e,t){var r,n=this.length;if(e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;r=new u(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},u.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||D(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},u.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||D(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},u.prototype.readUInt8=function(e,t){return t||D(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||D(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||D(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||D(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||D(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},u.prototype.readInt8=function(e,t){return t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||D(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(e,t){t||D(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(e,t){return t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||D(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||D(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||L(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},u.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||L(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},u.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):P(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);L(this,e,t,r,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},u.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);L(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):P(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||L(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,r){return B(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return B(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return x(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return x(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},u.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var a=u.isBuffer(e)?e:q(new u(e,n).toString()),s=a.length;for(o=0;o<r-t;++o)this[o+t]=a[o%s]}return this};var k=/[^+\/0-9A-Za-z-_]/g;function G(e){return e<16?"0"+e.toString(16):e.toString(16)}function q(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function F(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(k,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function W(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(13))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(45);Object.defineProperty(t,"AES_CBC",{enumerable:!0,get:function(){return n.AES_CBC}})},function(e,t,r){"use strict";function n(e){return e instanceof Uint8Array}function i(e,t,r,n,i){var o=e.length-t,a=o<i?o:i;return e.set(r.subarray(n,n+a),t),a}r.r(t),r.d(t,"AES_CBC",function(){return f});var o=(()=>{function e(){var e=Error.apply(this,arguments);this.message=e.message,this.stack=e.stack}return e.prototype=Object.create(Error.prototype,{name:{value:"IllegalArgumentError"}}),e})(),a=(()=>{function e(){var e=Error.apply(this,arguments);this.message=e.message,this.stack=e.stack}return e.prototype=Object.create(Error.prototype,{name:{value:"SecurityError"}}),e})(),s=(()=>{var e,t,r,n,i,o,a=!1;function s(r,n){var i=e[(t[r]+t[n])%255];return 0!==r&&0!==n||(i=0),i}function u(){function u(r){var n,i,o;for(i=o=function(r){var n=e[255-t[r]];return 0===r&&(n=0),n}(r),n=0;n<4;n++)o^=i=255&(i<<1|i>>>7);return o^=99}a||function(){e=[],t=[];var r,n,i=1;for(r=0;r<255;r++)e[r]=i,n=128&i,i<<=1,i&=255,128===n&&(i^=27),i^=e[r],t[e[r]]=r;e[255]=e[0],t[0]=0,a=!0}(),r=[],n=[],i=[[],[],[],[]],o=[[],[],[],[]];for(var c=0;c<256;c++){var l=u(c);r[c]=l,n[l]=c,i[0][c]=s(2,l)<<24|l<<16|l<<8|s(3,l),o[0][l]=s(14,c)<<24|s(9,c)<<16|s(13,c)<<8|s(11,c);for(var f=1;f<4;f++)i[f][c]=i[f-1][c]>>>8|i[f-1][c]<<24,o[f][l]=o[f-1][l]>>>8|o[f-1][l]<<24}}var c=function(e,t){u();var a=new Uint32Array(t);a.set(r,512),a.set(n,768);for(var s=0;s<4;s++)a.set(i[s],4096+1024*s>>2),a.set(o[s],8192+1024*s>>2);var c=function(e,t,r){"use asm";var n=0,i=0,o=0,a=0,s=0,u=0,c=0,l=0,f=0,d=0,_=0,p=0,h=0,E=0,g=0,m=0,S=0,v=0,y=0,T=0,A=0;var C=new e.Uint32Array(r),O=new e.Uint8Array(r);function I(e,t,r,s,u,c,l,f){e=e|0;t=t|0;r=r|0;s=s|0;u=u|0;c=c|0;l=l|0;f=f|0;var d=0,_=0,p=0,h=0,E=0,g=0,m=0,S=0;d=r|0x400,_=r|0x800,p=r|0xc00;u=u^C[(e|0)>>2],c=c^C[(e|4)>>2],l=l^C[(e|8)>>2],f=f^C[(e|12)>>2];for(S=16;(S|0)<=s<<4;S=S+16|0){h=C[(r|u>>22&1020)>>2]^C[(d|c>>14&1020)>>2]^C[(_|l>>6&1020)>>2]^C[(p|f<<2&1020)>>2]^C[(e|S|0)>>2],E=C[(r|c>>22&1020)>>2]^C[(d|l>>14&1020)>>2]^C[(_|f>>6&1020)>>2]^C[(p|u<<2&1020)>>2]^C[(e|S|4)>>2],g=C[(r|l>>22&1020)>>2]^C[(d|f>>14&1020)>>2]^C[(_|u>>6&1020)>>2]^C[(p|c<<2&1020)>>2]^C[(e|S|8)>>2],m=C[(r|f>>22&1020)>>2]^C[(d|u>>14&1020)>>2]^C[(_|c>>6&1020)>>2]^C[(p|l<<2&1020)>>2]^C[(e|S|12)>>2];u=h,c=E,l=g,f=m}n=C[(t|u>>22&1020)>>2]<<24^C[(t|c>>14&1020)>>2]<<16^C[(t|l>>6&1020)>>2]<<8^C[(t|f<<2&1020)>>2]^C[(e|S|0)>>2],i=C[(t|c>>22&1020)>>2]<<24^C[(t|l>>14&1020)>>2]<<16^C[(t|f>>6&1020)>>2]<<8^C[(t|u<<2&1020)>>2]^C[(e|S|4)>>2],o=C[(t|l>>22&1020)>>2]<<24^C[(t|f>>14&1020)>>2]<<16^C[(t|u>>6&1020)>>2]<<8^C[(t|c<<2&1020)>>2]^C[(e|S|8)>>2],a=C[(t|f>>22&1020)>>2]<<24^C[(t|u>>14&1020)>>2]<<16^C[(t|c>>6&1020)>>2]<<8^C[(t|l<<2&1020)>>2]^C[(e|S|12)>>2]}function R(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;I(0x0000,0x0800,0x1000,A,e,t,r,n)}function N(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var o=0;I(0x0400,0x0c00,0x2000,A,e,n,r,t);o=i,i=a,a=o}function w(e,t,r,f){e=e|0;t=t|0;r=r|0;f=f|0;I(0x0000,0x0800,0x1000,A,s^e,u^t,c^r,l^f);s=n,u=i,c=o,l=a}function b(e,t,r,f){e=e|0;t=t|0;r=r|0;f=f|0;var d=0;I(0x0400,0x0c00,0x2000,A,e,f,r,t);d=i,i=a,a=d;n=n^s,i=i^u,o=o^c,a=a^l;s=e,u=t,c=r,l=f}function D(e,t,r,f){e=e|0;t=t|0;r=r|0;f=f|0;I(0x0000,0x0800,0x1000,A,s,u,c,l);s=n=n^e,u=i=i^t,c=o=o^r,l=a=a^f}function L(e,t,r,f){e=e|0;t=t|0;r=r|0;f=f|0;I(0x0000,0x0800,0x1000,A,s,u,c,l);n=n^e,i=i^t,o=o^r,a=a^f;s=e,u=t,c=r,l=f}function M(e,t,r,f){e=e|0;t=t|0;r=r|0;f=f|0;I(0x0000,0x0800,0x1000,A,s,u,c,l);s=n,u=i,c=o,l=a;n=n^e,i=i^t,o=o^r,a=a^f}function P(e,t,r,s){e=e|0;t=t|0;r=r|0;s=s|0;I(0x0000,0x0800,0x1000,A,f,d,_,p);p=~m&p|m&p+1;_=~g&_|g&_+((p|0)==0);d=~E&d|E&d+((_|0)==0);f=~h&f|h&f+((d|0)==0);n=n^e;i=i^t;o=o^r;a=a^s}function U(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;var i=0,o=0,a=0,f=0,d=0,_=0,p=0,h=0,E=0,g=0;e=e^s,t=t^u,r=r^c,n=n^l;i=S|0,o=v|0,a=y|0,f=T|0;for(;(E|0)<128;E=E+1|0){if(i>>>31){d=d^e,_=_^t,p=p^r,h=h^n}i=i<<1|o>>>31,o=o<<1|a>>>31,a=a<<1|f>>>31,f=f<<1;g=n&1;n=n>>>1|r<<31,r=r>>>1|t<<31,t=t>>>1|e<<31,e=e>>>1;if(g)e=e^0xe1000000}s=d,u=_,c=p,l=h}function B(e){e=e|0;A=e}function x(e,t,r,s){e=e|0;t=t|0;r=r|0;s=s|0;n=e,i=t,o=r,a=s}function k(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;s=e,u=t,c=r,l=n}function G(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;f=e,d=t,_=r,p=n}function q(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;h=e,E=t,g=r,m=n}function F(e,t,r,n){e=e|0;t=t|0;r=r|0;n=n|0;p=~m&p|m&n,_=~g&_|g&r,d=~E&d|E&t,f=~h&f|h&e}function W(e){e=e|0;if(e&15)return-1;O[e|0]=n>>>24,O[e|1]=n>>>16&255,O[e|2]=n>>>8&255,O[e|3]=n&255,O[e|4]=i>>>24,O[e|5]=i>>>16&255,O[e|6]=i>>>8&255,O[e|7]=i&255,O[e|8]=o>>>24,O[e|9]=o>>>16&255,O[e|10]=o>>>8&255,O[e|11]=o&255,O[e|12]=a>>>24,O[e|13]=a>>>16&255,O[e|14]=a>>>8&255,O[e|15]=a&255;return 16}function j(e){e=e|0;if(e&15)return-1;O[e|0]=s>>>24,O[e|1]=s>>>16&255,O[e|2]=s>>>8&255,O[e|3]=s&255,O[e|4]=u>>>24,O[e|5]=u>>>16&255,O[e|6]=u>>>8&255,O[e|7]=u&255,O[e|8]=c>>>24,O[e|9]=c>>>16&255,O[e|10]=c>>>8&255,O[e|11]=c&255,O[e|12]=l>>>24,O[e|13]=l>>>16&255,O[e|14]=l>>>8&255,O[e|15]=l&255;return 16}function K(){R(0,0,0,0);S=n,v=i,y=o,T=a}function Y(e,t,r){e=e|0;t=t|0;r=r|0;var s=0;if(t&15)return-1;while((r|0)>=16){V[e&7](O[t|0]<<24|O[t|1]<<16|O[t|2]<<8|O[t|3],O[t|4]<<24|O[t|5]<<16|O[t|6]<<8|O[t|7],O[t|8]<<24|O[t|9]<<16|O[t|10]<<8|O[t|11],O[t|12]<<24|O[t|13]<<16|O[t|14]<<8|O[t|15]);O[t|0]=n>>>24,O[t|1]=n>>>16&255,O[t|2]=n>>>8&255,O[t|3]=n&255,O[t|4]=i>>>24,O[t|5]=i>>>16&255,O[t|6]=i>>>8&255,O[t|7]=i&255,O[t|8]=o>>>24,O[t|9]=o>>>16&255,O[t|10]=o>>>8&255,O[t|11]=o&255,O[t|12]=a>>>24,O[t|13]=a>>>16&255,O[t|14]=a>>>8&255,O[t|15]=a&255;s=s+16|0,t=t+16|0,r=r-16|0}return s|0}function H(e,t,r){e=e|0;t=t|0;r=r|0;var n=0;if(t&15)return-1;while((r|0)>=16){J[e&1](O[t|0]<<24|O[t|1]<<16|O[t|2]<<8|O[t|3],O[t|4]<<24|O[t|5]<<16|O[t|6]<<8|O[t|7],O[t|8]<<24|O[t|9]<<16|O[t|10]<<8|O[t|11],O[t|12]<<24|O[t|13]<<16|O[t|14]<<8|O[t|15]);n=n+16|0,t=t+16|0,r=r-16|0}return n|0}var V=[R,N,w,b,D,L,M,P];var J=[w,U];return{set_rounds:B,set_state:x,set_iv:k,set_nonce:G,set_mask:q,set_counter:F,get_state:W,get_iv:j,gcm_init:K,cipher:Y,mac:H}}({Uint8Array:Uint8Array,Uint32Array:Uint32Array},e,t);return c.set_key=function(e,t,n,i,s,u,l,f,d){var _=a.subarray(0,60),p=a.subarray(256,316);_.set([t,n,i,s,u,l,f,d]);for(var h=e,E=1;h<4*e+28;h++){var g=_[h-1];(h%e==0||8===e&&h%e==4)&&(g=r[g>>>24]<<24^r[g>>>16&255]<<16^r[g>>>8&255]<<8^r[255&g]),h%e==0&&(g=g<<8^g>>>24^E<<24,E=E<<1^(128&E?27:0)),_[h]=_[h-e]^g}for(var m=0;m<h;m+=4)for(var S=0;S<4;S++)g=_[h-(4+m)+(4-S)%4],p[m+S]=m<4||m>=h-4?g:o[0][r[g>>>24]]^o[1][r[g>>>16&255]]^o[2][r[g>>>8&255]]^o[3][r[255&g]];c.set_rounds(e+5)},c};return c.ENC={ECB:0,CBC:2,CFB:4,OFB:6,CTR:7},c.DEC={ECB:1,CBC:3,CFB:5,OFB:6,CTR:7},c.MAC={CBC:0,GCM:1},c.HEAP_DATA=16384,c})(),u=new Uint8Array(1048576),c=(()=>s(null,u.buffer))();class l{constructor(e,t,r,n,i){this.nonce=null,this.counter=0,this.counterSize=0,this.heap=function(e,t,r){var n=t?t.byteLength:r||65536;if(4095&n||n<=0)throw new Error("heap size must be a positive integer and a multiple of 4096");return t=t||new e(new ArrayBuffer(n))}(Uint8Array,n).subarray(s.HEAP_DATA),this.asm=i||s(null,this.heap.buffer),this.mode=null,this.key=null,this.AES_reset(e,t,r)}AES_set_key(e){if(void 0!==e){if(!n(e))throw new TypeError("unexpected key type");var t=e.length;if(16!==t&&24!==t&&32!==t)throw new o("illegal key size");var r=new DataView(e.buffer,e.byteOffset,e.byteLength);this.asm.set_key(t>>2,r.getUint32(0),r.getUint32(4),r.getUint32(8),r.getUint32(12),t>16?r.getUint32(16):0,t>16?r.getUint32(20):0,t>24?r.getUint32(24):0,t>24?r.getUint32(28):0),this.key=e}else if(!this.key)throw new Error("key is required")}AES_CTR_set_options(e,t,r){if(void 0!==r){if(r<8||r>48)throw new o("illegal counter size");this.counterSize=r;var i=Math.pow(2,r)-1;this.asm.set_mask(0,0,i/4294967296|0,0|i)}else this.counterSize=r=48,this.asm.set_mask(0,0,65535,4294967295);if(void 0===e)throw new Error("nonce is required");if(!n(e))throw new TypeError("unexpected nonce type");var a=e.length;if(!a||a>16)throw new o("illegal nonce size");this.nonce=e;var s=new DataView(new ArrayBuffer(16));if(new Uint8Array(s.buffer).set(e),this.asm.set_nonce(s.getUint32(0),s.getUint32(4),s.getUint32(8),s.getUint32(12)),void 0!==t){if(!
    /*! asmCrypto v0.22.0, (c) 2018 asmCrypto.js, opensource.org/licenses/MIT */
    function(e){return"number"==typeof e}(t))throw new TypeError("unexpected counter type");if(t<0||t>=Math.pow(2,r))throw new o("illegal counter value");this.counter=t,this.asm.set_counter(0,0,t/4294967296|0,0|t)}else this.counter=0}AES_set_iv(e){if(void 0!==e){if(!n(e))throw new TypeError("unexpected iv type");if(16!==e.length)throw new o("illegal iv size");var t=new DataView(e.buffer,e.byteOffset,e.byteLength);this.iv=e,this.asm.set_iv(t.getUint32(0),t.getUint32(4),t.getUint32(8),t.getUint32(12))}else this.iv=null,this.asm.set_iv(0,0,0,0)}AES_set_padding(e){this.padding=void 0===e||!!e}AES_reset(e,t,r){return this.result=null,this.pos=0,this.len=0,this.AES_set_key(e),this.AES_set_iv(t),this.AES_set_padding(r),this}AES_Encrypt_process(e){if(!n(e))throw new TypeError("data isn't of expected type");for(var t=this.asm,r=this.heap,o=s.ENC[this.mode],a=s.HEAP_DATA,u=this.pos,c=this.len,l=0,f=e.length||0,d=0,_=0,p=new Uint8Array(c+f&-16);f>0;)c+=_=i(r,u+c,e,l,f),l+=_,f-=_,(_=t.cipher(o,a+u,c))&&p.set(r.subarray(u,u+_),d),d+=_,_<c?(u+=_,c-=_):(u=0,c=0);return this.result=p,this.pos=u,this.len=c,this}AES_Encrypt_finish(e){var t=null,r=0;void 0!==e&&(r=(t=this.AES_Encrypt_process(e).result).length);var n=this.asm,i=this.heap,a=s.ENC[this.mode],u=s.HEAP_DATA,c=this.pos,l=this.len,f=16-l%16,d=l;if(this.hasOwnProperty("padding")){if(this.padding){for(var _=0;_<f;++_)i[c+l+_]=f;d=l+=f}else if(l%16)throw new o("data length must be a multiple of the block size")}else l+=f;var p=new Uint8Array(r+d);return r&&p.set(t),l&&n.cipher(a,u+c,l),d&&p.set(i.subarray(c,c+d),r),this.result=p,this.pos=0,this.len=0,this}AES_Decrypt_process(e){if(!n(e))throw new TypeError("data isn't of expected type");var t=this.asm,r=this.heap,o=s.DEC[this.mode],a=s.HEAP_DATA,u=this.pos,c=this.len,l=0,f=e.length||0,d=0,_=c+f&-16,p=0,h=0;this.padding&&(_-=p=c+f-_||16);for(var E=new Uint8Array(_);f>0;)c+=h=i(r,u+c,e,l,f),l+=h,f-=h,(h=t.cipher(o,a+u,c-(f?0:p)))&&E.set(r.subarray(u,u+h),d),d+=h,h<c?(u+=h,c-=h):(u=0,c=0);return this.result=E,this.pos=u,this.len=c,this}AES_Decrypt_finish(e){var t=null,r=0;void 0!==e&&(r=(t=this.AES_Decrypt_process(e).result).length);var n=this.asm,i=this.heap,u=s.DEC[this.mode],c=s.HEAP_DATA,l=this.pos,f=this.len,d=f;if(f>0){if(f%16){if(this.hasOwnProperty("padding"))throw new o("data length must be a multiple of the block size");f+=16-f%16}if(n.cipher(u,c+l,f),this.hasOwnProperty("padding")&&this.padding){var _=i[l+d-1];if(_<1||_>16||_>d)throw new a("bad padding");for(var p=0,h=_;h>1;h--)p|=_^i[l+d-h];if(p)throw new a("bad padding");d-=_}}var E=new Uint8Array(r+d);return r>0&&E.set(t),d>0&&E.set(i.subarray(l,l+d),r),this.result=E,this.pos=0,this.len=0,this}}var f=(()=>{class e extends l{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!(arguments.length>2&&void 0!==arguments[2])||arguments[2],arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0),this.mode="CBC",this.BLOCK_SIZE=16}encrypt(e){return this.AES_Encrypt_finish(e)}decrypt(e){return this.AES_Decrypt_finish(e)}}return e.encrypt=d,e.decrypt=_,e})();function d(e,t,r,n){if(void 0===e)throw new SyntaxError("data required");if(void 0===t)throw new SyntaxError("key required");return new f(t,n,r,u,c).encrypt(e).result}function _(e,t,r,n){if(void 0===e)throw new SyntaxError("data required");if(void 0===t)throw new SyntaxError("key required");return new f(t,n,r,u,c).decrypt(e).result}var p="undefined"!=typeof crypto?crypto:"undefined"!=typeof msCrypto?msCrypto:void 0;void 0!==p&&p.getRandomValues},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.extractCloudID=void 0;var n=r(27),i=r(1);t.extractCloudID=function(e){var t=[];for(var r in e)i.isObject(e[r])&&e[r]._internalType===n.SYMBOL_CLOUD_ID&&t.push({key:r,cloudID:e[r].cloudID});return t}},function(e,t,r){var n=this;Object.defineProperty(t,"__esModule",{value:!0}),t.autoDevtoolsNetworkLog=t.devtoolsNetworkLog=void 0;var i=r(0),o=r(8),a=r(1),s=function(e){return i.__assign(i.__assign({},e),{errMsg:void 0})};t.devtoolsNetworkLog=function(e){try{o.isDevTools()&&"undefined"!=typeof __global&&__global.networkLog&&__global.networkLog(i.__assign(i.__assign({},e),{domain:"cloud",method:"POST",realMethod:e.method,timestampMs:e.timestampMs||+new Date,callFramesIgnoreLength:e.hasOwnProperty("callFramesIgnoreLength")?e.callFramesIgnoreLength:1}))}catch(e){}},t.autoDevtoolsNetworkLog=function(e,r){try{if(o.isDevTools()&&"undefined"!=typeof __global&&__global.networkLog){var u=r(),c=Math.random()+"-"+ +new Date,l=u.console||!1,f=u.resultGetter||s;t.devtoolsNetworkLog({reqId:c,type:"requestWillBeSent",url:u.url,headers:u.headers||{},body:u.reqBody,console:l,callFramesIgnoreLength:2,timestampMs:u.timestampMs,method:u.method}),e.then(function(e){return i.__awaiter(n,void 0,void 0,function(){return i.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(e){return void 0===e&&(e=0),new Promise(function(t){return setTimeout(t,e)})}()];case 1:return r.sent(),t.devtoolsNetworkLog({reqId:c,type:"loadingFinished",body:JSON.stringify(f(e),null,2),console:l,callFramesIgnoreLength:2,timestampMs:Date.now()}),[3,3];case 2:return r.sent(),[3,3];case 3:return[2]}})})}).catch(function(e){try{t.devtoolsNetworkLog({reqId:c,type:"loadingFailed",errorCode:e&&e.errCode||-1,errorMsg:a.isObject(e)?e.errMsg||JSON.stringify(e):e.toString(),console:l,callFramesIgnoreLength:2,timestampMs:Date.now()})}catch(e){}})}}catch(e){0}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getUA=void 0;var n,i=r(4);t.getUA=function(){return n||i.getSDK().private_getUserAgent(function(e){n=e}),n}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getRuntimeInfo=void 0,r(32);var n={env:"",platform:""};if(t.getRuntimeInfo=function(){return n},"undefined"!=typeof __wxConfig)n.env="miniprogram",n.platform=__wxConfig.platform;else if(n.env="web",window.__wxjs_environment&&"miniprogram"===window.__wxjs_environment)n.platform="miniprogram";else{var i=window.navigator.userAgent.toLowerCase();/MicroMessenger/i.test(i)&&(n.platform="wxweb")}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),i=r(111),o=r(33),a=r(112),s=r(113),u=r(114),c=r(115),l=r(116),f=r(117),d=r(118),_={_operateWXData:i.operateWXData,_uploadFileSkipCheckDomain:a.uploadFile,_downloadFileSkipCheckDomain:s.downloadFile,_requestSkipCheckDomain:o.request,_socketSkipCheckDomainFactory:u.socketFactory,uploadToCommonCDN:c.uploadToCommonCDN,wx:l.wx,invokeOperateWXData:i.invokeOperateWXData,cacheManager:f.CacheManager,privateCacheManager:f.PrivateCacheManager,isUsedCache:f.isUsedCache,reportCallContainer:f.noop,private_getUserAgent:d.getUserAgent,request:o.request};n.setDefaultSDK(_),t.default=_},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CGI_ERROR_CODE=t.getSDKError=void 0,t.getSDKError=function(e,t){var r=new Error(t);return r.errCode=e,r.errMsg=t,r},function(e){e[e.INVALID_REFRESH_TOKEN=40030]="INVALID_REFRESH_TOKEN",e[e.INVALID_ACCESS_TOKEN=40014]="INVALID_ACCESS_TOKEN",e[e.EXPIRED_ACCESS_TOKEN=42001]="EXPIRED_ACCESS_TOKEN",e[e.EXPIRED_REFRESH_TOKEN=42002]="EXPIRED_REFRESH_TOKEN",e[e.INVALID_CREDENTIAL=40001]="INVALID_CREDENTIAL",e[e.INVALID_ARGS=40097]="INVALID_ARGS",e[e.NO_SESSION_IN_COOKIE=85103]="NO_SESSION_IN_COOKIE"}(t.CGI_ERROR_CODE||(t.CGI_ERROR_CODE={}))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.createWebService=t.WEB_SERVICE_NAME=void 0;var n=r(119);t.WEB_SERVICE_NAME="web",t.createWebService=function(e){var r={name:t.WEB_SERVICE_NAME,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,get debug(){return e.debug},get env(){return e.getEnvForService(t.WEB_SERVICE_NAME)},cloud:e,appConfig:{}};return{name:t.WEB_SERVICE_NAME,context:r,getAPIs:n.getAPIs.bind(null,r)}}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getPersistence=t.setPersistence=t.getStorage=t.AuthStorage=void 0;var r="wxcloudbase_",n=r+"_persistence",i={},o=localStorage.getItem(n)||"local",a=function(){function e(e){this.prefix=""+r+e.provider+"_"+e.id+"_",this.storage="session"===o?sessionStorage:localStorage}return e.prototype.setItem=function(e,t){this.storage.setItem(this.getKeyFullName(e),t)},e.prototype.getItem=function(e){return this.storage.getItem(this.getKeyFullName(e))},e.prototype.getKeyFullName=function(e){return""+this.prefix+e},e}();t.AuthStorage=a,t.getStorage=function(e){var t=e.provider+"_"+e.id,r=i[t];return r||(r=new a(e),i[t]=r,r)},t.setPersistence=function(e){o=e,localStorage.setItem(n,e)},t.getPersistence=function(){return o}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.commands=void 0;var n=r(0),i=r(34),o=r(28),a=r(35),s=r(29),u=r(55),c=r(30),l=r(1),f=new Set(["each","position","slice","sort"]);t.commands={eq:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.EQ,[e])},neq:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.NEQ,[e])},lt:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.LT,[e])},lte:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.LTE,[e])},gt:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.GT,[e])},gte:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.GTE,[e])},in:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.IN,e)},nin:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.NIN,e)},geoNear:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.GEO_NEAR,[e])},geoWithin:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.GEO_WITHIN,[e])},geoIntersects:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.GEO_INTERSECTS,[e])},and:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=l.isArray(arguments[0])?arguments[0]:Array.from(arguments);return new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.AND,r)},or:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=l.isArray(arguments[0])?arguments[0]:Array.from(arguments);return new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.OR,r)},nor:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=l.isArray(arguments[0])?arguments[0]:Array.from(arguments);return new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.NOR,r)},not:function(e){return new o.LogicCommmand(o.LOGIC_COMMANDS_LITERAL.NOT,[e])},exists:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.EXISTS,[e])},mod:function(e,t){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.MOD,[e,t])},all:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.ALL,e)},elemMatch:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.ELEM_MATCH,[e])},size:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.SIZE,[e])},expr:function(e){return new i.QueryCommmand(i.QUERY_COMMANDS_LITERAL.EXPR,[e])},set:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.SET,[e])},remove:function(){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.REMOVE,[])},inc:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.INC,[e])},mul:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.MUL,[e])},min:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.MIN,[e])},max:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.MAX,[e])},rename:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.RENAME,[e])},bit:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.BIT,[e])},push:function(e){var t,r,i={};if(l.isArray(e))i.each=e;else if(l.isObject(e)&&l.isArray(e.each)){var o=Object.keys(e);if(1===o.length)i=e;else{var s=!1;try{for(var u=n.__values(o),c=u.next();!c.done;c=u.next()){var d=c.value;if(!f.has(d)){s=!0;break}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}i=s?[e]:e}}else i.each=[e];return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.PUSH,[i])},pop:function(){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.POP,[])},shift:function(){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.SHIFT,[])},unshift:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=l.isArray(arguments[0])?arguments[0]:Array.from(arguments);return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.UNSHIFT,r)},addToSet:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.ADD_TO_SET,[e])},pull:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.PULL,[e])},pullAll:function(e){return new a.UpdateCommand(a.UPDATE_COMMANDS_LITERAL.PULL_ALL,[e])},project:{slice:function(e){return new u.ProjectionCommmand(u.PROJECTION_COMMANDS_LITERAL.SLICE,[e])}},aggregate:{pipeline:function(){return new c.Pipeline([])},abs:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ABS,[e])},add:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ADD,[e])},addToSet:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ADDTOSET,[e])},allElementsTrue:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ALLELEMENTSTRUE,[e])},and:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.AND,[e])},anyElementTrue:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ANYELEMENTTRUE,[e])},arrayElemAt:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ARRAYELEMAT,[e])},arrayToObject:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ARRAYTOOBJECT,[e])},avg:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.AVG,[e])},ceil:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.CEIL,[e])},cmp:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.CMP,[e])},concat:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.CONCAT,[e])},concatArrays:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.CONCATARRAYS,[e])},cond:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.COND,[e])},convert:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.CONVERT,[e])},dateFromParts:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DATEFROMPARTS,[e])},dateToParts:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DATETOPARTS,[e])},dateFromString:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DATEFROMSTRING,[e])},dateToString:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DATETOSTRING,[e])},dayOfMonth:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DAYOFMONTH,[e])},dayOfWeek:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DAYOFWEEK,[e])},dayOfYear:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DAYOFYEAR,[e])},divide:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.DIVIDE,[e])},eq:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.EQ,[e])},exp:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.EXP,[e])},filter:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.FILTER,[e])},first:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.FIRST,[e])},floor:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.FLOOR,[e])},gt:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.GT,[e])},gte:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.GTE,[e])},hour:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.HOUR,[e])},ifNull:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.IFNULL,[e])},in:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.IN,[e])},indexOfArray:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.INDEXOFARRAY,[e])},indexOfBytes:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.INDEXOFBYTES,[e])},indexOfCP:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.INDEXOFCP,[e])},isArray:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ISARRAY,[e])},isoDayOfWeek:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ISODAYOFWEEK,[e])},isoWeek:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ISOWEEK,[e])},isoWeekYear:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ISOWEEKYEAR,[e])},last:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LAST,[e])},let:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LET,[e])},literal:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LITERAL,[e])},ln:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LN,[e])},log:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LOG,[e])},log10:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LOG10,[e])},lt:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LT,[e])},lte:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LTE,[e])},ltrim:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.LTRIM,[e])},map:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MAP,[e])},max:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MAX,[e])},mergeObjects:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MERGEOBJECTS,[e])},meta:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.META,[e])},min:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MIN,[e])},millisecond:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MILLISECOND,[e])},minute:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MINUTE,[e])},mod:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MOD,[e])},month:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MONTH,[e])},multiply:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.MULTIPLY,[e])},neq:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.NEQ,[e])},not:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.NOT,[e])},objectToArray:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.OBJECTTOARRAY,[e])},or:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.OR,[e])},pow:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.POW,[e])},push:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.PUSH,[e])},range:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.RANGE,[e])},reduce:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.REDUCE,[e])},reverseArray:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.REVERSEARRAY,[e])},rtrim:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.RTRIM,[e])},second:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SECOND,[e])},setDifference:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SETDIFFERENCE,[e])},setEquals:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SETEQUALS,[e])},setIntersection:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SETINTERSECTION,[e])},setIsSubset:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SETISSUBSET,[e])},setUnion:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SETUNION,[e])},size:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SIZE,[e])},slice:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SLICE,[e])},split:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SPLIT,[e])},sqrt:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SQRT,[e])},stdDevPop:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.STDDEVPOP,[e])},stdDevSamp:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.STDDEVSAMP,[e])},strcasecmp:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.STRCASECMP,[e])},strLenBytes:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.STRLENBYTES,[e])},strLenCP:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.STRLENCP,[e])},substr:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SUBSTR,[e])},substrBytes:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SUBSTRBYTES,[e])},substrCP:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SUBSTRCP,[e])},subtract:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SUBTRACT,[e])},sum:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SUM,[e])},switch:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.SWITCH,[e])},toBool:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TOBOOL,[e])},toDate:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TODATE,[e])},toDecimal:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TODECIMAL,[e])},toDouble:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TODOUBLE,[e])},toInt:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TOINT,[e])},toLong:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TOLONG,[e])},toObjectId:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TOOBJECTID,[e])},toString:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TOSTRING,[e])},toLower:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TOLOWER,[e])},toUpper:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TOUPPER,[e])},trim:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TRIM,[e])},trunc:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TRUNC,[e])},type:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.TYPE,[e])},week:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.WEEK,[e])},year:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.YEAR,[e])},zip:function(e){return new s.AggregateCommand(s.AGGREGATE_COMMANDS_LITERAL.ZIP,[e])}}},t.default=t.commands},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isProjectionCommand=t.ProjectionCommmand=t.projectionCommandsSet=t.PROJECTION_COMMANDS_LITERAL=t.SLICE=void 0;var n,i=r(7);t.SLICE="slice",function(e){e.SLICE="slice"}(n=t.PROJECTION_COMMANDS_LITERAL||(t.PROJECTION_COMMANDS_LITERAL={})),t.projectionCommandsSet=new Set([n.SLICE]);var o=function(){function e(e,t,r){this._internalType=i.SYMBOL_PROJECT_COMMAND,this.operator=e,this.operands=t,this.fieldName=r||i.SYMBOL_UNSET_FIELD_NAME}return e.prototype._setFieldName=function(t){return new e(this.operator,this.operands,t)},e}();t.ProjectionCommmand=o,t.isProjectionCommand=function(e){return e&&e instanceof o&&e._internalType===i.SYMBOL_PROJECT_COMMAND},t.default=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getQueryClass=t.ORDER_DIRECTION=void 0;var n=r(0),i=r(10),o=r(57),a=r(3),s=r(20),u=r(9),c=r(2),l=r(6),f=r(54),d=r(8),_=r(60),p=r(5);!function(e){e.ASC="asc",e.DESC="desc"}(t.ORDER_DIRECTION||(t.ORDER_DIRECTION={})),t.getQueryClass=function(e){var t=function(){function t(t,i){var o=this;if(this.watch=function(t){return a.assertType(t,{onChange:"function",onError:"function"}),e.serviceContext.ws||(e.serviceContext.ws=new _.RealtimeWebSocketClient({serviceContext:e.serviceContext})),e.serviceContext.ws.watch(n.__assign(n.__assign({},t),{envId:e.database.config.env||e.serviceContext.env,collectionName:o.collectionName,query:JSON.stringify(e.engine.QuerySerializer.encode(o._query.where||{})),limit:o._query.limit,orderBy:o._query.order?o._query.order.reduce(function(e,t){return e[t.fieldPath]=t.order,e},{}):void 0,queryType:s.QUERY_TYPE.WHERE,reportAPIName:"cloud.db.collection.watch"}))},!t)throw new c.CloudSDKError({errCode:p.ERR_CODE.SDK_API_PARAMETER_TYPE_ERROR,errMsg:"collectionName must be provided"});this.collectionName=t,this._query=new r(i),Object.defineProperties(this,{_field:{enumerable:!1,configurable:!1,writable:!0}}),this._field=i&&i.field||{}}return t.prototype.field=function(e){return a.assertRequiredParam(e,"object","field"),new t(this.collectionName,n.__assign(n.__assign({},this._query.getProperties()),{field:e}))},t.prototype.where=function(e){return a.assertRequiredParam(e,"condition","where"),this._query.where?new t(this.collectionName,n.__assign(n.__assign({},this._query.getProperties()),{where:f.commands.and(this._query.where,e)})):new t(this.collectionName,n.__assign(n.__assign({},this._query.getProperties()),{where:e}))},t.prototype.orderBy=function(e,r){return a.assertRequiredParam(e,"fieldPath","orderBy"),a.assertRequiredParam(r,"order","orderBy"),new t(this.collectionName,n.__assign(n.__assign({},this._query.getProperties()),{order:n.__spread(this._query.order||[],[{fieldPath:e,order:r}])}))},t.prototype.limit=function(e){return a.assertRequiredParam(e,"max","limit"),new t(this.collectionName,n.__assign(n.__assign({},this._query.getProperties()),{limit:e}))},t.prototype.skip=function(e){return a.assertRequiredParam(e,"offset","skip"),new t(this.collectionName,n.__assign(n.__assign({},this._query.getProperties()),{offset:e}))},t.prototype.get=function(t){var r=this,a="collection.get",f={apiStartTime:+new Date};var _=u.hasAPICallback(t),p=new Promise(function(u,_){return n.__awaiter(r,void 0,void 0,function(){var p,h;return n.__generator(this,function(E){switch(E.label){case 0:return E.trys.push([0,2,3,4]),[4,s.queryDocument({env:e.database.config.env,collectionName:r.collectionName,query:e.engine.QuerySerializer.encode(r._query.where||{}),queryType:s.QUERY_TYPE.WHERE,options:o.extractQueryOptions(r,e),instanceContext:e,timing:f,explain:null===t||void 0===t?void 0:t.explain})];case 1:return p=E.sent(),(null===t||void 0===t?void 0:t.explain)&&d.isDevTools()?(u(p),[2]):(u({data:p.list,errMsg:i.apiSuccessMsg(a)}),[3,4]);case 2:return h=E.sent(),_(c.returnAsFinalCloudSDKError(h,a)),[3,4];case 3:return l.reportAPISpeed(n.__assign(n.__assign({},f),{apiEndTime:+new Date,apiName:"cloud.db."+a})),[7];case 4:return[2]}})})});if(!_)return p;p.then(function(e){u.invokeSuccessCompleteCallbacks(a,t,e)}).catch(function(e){u.invokeFailCompleteCallbacks(a,t,e)})},t.prototype.update=function(t){var r=this,o="collection.update",f={apiStartTime:+new Date};var _=u.hasAPICallback(t),p=new Promise(function(u,_){return n.__awaiter(r,void 0,void 0,function(){var p,h;return n.__generator(this,function(E){switch(E.label){case 0:return E.trys.push([0,2,3,4]),function(){if(a.assertRequiredParam(t,"options","update"),a.assertType(t,{data:"object"}),!r._query.where)throw new c.CloudSDKError({errCode:-1,errMsg:"query condition must be provided"})}(),[4,s.updateDocument({env:e.database.config.env,collectionName:r.collectionName,query:e.engine.QuerySerializer.encode(r._query.where||{}),data:e.engine.UpdateSerializer.encode(t.data),queryType:s.QUERY_TYPE.WHERE,options:{multi:!1!==t.multi,merge:!0},instanceContext:e,timing:f,explain:t.explain})];case 1:return p=E.sent(),(null===t||void 0===t?void 0:t.explain)&&d.isDevTools()?[2,u(p)]:(u({stats:{updated:p.updated},errMsg:i.apiSuccessMsg(o)}),[3,4]);case 2:return h=E.sent(),_(c.returnAsFinalCloudSDKError(h,o)),[3,4];case 3:return l.reportAPISpeed(n.__assign(n.__assign({},f),{apiEndTime:+new Date,apiName:"cloud.db."+o})),[7];case 4:return[2]}})})});if(!_)return p;p.then(function(e){u.invokeSuccessCompleteCallbacks(o,t,e)}).catch(function(e){u.invokeFailCompleteCallbacks(o,t,e)})},t.prototype.remove=function(t){var r=this,o="collection.remove",a={apiStartTime:+new Date};var f=u.hasAPICallback(t),_=new Promise(function(u,f){return n.__awaiter(r,void 0,void 0,function(){var _,p;return n.__generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,3,4]),function(){if(!r._query.where||0===Object.keys(r._query.where).length)throw new c.CloudSDKError({errCode:-1,errMsg:"query condition must be provided and not be empty"})}(),[4,s.removeDocument({env:e.database.config.env,collectionName:r.collectionName,query:e.engine.QuerySerializer.encode(r._query.where||{}),queryType:s.QUERY_TYPE.WHERE,options:{multi:!0},instanceContext:e,timing:a,explain:null===t||void 0===t?void 0:t.explain})];case 1:return _=h.sent(),(null===t||void 0===t?void 0:t.explain)&&d.isDevTools()?[2,u(_)]:(u({stats:{removed:_.removed||0},errMsg:i.apiSuccessMsg(o)}),[3,4]);case 2:return p=h.sent(),f(c.returnAsFinalCloudSDKError(p,o)),[3,4];case 3:return l.reportAPISpeed(n.__assign(n.__assign({},a),{apiEndTime:+new Date,apiName:"cloud.db."+o})),[7];case 4:return[2]}})})});if(!f)return _;_.then(function(e){u.invokeSuccessCompleteCallbacks(o,t,e)}).catch(function(e){u.invokeFailCompleteCallbacks(o,t,e)})},t.prototype.count=function(t){var r=this,o="collection.count",a={apiStartTime:+new Date};var f=u.hasAPICallback(t),_=new Promise(function(u,f){return n.__awaiter(r,void 0,void 0,function(){var _,p;return n.__generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,3,4]),[4,s.countDocument({env:e.database.config.env,collectionName:r.collectionName,query:e.engine.QuerySerializer.encode(r._query.where||{}),queryType:s.QUERY_TYPE.WHERE,instanceContext:e,timing:a,explain:null===t||void 0===t?void 0:t.explain})];case 1:return _=h.sent(),(null===t||void 0===t?void 0:t.explain)&&d.isDevTools()?[2,u(_)]:(u({total:_.total,errMsg:i.apiSuccessMsg(o)}),[3,4]);case 2:return p=h.sent(),f(c.returnAsFinalCloudSDKError(p,o)),[3,4];case 3:return l.reportAPISpeed(n.__assign(n.__assign({},a),{apiEndTime:+new Date,apiName:"cloud.db."+o})),[7];case 4:return[2]}})})});if(!f)return _;_.then(function(e){u.invokeSuccessCompleteCallbacks(o,t,e)}).catch(function(e){u.invokeFailCompleteCallbacks(o,t,e)})},t.prototype.toJSON=function(){},t}(),r=function(){function e(e){this.where=e&&e.where,this.offset=e&&e.offset,this.limit=e&&e.limit,this.order=e&&e.order,this.field=e&&e.field}return e.prototype.getProperties=function(){return{where:this.where,offset:this.offset,limit:this.limit,order:this.order,field:this.field}},e}();return t}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getProjectionDefinition=t.extractQueryOptions=void 0;var n=r(56),i=r(20),o=r(18);t.extractQueryOptions=function(e,t){return{limit:e._query.limit,offset:e._query.offset,order:function(e){return e.map(function(e){return{field:e.fieldPath,direction:e.order===n.ORDER_DIRECTION.DESC?i.ORDER_DIRECTION.DESC:i.ORDER_DIRECTION.ASC}})}(e._query.order||[]),projection:t.engine.ProjectionSerializer.encode(e._field)}},t.getProjectionDefinition=function(e){var t=o.flattenObject(e);for(var r in t)!0===t[r]||1===t[r]?t[r]=1:!1===t[r]||0===t[r]?t[r]=0:delete t[r];return t}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r(0).__exportStar(r(132),t)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.__safe_props__=void 0;var n=r(0);n.__exportStar(r(133),t),n.__exportStar(r(134),t),n.__exportStar(r(135),t),n.__exportStar(r(136),t),n.__exportStar(r(137),t),n.__exportStar(r(138),t);t.__safe_props__=void 0},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.RealtimeWebSocketClient=void 0;var n=r(0),i=r(4),o=r(61),a=r(139),s=r(62),u=r(11),c=r(20),l=r(63),f=r(144),d=r(2),_=r(65),p=r(5),h=r(8),E=r(6),g=r(64),m=r(6),S=r(25),v={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},y=3,T=5e3,A=1e4,C=5e3,O=100,I=function(){function e(e){var t=this;this._virtualWSClient=new Set,this._queryIdClientMap=new Map,this._watchIdClientMap=new Map,this._pingFailed=0,this._pongMissed=0,this._logins=new Map,this._signatures=new Map,this._wsResponseWait=new Map,this._rttObserved=[],this._closedWatches=new Set,this.initWebSocketConnection=function(e,a){return void 0===a&&(a=t._maxReconnect),n.__awaiter(t,void 0,void 0,function(){var t,a,s,c,l,f,_,S,v,y=this;return n.__generator(this,function(T){switch(T.label){case 0:if(this._EJSON||(t=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t;return n.__generator(this,function(n){return e=Date.now(),t=r(17),m.reportAPISpeed({apiName:"_realtime.importBSON",apiStartTime:e,apiEndTime:Date.now()}),[2,t.EJSON]})})}().then(function(e){return y._EJSON=e})),this._fsm.currentState!==o.WSState.DISCONNECTED)return[2];this._fsm.transition(o.WSEvent.CONNECTION_START),this._logins=new Map,this._wsResponseWait=new Map,a=!1,s=[],c=!1,!this._totalConnectionTimeoutId&&this._totalConnectionTimeout&&this._totalConnectionTimeout!==1/0&&(l=this._totalConnectionTimeout,this._totalConnectionTimeoutId=setTimeout(function(){c=!0,y._totalConnectionTimeoutId=void 0;var e=new d.TimeoutError("reconnect timeout (reach totalConnectionTimeout "+l+"s)",{subtype:"totalConnectionTimeout",retryable:!1});E.reportIDKey(g.ErrorID,g.ErrorKey.REALTIME_DB_WS_TOTAL_CONNECTION_TIMEOUT,!0),y._fsm.transition({type:o.WSEvent.CONNECTION_FAIL,error:e})},1e3*l)),f=function(r){var l,f,d,E;return n.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,11,,17]),[4,u.getNetworkStatus()];case 1:return r.sent().isConnected?[3,5]:e?[3,2]:(_._fsm.transition({type:o.WSEvent.CONNECTION_FAIL,error:new Error("network offline")}),[2,{value:void 0}]);case 2:return[4,u.onceNetworkOnline()];case 3:return r.sent(),0===_._virtualWSClient.size?(_.clearTotalReconnectTimeout(),[2,{value:void 0}]):h.isDevTools()?[4,u.sleep(O)]:[3,5];case 4:r.sent(),r.label=5;case 5:return c?[2,{value:void 0}]:[4,_.getSignature(_._connectionEnvId)];case 6:return l=r.sent(),c?[2,{value:void 0}]:(f=Date.now(),[4,new Promise(function(e,t){y._ws=i.getSDK(y._context.identifiers)._socketSkipCheckDomainFactory().connectSocket({url:l.wsUrl,header:{"content-type":"application/json"},perMessageDeflate:!0,success:e,fail:t})})]);case 7:return r.sent(),c?[2,{value:void 0}]:(m.reportAPISpeed({apiName:"_realtime.connectSocket",apiStartTime:f,apiEndTime:Date.now()}),[4,_.initWebSocketEvent()]);case 8:return r.sent(),c?[2,{value:void 0}]:t?[4,t]:[3,10];case 9:if(r.sent(),c)return[2,{value:void 0}];r.label=10;case 10:return a=!0,[2,"break"];case 11:return d=r.sent(),s.unshift(d),d.errCode===p.ERR_CODE.TCB_PERMISSION_DENIED?[2,"break"]:[4,u.getNetworkStatus()];case 12:return E=r.sent().isConnected,c?[2,{value:void 0}]:E?[4,u.sleep(_._reconnectInterval)]:[3,14];case 13:if(r.sent(),c)return[2,{value:void 0}];r.label=14;case 14:return h.isDevTools()?[4,u.sleep(0)]:[3,16];case 15:if(r.sent(),c)return[2,{value:void 0}];r.label=16;case 16:return[3,17];case 17:return[2]}})},_=this,S=this._maxReconnect,T.label=1;case 1:return S>=0?[5,f(S)]:[3,4];case 2:if("object"==typeof(v=T.sent()))return[2,v.value];if("break"===v)return[3,4];T.label=3;case 3:return S--,[3,1];case 4:return a?(this.clearTotalReconnectTimeout(),E.reportIDKey(g.ErrorID,e?g.ErrorKey.REALTIME_DB_RECONNECT_WS_SUCCESS:g.ErrorKey.REALTIME_DB_INIT_WS_SUCCESS,!0),this._fsm.transition(o.WSEvent.CONNECTION_SUCCESS),[2]):(this.clearTotalReconnectTimeout(),E.reportIDKey(g.ErrorID,e?g.ErrorKey.REALTIME_DB_RECONNECT_WS_FAIL:g.ErrorKey.REALTIME_DB_INIT_WS_FAIL,!0),e?this._fsm.transition({type:o.WSEvent.CONNECTION_FAIL,error:new d.CloudSDKError({errCode:p.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WS_FAIL,errMsg:"errors of each retry (latest to oldest): "+JSON.stringify(s.map(function(e){return e+""}))})}):this._fsm.transition({type:o.WSEvent.CONNECTION_FAIL,error:new d.CloudSDKError({errCode:p.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_INIT_WS_FAIL,errMsg:"errors of each retry (latest to oldest): "+JSON.stringify(s.map(function(e){return e+""}))})}),[2])}})})},this.initWebSocketEvent=function(){return new Promise(function(e,r){if(!t._ws)throw new Error("can not initWebSocketEvent, ws not exists");var n=!1;t._ws.onOpen(function(r){t._context.debug&&console.warn("[realtime] ws event: open",r),n=!0,e()});var i=null;t._ws.onError(function(e){i=e,t._logins=new Map,n?(t._context.debug&&console.error("[realtime] ws event: error",e),t.clearHeartbeat(),E.reportIDKey(g.ErrorID,g.ErrorKey.REALTIME_DB_WS_ONERROR_WHILE_ACTIVE,!0)):(t._context.debug&&console.error("[realtime] ws open failed with ws event: error",e),r(e),E.reportIDKey(g.ErrorID,g.ErrorKey.REALTIME_DB_WS_ONERROR_BEFORE_OPEN,!0))}),t._ws.onClose(function(e){t._logins=new Map,t.clearHeartbeat();var r=i||f.getWSCloseError(e.code);switch(e.code){case f.CLOSE_EVENT_CODE.ReconnectOnServerUpgrade:case f.CLOSE_EVENT_CODE.ReconnectWebSocket:case f.CLOSE_EVENT_CODE.NoRealtimeListeners:t._fsm.transition({type:o.WSEvent.DISCONNECT,error:r});break;case f.CLOSE_EVENT_CODE.HeartbeatPingError:case f.CLOSE_EVENT_CODE.HeartbeatPongTimeoutError:case f.CLOSE_EVENT_CODE.NormalClosure:case f.CLOSE_EVENT_CODE.AbnormalClosure:t._maxReconnect>0?(t._fsm.transition({type:o.WSEvent.DISCONNECT,error:r}),t.initWebSocketConnection(!0)):t._fsm.transition({type:o.WSEvent.CONNECTION_FAIL,error:r}),e.code===f.CLOSE_EVENT_CODE.HeartbeatPingError?E.reportIDKey(g.ErrorID,g.ErrorKey.REALTIME_DB_WS_ONCLOSE_HEARTBEAT_PING_FAIL,!0):e.code===f.CLOSE_EVENT_CODE.HeartbeatPongTimeoutError?E.reportIDKey(g.ErrorID,g.ErrorKey.REALTIME_DB_WS_ONCLOSE_HEARTBEAT_PONG_TIMEOUT,!0):E.reportIDKey(g.ErrorID,g.ErrorKey.REALTIME_DB_WS_ONCLOSE_AB_NORMAL_CLOSURE,!0);break;case f.CLOSE_EVENT_CODE.UnauthenticatedIdleConnection:t._fsm.transition({type:o.WSEvent.CONNECTION_FAIL,error:f.getWSCloseError(e.code,e.reason)}),E.reportIDKey(g.ErrorID,g.ErrorKey.REALTIME_DB_WS_ONCLOSE_SERVER_CLOSE_NO_AUTH,!0);break;case f.CLOSE_EVENT_CODE.ServerUpgrade:t._fsm.transition({type:o.WSEvent.DISCONNECT,error:r}),t.initWebSocketConnection(!0),E.reportIDKey(g.ErrorID,g.ErrorKey.REALTIME_DB_WS_ONCLOSE_SERVER_CLOSE_FOR_UPGRADE,!0);break;default:t._maxReconnect>0?(t._fsm.transition({type:o.WSEvent.DISCONNECT,error:r}),t.initWebSocketConnection(!0)):t._fsm.transition({type:o.WSEvent.CONNECTION_FAIL,error:f.getWSCloseError(e.code,e.reason)}),E.reportIDKey(g.ErrorID,g.ErrorKey.REALTIME_DB_WS_ONCLOSE_UNKNOWN_ORIGIN,!0)}E.reportIDKey(g.ErrorID,g.ErrorKey.REALTIME_DB_WS_ONCLOSE,!0)});var a={timing:{},startKey:"apiStartTime",endKey:"apiEndTime",samplePicker:E.socketOnMessageSamplePicker,autoReport:"_realtime.onSocketMessage"};t._ws.onMessage(E.wrapTiming(t.onSocketMessage,a)),t.heartbeat()})},this.isWSConnected=function(){return Boolean(t._ws&&t._ws.readyState===v.OPEN)},this.onSocketMessage=function(e){var r,n=e.data;t.heartbeat();try{r=JSON.parse(n)}catch(e){throw new Error("[realtime] onMessage parse res.data error: "+e)}t._context.debug&&console.log("[realtime] onMessage "+r.msgType+" ("+(new Date).toLocaleString()+")",r);var i=t._wsResponseWait.get(r.requestId);if(i){try{"ERROR"===r.msgType?i.reject(new _.RealtimeErrorMessageError(r)):i.resolve(r)}catch(e){t._context.debug&&console.error("ws onMessage responseWaitSpec.resolve(msg) errored:",e)}finally{t._wsResponseWait.delete(r.requestId)}if(i.skipOnMessage)return}if("PONG"!==r.msgType){var o=r.watchId&&t._watchIdClientMap.get(r.watchId);if(o)o.onMessage(r);else switch(r.watchId?t._closedWatches.has(r.watchId)?E.reportIDKey(g.ErrorID,g.ErrorKey.REALTIME_DB_RECV_MSG_WITH_CLOSED_WATCHID,!0):E.reportIDKey(g.ErrorID,g.ErrorKey.REALTIME_DB_RECV_MSG_WITH_UNKNOWN_WATCHID,!0):E.reportIDKey(g.ErrorID,g.ErrorKey.REALTIME_DB_RECV_MSG_WITHOUT_WATCHID,!0),r.msgType){case"INIT_EVENT":case"NEXT_EVENT":case"CHECK_EVENT":(o=t._queryIdClientMap.get(r.msgData.queryID))&&o.onMessage(r)}}else if(t._lastPingSendTS){var a=Date.now()-t._lastPingSendTS;if(a>A)return void(t._context.debug&&console.warn("[realtime] untrusted rtt observed: "+a));t._rttObserved.length>=y&&t._rttObserved.splice(0,t._rttObserved.length-y+1),t._rttObserved.push(a)}},this.login=function(e,r,i){return n.__awaiter(t,void 0,void 0,function(){var t,o,a,s,c,f,d,_,p=this;return n.__generator(this,function(h){switch(h.label){case 0:if(e=e||this._context.env||this._defaultEnvId,!r)if(e){if(t=this._logins.get(e)){if(t.loggedIn&&t.loginResult)return[2,t.loginResult];if(t.loggingInPromise)return[2,t.loggingInPromise]}}else if((o=this._logins.get(""))&&o.loggingInPromise)return[2,o.loggingInPromise];0,a=new Promise(function(t,o){return n.__awaiter(p,void 0,void 0,function(){var a,s,c,f,d;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,i?E.wrapTiming(this.getSignature(e,r),{timing:i,startKey:"tunnelStartTime",endKey:"tunnelEndTime",condition:{emptyKey:!0}}):this.getSignature(e,r)];case 1:return a=n.sent(),s=u.getWXVersion(),c={watchId:void 0,requestId:l.genRequestId(),msgType:"LOGIN",msgData:{envId:a.envId,signStr:a.signStr,secretVersion:a.secretVersion,referrer:"mp",sdkVersion:s.version,dataVersion:s.updateDateInDashes}},[4,this.send({msg:c,waitResponse:!0,skipOnMessage:!0,timeout:C})];case 2:return(f=n.sent()).msgData.code?o(new Error(f.msgData.code+" "+f.msgData.message)):t({envId:a.envId}),[3,4];case 3:return d=n.sent(),o(d),[3,4];case 4:return[2]}})})}),s=e&&this._logins.get(e),c=Date.now(),s?(s.loggedIn=!1,s.loggingInPromise=a,s.loginStartTS=c):(s={loggedIn:!1,loggingInPromise:a,loginStartTS:c},this._logins.set(e||"",s)),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,a];case 2:if(f=h.sent(),(d=this._logins.get(e||""))&&d===s&&d.loginStartTS===c)return s.loggedIn=!0,s.loggingInPromise=void 0,s.loginStartTS=void 0,s.loginResult=f,[2,f];if(d){if(d.loggedIn&&d.loginResult)return[2,d.loginResult];if(d.loggingInPromise)return[2,d.loggingInPromise];throw new Error("ws unexpected login info")}throw new Error("ws login info reset");case 3:throw _=h.sent(),s.loggedIn=!1,s.loggingInPromise=void 0,s.loginStartTS=void 0,s.loginResult=void 0,_;case 4:return[2]}})})},this.getSignature=function(e,r){return n.__awaiter(t,void 0,void 0,function(){var t,i,o,a;return n.__generator(this,function(s){switch(s.label){case 0:if(e=e||this._context.env||this._defaultEnvId,!r&&e&&this._signatures.has(e)){if(t=this._signatures.get(e),Date.now()<t.expireTS)return[2,t]}else 0;return i=Date.now()+6e4,[4,c.getRealtimeConnectionSignature(this._context,e)];case 1:return o=s.sent(),Date.now()-i>6e4?[2,this.getSignature(e,r)]:(a=n.__assign(n.__assign({},o),{expireTS:i}),this._signatures.set(a.envId,a),e||(this._defaultEnvId=a.envId),[2,a])}})})},this.getWaitExpectedTimeoutLength=function(){return t._rttObserved.length?t._rttObserved.reduce(function(e,t){return e+t})/t._rttObserved.length*1.5:T},this.ping=function(){return n.__awaiter(t,void 0,void 0,function(){var e;return n.__generator(this,function(t){switch(t.label){case 0:return e={watchId:void 0,requestId:l.genRequestId(),msgType:"PING",msgData:null},[4,this.send({msg:e})];case 1:return t.sent(),this._context.debug&&console.log("ping sent"),[2]}})})},this.send=function(e){return new Promise(function(r,i){return n.__awaiter(t,void 0,void 0,function(){var t,a,s,c,l,f=this;return n.__generator(this,function(_){if(this._fsm.currentState!==o.WSState.CONNECTED)return[2,i(new Error("websocket not connected"))];a=!1,s=!1,c=function(e){a=!0,t&&clearTimeout(t),r(e)},l=function(e){s=!0,t&&clearTimeout(t),i(e)},e.timeout&&(t=setTimeout(function(){return n.__awaiter(f,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return a&&s?[3,2]:[4,u.sleep(0)];case 1:e.sent(),a&&s||l(new d.TimeoutError("wsclient.send timedout")),e.label=2;case 2:return[2]}})})},e.timeout));try{if(this._context.debug&&console.log("[realtime] ws send "+e.msg.msgType+" ("+(new Date).toLocaleString()+"): ",e),!this._ws)return l(new Error("invalid state: ws connection not exists, can not send message")),[2];if(this._ws.readyState!==v.OPEN)return l(new Error("ws readyState invalid: "+this._ws.readyState+", can not send message")),[2];e.waitResponse&&this._wsResponseWait.set(e.msg.requestId,{resolve:c,reject:l,skipOnMessage:e.skipOnMessage}),this._ws.send({data:JSON.stringify(e.msg),success:function(t){e.waitResponse||c(t)},fail:function(t){l(t),e.waitResponse&&f._wsResponseWait.delete(e.msg.requestId)}})}catch(e){l(e)}return[2]})})})},this.onWatchStart=function(e,r){t._queryIdClientMap.set(r,e)},this.onWatchClose=function(e,r){r&&t._queryIdClientMap.delete(r),t._watchIdClientMap.delete(e.watchId),t._virtualWSClient.delete(e),t._closedWatches.add(e.watchId),t._virtualWSClient.size||t.close(f.CLOSE_EVENT_CODE.NoRealtimeListeners)},this.getEJSON=function(){return t._EJSON},this._fsm=new s.FSM({initialState:o.WSState.DISCONNECTED,states:o.WSStates}),this._serviceContext=e.serviceContext}return Object.defineProperty(e.prototype,"_context",{get:function(){return this._serviceContext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_maxReconnect",{get:function(){return this._context.appConfig.realtimeMaxReconnect},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_reconnectInterval",{get:function(){return this._context.appConfig.realtimeReconnectInterval},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_totalConnectionTimeout",{get:function(){return this._context.appConfig.realtimeTotalConnectionTimeout},enumerable:!1,configurable:!0}),e.prototype.heartbeat=function(e){var t=this;this.clearHeartbeat(),this._pingTimeoutId=setTimeout(function(){return n.__awaiter(t,void 0,void 0,function(){var e=this;return n.__generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this._ws&&this._ws.readyState===v.OPEN?(this._lastPingSendTS=Date.now(),[4,this.ping()]):[2];case 1:return t.sent(),this._pingFailed=0,this._pongTimeoutId=setTimeout(function(){e._context.debug&&console.error("pong timed out"),e._pongMissed<2?(e._pongMissed++,e.heartbeat(!0)):e.close(f.CLOSE_EVENT_CODE.HeartbeatPongTimeoutError)},this._context.appConfig.realtimePongWaitTimeout),[3,3];case 2:return t.sent(),this._pingFailed<2?(this._pingFailed++,this.heartbeat()):this.close(f.CLOSE_EVENT_CODE.HeartbeatPingError),[3,3];case 3:return[2]}})})},e?0:this._context.appConfig.realtimePingInterval)},e.prototype.clearHeartbeat=function(){this._pingTimeoutId&&clearTimeout(this._pingTimeoutId),this._pongTimeoutId&&clearTimeout(this._pongTimeoutId)},e.prototype.clearTotalReconnectTimeout=function(){this._totalConnectionTimeoutId&&clearTimeout(this._totalConnectionTimeoutId)},e.prototype.close=function(e){this.clearHeartbeat(),this._ws&&(this._ws.close({code:e,reason:f.CLOSE_EVENT_CODE_INFO[e].name}),this._ws=void 0)},e.prototype.watch=function(e){var t=this,r={apiStartTime:Date.now()},i=!1,s=function(){m.reportAPISpeed(n.__assign(n.__assign({},r),{apiName:e.reportAPIName}))},u=e.onChange,c=e.onError;this._fsm.currentState===o.WSState.DISCONNECTED&&(this._connectionEnvId=e.envId,this.initWebSocketConnection(!1));var l=new a.VirtualWebSocketClient(n.__assign(n.__assign({},e),{parentFSM:this._fsm,send:this.send,login:this.login,isWSConnected:this.isWSConnected,getWaitExpectedTimeoutLength:this.getWaitExpectedTimeoutLength,getEJSON:this.getEJSON,getServiceContext:function(){return t._context},onWatchStart:this.onWatchStart,onWatchClose:this.onWatchClose,timing:r,debug:this._context.debug,wsclient:this,onChange:d,onError:_}));this._virtualWSClient.add(l),this._watchIdClientMap.set(l.watchId,l);var f=l.listener;return f;function d(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i||(i=!0,r.apiEndTime=Date.now(),s()),p(),S.default.surroundThirdByTryCatch(function(){return f.onChange.apply(e,t)})()}function _(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i||(i=!0,r.apiEndTime=Date.now(),s()),p(),S.default.surroundThirdByTryCatch(function(){return f.onError.apply(e,t)})()}function p(){f.onChange===d&&(f.onChange=u),f.onError===_&&(f.onError=c)}},e}();t.RealtimeWebSocketClient=I},function(e,t){var r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.WSStates=t.WSEvent=t.WSState=void 0,function(e){e.DISCONNECTED="DISCONNECTED",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED"}(n=t.WSState||(t.WSState={})),function(e){e.CONNECTION_START="connectionStart",e.CONNECTION_SUCCESS="connectionSuccess",e.CONNECTION_FAIL="connectionFail",e.DISCONNECT="disconnect"}(i=t.WSEvent||(t.WSEvent={})),t.WSStates=((r={})[n.DISCONNECTED]={transitions:[{accept:i.CONNECTION_START,to:n.CONNECTING}]},r[n.CONNECTING]={transitions:[{accept:i.CONNECTION_SUCCESS,to:n.CONNECTED},{accept:i.CONNECTION_FAIL,to:n.DISCONNECTED},{accept:i.DISCONNECT,to:n.DISCONNECTED}]},r[n.CONNECTED]={transitions:[{accept:i.DISCONNECT,to:n.DISCONNECTED},{accept:i.CONNECTION_FAIL,to:n.DISCONNECTED}]},r)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isFSMTransitionError=t.FSMTransitionError=t.FSM=void 0;var n=r(0),i=function(){function e(e){for(var t in this.listeners=new Set,this.currentState=e.initialState,this.states=new Map,e.states)this.states.set(t,{name:t,transitions:new Map(e.states[t].transitions.map(function(e){return[e.accept,e.to]}))});this.history={options:{enable:!1,limit:100},transitions:[]},e.history&&("boolean"==typeof e.history?e.history&&(this.history.options.enable=!0):Boolean(e.history.enable)&&(void 0===e.history.limit||null===e.history.limit?this.history.options={enable:!0,limit:100}:e.history.limit>0&&(this.history.options={enable:!0,limit:e.history.limit}))),this.history.options.enable&&this.history.transitions.push({state:this.currentState})}return e.prototype.transition=function(e,t){var r=this;if(t&&(t instanceof Set?!t.has(this.currentState):t!==this.currentState))throw new o("current state ("+this.currentState+") != expected from state ("+(t instanceof Set?JSON.stringify(n.__spread(t)):t)+")","unexpectedFromState");var i="string"==typeof e?{type:e}:e,a=this.states.get(this.currentState),s=a.transitions.get(i.type);if(!s)throw new o("current state ("+this.currentState+') does not accept "'+i.type+'"',"unexpectedInput");this.currentState=s,this.history.options.enable&&(this.history.transitions.push({event:i.type,state:this.currentState}),this.history.transitions.length>this.history.options.limit&&(this.history.transitions.length===this.history.options.limit+1?this.history.transitions.shift():this.history.transitions.splice(0,this.history.transitions.length-this.history.options.limit))),this.listeners.forEach(function(e){try{e({event:i,from:a.name,to:r.currentState})}catch(e){console.error("FSM listener exec error: ",e)}})},e.prototype.canAccept=function(e){return this.states.get(this.currentState).transitions.has(e)},e.prototype.subscribe=function(e){this.listeners.add(e)},e.prototype.unsubscribe=function(e){this.listeners.delete(e)},e.prototype.getHistoryRepresentation=function(e){return this.history.options.enable?"states: "+(e.limit?this.history.transitions.slice(-e.limit):this.history.transitions).map(function(e){var t=e.state,r=e.event;return(r?"-("+r+")->":"")+t}).join(""):""},e}();t.FSM=i;var o=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.type="transition",i.generic=!0,i.subtype=r,i.payload=n,i}return n.__extends(t,e),t}(Error);t.FSMTransitionError=o,t.isFSMTransitionError=function(e){return"transition"===e.type}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isInitEventMessage=t.genRequestId=void 0,t.genRequestId=function(e){return void 0===e&&(e=""),(e?e+"_":"")+ +new Date+"_"+Math.random()},t.isInitEventMessage=function(e){return"INIT_EVENT"===e.msgType}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorKey=t.ErrorID=void 0,t.ErrorID=1128,t.ErrorKey={REALTIME_DB_INIT_WS_SUCCESS:1,REALTIME_DB_INIT_WS_FAIL:2,REALTIME_DB_RECONNECT_WS_SUCCESS:3,REALTIME_DB_RECONNECT_WS_FAIL:4,REALTIME_DB_INIT_WATCH_SUCCESS:5,REALTIME_DB_INIT_WATCH_FAIL:6,REALTIME_DB_REBUILD_WATCH_SUCCESS:7,REALTIME_DB_REBUILD_WATCH_FAIL:8,REALTIME_DB_WS_ONERROR_BEFORE_OPEN:9,REALTIME_DB_WS_ONERROR_WHILE_ACTIVE:10,REALTIME_DB_WS_ONCLOSE:11,REALTIME_DB_WS_ONCLOSE_HEARTBEAT_PING_FAIL:12,REALTIME_DB_WS_ONCLOSE_HEARTBEAT_PONG_TIMEOUT:13,REALTIME_DB_WS_ONCLOSE_AB_NORMAL_CLOSURE:14,REALTIME_DB_WS_ONCLOSE_SERVER_CLOSE_NO_AUTH:15,REALTIME_DB_WS_ONCLOSE_UNKNOWN_ORIGIN:16,REALTIME_DB_WS_TOTAL_CONNECTION_TIMEOUT:17,REALTIME_DB_WS_ONCLOSE_SERVER_CLOSE_FOR_UPGRADE:18,REALTIME_DB_RECV_MSG_WITH_CLOSED_WATCHID:30,REALTIME_DB_RECV_MSG_WITH_UNKNOWN_WATCHID:31,REALTIME_DB_RECV_MSG_WITHOUT_WATCHID:32,REALTIME_DB_HANDLE_EVENT_ERROR:33,REALTIME_DB_RECV_DUPLICATE_EVENT:34,REALTIME_DB_RECV_DUPLICATE_EVENT_AND_EVENT_OUT_OF_ORDER:35,REALTIME_DB_UNEXPECTED_EVENT_DATATYPE_UPDATE_NO_ASSOCIATED_DOC:36,REALTIME_DB_UNEXPECTED_EVENT_REMOVE_NO_ASSOCIATED_DOC:37,REALTIME_DB_UNEXPECTED_EVENT_DEQUEUE_NO_ASSOCIATED_DOC:38,REALTIME_DB_UNEXPECTED_EVENT_QUEUETYPE_UPDATE_NO_ASSOCIATED_DOC:39,REALTIME_DB_EVENT_OUT_OF_ORDER:40,REALTIME_DB_INIT_WATCH_FAIL_SERVER_SIGN_ERROR:50,REALTIME_DB_REBUILD_WATCH_FAIL_SERVER_SIGN_ERROR:51,REALTIME_DB_INIT_WATCH_FAIL_SERVER_OTHER_ERROR:52,REALTIME_DB_REBUILD_WATCH_FAIL_SERVER_OTHER_ERROR:53,REALTIME_DB_INIT_WATCH_FAIL_TIMEOUT_ERROR_TOTAL_CONNECTION:54,REALTIME_DB_REBUILD_WATCH_FAIL_TIMEOUT_ERROR_TOTAL_CONNECTION:55,REALTIME_DB_REBUILD_WATCH_FAIL_TIMEOUT_ERROR_QUERY_EVENT_CACHE:56,REALTIME_DB_INIT_WATCH_FAIL_CANCELLED_ERROR:57,REALTIME_DB_REBUILD_WATCH_FAIL_CANCELLED_ERROR:58,REALTIME_DB_INIT_WATCH_FAIL_UNKNOWN_ERROR:59,REALTIME_DB_REBUILD_WATCH_FAIL_UNKNOWN_ERROR:60}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isRealtimeErrorMessageError=t.RealtimeErrorMessageError=void 0;var n=r(0),i=function(e){function t(t){var r=e.call(this,"Watch Error "+JSON.stringify(t.msgData)+" (requestid: "+t.requestId+")")||this;return r.isRealtimeErrorMessageError=!0,r.payload=t,r}return n.__extends(t,e),t}(Error);t.RealtimeErrorMessageError=i,t.isRealtimeErrorMessageError=function(e){return e&&e.isRealtimeErrorMessageError}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AggregateSerializer=void 0;var n=r(18),i=r(30),o=r(29),a=r(1),s=r(21),u=r(36),c=function(){function e(){}return e.encodeStages=function(e){return(new l).encodeStages(e)},e.encode=function(e){return(new l).encodeAny(e)},e}();t.AggregateSerializer=c;var l=function(){function e(){}return e.prototype.encodeStages=function(e){var t=this;return e.map(function(e){return t.encodePipelineStage(e)})},e.prototype.encodeAny=function(e){var t=this;return n.isConversionRequired(e)?i.isPipeline(e)?this.encodePipeline(e):i.isPipelineStage(e)?this.encodePipelineStage(e):o.isAggregateCommand(e)?this.encodeAggregateCommand(e):n.encodeInternalDataType(e):a.isObject(e)?this.encodeObject(e):a.isArray(e)?e.map(function(e){return t.encodeAny(e)}):e},e.prototype.encodeObject=function(e){var t={};for(var r in e)t[r]=this.encodeAny(e[r]);return t},e.prototype.encodePipeline=function(e){var t=this;return e._stages.map(function(e){return t.encodeAny(e)})},e.prototype.encodePipelineStage=function(e){var t,r,n="$"+e.stage;switch(e.stage){case"match":return(t={})[n]=u.QuerySerializer.encode(e.val),t;default:return(r={})[n]=this.encodeAny(e.val),r}},e.prototype.encodeAggregateCommand=function(e){var t;return(t={})[s.aggregateOperatorToString(e.operator)]=this.encodeAny(e.operands[0]),t},e}()},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.invokeOperateWXData=void 0;var n=r(0),i=r(4);t.invokeOperateWXData=function(e,t){return new Promise(function(r,o){(t||i.getSDK()).invokeOperateWXData(n.__assign(n.__assign({},e),{success:r,fail:o}))})}},function(e,t,r){"use strict";(function(e){var r="object"==typeof e&&e&&e.Object===Object&&e;t.a=r}).call(this,r(13))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(70),i=r(52),o=n.getCloudInstance();o.registerService(i.createWebService(o)),o.exportAPI.version={updateTime:"2022.06.27 10:04:07",version:"1.4.0"},"undefined"!=typeof wx&&(wx.cloud=o.exportAPI),window.cloud=o.exportAPI},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);n.__exportStar(r(71),t),n.__exportStar(r(158),t),n.__exportStar(r(4),t)},function(e,t,r){(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.InstanceCloud=t.DefaultCloud=t.getCloudAPI=t.getCloudInstance=void 0;var n=r(0),i=r(72),o=r(73),a=r(32),s=r(2),u=r(1),c=r(38),l=r(5),f=r(4),d=r(8),_=r(6),p=r(157),h=r(49),E=r(32),g=r(26),m=r(11),S=r(48),v=r(8);t.getCloudInstance=function(e){void 0===e&&(e={});var t=e.sdk,r=e.identifiers||{};return t&&f.setSDK(r,t),new y(r,!1)},t.getCloudAPI=function(e){return void 0===e&&(e={}),t.getCloudInstance(e).exportAPI};var y=function(){function t(t,i){var a=this;this.inited=!1,this.services={},this.apiServiceMap={},this.debug=!1,this.testSpeed=function(){return n.__awaiter(a,void 0,void 0,function(){var e,t,r;return n.__generator(this,function(n){return e=+new Date,t=e,r=c.constructTunnelReq({cloud:this,apiName:"tcbapi_testspeed",serializedReqData:null}),[2,c.tunnel(r,{fireOnIdle:!0,onFire:function(){e=+new Date,t=e}}).then(function(r){_.reportAPISpeed({apiName:"cloud.testspeed",apiEndTime:+new Date,apiStartTime:e,tunnelEndTime:+new Date,tunnelStartTime:t,tunnelTimeNoCSNetCost:r.data.baseresponse.stat.qbase_cost_time})}).catch(function(e){0})]})})},this.identifiers=t,this.isInstance=i,this.runtimeInfo=h.getRuntimeInfo(),this.serviceEndpoint=new g.ServiceEndpoint(t),this.request=c.getBoundTunnelRequest({cloud:this});var s=this;this.exportAPI={init:this.init.bind(this)},this.isInstance||(this.exportAPI.Cloud=function(e){return new T(t,s,e).exportAPI}),o.registerServices(this),this.meta={session_id:Date.now()+""},this.meta.session_id=r(163).v4(),this.serviceEndpoint.setMetaData(this.getMetaData()),this.serviceEndpoint.setTunnelRequest(this.request),this.config={database:A()},this.appConfig=n.__assign({},p.default),this.apiPermissions={};try{d.default.onReady(function(){setTimeout(function(){_.init()},2e3),S.getUA()}),e.env.TEST&&(this.exportAPI.getCloudInstance=function(){return a})}catch(e){}}return t.prototype.getMetaData=function(){var e;if(!this.meta.sdk_version){var t=f.getSDK(this.identifiers);if(t){var r=t.wx;r&&r.version&&("miniprogram"===this.runtimeInfo.env?this.meta.sdk_version="wx-miniprogram-sdk/"+r.version.version+" ("+Date.parse(r.version.updateTime+" GMT+0800")+")":this.meta.sdk_version="wx-web-sdk/1.4.0 ("+Date.parse("2022.06.27 10:04:07 GMT+0800")+")")}}return this.meta.filter_user_info="singlePage"===(null===(e=v.default.appLaunchInfo)||void 0===e?void 0:e.mode),this.meta},t.prototype.getConfig=function(){return this.config},t.prototype.getEnvForService=function(e){if(this.isInstance)return this.instanceOptions.resourceEnv;var t=this.config;if(t.env)switch(u.getType(t.env)){case"string":return t.env;case"object":return t.env[e];default:return}},t.prototype.checkAPIPermission=function(e){return!this.apiPermissions.hasOwnProperty(e)||1===this.apiPermissions[e]},t.prototype.init=function(e){var t=this;void 0===e&&(e={}),this.inited=!0,this.initConfig(e),setTimeout(function(){r(44)});try{m.privateGetBackgroundFetchData(500,this.identifiers)}catch(e){null===m._wxConsole||void 0===m._wxConsole||m._wxConsole.log("privateGetBackgroundFetchData error",e)}return Promise.all([this.sendInitRequest().then(function(){t.testSpeed()})]).then(function(){})},t.prototype.initConfig=function(e){this.config=JSON.parse(JSON.stringify(e)),this.config.database?this.config.database=i.default(this.config.database,A()):this.config.database=A()},t.prototype.sendInitRequest=function(){var e=this,t="string"==typeof this.config.env?this.config.env:void 0,r=JSON.stringify({trace_user:!1!==this.config.traceUser,env:t,region:this.config.region}),i=+new Date,o=i;return this.request(n.__assign(n.__assign({},this.config),{apiName:"tcbapi_init",serializedReqData:r,env:t})).then(function(t){var r=+new Date,a=t.data;e.appConfig=n.__assign(n.__assign({},e.appConfig),a.config);for(var s=a.tcb_api_list||[],u=0,c=s.length;u<c;u++)e.apiPermissions[s[u].apiname]=s[u].status;_.reportAPISpeed({apiName:"cloud.init",apiEndTime:+new Date,apiStartTime:i,tunnelEndTime:r,tunnelStartTime:o,tunnelTimeNoCSNetCost:a.baseresponse.stat.qbase_cost_time})}).catch(function(e){console.error("cloud init error: ",e)})},t.prototype.registerService=function(e){this.services[e.name]=e;var t=e.getAPIs();for(var r in t)if(this.apiServiceMap[r]=e.name,"function"==typeof t[r])this.registerFunction(r,!0,t[r]);else{var n=t[r],i=n.initRequired,o=n.fn;this.registerFunction(r,i,o)}},t.prototype.registerFunction=function(e,t,r){var n=this;this.exportAPI[e]=t?function(){if(!n.inited)throw new s.CloudSDKError({errMsg:"Cloud API isn't enabled, please call wx.cloud.init first\nè¯·å…ˆè°ƒç”¨ wx.cloud.init() å®Œæˆåˆå§‹åŒ–åŽå†è°ƒç”¨å…¶ä»–äº‘ APIã€‚"});if(!n.checkAPIPermission(e))throw new s.CloudSDKError({errCode:l.ERR_CODE.SDK_API_PERMISSION_DENIED,errMsg:l.ERR_CODE[l.ERR_CODE.SDK_API_PERMISSION_DENIED]});return r.apply(n,arguments)}:r},t.prototype.toJSON=function(){},t}();t.DefaultCloud=y;var T=function(e){function t(t,r,n){var o=e.call(this,t,!0)||this;if("web"===o.runtimeInfo.env){if(!n.identityless&&!n.appid)throw new Error("appid must be provided");if(!n.resourceAppid)throw new Error("resourceAppid must be provided")}if(!n.resourceEnv)throw new Error("resourceEnv must be provided");if(n.config||(n.config={}),o.defaultInstance=r,o.instanceOptions=JSON.parse(JSON.stringify(n)),o.meta=r.meta,o.apiPermissions=r.apiPermissions,o.instanceOptions.config.database=i.default(A(),o.instanceOptions.config.database||{}),"web"===o.runtimeInfo.env){if(o.exportAPI.init=o.webInit.bind(o),o.webRequest=E.getBoundAuthRequest(o),o.registerService(a.createWebService(o)),!o.instanceOptions.identityless&&(o.authStorage=o.defaultInstance.authStorage,!o.authStorage))throw new Error("authStorage not found")}else o.exportAPI.init=o.miniprogramInit.bind(o);return o.instanceOptions.resourceAppid&&(o.exportAPI.refreshAuth=o.refreshAuth.bind(o)),o}return n.__extends(t,e),t.prototype.miniprogramInit=function(){return n.__awaiter(this,void 0,void 0,function(){var t,r;return n.__generator(this,function(n){switch(n.label){case 0:return this.inited?[2]:this.instanceOptions.resourceAppid?[4,this.refreshAuth()]:[3,2];case 1:return t=n.sent(),0===(r=t.data.env_auth_info).errCode?(e.prototype.init.call(this),[2,{errCode:r.errCode,errMsg:r.errMsg,expireTime:1e3*r.expire_time}]):[2,{errCode:r.errCode,errMsg:r.errMsg}];case 2:return e.prototype.init.call(this),[2]}})})},t.prototype.webInit=function(){return n.__awaiter(this,void 0,void 0,function(){var t,r,i=this;return n.__generator(this,function(n){switch(n.label){case 0:return this.inited?[2]:this.instanceOptions.identityless?[3,2]:[4,this.refreshAuth()];case 1:return t=n.sent(),0===(r=t.data.env_auth_info).errCode?(this.sendInitRequest().then(function(){i.testSpeed()}),e.prototype.init.call(this),[2,{errCode:r.errCode,errMsg:r.errMsg,expireTime:1e3*r.expire_time}]):[2,{errCode:r.errCode,errMsg:r.errMsg}];case 2:return this.inited=!0,[2]}})})},t.prototype.webRefreshToken=function(){return n.__awaiter(this,void 0,void 0,function(){var e=this;return n.__generator(this,function(t){return this._webCurrentRefreshTokenPromise?[2,this._webCurrentRefreshTokenPromise]:(this._webCurrentRefreshTokenPromise=new Promise(function(t,r){return n.__awaiter(e,void 0,void 0,function(){var e,i,o;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,3,4]),[4,this.webRequest({url:"/refresh_token",method:"POST",json:{appid:this.instanceOptions.appid,refresh_token:this.authStorage.getItem("refreshToken")}})];case 1:return e=n.sent(),i=e.data,this.authStorage.setItem("appid",i.access_token),t(),[3,4];case 2:return o=n.sent(),r(o),[3,4];case 3:return this._webCurrentRefreshTokenPromise=void 0,[7];case 4:return[2]}})})}),[2,this._webCurrentRefreshTokenPromise])})})},t.prototype.refreshAuth=function(){var e=JSON.stringify({resource_appid:this.instanceOptions.resourceAppid,resource_env:this.instanceOptions.resourceEnv}),t=+new Date,r=t,n=this.request({apiName:"tcbapi_getenvauth",serializedReqData:e});return n.then(function(e){var n=+new Date;_.reportAPISpeed({apiName:"cloud.refreshAuth",apiEndTime:+new Date,apiStartTime:t,tunnelEndTime:n,tunnelStartTime:r})}),n},t}(y);function A(){return{realtime:{maxReconnect:p.clientConfigDefaults.REALTIME_DB_MAX_RECONNECT,reconnectInterval:p.clientConfigDefaults.REALTIME_DB_WS_RECONNECT_INTERVAL,totalConnectionTimeout:p.clientConfigDefaults.REALTIME_DB_TOTAL_CONNECTION_TIMEOUT}}}t.InstanceCloud=T}).call(this,r(22))},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);function i(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}t.default=function e(t,r){var o,a;if(t===r)return t;try{for(var s=n.__values(Object.keys(r)),u=s.next();!u.done;u=s.next()){var c=u.value,l=i(r,c),f=i(t,c),d=void 0;"object"==typeof l?e(d=f||{},l):d=l,t[c]=d}}catch(e){o={error:e}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(o)throw o.error}}return t}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerServices=void 0;var n=r(74),i=r(100),o=r(108),a=r(127),s=r(153);t.registerServices=function(e){n.registerService(e),o.registerService(e),a.registerService(e),s.registerService(e),i.registerService(e)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerService=t.FUNCTIONS_SERVICE_NAME=void 0;var n=r(75);t.FUNCTIONS_SERVICE_NAME="functions",t.registerService=function(e){e.registerService(function(e){var r={name:t.FUNCTIONS_SERVICE_NAME,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,get debug(){return e.debug},get env(){return e.getEnvForService(t.FUNCTIONS_SERVICE_NAME)},appConfig:{get maxReqDataSize(){return e.appConfig.call_function_max_req_data_size},get maxPollRetry(){return e.appConfig.call_function_poll_max_retry},get maxStartRetryGap(){return e.appConfig.call_function_valid_start_retry_gap},get clientPollTimeout(){return e.appConfig.call_function_client_poll_timeout}}};return{name:t.FUNCTIONS_SERVICE_NAME,context:r,getAPIs:n.getAPIs.bind(null,r)}}(e))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getAPIs=void 0;var n=r(23);t.getAPIs=function(e){return{callFunction:n.default(e)}}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e,t){var r=null,n=!1,i=function(){r?n=!0:(e(),r=setTimeout(function(){clearTimeout(r),r=null,n&&(n=!1,i())},t))};return i}},function(e,t,r){(function(e){var n=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},r(78),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||globalThis&&globalThis.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||globalThis&&globalThis.clearImmediate}).call(this,r(13))},function(e,t,r){(function(e,t){!function(e,r){"use strict";if(!e.setImmediate){var n,i=1,o={},a=!1,s=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick(function(){l(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?function(){var t="setImmediate$"+Math.random()+"$",r=function(r){r.source===e&&"string"==typeof r.data&&0===r.data.indexOf(t)&&l(+r.data.slice(t.length))};e.addEventListener?e.addEventListener("message",r,!1):e.attachEvent("onmessage",r),n=function(r){e.postMessage(t+r,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){l(e.data)},n=function(t){e.port2.postMessage(t)}}():s&&"onreadystatechange"in s.createElement("script")?function(){var e=s.documentElement;n=function(t){var r=s.createElement("script");r.onreadystatechange=function(){l(t),r.onreadystatechange=null,e.removeChild(r),r=null},e.appendChild(r)}}():n=function(e){setTimeout(l,0,e)},u.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var a={callback:e,args:t};return o[i]=a,n(i),i++},u.clearImmediate=c}function c(e){delete o[e]}function l(e){if(a)setTimeout(l,0,e);else{var t=o[e];if(t){a=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(r,n)}}(t)}finally{c(e),a=!1}}}}}("undefined"==typeof self?void 0===e?globalThis:e:self)}).call(this,r(13),r(22))},function(e,t,r){"use strict";var n=r(39),i=n.Reader,o=n.Writer,a=n.util,s=n.roots.default||(n.roots.default={});s.QBaseApiData=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.qbase_api_name="",e.prototype.qbase_meta=null,e.prototype.qbase_options=null,e.prototype.qbase_req="",e.prototype.cli_req_id="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=o.create()),null!=e.qbase_api_name&&Object.hasOwnProperty.call(e,"qbase_api_name")&&t.uint32(10).string(e.qbase_api_name),null!=e.qbase_meta&&Object.hasOwnProperty.call(e,"qbase_meta")&&s.QBaseApiData.QBaseMeta.encode(e.qbase_meta,t.uint32(18).fork()).ldelim(),null!=e.qbase_options&&Object.hasOwnProperty.call(e,"qbase_options")&&s.QBaseApiData.QBaseOptions.encode(e.qbase_options,t.uint32(26).fork()).ldelim(),null!=e.qbase_req&&Object.hasOwnProperty.call(e,"qbase_req")&&t.uint32(34).string(e.qbase_req),null!=e.cli_req_id&&Object.hasOwnProperty.call(e,"cli_req_id")&&t.uint32(42).string(e.cli_req_id),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new s.QBaseApiData;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.qbase_api_name=e.string();break;case 2:n.qbase_meta=s.QBaseApiData.QBaseMeta.decode(e,e.uint32());break;case 3:n.qbase_options=s.QBaseApiData.QBaseOptions.decode(e,e.uint32());break;case 4:n.qbase_req=e.string();break;case 5:n.cli_req_id=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.qbase_api_name&&e.hasOwnProperty("qbase_api_name")&&!a.isString(e.qbase_api_name))return"qbase_api_name: string expected";var t;if(null!=e.qbase_meta&&e.hasOwnProperty("qbase_meta")&&(t=s.QBaseApiData.QBaseMeta.verify(e.qbase_meta)))return"qbase_meta."+t;if(null!=e.qbase_options&&e.hasOwnProperty("qbase_options")&&(t=s.QBaseApiData.QBaseOptions.verify(e.qbase_options)))return"qbase_options."+t;return null!=e.qbase_req&&e.hasOwnProperty("qbase_req")&&!a.isString(e.qbase_req)?"qbase_req: string expected":null!=e.cli_req_id&&e.hasOwnProperty("cli_req_id")&&!a.isString(e.cli_req_id)?"cli_req_id: string expected":null},e.fromObject=function(e){if(e instanceof s.QBaseApiData)return e;var t=new s.QBaseApiData;if(null!=e.qbase_api_name&&(t.qbase_api_name=String(e.qbase_api_name)),null!=e.qbase_meta){if("object"!=typeof e.qbase_meta)throw TypeError(".QBaseApiData.qbase_meta: object expected");t.qbase_meta=s.QBaseApiData.QBaseMeta.fromObject(e.qbase_meta)}if(null!=e.qbase_options){if("object"!=typeof e.qbase_options)throw TypeError(".QBaseApiData.qbase_options: object expected");t.qbase_options=s.QBaseApiData.QBaseOptions.fromObject(e.qbase_options)}return null!=e.qbase_req&&(t.qbase_req=String(e.qbase_req)),null!=e.cli_req_id&&(t.cli_req_id=String(e.cli_req_id)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.qbase_api_name="",r.qbase_meta=null,r.qbase_options=null,r.qbase_req="",r.cli_req_id=""),null!=e.qbase_api_name&&e.hasOwnProperty("qbase_api_name")&&(r.qbase_api_name=e.qbase_api_name),null!=e.qbase_meta&&e.hasOwnProperty("qbase_meta")&&(r.qbase_meta=s.QBaseApiData.QBaseMeta.toObject(e.qbase_meta,t)),null!=e.qbase_options&&e.hasOwnProperty("qbase_options")&&(r.qbase_options=s.QBaseApiData.QBaseOptions.toObject(e.qbase_options,t)),null!=e.qbase_req&&e.hasOwnProperty("qbase_req")&&(r.qbase_req=e.qbase_req),null!=e.cli_req_id&&e.hasOwnProperty("cli_req_id")&&(r.cli_req_id=e.cli_req_id),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e.QBaseMeta=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.first_launch=!1,e.prototype.session_id="",e.prototype.sdk_version="",e.prototype.filter_user_info=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=o.create()),null!=e.first_launch&&Object.hasOwnProperty.call(e,"first_launch")&&t.uint32(8).bool(e.first_launch),null!=e.session_id&&Object.hasOwnProperty.call(e,"session_id")&&t.uint32(18).string(e.session_id),null!=e.sdk_version&&Object.hasOwnProperty.call(e,"sdk_version")&&t.uint32(26).string(e.sdk_version),null!=e.filter_user_info&&Object.hasOwnProperty.call(e,"filter_user_info")&&t.uint32(32).bool(e.filter_user_info),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new s.QBaseApiData.QBaseMeta;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.first_launch=e.bool();break;case 2:n.session_id=e.string();break;case 3:n.sdk_version=e.string();break;case 4:n.filter_user_info=e.bool();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.first_launch&&e.hasOwnProperty("first_launch")&&"boolean"!=typeof e.first_launch?"first_launch: boolean expected":null!=e.session_id&&e.hasOwnProperty("session_id")&&!a.isString(e.session_id)?"session_id: string expected":null!=e.sdk_version&&e.hasOwnProperty("sdk_version")&&!a.isString(e.sdk_version)?"sdk_version: string expected":null!=e.filter_user_info&&e.hasOwnProperty("filter_user_info")&&"boolean"!=typeof e.filter_user_info?"filter_user_info: boolean expected":null},e.fromObject=function(e){if(e instanceof s.QBaseApiData.QBaseMeta)return e;var t=new s.QBaseApiData.QBaseMeta;return null!=e.first_launch&&(t.first_launch=Boolean(e.first_launch)),null!=e.session_id&&(t.session_id=String(e.session_id)),null!=e.sdk_version&&(t.sdk_version=String(e.sdk_version)),null!=e.filter_user_info&&(t.filter_user_info=Boolean(e.filter_user_info)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.first_launch=!1,r.session_id="",r.sdk_version="",r.filter_user_info=!1),null!=e.first_launch&&e.hasOwnProperty("first_launch")&&(r.first_launch=e.first_launch),null!=e.session_id&&e.hasOwnProperty("session_id")&&(r.session_id=e.session_id),null!=e.sdk_version&&e.hasOwnProperty("sdk_version")&&(r.sdk_version=e.sdk_version),null!=e.filter_user_info&&e.hasOwnProperty("filter_user_info")&&(r.filter_user_info=e.filter_user_info),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),e.QBaseOptions=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.env="",e.prototype.appid="",e.prototype.region="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=o.create()),null!=e.env&&Object.hasOwnProperty.call(e,"env")&&t.uint32(10).string(e.env),null!=e.appid&&Object.hasOwnProperty.call(e,"appid")&&t.uint32(18).string(e.appid),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(26).string(e.region),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new s.QBaseApiData.QBaseOptions;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.env=e.string();break;case 2:n.appid=e.string();break;case 3:n.region=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.env&&e.hasOwnProperty("env")&&!a.isString(e.env)?"env: string expected":null!=e.appid&&e.hasOwnProperty("appid")&&!a.isString(e.appid)?"appid: string expected":null!=e.region&&e.hasOwnProperty("region")&&!a.isString(e.region)?"region: string expected":null},e.fromObject=function(e){if(e instanceof s.QBaseApiData.QBaseOptions)return e;var t=new s.QBaseApiData.QBaseOptions;return null!=e.env&&(t.env=String(e.env)),null!=e.appid&&(t.appid=String(e.appid)),null!=e.region&&(t.region=String(e.region)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.env="",r.appid="",r.region=""),null!=e.env&&e.hasOwnProperty("env")&&(r.env=e.env),null!=e.appid&&e.hasOwnProperty("appid")&&(r.appid=e.appid),null!=e.region&&e.hasOwnProperty("region")&&(r.region=e.region),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),e}(),e.exports=s},function(e,t,r){"use strict";var n=t;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r(40),n.BufferWriter=r(89),n.Reader=r(41),n.BufferReader=r(90),n.util=r(14),n.rpc=r(91),n.roots=r(93),n.configure=i,i()},function(e,t,r){"use strict";e.exports=function(e,t){var r=new Array(arguments.length-1),n=0,i=2,o=!0;for(;i<arguments.length;)r[n++]=arguments[i++];return new Promise(function(i,a){r[n]=function(e){if(o)if(o=!1,e)a(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){o&&(o=!1,a(e))}})}},function(e,t,r){"use strict";var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var i=new Array(64),o=new Array(123),a=0;a<64;)o[i[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;n.encode=function(e,t,r){for(var n,o=null,a=[],s=0,u=0;t<r;){var c=e[t++];switch(u){case 0:a[s++]=i[c>>2],n=(3&c)<<4,u=1;break;case 1:a[s++]=i[n|c>>4],n=(15&c)<<2,u=2;break;case 2:a[s++]=i[n|c>>6],a[s++]=i[63&c],u=0}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return u&&(a[s++]=i[n],a[s++]=61,1===u&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))};n.decode=function(e,t,r){for(var n,i=r,a=0,s=0;s<e.length;){var u=e.charCodeAt(s++);if(61===u&&a>1)break;if(void 0===(u=o[u]))throw Error("invalid encoding");switch(a){case 0:n=u,a=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,a=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,a=3;break;case 3:t[r++]=(3&n)<<6|u,a=0}}if(1===a)throw Error("invalid encoding");return r-i},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},function(e,t,r){"use strict";function n(){this._listeners={}}e.exports=n,n.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},n.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},n.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},function(e,t,r){"use strict";function n(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function o(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function s(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:o,e.writeFloatBE=n?o:i,e.readFloatLE=n?a:s,e.readFloatBE=n?s:a}():function(){function t(e,t,r,n){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>3.4028234663852886e38)e((i<<31|2139095040)>>>0,r,n);else if(t<1.1754943508222875e-38)e((i<<31|Math.round(t/1.401298464324817e-45))>>>0,r,n);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=2*(n>>31)+1,o=n>>>23&255,a=8388607&n;return 255===o?a?NaN:i*(1/0):0===o?1.401298464324817e-45*i*a:i*Math.pow(2,o-150)*(a+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,o),e.readFloatLE=r.bind(null,a),e.readFloatBE=r.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function o(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function s(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:o,e.writeDoubleBE=n?o:i,e.readDoubleLE=n?a:s,e.readDoubleBE=n?s:a}():function(){function t(e,t,r,n,i,o){var a=n<0?1:0;if(a&&(n=-n),0===n)e(0,i,o+t),e(1/n>0?0:2147483648,i,o+r);else if(isNaN(n))e(0,i,o+t),e(2146959360,i,o+r);else if(n>1.7976931348623157e308)e(0,i,o+t),e((a<<31|2146435072)>>>0,i,o+r);else{var s;if(n<2.2250738585072014e-308)e((s=n/5e-324)>>>0,i,o+t),e((a<<31|s/4294967296)>>>0,i,o+r);else{var u=Math.floor(Math.log(n)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(s=n*Math.pow(2,-u))>>>0,i,o+t),e((a<<31|u+1023<<20|1048576*s&1048575)>>>0,i,o+r)}}}function r(e,t,r,n,i){var o=e(n,i+t),a=e(n,i+r),s=2*(a>>31)+1,u=a>>>20&2047,c=4294967296*(1048575&a)+o;return 2047===u?c?NaN:s*(1/0):0===u?5e-324*s*c:s*Math.pow(2,u-1075)*(c+4503599627370496)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,o,4,0),e.readDoubleLE=r.bind(null,a,0,4),e.readDoubleBE=r.bind(null,s,4,0)}(),e}function i(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function o(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=n(n)},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},function(e,t,r){"use strict";var n=t;n.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},n.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,o=[],a=0;t<r;)(n=e[t++])<128?o[a++]=n:n>191&&n<224?o[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(n>>10),o[a++]=56320+(1023&n)):o[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},n.write=function(e,t,r){for(var n,i,o=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(a+1)))?(n=65536+((1023&n)<<10)+(1023&i),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-o}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=r||8192,i=n>>>1,o=null,a=n;return function(r){if(r<1||r>i)return e(r);a+r>n&&(o=e(n),a=0);var s=t.call(o,a,a+=r);return 7&a&&(a=1+(7|a)),s}}},function(e,t,r){"use strict";e.exports=i;var n=r(14);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=i.zero=new i(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e)){if(!n.Long)return i.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):o},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var s=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?o:new i((s.call(e,0)|s.call(e,1)<<8|s.call(e,2)<<16|s.call(e,3)<<24)>>>0,(s.call(e,4)|s.call(e,5)<<8|s.call(e,6)<<16|s.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},function(e,t,r){"use strict";e.exports=o;var n=r(40);(o.prototype=Object.create(n.prototype)).constructor=o;var i=r(14);function o(){n.call(this)}function a(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}o._configure=function(){o.alloc=i._Buffer_allocUnsafe,o.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},o.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(o.writeBytesBuffer,t,e),this},o.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},o._configure()},function(e,t,r){"use strict";e.exports=o;var n=r(41);(o.prototype=Object.create(n.prototype)).constructor=o;var i=r(14);function o(e){n.call(this,e)}o._configure=function(){i.Buffer&&(o.prototype._slice=i.Buffer.prototype.slice)},o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},o._configure()},function(e,t,r){"use strict";t.Service=r(92)},function(e,t,r){"use strict";e.exports=i;var n=r(14);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,o,a){if(!o)throw TypeError("request must be specified");var s=this;if(!a)return n.asPromise(e,s,t,r,i,o);if(s.rpcImpl)try{return s.rpcImpl(t,r[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),function(e,r){if(e)return s.emit("error",e,t),a(e);if(null!==r){if(!(r instanceof i))try{r=i[s.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return s.emit("error",e,t),a(e)}return s.emit("data",r,t),a(null,r)}s.end(!0)})}catch(e){return s.emit("error",e,t),void setTimeout(function(){a(e)},0)}else setTimeout(function(){a(Error("already ended"))},0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(e,t,r){"use strict";e.exports={}},function(e,t,r){"use strict";t.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){for(var t,r=c(e),n=r[0],a=r[1],s=new o(function(e,t,r){return 3*(t+r)/4-r}(0,n,a)),u=0,l=a>0?n-4:n,f=0;f<l;f+=4)t=i[e.charCodeAt(f)]<<18|i[e.charCodeAt(f+1)]<<12|i[e.charCodeAt(f+2)]<<6|i[e.charCodeAt(f+3)],s[u++]=t>>16&255,s[u++]=t>>8&255,s[u++]=255&t;2===a&&(t=i[e.charCodeAt(f)]<<2|i[e.charCodeAt(f+1)]>>4,s[u++]=255&t);1===a&&(t=i[e.charCodeAt(f)]<<10|i[e.charCodeAt(f+1)]<<4|i[e.charCodeAt(f+2)]>>2,s[u++]=t>>8&255,s[u++]=255&t);return s},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],a=0,s=r-i;a<s;a+=16383)o.push(f(e,a,a+16383>s?s:a+16383));1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=a.length;s<u;++s)n[s]=a[s],i[a.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e){return n[e>>18&63]+n[e>>12&63]+n[e>>6&63]+n[63&e]}function f(e,t,r){for(var n,i=[],o=t;o<r;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(l(n));return i.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,c=u>>1,l=-7,f=r?i-1:0,d=r?-1:1,_=e[t+f];for(f+=d,o=_&(1<<-l)-1,_>>=-l,l+=s;l>0;o=256*o+e[t+f],f+=d,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;l>0;a=256*a+e[t+f],f+=d,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(_?-1:1);a+=Math.pow(2,n),o-=c}return(_?-1:1)*a*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,_=n?0:o-1,p=n?1:-1,h=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+f>=1?d/u:d*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(t*u-1)*Math.pow(2,i),a+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;e[r+_]=255&s,_+=p,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[r+_]=255&a,_+=p,a/=256,c-=8);e[r+_-p]|=128*h}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(10),o=r(15),a=r(23);t.default=function(e){return function(t){return n.__awaiter(this,void 0,void 0,function(){var r,s,u,c,l;return n.__generator(this,function(n){switch(n.label){case 0:return r={function_name:t.name,data:o.serialize(t.data),cloudid_list:[]},s=o.serialize(r),[4,e.request({apiName:"tcbapi_callfunction",serviceName:e.name,serializedReqData:s,env:t.config&&t.config.env||e.env})];case 1:if(u=n.sent(),c=u.data,l=c&&c.data)try{l=JSON.parse(l)}catch(e){}return[2,{errMsg:i.apiSuccessMsg(a.API_NAME),result:l}]}})})}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(5),o=r(4),a=r(3),s=r(2),u=r(10),c=r(15),l=r(46),f=r(23);t.default=function(e){return function(t){return n.__awaiter(this,void 0,void 0,function(){function r(t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(r){return[2,new Promise(function(r,a){!function t(r,a,u,l){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){return o.getSDK(e.identifiers)._requestSkipCheckDomain({url:r,success:function(e){try{if(200!==e.statusCode)return l(s.returnAsFinalCloudSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_STATUS_CODE_ERROR,errMsg:"polling status code "+e.statusCode},f.API_NAME));var n=e.data;if(!n)return l(s.returnAsFinalCloudSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_JSON,errMsg:i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_JSON]},f.API_NAME));if(n.base_resp&&0===n.base_resp.ret){if(0!==n.status){if(1===n.status){if(0!==n.service_errcode){var o=s.returnAsFinalCloudSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR,errMsg:"requestID "+n.func_req_id+", cloud function service error code "+(n.service_errcode||"unknown")+", error message "+(n.service_errmsg||"unknown")},f.API_NAME);return o.requestID=n.func_req_id,l(o)}var d=n.content;try{d=c.deserialize(d)}catch(e){try{d=JSON.parse(d)}catch(e){}}return u({result:d,requestID:n.func_req_id})}return l(s.returnAsFinalCloudSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_EXPIRED,errMsg:"timeout for result fetching"},f.API_NAME))}if(!(a>=0))return l(s.returnAsFinalCloudSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY,errMsg:i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY]},f.API_NAME));t(r,a-1,u,l)}else{if(!n.base_resp)return l(s.returnAsFinalCloudSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP,errMsg:i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP]},f.API_NAME));if(0!==n.base_resp.ret)return l(s.returnAsFinalCloudSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_BASE_RESP_RET_ABNORMAL,errMsg:"polling base_resp.ret "+n.base_resp.ret},f.API_NAME))}}catch(e){l(s.returnAsFinalCloudSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_ERROR,errMsg:"polling catch error: "+e},f.API_NAME))}},fail:function(e){l(s.returnAsFinalCloudSDKError(e,f.API_NAME))}}),[2]})})}(t,e.appConfig.maxPollRetry||50,r,a)})]})})}var d,_,p,h,E,g,m,S,v,y,T,A,C,O,I,R;return n.__generator(this,function(o){switch(o.label){case 0:if(d=n.__assign({},t.data),(_=l.extractCloudID(d).map(function(e){return{key_name:e.key,cloud_id:e.cloudID}})).length)try{for(p=n.__values(_),h=p.next();!h.done;h=p.next())E=h.value,delete d[E.key_name]}catch(e){I={error:e}}finally{try{h&&!h.done&&(R=p.return)&&R.call(p)}finally{if(I)throw I.error}}return[4,t.cdnMapPromise];case 1:return g=o.sent(),m=c.serialize(d,g),a.assertStringLength({input:m,max:e.appConfig.maxReqDataSize,name:"callFunction data",maxWording:e.appConfig.maxReqDataSize/1024+" KB"}),S={function_name:t.name,data:m,cloudid_list:_},v=c.serialize(S),t.context.tunnelStartTime=+new Date,[4,e.request(n.__assign(n.__assign({},t.config),{apiName:"tcbapi_slowcallfunction",serviceName:e.name,serializedReqData:v,env:t.config&&t.config.env||e.env}))];case 2:if(y=o.sent(),t.context.tunnelEndTime=+new Date,!(T=y.data))throw s.returnAsFinalCloudSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_EMPTY_CALL_RESULT,errMsg:i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EMPTY_CALL_RESULT]},f.API_NAME);if(T.event_id,!T.poll_url)throw s.returnAsFinalCloudSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_URL,errMsg:i.ERR_CODE[i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_URL]},f.API_NAME);return T.poll_url.indexOf("?")>-1?T.poll_url+="&devtools_ignore=true&skip_domain_check=true":T.poll_url+="?devtools_ignore=true&skip_domain_check=true",t.context.pollStartTime=+new Date,[4,r(T.poll_url)];case 3:return A=o.sent(),C=A.result,O=A.requestID,t.context.pollEndTime=+new Date,[2,{errMsg:u.apiSuccessMsg(f.API_NAME),result:C,requestID:O}]}})})}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(5),o=r(3),a=r(2),s=r(10),u=r(15),c=r(46),l=r(11),f=r(8),d=r(23),_=20,p=2,h=2,E=2e4,g=function(e){var t=new Date;return t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()+" "+e},m=function(e){return e.join("->")};t.default=function(e){return function(t){return n.__awaiter(this,void 0,void 0,function(){function r(t,r,i,o){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){return[2,new Promise(function(n,a){var s=[g("start")],u=function(e,t,r){var n=function(t){e.push(g("app "+t))};return l.onAppVisibilityChange(n),{resolve:function(e){l.offAppVisibilityChange(n),t(e)},reject:function(e){l.offAppVisibilityChange(n),r(e)}}}(s,n,a),c=u.resolve,f=u.reject;S({param:t,functionName:t.name,data:r,cloudIDList:i,callID:o,action:d.SlowCallAction.CALL,scene:d.SlowCallScene.INITIATE_CALL,tryCount:e.appConfig.maxPollRetry||_,systemErrorRetry:p,timeoutErrorRetry:h,trace:s,resolve:c,reject:f})})]})})}function S(r){return n.__awaiter(this,void 0,void 0,function(){function o(e){try{if(b)return;L(),U(e);var t=e.data;if(!t)return T.push(g("empty resp")),I(a.toSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_EMPTY_CALL_RESULT},d.API_NAME));if(!t.baseresponse||0!==t.baseresponse.errcode)return t.baseresponse?0!==t.baseresponse.errcode?I(a.toSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_BASE_RESP_RET_ABNORMAL,errMsg:"polling base_resp.errcode "+t.baseresponse.errcode+" errmsg "+t.baseresponse.errmsg+" (callId: "+_+")"},d.API_NAME)):I(a.toSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP,errMsg:"polling base_resp "+JSON.stringify(t.baseresponse)+" (callId: "+_+")"},d.API_NAME)):I(a.toSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP},d.API_NAME));if(0!==t.status){if(1===t.status){if(0!==t.service_errcode){if(t.service_errcode===i.ERR_CODE.TCB_FUNCTIONS_EXEC_FAIL){var o=t.service_errmsg||"";try{for(var s=o.split("\n"),c=[],l=0;l<s.length;l++)s[l].startsWith("Error: ")&&c.push([s[l],l]);if(c.length%2==1){var f=c[Math.floor(c.length/2)][1];o=s.slice(f).join("\n")}}catch(e){}return(p=a.toSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR,errMsg:"äº‘å‡½æ•°æ‰§è¡Œé”™è¯¯\näº‘ç«¯å †æ ˆä¿¡æ¯(error stack)("+(t.func_request_id?"requestId "+t.func_request_id+", ":"")+"callid "+_+"):\n"+o},d.API_NAME)).stack="Error: "+p.message,p.requestID=t.func_request_id,I(p)}var p;return(p=a.toSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR,errMsg:"\näº‘å‡½æ•°è°ƒç”¨å¤±è´¥("+(t.func_request_id?"requestId "+t.func_request_id+", ":"")+"callid "+_+"):\n"+t.service_errcode+" "+t.service_errmsg},d.API_NAME)).stack="Error: "+p.message,p.requestID=t.func_request_id,I(p)}var h=t.data;try{h=u.deserialize(h)}catch(e){try{h=JSON.parse(h)}catch(e){}}return O({result:h,requestID:t.func_request_id})}return T.push(g("poll result expired")),I(a.toSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_EXPIRED,errMsg:"timeout for result fetching, result cannot be fetched anymore (callId: "+_+") (trace: "+m(T)+")"},d.API_NAME))}if(!(v>=0))return T.push(g("too many polls, abort")),I(a.toSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY,errMsg:"(callId: "+_+") (trace: "+m(T)+")"},d.API_NAME));T.push(g("normal poll")),S(n.__assign(n.__assign({},r),{action:d.SlowCallAction.POLL,scene:d.SlowCallScene.NORMAL_POLL_RETRY,tryCount:v-1}))}catch(e){I(a.toSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_ERROR,errMsg:"polling catch error: "+e+" (callId: "+_+")"},d.API_NAME))}}var s,c,_,p,h,v,T,A,C,O,I,R,N,w,b,D,L,M,P,U,B=this;return n.__generator(this,function(x){return s=r.functionName,c=r.data,_=r.callID,p=r.action,h=r.scene,v=r.tryCount,T=r.trace,A=r.systemErrorRetry,C=r.timeoutErrorRetry,O=r.resolve,I=r.reject,R=p===d.SlowCallAction.CALL&&f.isDevTools()?t.localDebugNoTimeout:void 0,N={function_name:s,data:p===d.SlowCallAction.CALL?c:void 0,action:p,scene:h,call_id:_,cloudid_list:p===d.SlowCallAction.CALL?y:[],local_debug_no_timeout:R},w=u.serialize(N),b=!1,D=!1,L=function(){clearTimeout(P),D=!0},M=+new Date,P=R?void 0:setTimeout(function(){return n.__awaiter(B,void 0,void 0,function(){var t;return n.__generator(this,function(o){switch(o.label){case 0:return t=e.appConfig.clientPollTimeout||E,+new Date-M>t?[4,l.sleep()]:[3,2];case 1:if(o.sent(),D)return[2];o.label=2;case 2:return!f.isDevTools()&&+new Date-M>e.appConfig.maxStartRetryGap?(T.push(g("timeout, exceed max retry gap")),[2,I(a.toSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_EXPIRED,errMsg:"timeout for retry, cannot retry fetching the result anymore (callId: "+_+") (trace: "+m(T)+")"},d.API_NAME))]):(b=!0,r.timeoutErrorRetry>0?(T.push(g("timeout, retry")),S(n.__assign(n.__assign({},r),{scene:d.SlowCallScene.TIMEOUT_RETRY,tryCount:v-1,timeoutErrorRetry:C-1}))):(T.push(g("timeout, abort")),I(a.toSDKError({errCode:i.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_TIMEOUT_POLL_RETRY,errMsg:"(callId: "+_+") (trace: "+m(T)+")"},d.API_NAME))),[2])}})})},e.appConfig.clientPollTimeout||E),U=function(e){var r,n=e.data;n&&n.baseresponse&&n.baseresponse.stat&&(n.baseresponse.stat.qbase_cost_time&&(t.context.tunnelTimeNoCSNetCost+=n.baseresponse.stat.qbase_cost_time),n.baseresponse.stat.func_exec_cost_time&&(t.context.funcExecTime=n.baseresponse.stat.func_exec_cost_time)),t.context.channelType=null!==(r=e.channelType)&&void 0!==r?r:0,e.profile&&(null===l._wxConsole||void 0===l._wxConsole||l._wxConsole.log("callFunction profile",e.profile))},e.request(n.__assign(n.__assign({},t.config),{apiName:"tcbapi_slowcallfunction_v2",serviceName:e.name,serializedReqData:w,env:t.config&&t.config.env||e.env,stdpriv:!0})).then(o).catch(function(e){b||(L(),e&&e.operateWXDataFail&&A>0?(T.push(g("system error ("+e+"), retry")),S(n.__assign(n.__assign({},r),{scene:d.SlowCallScene.SYSTEM_ERROR_RETRY,tryCount:v-1,systemErrorRetry:A-1}))):(T.push(g("system error ("+e+"), abort")),I(a.toSDKError(e+" (callId: "+_+") (trace: "+m(T)+")",d.API_NAME))))}),[2]})})}var v,y,T,A,C,O,I,R,N,w,b,D,L;return n.__generator(this,function(i){switch(i.label){case 0:if(v=n.__assign({},t.data),(y=c.extractCloudID(v).map(function(e){return{key_name:e.key,cloud_id:e.cloudID}})).length)try{for(T=n.__values(y),A=T.next();!A.done;A=T.next())C=A.value,delete v[C.key_name]}catch(e){D={error:e}}finally{try{A&&!A.done&&(L=T.return)&&L.call(T)}finally{if(D)throw D.error}}return[4,t.cdnMapPromise];case 1:return O=i.sent(),I=u.serialize(v,O),o.assertStringLength({input:I,max:e.appConfig.maxReqDataSize,name:"callFunction data",maxWording:e.appConfig.maxReqDataSize/1024+" KB"}),R=+new Date+"-"+Math.random(),t.context.tunnelStartTime=+new Date,[4,r(t,I,y,R)];case 2:return N=i.sent(),w=N.result,b=N.requestID,t.context.tunnelEndTime=+new Date,[2,{errMsg:s.apiSuccessMsg(d.API_NAME),result:w,requestID:b}]}})})}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerService=t.CONTAINER_SERVICE_NAME=void 0;var n=r(101);t.CONTAINER_SERVICE_NAME="container",t.registerService=function(e){e.registerService(function(e){var r={name:t.CONTAINER_SERVICE_NAME,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,serviceEndpoint:e.serviceEndpoint,get debug(){return e.debug},get appid(){return e.isInstance?e.instanceOptions.resourceAppid:void 0},get env(){return e.getEnvForService(t.CONTAINER_SERVICE_NAME)},appConfig:{get maxPollRetry(){return e.appConfig.call_container_poll_max_retry},get clientPollTimeout(){return e.appConfig.call_container_client_poll_timeout},get maxStartRetryGap(){return e.appConfig.call_container_valid_start_retry_gap}}};return{name:t.CONTAINER_SERVICE_NAME,context:r,getAPIs:n.getAPIs.bind(null,r)}}(e))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getAPIs=void 0;var n=r(102),i=r(107);t.getAPIs=function(e){return{callContainer:n.default(e),connectContainer:i.default(e)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.API_NAME=void 0;var n=r(0),i=r(9),o=r(3),a=r(2),s=r(24),u=r(12),c=r(6),l=r(15),f=r(31),d=r(47),_=r(4),p=r(103),h=r(106),E=r(1),g=r(11),m=r(48);t.API_NAME="cloud.callContainer";var S={OFF:0,ON:1,UNKNOWN:2},v=!0,y=6,T=new WeakMap;t.default=function(e){var r,A;function C(){return A||(A=h.default(e)),A}return function(e){var r=+new Date;o.assertType(e,"object");var n=u.shallowClone(e);return n.data||(n.data={}),n.dataType||(n.dataType="json"),n.context={tunnelTimeNoCSNetCost:0},n.context.apiStartTime=r,n.stats={apiStartTime:r},i.hasAPICallback(n)?function(e){s.wrapParamCallbacksWithTryCatch({apiName:t.API_NAME,param:e}),O(e).then(function(r){i.invokeSuccessCompleteCallbacks(t.API_NAME,e,r)}).catch(function(r){i.invokeFailCompleteCallbacks(t.API_NAME,e,r)})}(n):O(n)};function O(r){return n.__awaiter(this,void 0,void 0,function(){var i,s,p,h,A,C,O,N,w,b,D,L,M,P,U;return n.__generator(this,function(B){switch(B.label){case 0:i=!1,B.label=1;case 1:for(A in B.trys.push([1,6,,7]),function(t){var r;if(t.service,e.isInstance){if(!e.env)throw new Error("envId must be provided")}else if(null===(r=t.config)||void 0===r?void 0:r.env)o.assertType(t.config.env,"string");else if(!e.env)throw new Error("envId must be provided")}(r),r.path||(r.path=""),r.method||(r.method="GET"),r.header||(r.header={}),r.dataType||(r.dataType="json"),r.responseType||(r.responseType="text"),s="",r.header)"content-type"===A.toLowerCase()&&r.header&&(s=r.header[A]);if(s||(s="application/json",r.header["content-type"]="application/json"),r.header["User-Agent"]=m.getUA()||"",/get/i.test(r.method||"")&&r.data&&E.isObject(r.data)){for(A in h="",r.data)h+=(h.length?"&":"")+g.encodeWithDecode(A)+"="+g.encodeWithDecode(r.data[A]);r.path.includes("?")?r.path+=(r.path.endsWith("&")?"":h?"&":"")+h:r.path+=(r.path.endsWith("?")?"":h?"?":"")+h,r.data=void 0}else if(/post|put|patch|delete/i.test(r.method||"")&&r.data)if(s.includes("application/json"))p=E.getType(r.data),r.shouldSerialize="string"!==p;else if(s.includes("application/x-www-form-urlencoded")&&E.isObject(r.data)){for(A in h="",r.data)h+=(h.length?"&":"")+encodeURIComponent(A)+"="+encodeURIComponent(r.data[A]);r.data=h}return r.cdnMapPromise=r.shouldSerialize?f.collect(r.data):void 0,C=Date.now(),v?(v=!1,[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,i;return n.__generator(this,function(n){switch(n.label){case 0:return Boolean(e.serviceEndpoint.getEndpointSync("container"))?[3,2]:(r=new Promise(function(e){return setTimeout(e,50)}),i=e.serviceEndpoint.getEndpoint("container"),[4,Promise.race([r,i])]);case 1:n.sent(),n.label=2;case 2:return[2,I(t)]}})})}(r)]):[3,3];case 2:return O=B.sent(),[3,4];case 3:O=I(r),B.label=4;case 4:return i=O,r.stats.tsBeforeCallContainerImpl=Date.now(),N=u.shallowClone(r),w=r.data,b=R(r,i),L=r.service||r.header["X-WX-SERVICE"],D=L?"wx.cloud.callContainer."+L+r.path:"wx.cloud.callContainer"+r.path,d.autoDevtoolsNetworkLog(b,function(){var t;return{url:D,method:r.method,headers:n.__assign({Env:e.isInstance?e.env:(null===(t=r.config)||void 0===t?void 0:t.env)||e.env},r.header),reqBody:l.serialize(w),timestampMs:C,console:e.debug}}),M=function(r,i){var o;return null===(o=r.followRedirect)||void 0===o||o?function r(o,a){return new Promise(function(s,c){a.then(function(a){var l;if(302===a.statusCode){var f=null!==(l=T.get(i))&&void 0!==l?l:0;if(f>=y)c("reach the max redirect count");else{T.set(i,f+1);var d="";for(var p in a.header)"location"===p.toLowerCase()&&(d=a.header[p]);if(d)if(d.startsWith("/")){var h=u.shallowClone(o);o.path=d;var E=R(o);r(h,E).then(s).catch(c)}else{var g=_.getSDK(e.identifiers);g.request({url:d,method:o.method,header:o.header,data:o.data,dataType:o.dataType,responseType:o.responseType,timeout:o.timeout,success:function(e){s(n.__assign(n.__assign({},e),{errMsg:t.API_NAME+":ok"}))},fail:function(e){c(e.errMsg.replace(/^request/,t.API_NAME))}})}else s(a)}}else s(a)}).catch(c)})}(r,i):i}(N,b),[4,function(t,r){var n,i=_.getSDK(e.identifiers);if(!i.isUsedCache())return r;var o=function(e){var t={abort:function(){},promise:Promise.resolve()},r=new Promise(function(e,r){t.abort=r});return t.promise=Promise.race([e,r]),t}(r),a=i.reportCallContainer,s=i.privateCacheManager,u=i.cacheManager,c=Date.now(),l=t.data,f=t.method,d="https://wx.cloud.callContainer/"+((null===(n=t.config)||void 0===n?void 0:n.env)||e.env),p=t.service;if(!p)for(var h in t.header)"X-WX-SERVICE"===h.toUpperCase()&&(p=t.header[h]);d+=p?"/"+p+t.path:t.path;var E=function(e,t,n){var i=s.emit("request",{url:d,data:l,method:f,request:function(){return new Promise(function(e,t){r.then(e).catch(t)})}});if(i.length){var a=i.find(function(e){return e&&"function"==typeof e.then});a&&a.then(e).catch(t).finally(function(){o.abort()})}else n&&t(n)};return new Promise(function(e,t){var n=function(t){a({isSuccess:!0,costTime:Date.now()-c,extra1:d}),e(t)},i=function(e){a({isSuccess:!1,costTime:Date.now()-c,extra1:d}),t(e)},o=function(e){s.checkNeedStore(d,l,f,e),n(e)};u.state===S.UNKNOWN?r.then(function(e){o(e)}).catch(function(e){E(n,i,e)}):u.state===S.ON?E(n,i):u.state===S.OFF&&r.then(function(e){o(e)}).catch(function(e){i(e)})})}(r,M)];case 5:return P=B.sent(),function(e,r){e.stats.apiEndTime=Date.now(),c.reportAPISpeed(n.__assign(n.__assign({},e.context),{apiEndTime:e.stats.apiEndTime,apiName:t.API_NAME}));var i=Boolean(e.stats.profile),o=e.stats.profile||{},a=e.stats.serverEndTs-e.stats.serverStartTs,s=e.stats.httpRequest?e.stats.httpRequest<=6e4?e.stats.httpRequest:6e4:void 0,u=e.stats.apiEndTime,l=u-e.context.apiStartTime;if(l>9e4&&(l=9e4),!(r&&l<=0||s<=0)){var f=e.path||"";f=f.split("?")[0].replace(/\/\d+\//g,"/*/").replace(/\/\d+$/g,"/*"),c.reportMMData(22601,9,[e.stats.callid,e.context.apiStartTime,u,e.stats.serverStartTs,e.stats.serverEndTs,e.stats.requestBodyBytes,e.stats.responseBodyBytes,e.stats.getServiceEndpoint,e.stats.queryDNS,e.stats.compress,e.stats.loadAsmcrypto,e.stats.encrypt,s,e.stats.decrypt,e.stats.uncompress,e.stats.decodePb,e.stats.decodeBody,e.stats.ip,o.redirectStart,i?o.redirectEnd-o.redirectStart:void 0,o.fetchStart,o.domainLookupStart,i?o.domainLookupEnd-o.domainLookupStart:void 0,o.connectStart,i?o.connectEnd-o.connectStart:void 0,o.SSLconnectionStart,i?o.SSLconnectionEnd-o.SSLconnectionStart:void 0,o.requestStart,i?o.requestEnd-o.requestStart:void 0,o.responseStart,i?o.responseEnd-o.responseStart:void 0,o.rtt,o.estimate_nettype,o.httpRttEstimate,o.transportRttEstimate,o.downstreamThroughputKbpsEstimate,o.throughputKbps,o.peerIP,o.port,i?o.socketReused?1:0:void 0,o.sendBytesCount,o.receivedBytedCount,r?o.protocol:"im",g.getSystemInfo().system,l,a>0?a:0,s?l-s:void 0,f,g.getSystemInfo().platform,e.stats.requestStartTs,1656295447274,e.stats.ecdnId,e.stats.ecdnEdgeTiming,e.stats.domain,e.stats.stringToBuffer,e.stats.encodePb,e.stats.tsBeforeCallContainerImpl,e.stats.tsCallContainerImplStart,e.stats.decodeJson].join(","))}}(r,i),[2,P];case 6:throw U=B.sent(),a.returnAsFinalCloudSDKError(U,t.API_NAME);case 7:return[2]}})})}function I(t){return"windows"!==g.getSystemInfo().platform&&(1===t.apiVersion||Boolean(e.serviceEndpoint.getEndpointSync("container")))}function R(t,i){var o;if(i=null!==i&&void 0!==i?i:I(t)){var a=n.__assign(n.__assign({},t),{stats:n.__assign({},t.stats)});o=(r||(r=p.default(e)),r)(t).catch(function(e){if(-9999===(null===e||void 0===e?void 0:e.errCode))return C()(a);throw e})}else o=C()(t);return o}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.API_NAME=void 0;var n=r(0),i=r(15),o=r(4),a=r(104),s=r(11),u=r(1),c=r(26);new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);t.API_NAME="cloud.callContainer",t.default=function(e){return function(l){return n.__awaiter(this,void 0,void 0,function(){var f,d,_,p;return n.__generator(this,function(h){switch(h.label){case 0:return f=e.serviceEndpoint.getEndpointSync("container"),d=new WeakMap,!l.cdnMapPromise&&f?[3,2]:[4,Promise.all([l.cdnMapPromise,function(e,t,r){var n=Date.now();return e.then(function(){return t[r]=Date.now()-n}).catch(function(){return t[r]=Date.now()-n}),e}(e.serviceEndpoint.getEndpoint("container"),l.stats,"getServiceEndpoint")])];case 1:return(_=h.sent())[0]&&(d=_[0]),f=_[1],[3,3];case 2:l.stats.getServiceEndpoint=0,h.label=3;case 3:return l.shouldSerialize&&(l.data=i.serialize(l.data,d)),f.http?((p=function(i,l){return new Promise(function(f,d){var _,p;l.stats.tsCallContainerImplStart=Date.now();var h=o.getSDK(e.identifiers),E={"X-WX-ENCRYPTION-VERSION":2,"X-WX-ENCRYPTION-TIMESTAMP":i.timestamp+"","X-WX-COMPRESSION":"snappy","X-WX-USER-TIMEOUT":l.timeout||"","X-WX-LIB-BUILD-TS":1656295447274,"X-WX-RESPONSE-CONTENT-ACCEPT-ENCODING":"PB, JSON","Content-Type":"application/octet-stream"},g=Math.random()+"_"+Date.now(),m=n.__assign(n.__assign({},l.header),{"X-WX-ENV":e.isInstance?e.env:(null===(_=l.config)||void 0===_?void 0:_.env)||e.env,"X-WX-CALL-ID":g});e.appid&&(m["X-WX-RESOURCE-APPID"]=e.appid),l.service&&(m["X-WX-SERVICE"]=l.service);var S=l.stats;S.callid=g;var v,y=Date.now(),T=!1;if(l.data||(v=void 0),"GET"===(null===(p=l.method)||void 0===p?void 0:p.toUpperCase())&&l.data&&u.isObject(l.data)){var A=[];for(var C in l.data)A.push(C+"="+l.data[C]);l.path+=(l.path.includes("?")?l.path.endsWith("&")?"":"&":"?")+A.join("&"),l.data=void 0}else{var O=u.getType(l.data);"object"===O?v=JSON.stringify(l.data):"arraybuffer"!==O?v=l.data+"":(v=l.data,T=!0)}m["X-WX-CONTAINER-PATH"]=l.path;var I,R=[];for(var N in m)void 0!==m[N]&&null!==m[N]&&R.push({key:N.toLowerCase(),value:m[N]+""});y=Date.now(),T?(I=a.HTTPRequest.encode({method:l.method||"GET",header:R,body:new Uint8Array(v),callId:g}).finish(),S.encodePb=Date.now()-y,E["X-WX-REQUEST-CONTENT-ENCODING"]="PB"):(I=new Uint8Array(s.stringToArrayBuffer(JSON.stringify({method:l.method||"GET",header:R,body:v,call_id:g}))),S.stringToBuffer=Date.now()-y,E["X-WX-REQUEST-CONTENT-ENCODING"]="JSON"),y=Date.now();var w=r(42),b=w.compress(I);S.compress=Date.now()-y,y=Date.now();var D=r(105);S.loadAsmcrypto=Date.now()-y,y=Date.now();var L=new Uint8Array(s.base64ToArrayBuffer(i.key)),M=D.AES_CBC.encrypt(b,L,void 0,L);S.encrypt=Date.now()-y,y=Date.now();var P=i.url;l.rdm?P="https://wxardm.weixin.qq.com/wxa-qbase/container_service?token="+i.token:l.ecdn&&(P="https://cloudbase.servicewechat.com/wxa-qbase/container_service?token="+i.token),l.verbose&&console.log("[cloud.callContainer] url "+P),i.domain&&(l.stats.domain=i.domain),S.requestBodyBytes=M.byteLength,S.requestStartTs=Date.now(),l._fallback?d({errCode:-9999,errMsg:t.API_NAME+":fail emulated fallback"}):h._requestSkipCheckDomain({url:P,method:"POST",header:E,data:M.buffer,dataType:"arraybuffer",responseType:"arraybuffer",timeout:l.timeout,enableHttp2:!0,success:function(e){try{for(var r in e.header)if("x-nws-log-uuid"===r.toLowerCase()&&(l.verbose&&console.log("[cloud.callContainer] x-nws-log-uuid "+e.header[r]),l.stats.ecdnId=e.header[r]),"x-edge-timing"===r.toLowerCase()&&(l.stats.ecdnEdgeTiming=e.header[r]),"x-wx-system-error"===r.toLowerCase()){var n=Number(e.header[r]);return 85104===n&&c.ServiceEndpoint.invalidateService("container"),void d({errCode:n,errMsg:t.API_NAME+":fail system error. code: "+n})}if(l.verbose&&console.warn("res",e),S.profile=e.profile,S.httpRequest=Date.now()-y,200===e.statusCode){var i=e.data;S.responseBodyBytes=i.byteLength,y=Date.now();var o=D.AES_CBC.decrypt(new Uint8Array(i),L,void 0,L);S.decrypt=Date.now()-y,l.verbose&&console.warn("decrypt done");var u="pb";for(var _ in e.header)if("x-wx-compression"===_.toLowerCase()&&"snappy"===e.header[_]&&(y=Date.now(),o=w.uncompress(o),S.uncompress=Date.now()-y),"x-wx-response-content-encoding"===_.toLowerCase()&&"json"===e.header[_].toLowerCase()&&(u="json"),"x-wx-server-timing"===_.toLowerCase()){var p=e.header[_]||"",h=p.split(",");h.length>=2&&(S.serverStartTs=Number(h[0]),S.serverEndTs=Number(h[1]))}y=Date.now();var E=void 0;if("json"===u){var m=JSON.parse(s.arrayBufferToString(o));E={statusCode:m.status_code,header:m.header,bodyBuffer:m.body_buffer,bodyString:m.body_string},S.decodeJson=Date.now()-y}else E=a.HTTPResponse.decode(o),S.decodePb=Date.now()-y;y=Date.now();var v=void 0;if("json"===l.dataType){var T=E.bodyString||(E.bodyBuffer?s.arrayBufferToString(E.bodyBuffer):"{}");try{v=JSON.parse(T)}catch(e){return void d({errCode:-1,errMsg:t.API_NAME+":fail [call_id "+g+"] parse response body as JSON failed: "+e+". input: "+T})}}else v="text"===l.responseType?E.bodyString||(E.bodyBuffer?s.arrayBufferToString(E.bodyBuffer):""):"arraybuffer"===l.responseType&&E.bodyString?s.stringToArrayBuffer(E.bodyString):E.bodyString||E.bodyBuffer;S.decodeBody=Date.now()-y,f({statusCode:E.statusCode,header:E.header.reduce(function(e,t){return e[t.key+""]=t.value+"",e},{}),data:v,stats:S,callID:g,errMsg:t.API_NAME+":ok"})}else d({errCode:-9999,errMsg:t.API_NAME+":fail [call_id "+g+"] system conn status not 200"})}catch(e){d({errCode:-1,errMsg:t.API_NAME+":fail [call_id "+g+"] error while processing internal response "+e})}},fail:function(e){d(n.__assign(n.__assign({},e),{errCode:-9999,errMsg:e.errMsg.replace(/^request/,t.API_NAME)}))}})})}(f,l)).then(c.keepAlive).catch(c.keepAlive),[2,p]):[2,function(r,i){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(a){return[2,new Promise(function(a,s){var u,c=o.getSDK(e.identifiers),l=n.__assign(n.__assign({},i.header),{"X-WX-ENV":e.isInstance?e.env:(null===(u=i.config)||void 0===u?void 0:u.env)||e.env,"X-WX-SERVICE":i.service,"X-WX-CONTAINER-PATH":i.path,"X-WX-CALL-ID":Math.random()+"_"+Date.now(),"X-WX-USER-TIMEOUT":i.timeout});e.appid&&(l["X-WX-RESOURCE-APPID"]=e.appid),c._requestSkipCheckDomain({url:r,method:i.method,header:l,data:i.data,dataType:i.dataType,responseType:i.responseType,timeout:i.timeout,success:function(e){a(n.__assign(n.__assign({},e),{errMsg:t.API_NAME+":ok"}))},fail:function(e){s(n.__assign(n.__assign({},e),{errMsg:e.errMsg.replace(/^request/,t.API_NAME)}))}})})]})})}(f.url,l)]}})})}}},function(e,t,r){"use strict";var n=r(39),i=n.Reader,o=n.Writer,a=n.util,s=n.roots.default||(n.roots.default={});s.HTTPRequest=function(){function e(e){if(this.header=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.method="",e.prototype.header=a.emptyArray,e.prototype.body=a.newBuffer([]),e.prototype.callId="",e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=o.create()),null!=e.method&&Object.hasOwnProperty.call(e,"method")&&t.uint32(10).string(e.method),null!=e.header&&e.header.length)for(var r=0;r<e.header.length;++r)s.HTTPHeader.encode(e.header[r],t.uint32(18).fork()).ldelim();return null!=e.body&&Object.hasOwnProperty.call(e,"body")&&t.uint32(26).bytes(e.body),null!=e.callId&&Object.hasOwnProperty.call(e,"callId")&&t.uint32(34).string(e.callId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new s.HTTPRequest;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.method=e.string();break;case 2:n.header&&n.header.length||(n.header=[]),n.header.push(s.HTTPHeader.decode(e,e.uint32()));break;case 3:n.body=e.bytes();break;case 4:n.callId=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.method&&e.hasOwnProperty("method")&&!a.isString(e.method))return"method: string expected";if(null!=e.header&&e.hasOwnProperty("header")){if(!Array.isArray(e.header))return"header: array expected";for(var t=0;t<e.header.length;++t){var r=s.HTTPHeader.verify(e.header[t]);if(r)return"header."+r}}return null!=e.body&&e.hasOwnProperty("body")&&!(e.body&&"number"==typeof e.body.length||a.isString(e.body))?"body: buffer expected":null!=e.callId&&e.hasOwnProperty("callId")&&!a.isString(e.callId)?"callId: string expected":null},e.fromObject=function(e){if(e instanceof s.HTTPRequest)return e;var t=new s.HTTPRequest;if(null!=e.method&&(t.method=String(e.method)),e.header){if(!Array.isArray(e.header))throw TypeError(".HTTPRequest.header: array expected");t.header=[];for(var r=0;r<e.header.length;++r){if("object"!=typeof e.header[r])throw TypeError(".HTTPRequest.header: object expected");t.header[r]=s.HTTPHeader.fromObject(e.header[r])}}return null!=e.body&&("string"==typeof e.body?a.base64.decode(e.body,t.body=a.newBuffer(a.base64.length(e.body)),0):e.body.length&&(t.body=e.body)),null!=e.callId&&(t.callId=String(e.callId)),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.header=[]),t.defaults&&(r.method="",t.bytes===String?r.body="":(r.body=[],t.bytes!==Array&&(r.body=a.newBuffer(r.body))),r.callId=""),null!=e.method&&e.hasOwnProperty("method")&&(r.method=e.method),e.header&&e.header.length){r.header=[];for(var n=0;n<e.header.length;++n)r.header[n]=s.HTTPHeader.toObject(e.header[n],t)}return null!=e.body&&e.hasOwnProperty("body")&&(r.body=t.bytes===String?a.base64.encode(e.body,0,e.body.length):t.bytes===Array?Array.prototype.slice.call(e.body):e.body),null!=e.callId&&e.hasOwnProperty("callId")&&(r.callId=e.callId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),s.HTTPResponse=function(){function e(e){if(this.header=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.statusCode=0,e.prototype.header=a.emptyArray,e.prototype.bodyBuffer=a.newBuffer([]),e.prototype.bodyString="",e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=o.create()),null!=e.statusCode&&Object.hasOwnProperty.call(e,"statusCode")&&t.uint32(8).uint32(e.statusCode),null!=e.header&&e.header.length)for(var r=0;r<e.header.length;++r)s.HTTPHeader.encode(e.header[r],t.uint32(18).fork()).ldelim();return null!=e.bodyBuffer&&Object.hasOwnProperty.call(e,"bodyBuffer")&&t.uint32(26).bytes(e.bodyBuffer),null!=e.bodyString&&Object.hasOwnProperty.call(e,"bodyString")&&t.uint32(34).string(e.bodyString),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new s.HTTPResponse;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.statusCode=e.uint32();break;case 2:n.header&&n.header.length||(n.header=[]),n.header.push(s.HTTPHeader.decode(e,e.uint32()));break;case 3:n.bodyBuffer=e.bytes();break;case 4:n.bodyString=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.statusCode&&e.hasOwnProperty("statusCode")&&!a.isInteger(e.statusCode))return"statusCode: integer expected";if(null!=e.header&&e.hasOwnProperty("header")){if(!Array.isArray(e.header))return"header: array expected";for(var t=0;t<e.header.length;++t){var r=s.HTTPHeader.verify(e.header[t]);if(r)return"header."+r}}return null!=e.bodyBuffer&&e.hasOwnProperty("bodyBuffer")&&!(e.bodyBuffer&&"number"==typeof e.bodyBuffer.length||a.isString(e.bodyBuffer))?"bodyBuffer: buffer expected":null!=e.bodyString&&e.hasOwnProperty("bodyString")&&!a.isString(e.bodyString)?"bodyString: string expected":null},e.fromObject=function(e){if(e instanceof s.HTTPResponse)return e;var t=new s.HTTPResponse;if(null!=e.statusCode&&(t.statusCode=e.statusCode>>>0),e.header){if(!Array.isArray(e.header))throw TypeError(".HTTPResponse.header: array expected");t.header=[];for(var r=0;r<e.header.length;++r){if("object"!=typeof e.header[r])throw TypeError(".HTTPResponse.header: object expected");t.header[r]=s.HTTPHeader.fromObject(e.header[r])}}return null!=e.bodyBuffer&&("string"==typeof e.bodyBuffer?a.base64.decode(e.bodyBuffer,t.bodyBuffer=a.newBuffer(a.base64.length(e.bodyBuffer)),0):e.bodyBuffer.length&&(t.bodyBuffer=e.bodyBuffer)),null!=e.bodyString&&(t.bodyString=String(e.bodyString)),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.header=[]),t.defaults&&(r.statusCode=0,t.bytes===String?r.bodyBuffer="":(r.bodyBuffer=[],t.bytes!==Array&&(r.bodyBuffer=a.newBuffer(r.bodyBuffer))),r.bodyString=""),null!=e.statusCode&&e.hasOwnProperty("statusCode")&&(r.statusCode=e.statusCode),e.header&&e.header.length){r.header=[];for(var n=0;n<e.header.length;++n)r.header[n]=s.HTTPHeader.toObject(e.header[n],t)}return null!=e.bodyBuffer&&e.hasOwnProperty("bodyBuffer")&&(r.bodyBuffer=t.bytes===String?a.base64.encode(e.bodyBuffer,0,e.bodyBuffer.length):t.bytes===Array?Array.prototype.slice.call(e.bodyBuffer):e.bodyBuffer),null!=e.bodyString&&e.hasOwnProperty("bodyString")&&(r.bodyString=e.bodyString),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),s.HTTPHeader=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.key="",e.prototype.value="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=o.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new s.HTTPHeader;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.key&&e.hasOwnProperty("key")&&!a.isString(e.key)?"key: string expected":null!=e.value&&e.hasOwnProperty("value")&&!a.isString(e.value)?"value: string expected":null},e.fromObject=function(e){if(e instanceof s.HTTPHeader)return e;var t=new s.HTTPHeader;return null!=e.key&&(t.key=String(e.key)),null!=e.value&&(t.value=String(e.value)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.key="",r.value=""),null!=e.key&&e.hasOwnProperty("key")&&(r.key=e.key),null!=e.value&&e.hasOwnProperty("value")&&(r.value=e.value),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),e.exports=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(45);Object.defineProperty(t,"AES_CBC",{enumerable:!0,get:function(){return n.AES_CBC}})},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.API_NAME=t.ResultStatus=t.DataType=t.RetryType=t.Action=void 0;var n,i,o,a=r(0),s=r(2),u=r(15),c=r(8),l=r(4),f=r(1),d=(r(31),r(11)),_=r(10),p=r(11),h=r(5);!function(e){e[e.CALL=1]="CALL",e[e.POLL=2]="POLL"}(n=t.Action||(t.Action={})),function(e){e[e.None=0]="None",e[e.Error=1]="Error",e[e.Timeout=2]="Timeout"}(i=t.RetryType||(t.RetryType={})),function(e){e[e.RAW=0]="RAW",e[e.BASE64=1]="BASE64",e[e.CDN_URL=2]="CDN_URL"}(o=t.DataType||(t.DataType={})),function(e){e[e.PENDING=0]="PENDING",e[e.DONE=1]="DONE",e[e.TIMEOUT=2]="TIMEOUT"}(t.ResultStatus||(t.ResultStatus={}));var E=function(e){var t=new Date;return t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()+" "+e},g=function(e){return e.join("->")},m=20,S=2,v=2,y=2e4,T=1e5;t.API_NAME="cloud.callContainer",t.default=function(e){return function(r){var A,C;return a.__awaiter(this,void 0,void 0,function(){function O(t,r,o,s){return a.__awaiter(this,void 0,void 0,function(){var u,c,l;return a.__generator(this,function(a){return u=!1,t.hasOwnProperty("timeout")&&(c=new Promise(function(e,r){setTimeout(function(){u=!0,r("timeout (options.timeout == "+t.timeout+")")},t.timeout)})),l=new Promise(function(a,l){var f=[E("start")],_=function(e,t,r){var n=function(t){e.push(E("app "+t))};return d.onAppVisibilityChange(n),{resolve:function(e){d.offAppVisibilityChange(n),t(e)},reject:function(e){d.offAppVisibilityChange(n),r(e)}}}(f,a,l),p=_.resolve,h=_.reject;I({param:t,data:r,dataType:o,callID:s,action:n.CALL,retryType:i.None,tryCount:e.appConfig.maxPollRetry||m,systemErrorRetry:S,timeoutErrorRetry:v,userTimeout:{get reached(){return!!c&&u}},trace:f,resolve:p,reject:h})}),[2,c?Promise.race([l,c]):l]})})}function I(f){return a.__awaiter(this,void 0,void 0,function(){function _(u){return a.__awaiter(this,void 0,void 0,function(){var c,_,p,m,v,y;return a.__generator(this,function(T){switch(T.label){case 0:return T.trys.push([0,13,,14]),U||N.reached?[2]:(x(),q(u),(c=u.data)?c.baseresponse&&0===c.baseresponse.errcode?0!==c.status?[3,1]:A>=0?(C.push(E("normal poll")),I(a.__assign(a.__assign({},f),{action:n.POLL,retryType:i.None,tryCount:A-1})),[3,10]):(C.push(E("too many polls, abort")),[2,b(s.toSDKError({errCode:h.ERR_CODE.SDK_CONTAINER_EXCEED_MAX_POLL_RETRY,errMsg:"(callId: "+S+") (trace: "+g(C)+")"},t.API_NAME))]):[3,11]:(C.push(E("empty resp")),[2,b(s.toSDKError({errCode:h.ERR_CODE.SDK_CONTAINER_EMPTY_CALL_RESULT},t.API_NAME))]));case 1:return 1!==c.status?[3,9]:(_=void 0,c.data_type!==o.BASE64?[3,2]:(_=d.base64ToArrayBuffer(c.data),"json"===r.dataType?_=d.tryJSONParse(d.arrayBufferToString(_)):"arraybuffer"!==r.responseType&&(_=d.arrayBufferToString(_)),[3,8]));case 2:if(c.data_type!==o.CDN_URL)return[3,7];T.label=3;case 3:return T.trys.push([3,5,,6]),p=l.getSDK(e.identifiers),[4,new Promise(function(e,t){p._requestSkipCheckDomain({url:c.data,dataType:r.dataType,responseType:r.responseType,success:function(r){200!==r.statusCode?t("download response status code "+r.statusCode):e(r)},fail:function(e){t(e)}})})];case 4:return m=T.sent(),_=m.data,[3,6];case 5:return v=T.sent(),[2,b(s.toSDKError({errCode:h.ERR_CODE.SDK_CONTAINER_DOWNLOAD_RESULT_FROM_CDN_FAIL,errMsg:"error: "+v+" \n (callId: "+S+") (trace: "+g(C)+")"},t.API_NAME))];case 6:return[3,8];case 7:_=c.data,"arraybuffer"===r.responseType?_=d.stringToArrayBuffer(_):"json"===r.dataType&&(_=d.tryJSONParse(_)),T.label=8;case 8:return[2,w({result:{data:_,statusCode:c.http_code,header:c.headers.reduce(function(e,t){return e[t.k]=t.v,e},{})}})];case 9:return C.push(E("poll result expired")),[2,b(s.toSDKError({errCode:h.ERR_CODE.SDK_CONTAINER_POLL_RESULT_EXPIRED,errMsg:"timeout for result fetching, result cannot be fetched anymore (callId: "+S+") (trace: "+g(C)+")"},t.API_NAME))];case 10:return[3,12];case 11:return c.baseresponse?0!==c.baseresponse.errcode?[2,b(s.toSDKError({errCode:h.ERR_CODE.SDK_CONTAINER_POLL_RESULT_BASE_RESP_RET_ABNORMAL,errMsg:"polling base_resp.errcode "+c.baseresponse.errcode+" errmsg "+c.baseresponse.errmsg+" (callId: "+S+")"},t.API_NAME))]:[2,b(s.toSDKError({errCode:h.ERR_CODE.SDK_CONTAINER_EMPTY_POLL_RESULT_BASE_RESP,errMsg:"polling base_resp "+JSON.stringify(c.baseresponse)+" (callId: "+S+")"},t.API_NAME))]:[2,b(s.toSDKError({errCode:h.ERR_CODE.SDK_CONTAINER_EMPTY_POLL_RESULT_BASE_RESP},t.API_NAME))];case 12:return[3,14];case 13:return y=T.sent(),b(s.toSDKError({errCode:h.ERR_CODE.SDK_CONTAINER_POLL_ERROR,errMsg:"polling catch error: "+y+" (callId: "+S+")"},t.API_NAME)),[3,14];case 14:return[2]}})})}var p,m,S,v,T,A,C,O,R,N,w,b,D,L,M,P,U,B,x,k,G,q,F=this;return a.__generator(this,function(o){for(L in p=f.data,m=f.dataType,S=f.callID,v=f.action,T=f.retryType,A=f.tryCount,C=f.trace,O=f.systemErrorRetry,R=f.timeoutErrorRetry,N=f.userTimeout,w=f.resolve,b=f.reject,D=[],r.header)D.push({k:L,v:r.header[L]});return M=v===n.CALL?{method:r.method||"GET",headers:D,data:v===n.CALL?p:void 0,data_type:m,action:v,retryType:T,call_id:S,user_timeout:r.timeout}:{call_id:S,action:v,retryType:T},P=u.serialize(M),U=!1,B=!1,x=function(){clearTimeout(G),B=!0},k=+new Date,G=setTimeout(function(){return a.__awaiter(F,void 0,void 0,function(){var r;return a.__generator(this,function(n){switch(n.label){case 0:return r=e.appConfig.clientPollTimeout||y,+new Date-k>r?[4,d.sleep()]:[3,2];case 1:if(n.sent(),B)return[2];n.label=2;case 2:return N.reached?[2]:!c.isDevTools()&&+new Date-k>e.appConfig.maxStartRetryGap?(C.push(E("timeout, exceed max retry gap")),[2,b(s.toSDKError({errCode:h.ERR_CODE.SDK_CONTAINER_POLL_RESULT_EXPIRED,errMsg:"timeout for retry, cannot retry fetching the result anymore (callId: "+S+") (trace: "+g(C)+")"},t.API_NAME))]):(U=!0,f.timeoutErrorRetry>0?(C.push(E("timeout, retry")),I(a.__assign(a.__assign({},f),{retryType:i.Timeout,tryCount:A-1,timeoutErrorRetry:R-1}))):(C.push(E("timeout, abort")),b(s.toSDKError({errCode:h.ERR_CODE.SDK_CONTAINER_EXCEED_MAX_TIMEOUT_POLL_RETRY,errMsg:"(callId: "+S+") (trace: "+g(C)+")"},t.API_NAME))),[2])}})})},e.appConfig.clientPollTimeout||y),q=function(e){var t=e.data;t&&t.baseresponse&&t.baseresponse.stat&&t.baseresponse.stat.qbase_cost_time&&(r.context.tunnelTimeNoCSNetCost+=t.baseresponse.stat.qbase_cost_time)},N.reached?[2]:(e.request(a.__assign(a.__assign({},r.config),{apiName:"tcbapi_call_container",serviceName:e.name,serializedReqData:P,env:r.config&&r.config.env||e.env})).then(_).catch(function(e){U||N.reached||(x(),e&&e.operateWXDataFail&&O>0?(C.push(E("system error ("+e+"), retry")),I(a.__assign(a.__assign({},f),{retryType:i.Error,tryCount:A-1,systemErrorRetry:O-1}))):(C.push(E("system error ("+e+"), abort")),b(s.toSDKError(e+" (callId: "+S+") (trace: "+g(C)+")",t.API_NAME))))}),[2])})})}var R,N,w,b,D,L,M,P,U,B,x;return a.__generator(this,function(n){switch(n.label){case 0:return r.shouldSerialize?[4,r.cdnMapPromise]:[3,2];case 1:R=n.sent(),r.data=u.serialize(r.data,R),n.label=2;case 2:return N=o.RAW,w=(null===(A=r.method)||void 0===A?void 0:A.toUpperCase())||"GET",r.data&&/^(POST|PUT|PATCH|DELETE)$/.test(w)?"object"!==(b=f.getType(r.data))?[3,3]:(r.data=JSON.stringify(r.data),[3,7]):[3,8];case 3:if("arraybuffer"!==b&&"string"!==b)return[3,6];if(D=!1,"string"===b?D=r.data.length>T:r.data.byteLength>T?D=!0:(L=p.arrayBufferToBase64(r.data)).length>T?D=!0:(r.data=L,N=o.BASE64),!D)return[3,5];throw new Error("input data size too large (> 100KB)");case 4:M=n.sent(),r.data=M.fileUrl,N=o.CDN_URL,n.label=5;case 5:return[3,7];case 6:throw new Error("input data type is not supported: "+b);case 7:return[3,9];case 8:if("GET"===w&&r.data&&f.isObject(r.data)){for(B in P=[],r.data)P.push(B+"="+r.data[B]);r.path+=(r.path.includes("?")?r.path.endsWith("&")?"":"&":"?")+P.join("&"),r.data=void 0}else r.data=void 0;n.label=9;case 9:for(B in U=+new Date+"-"+Math.random(),r.header=a.__assign(a.__assign({},r.header),{"X-WX-ENV":e.isInstance?e.env:(null===(C=r.config)||void 0===C?void 0:C.env)||e.env,"X-WX-CONTAINER-PATH":r.path}),r.service&&(r.header["X-WX-SERVICE"]=r.service),r.header)null!==r.header[B]&&void 0!==r.header[B]&&(r.header[B]+="");return r.context.tunnelStartTime=+new Date,[4,O(r,r.data,N,U)];case 10:return x=n.sent().result,r.context.tunnelEndTime=+new Date,[2,a.__assign(a.__assign({},x),{errMsg:_.apiSuccessMsg(t.API_NAME),callID:U})]}})})}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),o=r(3),a=r(9),s=r(10),u=r(12),c=r(6),l="cloud.connectContainer";t.default=function(e){return function(e){var r=u.shallowClone(e);return r.timing={apiStartTime:+new Date},a.hasAPICallback(r)?function(e){t(e).then(function(t){a.invokeSuccessCompleteCallbacks(l,e,t)}).catch(function(t){a.invokeFailCompleteCallbacks(l,e,t)})}(r):t(r)};function t(t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,3,4]),function(e){e.config&&e.config.env&&o.assertType(e.config.env,"string")}(t),[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,o,a,u,c,f;return n.__generator(this,function(d){switch(d.label){case 0:return r={service_name:t.service},o=JSON.stringify(r),t.timing.tunnelStartTime=+new Date,[4,e.request({apiName:"tcbapi_get_websocket_info",serviceName:e.name,serializedReqData:o,env:t.config&&t.config.env||e.env})];case 1:return a=d.sent(),t.timing.tunnelEndTime=+new Date,u=a.data,t.success,t.complete,c=n.__rest(t,["success","complete"]),f=i.getSDK(e.identifiers)._socketSkipCheckDomainFactory().connectSocket(n.__assign(n.__assign({},c),{url:"wss://"+u.host+(t.path||""),header:n.__assign(n.__assign({},c.header),{"content-type":"application/json","x-wx-token":u.token}),perMessageDeflate:!0})),[2,{errMsg:s.apiSuccessMsg(l),socketTask:f}]}})})}(t)];case 1:return[2,r.sent()];case 2:throw r.sent();case 3:return c.reportAPISpeed(n.__assign(n.__assign({},t.timing),{apiEndTime:+new Date,apiName:l})),[7];case 4:return[2]}})})}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerService=t.STORAGE_SERVICE_NAME=void 0;var n=r(109);t.STORAGE_SERVICE_NAME="storage",t.registerService=function(e){e.registerService(function(e){var r={name:t.STORAGE_SERVICE_NAME,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,get env(){return e.getEnvForService(t.STORAGE_SERVICE_NAME)},get debug(){return e.debug},appConfig:{get uploadMaxFileSize(){return e.appConfig.upload_max_file_size},get getTempFileURLMaxReq(){return e.appConfig.get_temp_file_url_max_requests}}};return{name:t.STORAGE_SERVICE_NAME,context:r,getAPIs:n.getAPIs.bind(null,r)}}(e))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getAPIs=void 0;var n=r(110),i=r(124),o=r(125),a=r(126);t.getAPIs=function(e){return{uploadFile:n.default(e),downloadFile:i.default(e),getTempFileURL:o.default(e),deleteFile:a.default(e)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(3),o=r(2),a=r(1),s=r(12),u=r(9),c=r(10),l=r(4),f=r(6),d=r(5),_=r(49),p="cloud.uploadFile",h="cloud.uploadFile_v2";t.default=function(e){return function(e){if(e=s.shallowClone(e),u.hasAPICallback(e))return function(e){var r={aborted:!1},i=function(e){return{onProgressUpdate:function(t){e.onProgressUpdateUserHandler=t},abort:function(){e.abort&&e.abort(),e.aborted=!0}}}(r),o={apiStartTime:+new Date};return t(n.__assign(n.__assign({},e),{context:r,timing:o,uploadTaskAgent:i})).then(function(t){u.invokeSuccessCompleteCallbacks(p,e,t)}).catch(function(t){u.invokeFailCompleteCallbacks(p,e,t)}),i}(e);var r={apiStartTime:+new Date};return t(n.__assign(n.__assign({},e),{timing:r}))};function t(t){var r=this;return new Promise(function(s,u){return n.__awaiter(r,void 0,void 0,function(){var r,E;return n.__generator(this,function(g){switch(g.label){case 0:return g.trys.push([0,2,3,4]),function(e){i.assertType(e,{cloudPath:"string"}),"miniprogram"===_.getRuntimeInfo().env?i.assertType(e,{filePath:"string"}):i.assertRequiredParam(e,"file","uploadFile")}(t),t.context&&(t.context.abort=function(){u(o.returnAsFinalCloudSDKError({errMsg:"abort"},p))},t.context.aborted)?[2,u(o.returnAsFinalCloudSDKError({errMsg:"abort"},p))]:[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,i;return n.__generator(this,function(s){switch(s.label){case 0:return r=l.getSDK(e.identifiers),[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,i,a,s;return n.__generator(this,function(n){switch(n.label){case 0:return r=JSON.stringify({path:t.cloudPath}),i=+new Date,[4,e.request({apiName:"tcbapi_cos_uploadfile",serviceName:e.name,serializedReqData:r,env:t.config&&t.config.env||e.env})];case 1:if(a=n.sent(),s=a.data,t.timing&&(t.timing.tunnelStartTime=i,t.timing.tunnelEndTime=+new Date,t.timing.tunnelTimeNoCSNetCost=s.baseresponse.stat.qbase_cost_time),!s.url)throw new o.CloudSDKError({errCode:d.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_UPLOAD_URL,errMsg:d.ERR_CODE[d.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_UPLOAD_URL]});return[2,s]}})})}(t)];case 1:return i=s.sent(),[2,new Promise(function(e,s){if(t.context&&t.context.aborted)return s(o.returnAsFinalCloudSDKError({errMsg:"abort"},p));var u,l,f=_.getRuntimeInfo();if("web"===f.env){var d=new FormData;d.append("key",t.cloudPath),d.append("signature",i.authorization),d.append("x-cos-security-token",i.token),d.append("x-cos-meta-fileid",i.cos_file_id),d.append("file",t.file),u={url:i.url,timeout:t.timeout,filePath:"",header:t.header,name:"",formData:d}}else u={url:i.url,timeout:t.timeout,filePath:t.filePath,header:t.header,name:"file",formData:{key:t.cloudPath,signature:i.authorization,"x-cos-security-token":i.token,"x-cos-meta-fileid":i.cos_file_id}};(l=r._uploadFileSkipCheckDomain(n.__assign(n.__assign({},u),{success:function(t){try{if(t.statusCode>=200&&t.statusCode<300)e({errMsg:c.apiSuccessMsg(p),fileID:i.file_id,statusCode:t.statusCode});else{var r=new o.CloudSDKError({errMsg:"status "+t.statusCode+", error: "+t.data+";"});s(r)}}catch(r){var n=new o.CloudSDKError({errMsg:"Error : "+t.data+";"});s(n)}},fail:function(e){s(e)}})))&&(l.onProgressUpdate(function(){t.uploadTaskAgent&&t.context&&t.context.onProgressUpdateUserHandler&&a.isFunction(t.context.onProgressUpdateUserHandler)&&t.context.onProgressUpdateUserHandler.apply(r._uploadFileSkipCheckDomain,arguments)}),t.context&&(t.context.abort=l.abort.bind(l)))})]}})})}(t)];case 1:return r=g.sent(),s(r),[3,4];case 2:return E=g.sent(),u(o.returnAsFinalCloudSDKError(E,p)),[3,4];case 3:return f.reportAPISpeed(n.__assign(n.__assign({},t.timing),{apiEndTime:+new Date,apiName:h})),[7];case 4:return[2]}})})})}}},function(e,t,r){var n=this;Object.defineProperty(t,"__esModule",{value:!0}),t.invokeOperateWXData=t.operateWXData=void 0;var i=r(0),o=r(16);t.operateWXData=function(e){return i.__awaiter(n,void 0,void 0,function(){var t,r,n,a;return i.__generator(this,function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!e.appid)throw new Error("missing appid");return t={appid:e.appid,data:e.reqData},[4,e.webRequest({url:"/jsoperatewxdata",method:"POST",json:t})];case 1:return r=i.sent(),0===(n=r.data).base_resp.ret?o.callbackSuccessComplete(e,{rawData:n.data}):o.callbackFailComplete(e,{errMsg:"operateWXData:fail base_resp.ret "+n.base_resp.ret}),[3,3];case 2:return a=i.sent(),o.callbackFailComplete(e,a),[3,3];case 3:return[2]}})})},t.invokeOperateWXData=function(e){return i.__awaiter(n,void 0,void 0,function(){var t,r,n,a;return i.__generator(this,function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!e.appid)throw new Error("missing appid");return t={appid:e.appid,data:e.reqData},[4,e.webRequest({url:"/jsoperatewxdata",method:"POST",json:t})];case 1:return r=i.sent(),0===(n=r.data).base_resp.ret?o.callbackSuccessComplete(e,{data:JSON.parse(n.data)}):o.callbackFailComplete(e,{errMsg:"operateWXData:fail base_resp.ret "+n.base_resp.ret}),[3,3];case 2:return a=i.sent(),o.callbackFailComplete(e,a),[3,3];case 3:return[2]}})})}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.uploadFile=void 0;var n=r(16);t.uploadFile=function(e){var t,r=e.url,i=e.header,o=e.formData,a=new XMLHttpRequest;for(var s in a.responseType="text",a.timeout=6e4,a.open("POST",r,!0),a.onreadystatechange=function(){if(4===a.readyState){a.onreadystatechange=null;var t=a.status;if(0===t);else{var r={errMsg:"uploadFile:ok",header:n.formatHeader(a),statusCode:t};r.data=a.responseText,n.callbackSuccessComplete(e,r)}}},a.onerror=function(){n.callbackFailComplete(e,{errMsg:"uploadFile:fail"})},a.ontimeout=function(){n.callbackFailComplete(e,{errMsg:"uploadFile:fail timeout"})},a.onabort=function(){n.callbackFailComplete(e,{errMsg:"uploadFile:fail abort"})},a.onprogress=function(e){t&&t({progress:e.loaded/e.total,totalBytesWritten:e.loaded,totalBytesExpectedToWrite:e.total})},i)if(i.hasOwnProperty(s))try{a.setRequestHeader(s,i[s])}catch(t){return void n.callbackFailComplete(e,{errMsg:"uploadFile:fail Failed to execute 'setRequestHeader' â€¦XMLHttpRequest': Value is not a valid ByteString."})}try{a.send(o)}catch(t){n.callbackFailComplete(e,{errMsg:"uploadFile:fail"})}return{abort:function(){try{a.abort(),n.callbackSuccessComplete(e,{errMsg:"uploadFile:ok"})}catch(t){n.callbackFailComplete(e,{errMsg:"uploadFile:fail abort"})}},onProgressUpdate:function(e){t=e}}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.downloadFile=void 0;var n=r(16);t.downloadFile=function(e){var t,r=e.url,i=e.header,o=new XMLHttpRequest;for(var a in o.responseType="arraybuffer",o.timeout=e.timeout||6e4,o.open("GET",r,!0),o.onreadystatechange=function(){if(4===o.readyState){o.onreadystatechange=null;var t=o.status;if(0===t);else{var r={errMsg:"downloadFile:ok",header:n.formatHeader(o),statusCode:t};r.data=o.response,n.callbackSuccessComplete(e,r)}}},o.onerror=function(){n.callbackFailComplete(e,{errMsg:"downloadFile:fail"})},o.ontimeout=function(){n.callbackFailComplete(e,{errMsg:"downloadFile:fail timeout"})},o.onabort=function(){n.callbackFailComplete(e,{errMsg:"downloadFile:fail abort"})},o.onprogress=function(e){t&&t({progress:e.loaded/e.total,totalBytesWritten:e.loaded,totalBytesExpectedToWrite:e.total})},i)if(i.hasOwnProperty(a))try{o.setRequestHeader(a,i[a])}catch(t){return void n.callbackFailComplete(e,{errMsg:"downloadFile:fail Failed to execute 'setRequestHeader' â€¦XMLHttpRequest': Value is not a valid ByteString."})}try{o.send()}catch(t){n.callbackFailComplete(e,{errMsg:"downloadFile:fail"})}return{abort:function(){try{o.abort(),n.callbackSuccessComplete(e,{errMsg:"downloadFile:ok"})}catch(t){n.callbackFailComplete(e,{errMsg:"downloadFile:fail abort"})}},onProgressUpdate:function(e){t=e}}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.socketFactory=void 0;var n=r(16);t.socketFactory=function(){return{connectSocket:function(e){var t,r;try{t=new WebSocket(e.url,e.protocols),n.callbackSuccessComplete(e,void 0)}catch(t){r=t,n.callbackFailComplete(e,t)}if(!r)return setTimeout(function(){return n.callbackSuccessComplete(e,void 0)}),{get readyState(){return t.readyState},send:function(e){t.send(e.data),n.callbackSuccessComplete(e,{})},close:function(e){t.close(null===e||void 0===e?void 0:e.code,null===e||void 0===e?void 0:e.reason),n.callbackSuccessComplete(e,{})},onOpen:function(e){t.onopen=function(){return e({header:{}})}},onClose:function(e){t.onclose=e},onError:function(e){t.onclose=e},onMessage:function(e){t.onmessage=e}};setTimeout(function(){return n.callbackFailComplete(e,r)})}}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.uploadToCommonCDN=void 0;var n=r(16);t.uploadToCommonCDN=function(e){n.callbackFailComplete(e,{errMsg:"uploadToCommonCDN:fail not supported in web"})}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.wx=void 0;var n=r(16);t.wx={getNetworkType:function(e){n.callbackSuccessComplete(e,{errMsg:"getNetworkType:ok",networkType:a()})},getSystemInfoSync:function(){return{platform:"web"}},onNetworkStatusChange:function(e){(function(){if(i)return;i=!0,navigator.connection.onchange=function(){o.forEach(function(e){try{e(a())}catch(e){}})}})(),o.push(e)},onAppShow:function(){},onAppHide:function(){},base64ToArrayBuffer:function(e){for(var t=window.atob(e),r=t.length,n=new Uint8Array(r),i=0;i<r;i++)n[i]=t.charCodeAt(i);return n.buffer},version:{version:"web",updateTime:""}};var i=!1,o=[];function a(){var e=navigator.connection;if(e)switch(e.type){case"wifi":return"wifi";case"none":return"none"}return"unknown"}},function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),t.isUsedCache=t.PrivateCacheManager=t.noop=t.CacheManager=void 0,function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON",e[e.UNKNOWN=2]="UNKNOWN"}(r||(r={})),t.CacheManager={origin:"",state:r.OFF},t.noop=function(){},t.PrivateCacheManager={checkNeedStore:t.noop,config:t.noop,emit:function(){return[]},start:t.noop,stop:t.noop},t.isUsedCache=function(){return!1}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getUserAgent=void 0,t.getUserAgent=function(e){return navigator?e(navigator.userAgent):e("")}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getAPIs=void 0;var n=r(120),i=r(121),o=r(122),a=r(123);t.getAPIs=function(e){return{checkLogin:{initRequired:!1,fn:n.default(e)},startLogin:{initRequired:!1,fn:i.default(e)},getJSSDKSignature:{initRequired:!0,fn:o.default(e)},refreshAuth:{initRequired:!0,fn:a.default(e)}}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(33),o=r(53),a=r(51),s="cloud.checkLogin";t.default=function(e){var t={};return function(u){return n.__awaiter(this,void 0,void 0,function(){var c,l;return n.__generator(this,function(f){if(c=u.provider+"_"+u.appid,t[c])return[2,t[c]];try{return l=void 0,"OfficialAccount"===u.provider&&(l=function(t){return n.__awaiter(this,void 0,void 0,function(){var s,u,c,l,f,d,_,p,h,E,g=this;return n.__generator(this,function(m){switch(m.label){case 0:if(s=t.provider,u=t.appid,c=t.ignoreUrl,!u)throw new Error("appid must be provided");if(l=o.getStorage({provider:s,id:u}),f=t.accessToken,d=t.refreshToken,c||f&&d||(_=new URLSearchParams(location.search),f=_.get("access_token"),d=_.get("refresh_token")),f&&d||(f=l.getItem("access_token"),d=l.getItem("refresh_token")),!f||!d)return[3,4];m.label=1;case 1:return m.trys.push([1,3,,4]),[4,r(u,f).catch(function(e){return n.__awaiter(g,void 0,void 0,function(){return n.__generator(this,function(t){switch(t.label){case 0:return(null===e||void 0===e?void 0:e.errCode)!==a.CGI_ERROR_CODE.INVALID_CREDENTIAL&&(null===e||void 0===e?void 0:e.errCode)!==a.CGI_ERROR_CODE.EXPIRED_ACCESS_TOKEN?[3,2]:[4,function(e,t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(r){switch(r.label){case 0:return[4,i.sendRequest({url:"/refresh_token",method:"POST",json:{appid:e,refresh_token:t}})];case 1:return[2,r.sent().data.access_token]}})})}(u,d)];case 1:return f=t.sent(),[2,r(u,f)];case 2:throw e}})})})];case 2:return p=m.sent().data,l.setItem("access_token",f),l.setItem("refresh_token",d),e.cloud.authStorage=l,h={errCode:0,loggedIn:!0},p&&p.cloudid&&(h.cloudID=p.cloudid),[2,h];case 3:switch(null===(E=m.sent())||void 0===E?void 0:E.errCode){case a.CGI_ERROR_CODE.INVALID_REFRESH_TOKEN:case a.CGI_ERROR_CODE.INVALID_ACCESS_TOKEN:case a.CGI_ERROR_CODE.INVALID_CREDENTIAL:case a.CGI_ERROR_CODE.EXPIRED_ACCESS_TOKEN:case a.CGI_ERROR_CODE.EXPIRED_REFRESH_TOKEN:case a.CGI_ERROR_CODE.NO_SESSION_IN_COOKIE:case a.CGI_ERROR_CODE.INVALID_ARGS:return[2,{errCode:0,loggedIn:!1}]}throw E;case 4:return[2,{errCode:0,loggedIn:!1}]}})})}(u)),l&&(t[c]=l),[2,l]}catch(e){throw(null===e||void 0===e?void 0:e.errCode)&&(e.message=s+" "+e.message,e.errMsg=e.message),e}finally{delete t[c]}return[2]})})};function r(e,t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(r){return[2,i.sendRequest({url:"/check_login",method:"POST",json:{appid:e,access_token:t}})]})})}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(3);t.default=function(e){return function(e){"OfficialAccount"===e.provider&&function(e){n.assertType(e,{appid:"string",scope:"string",redirectUri:"string"});var t=new URL(e.redirectUri).protocol+"//"+location.host+(location.port?":"+location.port:"")+"/__wx__/oauth?redirect_uri="+encodeURIComponent(e.redirectUri),r=void 0!==e.state?"&state="+e.state:"",i="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+e.appid+"&scope="+e.scope+"&redirect_uri="+encodeURIComponent(t)+r+"&response_type=code#wechat_redirect";location.href=i}(e)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.default=function(e){return function(t){return function(t){return n.__awaiter(this,void 0,void 0,function(){var r,i;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e.cloud.webRequest({url:"/check_login",method:"POST",json:{appid:e.cloud.instanceOptions.appid,url:t.url}})];case 1:return r=n.sent(),[2,{errCode:0,timestamp:(i=r.data).jssdk_info.timestamp,nonceStr:i.jssdk_info.noncestr,signature:i.jssdk_info.signature}];case 2:throw n.sent();case 3:return[2]}})})}(t)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i="cloud.refreshAuth";t.default=function(e){var t;return function(r){return n.__awaiter(this,void 0,void 0,function(){var r,o;return n.__generator(this,function(n){switch(n.label){case 0:if(t)return[2,t];n.label=1;case 1:return n.trys.push([1,3,4,5]),r=e.cloud,[4,t=r.webRequest({url:"/get_env_auth",method:"POST",json:{appid:r.instanceOptions.appid,resource_appid:r.instanceOptions.resourceAppid,resource_env:r.instanceOptions.resourceEnv}})];case 2:return n.sent(),[3,5];case 3:throw(null===(o=n.sent())||void 0===o?void 0:o.errCode)&&(o.message=i+" "+o.message,o.errMsg=o.message),o;case 4:return t=void 0,[7];case 5:return[2]}})})}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(3),o=r(1),a=r(12),s=r(2),u=r(9),c=r(4),l=r(6),f=r(5),d="cloud.downloadFile";t.default=function(e){return function(e){if(e=a.shallowClone(e),u.hasAPICallback(e))return function(e){var r={aborted:!1},i=function(e){return{onProgressUpdate:function(t){e.onProgressUpdateUserHandler=t},abort:function(){e.abort&&e.abort(),e.aborted=!0}}}(r),o={apiStartTime:+new Date};return t(n.__assign(n.__assign({},e),{context:r,timing:o,downloadTaskAgent:i})).then(function(t){u.invokeSuccessCompleteCallbacks(d,e,t)}).catch(function(t){u.invokeFailCompleteCallbacks(d,e,t)}),i}(e);var r={apiStartTime:+new Date};return t(n.__assign(n.__assign({},e),{timing:r}))};function t(t){return n.__awaiter(this,void 0,void 0,function(){var r=this;return n.__generator(this,function(a){return[2,new Promise(function(a,u){return n.__awaiter(r,void 0,void 0,function(){var r,_;return n.__generator(this,function(p){switch(p.label){case 0:return p.trys.push([0,2,3,4]),function(e){i.assertType(e,{fileID:"string"}),e.config&&e.config.env&&i.assertType(e.config.env,"string")}(t),t.context&&(t.context.abort=function(){u(s.returnAsFinalCloudSDKError({errMsg:"abort"},d))},t.context.aborted)?[2,u(s.returnAsFinalCloudSDKError({errMsg:"abort"},d))]:[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,i;return n.__generator(this,function(a){switch(a.label){case 0:return r=c.getSDK(e.identifiers),[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,a;return n.__generator(this,function(n){switch(n.label){case 0:return r=JSON.stringify({fileid:t.fileID}),i=+new Date,[4,e.request({apiName:"tcbapi_downloadfile",serviceName:e.name,serializedReqData:r,env:t.config&&t.config.env||e.env})];case 1:if(o=n.sent(),a=o.data,t.timing&&(t.timing.tunnelStartTime=i,t.timing.tunnelEndTime=+new Date,t.timing.tunnelTimeNoCSNetCost=a.baseresponse.stat.qbase_cost_time),!a.download_url)throw new s.CloudSDKError({errCode:f.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_DOWNLOAD_URL,errMsg:f.ERR_CODE[f.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_DOWNLOAD_URL]});return a.download_url.indexOf("?")>-1?a.download_url+="&skip_domain_check=true":a.download_url+="?skip_domain_check=true",[2,a.download_url]}})})}(t)];case 1:return i=a.sent(),[2,new Promise(function(e,n){if(t.context&&t.context.aborted)return n(s.returnAsFinalCloudSDKError({errMsg:"abort"},d));var a=r._downloadFileSkipCheckDomain({url:i,success:function(t){e(t)},fail:function(e){n(e)}});a&&(a.onProgressUpdate(function(){t.downloadTaskAgent&&t.context&&t.context.onProgressUpdateUserHandler&&o.isFunction(t.context.onProgressUpdateUserHandler)&&t.context.onProgressUpdateUserHandler.apply(r._downloadFileSkipCheckDomain,arguments)}),t.context&&(t.context.abort=a.abort.bind(a)))})]}})})}(t)];case 1:return r=p.sent(),a(r),[3,4];case 2:return _=p.sent(),u(s.returnAsFinalCloudSDKError(_,d)),[3,4];case 3:return l.reportAPISpeed(n.__assign(n.__assign({},t.timing),{apiEndTime:+new Date,apiName:d})),[7];case 4:return[2]}})})})]})})}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(3),o=r(2),a=r(9),s=r(10),u=r(12),c=r(1),l=r(6),f=r(5),d="cloud.getTempFileURL";t.default=function(e){return function(e){var r=u.shallowClone(e);return r.timing={apiStartTime:+new Date},a.hasAPICallback(r)?function(e){t(e).then(function(t){a.invokeSuccessCompleteCallbacks(d,e,t)}).catch(function(t){a.invokeFailCompleteCallbacks(d,e,t)})}(r):t(r)};function t(t){return n.__awaiter(this,void 0,void 0,function(){var r;return n.__generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,3,4]),function(t){if(i.assertType(t,{fileList:"array"}),t.config&&t.config.env&&i.assertType(t.config.env,"string"),e.appConfig.getTempFileURLMaxReq&&t.fileList.length>e.appConfig.getTempFileURLMaxReq)throw new o.CloudSDKError({errCode:f.ERR_CODE.SDK_API_PARAMETER_ERROR,errMsg:"parameter.fileList exceed max length "+e.appConfig.getTempFileURLMaxReq})}(t),t.fileList.length?[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,a;return n.__generator(this,function(n){switch(n.label){case 0:return r={file_list:t.fileList.map(function(e){return c.isString(e)?{fileid:e}:{fileid:e.fileID,max_age:e.maxAge}})},i=JSON.stringify(r),t.timing.tunnelStartTime=+new Date,[4,e.request({apiName:"tcbapi_gettempfileurl",serviceName:e.name,serializedReqData:i,env:t.config&&t.config.env||e.env})];case 1:return o=n.sent(),t.timing.tunnelEndTime=+new Date,a=o.data,t.timing.tunnelTimeNoCSNetCost=a.baseresponse.stat.qbase_cost_time,[2,{errMsg:s.apiSuccessMsg(d),fileList:a.download_list.map(function(e){return{fileID:e.fileid,tempFileURL:e.download_url,maxAge:e.max_age,status:e.status,errMsg:e.errmsg}})}]}})})}(t)]:[2,{errMsg:s.apiSuccessMsg(d),fileList:[]}];case 1:return[2,a.sent()];case 2:throw r=a.sent(),o.returnAsFinalCloudSDKError(r,d);case 3:return l.reportAPISpeed(n.__assign(n.__assign({},t.timing),{apiEndTime:+new Date,apiName:d})),[7];case 4:return[2]}})})}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(3),o=r(2),a=r(9),s=r(10),u=r(12),c=r(6),l=r(5),f="cloud.deleteFile";t.default=function(e){return function(e){var r=u.shallowClone(e);return r.timing={apiStartTime:+new Date},a.hasAPICallback(r)?function(e){t(e).then(function(t){a.invokeSuccessCompleteCallbacks(f,e,t)}).catch(function(t){a.invokeFailCompleteCallbacks(f,e,t)})}(r):t(r)};function t(t){return n.__awaiter(this,void 0,void 0,function(){var r;return n.__generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,3,4]),function(t){i.assertType(t,{fileList:"array"}),t.config&&t.config.env&&i.assertType(t.config.env,"string");for(var r=0,n=t.fileList.length;r<n;r++)i.assertType(t.fileList[r],"string","parameter.fileList["+r+"]");if(e.appConfig.getTempFileURLMaxReq&&t.fileList.length>e.appConfig.getTempFileURLMaxReq)throw new o.CloudSDKError({errCode:l.ERR_CODE.SDK_API_PARAMETER_ERROR,errMsg:"parameter.fileList exceed max length "+e.appConfig.getTempFileURLMaxReq})}(t),t.fileList.length?[4,function(t){return n.__awaiter(this,void 0,void 0,function(){var r,i,o,a;return n.__generator(this,function(n){switch(n.label){case 0:return r={fileid_list:t.fileList},i=JSON.stringify(r),t.timing.tunnelStartTime=+new Date,[4,e.request({apiName:"tcbapi_deletefile",serviceName:e.name,serializedReqData:i,env:t.config&&t.config.env||e.env})];case 1:return o=n.sent(),t.timing.tunnelEndTime=+new Date,a=o.data,t.timing.tunnelTimeNoCSNetCost=a.baseresponse.stat.qbase_cost_time,[2,{errMsg:s.apiSuccessMsg(f),fileList:a.delete_list.map(function(e){return{fileID:e.fileid,status:e.status,errMsg:e.errmsg}})}]}})})}(t)]:[2,{errMsg:s.apiSuccessMsg(f),fileList:[]}];case 1:return[2,a.sent()];case 2:throw r=a.sent(),o.returnAsFinalCloudSDKError(r,f);case 3:return c.reportAPISpeed(n.__assign(n.__assign({},t.timing),{apiEndTime:+new Date,apiName:f})),[7];case 4:return[2]}})})}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerService=void 0;var n=r(128),i="database";t.registerService=function(e){e.registerService(function(e){var t={name:i,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,get debug(){return e.debug},get env(){return e.getEnvForService(i)},appConfig:{get docSizeLimit(){return e.appConfig.db_doc_size_limit},get realtimePingInterval(){return e.appConfig.db_realtime_ping_interval},get realtimePongWaitTimeout(){return e.appConfig.db_realtime_pong_wait_timeout},get realtimeMaxReconnect(){return e.config.database.realtime.maxReconnect},get realtimeReconnectInterval(){return e.config.database.realtime.reconnectInterval},get realtimeTotalConnectionTimeout(){return e.config.database.realtime.totalConnectionTimeout},get realtimeQueryEventCacheTimeout(){return e.appConfig.db_realtime_query_event_cache_timeout}}};return{name:i,context:t,getAPIs:n.getAPIs.bind(null,t)}}(e))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getAPIs=void 0;var n=r(129);t.getAPIs=function(e){return{database:n.default.bind(null,e)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getDatabase=void 0;var n=r(54),i=r(130),o=r(59),a=r(58),s=r(146),u=r(147),c=r(3);function l(e,t){return new(d(e.identifiers||{}))({context:e,config:t})}function f(e){return e.debug}t.getDatabase=l,t.default=l;var d=function(e){var t,r;return function(){function l(l){var d=l.config,_=l.context;this.identifiers=e,this.config=d||{},t={database:this,serviceContext:_,engine:u.getEngine()},r=i.getCollectionReferenceClass(t),d&&d.env&&c.assertType(d.env,"string"),this.command=n.commands,this.Geo=o,this.serverDate=a.serverDate,this.RegExp=s.regExp,d&&d.hasOwnProperty("debug")&&Object.defineProperties(this,{debug:{value:!0},QuerySerializer:{enumerable:!1,configurable:!1,get:function(){return function(e){return f(e.database)?e.engine.QuerySerializer:void 0}(t)},set:function(){}},UpdateSerializer:{enumerable:!1,configurable:!1,get:function(){return function(e){return f(e.database)?e.engine.UpdateSerializer:void 0}(t)},set:function(){}},ProjectionSerializer:{enumerable:!1,configurable:!1,get:function(){return function(e){return f(e.database)?e.engine.ProjectionSerializer:void 0}(t)},set:function(){}},AggregateSerializer:{enumerable:!1,configurable:!1,get:function(){return function(e){return f(e.database)?e.engine.AggregateSerializer:void 0}(t)},set:function(){}},Decoder:{enumerable:!1,configurable:!1,get:function(){return function(e){return f(e.database)?e.engine.Decoder:void 0}(t)},set:function(){}}})}return l.prototype.collection=function(e){return new r(e)},l.prototype.toJSON=function(){},l}()}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getCollectionReferenceClass=void 0;var n=r(0),i=r(56),o=r(145),a=r(30),s=r(9),u=r(20),c=r(10),l=r(2),f=r(3),d=r(6);t.getCollectionReferenceClass=function(e){var t=i.getQueryClass(e),r=o.getDocumentReferenceClass(e),_=a.getAggregateClass(e);return function(t){function i(e){var r=t.call(this,e)||this;return r.collectionName=e,r}return n.__extends(i,t),i.prototype.doc=function(e){if(null===e||void 0===e)throw l.returnAsFinalCloudSDKError({errCode:-1,errMsg:"docId must not be empty"},"collection.doc");return new r(this,e)},i.prototype.add=function(t){var r=this,i="collection.add",o={apiStartTime:+new Date};var a=s.hasAPICallback(t),_=new Promise(function(a,s){return n.__awaiter(r,void 0,void 0,function(){var _,p;return n.__generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,3,4]),f.assertType(t,{data:"object"}),[4,u.addDocument({env:e.database.config.env,collectionName:r.collectionName,data:e.engine.encodeInternalDataType(t.data),instanceContext:e,timing:o})];case 1:return _=h.sent(),a({_id:_._id,errMsg:c.apiSuccessMsg(i)}),[3,4];case 2:return p=h.sent(),s(l.returnAsFinalCloudSDKError(p,i)),[3,4];case 3:return d.reportAPISpeed(n.__assign(n.__assign({},o),{apiEndTime:+new Date,apiName:"cloud.db."+i})),[7];case 4:return[2]}})})});if(!a)return _;_.then(function(e){s.invokeSuccessCompleteCallbacks(i,t,e)}).catch(function(e){s.invokeFailCompleteCallbacks(i,t,e)})},i.prototype.aggregate=function(){return new _(this,[])},i}(t)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.deserialize=t.serialize=void 0;var n=r(0),i=r(7),o=r(1),a=r(58),s=r(2),u=r(5),c=r(19);t.serialize=function(e){return function e(t,r){if(!o.isInternalObject(t)){if(o.isDate(t))return{$date:+t};if(o.isRegExp(t))return{$regex:t.source,$options:t.flags};if(o.isArray(t))return t.map(function(t){if(r.indexOf(t)>-1)throw new s.CloudSDKError({errCode:u.ERR_CODE.SDK_DATABASE_CIRCULAR_REFERENCE,errMsg:"Cannot convert circular structure to JSON"});return e(t,n.__spread(r,[t]))});if(o.isObject(t)){var a=n.__assign({},t);for(var c in a){if(r.indexOf(a[c])>-1)throw new s.CloudSDKError({errCode:u.ERR_CODE.SDK_DATABASE_CIRCULAR_REFERENCE,errMsg:"Cannot convert circular structure to JSON"});a[c]=e(a[c],n.__spread(r,[a[c]]))}return a}return t}switch(t._internalType){case i.SYMBOL_GEO_POINT:case i.SYMBOL_GEO_MULTIPOINT:case i.SYMBOL_GEO_LINESTRING:case i.SYMBOL_GEO_MULTILINESTRING:case i.SYMBOL_GEO_POLYGON:case i.SYMBOL_GEO_MULTIPOLYGON:return t.toJSON();case i.SYMBOL_SERVER_DATE:return{$date:t.options};case i.SYMBOL_REGEXP:return{$regex:t.regexp,$options:t.options};default:return t.toJSON?t.toJSON():t}}(e,[e])},t.deserialize=function(e){var t=n.__assign({},e);for(var r in t)switch(r){case"$date":switch(o.getType(t[r])){case"number":return new Date(t[r]);case"object":return a.serverDate(t[r])}break;case"type":switch(t.coordinates,t.type){case"Point":if(c.isGeoJSONPoint(t))return c.toPoint(t);break;case"MultiPoint":if(c.isGeoJSONMultiPoint(t))return c.toMultiPoint(t);break;case"LineString":if(c.isGeoJSONLineString(t))return c.toLineString(t);break;case"MultiLineString":if(c.isGeoJSONMultiLineString(t))return c.toMultiLineString(t);break;case"Polygon":if(c.isGeoJSONPolygon(t))return c.toPolygon(t);break;case"MultiPolygon":if(c.isGeoJSONMultiPolygon(t))return c.toMultiPolygon(t)}}return e}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.ServerDate=t.serverDate=void 0;var n=r(7),i=r(3);t.serverDate=function(e){return new o(e)};var o=function(){function e(e){void 0===e&&(e={offset:0}),i.assertType(e,"object","serverDate.options"),this.options=e}return Object.defineProperty(e.prototype,"_internalType",{get:function(){return n.SYMBOL_SERVER_DATE},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{$date:this.options}},e}();t.ServerDate=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GeoPoint=t.Point=void 0;var n=r(7),i=r(3),o=r(2),a=r(19);t.Point=function(e,t){return a.isGeoJSONPoint(e)?a.toPoint(e):new s(e,t)};var s=function(){function e(e,t){this._internalType=n.SYMBOL_GEO_POINT,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}});var r=e,a=t;Object.defineProperties(this,{longitude:{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){if(i.assertType(e,"number","longitude"),e>180||e<-180)throw new o.CloudSDKError({errMsg:"longitude should be a number ranges from -180 to 180"})}},latitude:{enumerable:!0,configurable:!1,get:function(){return a},set:function(e){if(i.assertType(e,"number","latitude"),e>90||e<-90)throw new o.CloudSDKError({errMsg:"latitude should be a number ranges from -90 to 90"})}}}),this.longitude=r,this.latitude=a}return e.prototype.toJSON=function(){return a.toGeoJSONPoint(this)},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();t.GeoPoint=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GeoMultiPoint=t.MultiPoint=void 0;var n=r(7),i=r(19);t.MultiPoint=function(e){return i.isGeoJSONMultiPoint(e)?i.toMultiPoint(e):new o(e)};var o=function(){function e(e){this._internalType=n.SYMBOL_GEO_MULTIPOINT,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.points=e}return e.prototype.toJSON=function(){return i.toGeoJSONMultiPoint(this)},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();t.GeoMultiPoint=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GeoLineString=t.LineString=void 0;var n=r(7),i=r(19);t.LineString=function(e){return i.isGeoJSONLineString(e)?i.toLineString(e):new o(e)};var o=function(){function e(e){this._internalType=n.SYMBOL_GEO_LINESTRING,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.points=e}return e.prototype.toJSON=function(){return i.toGeoJSONLineString(this)},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();t.GeoLineString=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GeoMultiLineString=t.MultiLineString=void 0;var n=r(7),i=r(19);t.MultiLineString=function(e){return i.isGeoJSONMultiLineString(e)?i.toMultiLineString(e):new o(e)};var o=function(){function e(e){this._internalType=n.SYMBOL_GEO_MULTILINESTRING,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.lines=e}return e.prototype.toJSON=function(){return i.toGeoJSONMultiLineString(this)},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();t.GeoMultiLineString=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GeoPolygon=t.Polygon=void 0;var n=r(7),i=r(19);t.Polygon=function(e){return i.isGeoJSONPolygon(e)?i.toPolygon(e):new o(e)};var o=function(){function e(e){this._internalType=n.SYMBOL_GEO_POLYGON,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.lines=e}return e.prototype.toJSON=function(){return i.toGeoJSONPolygon(this)},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();t.GeoPolygon=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GeoMultiPolygon=t.MultiPolygon=void 0;var n=r(7),i=r(19);t.MultiPolygon=function(e){return i.isGeoJSONMultiPolygon(e)?i.toMultiPolygon(e):new o(e)};var o=function(){function e(e){this._internalType=n.SYMBOL_GEO_MULTIPOLYGON,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.polygons=e}return e.prototype.toJSON=function(){return i.toGeoJSONMultiPolygon(this)},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();t.GeoMultiPolygon=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.VirtualWebSocketClient=void 0;var n=r(0),i=r(140),o=r(141),a=r(61),s=r(62),u=r(63),c=r(2),l=r(5),f=r(25),d=r(6),_=r(64),p=r(142),h=r(143),E=r(65),g=2,m=2,S=1e4,v=1e4,y=1e4,T=new Set([o.VWSState.REBUILD_LOGGING_IN,o.VWSState.INIT_LOGGING_IN]),A=function(e){0},C=function(){function e(e){var t=this;this.closeWatchInvoked=!1,this.userOnErrorInvoked=!1,this._loginInvalidated=!1,this._errors=[],this._snapshotHistory=[],this._login=function(e){return n.__awaiter(t,void 0,void 0,function(){var t,r;return n.__generator(this,function(n){switch(n.label){case 0:this._fsm.transition(o.VWSEvent.LOGIN_START),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.login(this.envId,e||this._loginInvalidated,this.timing)];case 2:return t=n.sent(),this.envId||(this.envId=t.envId),this._fsm.transition(o.VWSEvent.LOGIN_SUCCESS,T),this._loginInvalidated=!1,[3,4];case 3:r=n.sent(),this._errors.push(r),this._loginInvalidated=!0;try{this._fsm.transition(o.VWSEvent.LOGIN_FAIL,T)}catch(e){console.warn("[realtime]",e)}return[3,4];case 4:return[2]}})})},this.initWatch=function(){return n.__awaiter(t,void 0,void 0,function(){var e,t,r,i,a,s,c,l,p,E,m,S,y,T,A=this;return n.__generator(this,function(C){switch(C.label){case 0:e=Date.now(),t=u.genRequestId(),C.label=1;case 1:return C.trys.push([1,3,,4]),this._fsm.transition(o.VWSEvent.INIT_WATCH_START,o.VWSState.INIT_LOGGED_IN),r=this.envId,i={watchId:this.watchId,requestId:t,msgType:"INIT_WATCH",msgData:{envId:r,collName:this.collectionName,query:this.query,limit:this.limit,orderBy:this.orderBy,queryType:this.queryType}},[4,this.send({msg:i,waitResponse:!0,skipOnMessage:!0,timeout:v})];case 2:if(a=C.sent(),this.assertAsyncTaskStatus(),s=a.msgData,c=s.events,l=s.currEvent,this.sessionInfo={queryID:a.msgData.queryID,currentEventId:l-1,currentDocs:[],currentEventTS:Date.now()},c.length>0){try{for(p=n.__values(c),E=p.next();!E.done;E=p.next())E.value.ID=l}catch(e){y={error:e}}finally{try{E&&!E.done&&(T=p.return)&&T.call(p)}finally{if(y)throw y.error}}this.handleServerEvents(a)}else this.sessionInfo.currentEventId=l,m=new h.Snapshot({id:l,docChanges:[],docs:[],type:"init",EJSON:this.getEJSON(),requestId:a.requestId,watchId:this.watchId}),f.default.surroundThirdByTryCatch(function(){return A.listener.onChange(m)})(),this.scheduleSendACK(),this.debug&&this._snapshotHistory.push(m);return this.onWatchStart(this,this.sessionInfo.queryID),this._availableRetries.INIT_WATCH=g,this._wsDisconnectionTS=void 0,d.reportIDKey(_.ErrorID,_.ErrorKey.REALTIME_DB_INIT_WATCH_SUCCESS,!0),d.reportAPISpeed({apiName:"_realtime.initWatch(success)",apiStartTime:e,apiEndTime:Date.now()}),this._fsm.transition(o.VWSEvent.INIT_WATCH_SUCCESS),[3,4];case 3:return S=C.sent(),d.reportAPISpeed({apiName:"_realtime.initWatch(fail)",apiStartTime:e,apiEndTime:Date.now()}),this.handleWatchEstablishmentError(S,{operationName:"INIT_WATCH",requestId:t}),[3,4];case 4:return[2]}})})},this.rebuildWatch=function(){return n.__awaiter(t,void 0,void 0,function(){var e,t,r,i,a,s;return n.__generator(this,function(n){switch(n.label){case 0:e=Date.now(),t=u.genRequestId(),n.label=1;case 1:if(n.trys.push([1,4,,5]),this._fsm.transition(o.VWSEvent.REBUILD_WATCH_START,o.VWSState.REBUILD_LOGGED_IN),r=this.envId,!this.sessionInfo)throw new Error("can not rebuildWatch without a successful initWatch (lack of sessionInfo)");if(this._wsDisconnectionTS&&Date.now()-this._wsDisconnectionTS>.9*this.getServiceContext().appConfig.realtimeQueryEventCacheTimeout)throw new c.TimeoutError("query event cache timeout, ws has been disconnected for too long, PLEASE RECONNECT manually",{subtype:"queryEventCacheClientTimeout",retryable:!1});return i={watchId:this.watchId,requestId:t,msgType:"REBUILD_WATCH",msgData:{envId:r,collName:this.collectionName,queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:i,waitResponse:!0,skipOnMessage:!0,timeout:y})];case 2:return a=n.sent(),this.assertAsyncTaskStatus(),[4,this.handleServerEvents(a)];case 3:return n.sent(),this._availableRetries.REBUILD_WATCH=g,this._wsDisconnectionTS=void 0,d.reportIDKey(_.ErrorID,_.ErrorKey.REALTIME_DB_REBUILD_WATCH_SUCCESS,!0),d.reportAPISpeed({apiName:"_realtime.rebuildWatch(success)",apiStartTime:e,apiEndTime:Date.now()}),this._fsm.transition(o.VWSEvent.REBUILD_WATCH_SUCCESS),[3,5];case 4:return s=n.sent(),d.reportAPISpeed({apiName:"_realtime.rebuildWatch(fail)",apiStartTime:e,apiEndTime:Date.now()}),this.handleWatchEstablishmentError(s,{operationName:"REBUILD_WATCH",requestId:t}),[3,5];case 5:return[2]}})})},this.handleWatchEstablishmentError=function(e,r){return n.__awaiter(t,void 0,void 0,function(){var t,i,a=this;return n.__generator(this,function(n){return t="INIT_WATCH"===r.operationName,i=function(n){var i=(n||e)+" ("+(t?"initWatch":"rebuildWatch")+" requestId "+r.requestId+")";if(a.closeWithError(new c.CloudSDKError({errCode:t?l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:i})),d.reportIDKey(_.ErrorID,t?_.ErrorKey.REALTIME_DB_INIT_WATCH_FAIL:_.ErrorKey.REALTIME_DB_REBUILD_WATCH_FAIL,!0),!E.isRealtimeErrorMessageError(e)){if(c.isTimeoutError(e)){switch(e.payload.subtype){case"totalConnectionTimeout":d.reportIDKey(_.ErrorID,t?_.ErrorKey.REALTIME_DB_INIT_WATCH_FAIL_TIMEOUT_ERROR_TOTAL_CONNECTION:_.ErrorKey.REALTIME_DB_REBUILD_WATCH_FAIL_TIMEOUT_ERROR_TOTAL_CONNECTION,!0);break;case"queryEventCacheClientTimeout":t||d.reportIDKey(_.ErrorID,_.ErrorKey.REALTIME_DB_REBUILD_WATCH_FAIL_TIMEOUT_ERROR_QUERY_EVENT_CACHE,!0)}return}return c.isCancelledError(e)?void d.reportIDKey(_.ErrorID,t?_.ErrorKey.REALTIME_DB_INIT_WATCH_FAIL_CANCELLED_ERROR:_.ErrorKey.REALTIME_DB_REBUILD_WATCH_FAIL_CANCELLED_ERROR,!0):void d.reportIDKey(_.ErrorID,t?_.ErrorKey.REALTIME_DB_INIT_WATCH_FAIL_UNKNOWN_ERROR:_.ErrorKey.REALTIME_DB_REBUILD_WATCH_FAIL_UNKNOWN_ERROR,!0)}switch(e.payload.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":d.reportIDKey(_.ErrorID,t?_.ErrorKey.REALTIME_DB_INIT_WATCH_FAIL_SERVER_SIGN_ERROR:_.ErrorKey.REALTIME_DB_REBUILD_WATCH_FAIL_SERVER_SIGN_ERROR,!0);break;default:d.reportIDKey(_.ErrorID,t?_.ErrorKey.REALTIME_DB_INIT_WATCH_FAIL_SERVER_OTHER_ERROR:_.ErrorKey.REALTIME_DB_REBUILD_WATCH_FAIL_SERVER_OTHER_ERROR,!0)}},this._errors.push(e),this.handleCommonError(e,{onSignError:function(){a._loginInvalidated=!0,a._fsm.transition(a.initialized?o.VWSEvent.REBUILD_WATCH_FAIL:o.VWSEvent.INIT_WATCH_FAIL)},onTimeoutError:function(e){e.payload&&!e.payload.retryable?i(e):a._fsm.transition(a.initialized?o.VWSEvent.REBUILD_WATCH_FAIL:o.VWSEvent.INIT_WATCH_FAIL)},onNotRetryableError:i,onCancelledError:function(e){a._fsm.transition(a.initialized?o.VWSEvent.REBUILD_WATCH_FAIL:o.VWSEvent.INIT_WATCH_FAIL)},onUnknownError:function(){a._fsm.transition(a.initialized?o.VWSEvent.REBUILD_WATCH_FAIL:o.VWSEvent.INIT_WATCH_FAIL)}}),[2]})})},this.closeWatch=function(){return n.__awaiter(t,void 0,void 0,function(){var e,t;return n.__generator(this,function(r){switch(r.label){case 0:if(this.closeWatchInvoked=!0,e=this.sessionInfo?this.sessionInfo.queryID:"",this._fsm.currentState===o.VWSState.CLOSED)return[2];r.label=1;case 1:return r.trys.push([1,3,4,5]),this._fsm.transition(o.VWSEvent.CLOSE),[4,this.sendCloseWatch()];case 2:return r.sent(),[3,5];case 3:return t=r.sent(),console.warn("[realtime] non-fatal error while closing watch: "+t),[3,5];case 4:return this.sessionInfo=void 0,this.onWatchClose(this,e),this._cleanup(),[7];case 5:return[2]}})})},this.sendCloseWatch=function(){return n.__awaiter(t,void 0,void 0,function(){var e;return n.__generator(this,function(t){switch(t.label){case 0:return e={watchId:this.watchId,requestId:u.genRequestId(),msgType:"CLOSE_WATCH",msgData:null},[4,this.send({msg:e})];case 1:return t.sent(),[2]}})})},this.scheduleSendACK=function(){t.clearACKSchedule(),t._ackTimeoutId=setTimeout(function(){t._waitExpectedTimeoutId?t.scheduleSendACK():t.sendACK()},S)},this.clearACKSchedule=function(){t._ackTimeoutId&&clearTimeout(t._ackTimeoutId)},this.sendACK=function(){return n.__awaiter(t,void 0,void 0,function(){var e,t,r;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this._fsm.currentState!==o.VWSState.INIT_WATCH_SUCCESS&&this._fsm.currentState!==o.VWSState.REBUILD_WATCH_SUCCESS?(this.scheduleSendACK(),[2]):this.sessionInfo?(e={watchId:this.watchId,requestId:u.genRequestId(),msgType:"CHECK_LAST",msgData:{queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:e})]):(console.warn("[realtime listener] can not send ack without a successful initWatch (lack of sessionInfo)"),[2]);case 1:return n.sent(),this.scheduleSendACK(),[3,3];case 2:if(t=n.sent(),E.isRealtimeErrorMessageError(t))switch((r=t.payload).msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return this._loginInvalidated=!0,this._fsm.currentState!==o.VWSState.INIT_WATCH_SUCCESS&&this._fsm.currentState!==o.VWSState.REBUILD_WATCH_SUCCESS||this._fsm.transition(o.VWSEvent.NEED_REBUILD_WATCH),[2];case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":return this.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:r.msgData.code})),[2]}return this._availableRetries.CHECK_LAST&&this._availableRetries.CHECK_LAST>0?(this._availableRetries.CHECK_LAST--,this.scheduleSendACK()):this.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:t})),[3,3];case 3:return[2]}})})},this.handleCommonError=function(e,t){if(E.isRealtimeErrorMessageError(e)){switch(e.payload.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return void t.onSignError(e);case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":default:return void t.onNotRetryableError(e)}}else{if(c.isTimeoutError(e))return void t.onTimeoutError(e);if(c.isCancelledError(e))return void t.onCancelledError(e)}t.onUnknownError(e)},this.watchId="watchid_"+ +new Date+"_"+Math.random(),this._parentFSM=e.parentFSM,this.envId=e.envId,this.collectionName=e.collectionName,this.query=e.query,this.limit=e.limit,this.orderBy=e.orderBy,this.queryType=e.queryType,this.send=e.send,this.login=e.login,this.isWSConnected=e.isWSConnected,this.getWaitExpectedTimeoutLength=e.getWaitExpectedTimeoutLength,this.getEJSON=e.getEJSON,this.getServiceContext=e.getServiceContext,this.onWatchStart=e.onWatchStart,this.onWatchClose=e.onWatchClose,this.timing=e.timing,this.debug=e.debug,this._availableRetries={INIT_WATCH:g,REBUILD_WATCH:g,CHECK_LAST:m},this._fsm=new s.FSM({initialState:o.VWSState.UNINIT,states:o.VWSStates,history:!0}),this._subscribeParentFSMEvents(),this._subscribeFSMEvents(),this.listener=new p.RealtimeListener({close:this.closeWatch,onChange:e.onChange,onError:e.onError,debug:this.debug,virtualClient:this}),this._parentFSM.currentState===a.WSState.CONNECTED&&this._login(),e.debug&&(this.wsclient=e.wsclient)}return Object.defineProperty(e.prototype,"initialized",{get:function(){return Boolean(this.sessionInfo)},enumerable:!1,configurable:!0}),e.prototype._cleanup=function(){this._parentFSM.unsubscribe(this._parentFSMListener)},e.prototype._subscribeParentFSMEvents=function(){var e=this;this._parentFSMListener=function(t){var r=t.event;t.from,t.to;if(e._fsm.currentState!==o.VWSState.CLOSED)if(r.type===a.WSEvent.DISCONNECT||r.type===a.WSEvent.CONNECTION_FAIL)switch(e._fsm.currentState){case o.VWSState.UNINIT:case o.VWSState.INIT_LOGGING_IN:case o.VWSState.INIT_LOGIN_FAIL:case o.VWSState.INIT_LOGGED_IN:case o.VWSState.INIT_WATCH_PENDING:case o.VWSState.INIT_WATCH_FAIL:e.closeWithError(r.error||new Error("websocket connection fail"),!1);break;default:r.type===a.WSEvent.DISCONNECT?(e._wsDisconnectionTS||(e._wsDisconnectionTS=Date.now()),e._fsm.transition(o.VWSEvent.WS_DISCONNECTED)):e.closeWithError(r.error||new Error("websocket connection fail"),!1)}else if(r.type===a.WSEvent.CONNECTION_SUCCESS)switch(e._fsm.currentState){case o.VWSState.UNINIT:case o.VWSState.PAUSED:e._login();break;case o.VWSState.CLOSED:break;default:console.warn("[realtime] current state should not be "+e._fsm.currentState+" (parent event "+r+")")}},this._parentFSM.subscribe(this._parentFSMListener)},e.prototype._subscribeFSMEvents=function(){var e=this;this._FSMListener=function(t){var r=t.event,n=t.from;t.to;switch(r.type){case o.VWSEvent.WS_CONNECTED:e._login().catch(A);break;case o.VWSEvent.LOGIN_SUCCESS:n===o.VWSState.INIT_LOGGING_IN?e.initWatch().catch(A):n===o.VWSState.REBUILD_LOGGING_IN?e.rebuildWatch().catch(A):e.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:"unexpected state: event "+r.type+" from "+n}));break;case o.VWSEvent.LOGIN_FAIL:n===o.VWSState.INIT_LOGGING_IN?e.useRetryTicket("INIT_WATCH")?e._login().catch(A):e.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL,errMsg:"login fail "+e._errors[e._errors.length-1]})):n===o.VWSState.REBUILD_LOGGING_IN?e.useRetryTicket("REBUILD_WATCH")?e._login().catch(A):e.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:"login fail "+e._errors[e._errors.length-1]})):e.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:"unexpected state: event "+r.type+" from "+n}));break;case o.VWSEvent.INIT_WATCH_SUCCESS:e._availableRetries.INIT_WATCH=g,e._errors=[];break;case o.VWSEvent.INIT_WATCH_FAIL:e.useRetryTicket("INIT_WATCH")?e._login().catch(A):e.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL,errMsg:"init watch fail "+e._errors[e._errors.length-1]}));break;case o.VWSEvent.REBUILD_WATCH_SUCCESS:e._availableRetries.REBUILD_WATCH=g,e._errors=[];break;case o.VWSEvent.REBUILD_WATCH_FAIL:e.useRetryTicket("REBUILD_WATCH")?e._login().catch(A):e.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:"init watch fail "+e._errors[e._errors.length-1]}));break;case o.VWSEvent.NEED_REBUILD_WATCH:e._login().catch(A)}},this._fsm.subscribe(this._FSMListener)},e.prototype.useRetryTicket=function(e){return!!(this._availableRetries[e]&&this._availableRetries[e]>0)&&(this._availableRetries[e]--,!0)},e.prototype.assertAsyncTaskStatus=function(){if(this.closeWatchInvoked)throw new c.CancelledError("closeWatch",{subtype:"closeWatch"});switch(this._fsm.currentState){case o.VWSState.PAUSED:throw new c.CancelledError("pause",{subtype:"pause"});case o.VWSState.CLOSED:throw new c.CancelledError("close",{subtype:"close"})}},e.prototype.handleServerEvents=function(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),this.scheduleSendACK(),[4,this._handleServerEvents(e)];case 1:return r.sent(),this._postHandleServerEventsValidityCheck(e),[3,3];case 2:throw t=r.sent(),d.reportIDKey(_.ErrorID,_.ErrorKey.REALTIME_DB_HANDLE_EVENT_ERROR,!0),t;case 3:return[2]}})})},e.prototype._handleServerEvents=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r,a,s,u,p,E,g,m,S,v=this;return n.__generator(this,function(y){if(t=e.requestId,!(r=e.msgData.events).length||!this.sessionInfo)return[2];a=this.sessionInfo;try{s=r.map(O)}catch(e){return this.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA,errMsg:e})),[2]}for(u=n.__spread(a.currentDocs),p=!1,E=function(r,E){var m,S,y=s[r];if(a.currentEventId>=y.id)return!s[r-1]||y.id>s[r-1].id?d.reportIDKey(_.ErrorID,_.ErrorKey.REALTIME_DB_RECV_DUPLICATE_EVENT,!0):(console.error("[realtime listener] server non-fatal error: events out of order (the latter event's id is smaller than that of the former) (requestId "+t+")"),d.reportIDKey(_.ErrorID,_.ErrorKey.REALTIME_DB_RECV_DUPLICATE_EVENT_AND_EVENT_OUT_OF_ORDER,!0)),"continue";if(a.currentEventId===y.id-1){switch(y.dataType){case"update":if(!y.doc)switch(y.queueType){case"update":case"dequeue":if(R=u.find(function(e){return e._id===y.docId})){var T=JSON.parse(JSON.stringify(R));if(y.updatedFields)for(var A in y.updatedFields)i.set(T,A,y.updatedFields[A]);if(y.removedFields)try{for(var C=(m=void 0,n.__values(y.removedFields)),O=C.next();!O.done;O=C.next()){A=O.value;i.unset(T,A)}}catch(e){m={error:e}}finally{try{O&&!O.done&&(S=C.return)&&S.call(C)}finally{if(m)throw m.error}}y.doc=T}else console.error("[realtime listener] internal non-fatal server error: unexpected update dataType event where no doc is associated."),d.reportIDKey(_.ErrorID,_.ErrorKey.REALTIME_DB_UNEXPECTED_EVENT_DATATYPE_UPDATE_NO_ASSOCIATED_DOC,!0);break;case"enqueue":var I=new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="update" and queueType="enqueue" (requestId '+e.requestId+")"});throw g.closeWithError(I),I}break;case"limit":if(!y.doc)switch(y.queueType){case"dequeue":var R;(R=u.find(function(e){return e._id===y.docId}))?y.doc=R:console.error("[realtime listener] internal non-fatal server error: unexpected limit dataType dequeue queueType event where no doc is associated.")}break;case"replace":if(!y.doc){I=new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="replace" (requestId '+e.requestId+")"});throw g.closeWithError(I),I}break;case"remove":(T=u.find(function(e){return e._id===y.docId}))?y.doc=T:(console.error("[realtime listener] internal non-fatal server error: unexpected remove event where no doc is associated."),d.reportIDKey(_.ErrorID,_.ErrorKey.REALTIME_DB_UNEXPECTED_EVENT_REMOVE_NO_ASSOCIATED_DOC,!0))}switch(y.queueType){case"init":p?u.push(y.doc):(p=!0,u=[y.doc]);break;case"enqueue":u.push(y.doc);break;case"dequeue":(N=u.findIndex(function(e){return e._id===y.docId}))>-1?u.splice(N,1):(console.error("[realtime listener] internal non-fatal server error: unexpected dequeue event where no doc is associated."),d.reportIDKey(_.ErrorID,_.ErrorKey.REALTIME_DB_UNEXPECTED_EVENT_DEQUEUE_NO_ASSOCIATED_DOC,!0));break;case"update":var N;(N=u.findIndex(function(e){return e._id===y.docId}))>-1?u[N]=y.doc:(console.error("[realtime listener] internal non-fatal server error: unexpected queueType update event where no doc is associated."),d.reportIDKey(_.ErrorID,_.ErrorKey.REALTIME_DB_UNEXPECTED_EVENT_QUEUETYPE_UPDATE_NO_ASSOCIATED_DOC,!0))}if(r===E-1||s[r+1]&&s[r+1].id!==y.id){var w=n.__spread(u),b=s.slice(0,r+1).filter(function(e){return e.id===y.id});g.sessionInfo.currentEventId=y.id,g.sessionInfo.currentDocs=u,g.sessionInfo.currentEventTS=Date.now();var D=new h.Snapshot({id:y.id,type:"init"===b[0].queueType?"init":void 0,docChanges:g.getEJSON().deserialize(b),docs:g.getEJSON().deserialize(w),EJSON:g.getEJSON(),requestId:t,watchId:g.watchId});f.default.surroundThirdByTryCatch(function(){return v.listener.onChange(D)})(),g.debug&&g._snapshotHistory.push(D)}}else d.reportIDKey(_.ErrorID,_.ErrorKey.REALTIME_DB_EVENT_OUT_OF_ORDER,!0),g._fsm.transition(o.VWSEvent.NEED_REBUILD_WATCH)},g=this,m=0,S=s.length;m<S;m++)E(m,S);return[2]})})},e.prototype._postHandleServerEventsValidityCheck=function(e){this.sessionInfo?(this.sessionInfo.expectEventId&&this.sessionInfo.currentEventId>=this.sessionInfo.expectEventId&&this.clearWaitExpectedEvent(),this.sessionInfo.currentEventId<e.msgData.currEvent&&console.warn("[realtime listener] internal non-fatal error: client eventId "+this.sessionInfo.currentEventId+" does not match with server event id after server event handling "+e.msgData.currEvent+" (requestId "+e.requestId+")")):console.error("[realtime listener] internal non-fatal error: sessionInfo lost after server event handling, this should never occur. (requestId "+e.requestId+")")},e.prototype.clearWaitExpectedEvent=function(){this._waitExpectedTimeoutId&&(clearTimeout(this._waitExpectedTimeoutId),this._waitExpectedTimeoutId=void 0)},e.prototype.onMessage=function(e){var t=this;switch(this._fsm.currentState){case o.VWSState.INIT_WATCH_SUCCESS:case o.VWSState.REBUILD_WATCH_SUCCESS:break;case o.VWSState.PAUSED:if("ERROR"!==e.msgType)return;break;default:return void console.warn("[realtime listener] internal non-fatal error: unexpected message received while state is "+this._fsm.currentState)}if(this.sessionInfo)switch(this.scheduleSendACK(),e.msgType){case"NEXT_EVENT":0,this.handleServerEvents(e);break;case"CHECK_EVENT":this.sessionInfo.currentEventId<e.msgData.currEvent&&(this.sessionInfo.expectEventId=e.msgData.currEvent,this.clearWaitExpectedEvent(),this._waitExpectedTimeoutId=setTimeout(function(){t._fsm.transition(o.VWSEvent.NEED_REBUILD_WATCH)},this.getWaitExpectedTimeoutLength()));break;case"ERROR":this.closeWithError(new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG,errMsg:e.msgData.code+" - "+e.msgData.message}));break;default:0}else console.warn("[realtime listener] internal non-fatal error: sessionInfo not found while message is received.")},e.prototype.closeWithError=function(e,t){var r=this;if(void 0===t&&(t=!0),this._fsm.currentState!==o.VWSState.CLOSED&&this._fsm.transition(o.VWSEvent.CLOSE),!this.userOnErrorInvoked){var n=this._fsm.getHistoryRepresentation({limit:20});c.isSDKError(e)?(e.errMsg+="\nhistory "+n,e.history=n):e&&((e=new c.CloudSDKError({errCode:l.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:e+" \nhistory "+n})).history=n),this.clearACKSchedule(),f.default.surroundThirdByTryCatch(function(){return r.listener.onError(e)})(),this.userOnErrorInvoked=!0,this.onWatchClose(this,this.sessionInfo&&this.sessionInfo.queryID||""),t&&this.sendCloseWatch().catch(A),this.sessionInfo=void 0}},e}();function O(e){var t={id:e.ID,dataType:e.DataType,queueType:e.QueueType,docId:e.DocID,doc:e.Doc&&"{}"!==e.Doc?JSON.parse(e.Doc):void 0};return"update"===e.DataType&&(e.UpdatedFields&&(t.updatedFields=JSON.parse(e.UpdatedFields)),(e.removedFields||e.RemovedFields)&&(t.removedFields=e.removedFields?JSON.parse(e.removedFields):JSON.parse(e.RemovedFields))),t}t.VirtualWebSocketClient=C},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.unset=t.set=void 0;var r=function(e){var t=new Map;return function(r){return t.has(r)||t.set(r,e(r)),t.get(r)}}(function(e){return e.replace(/\[(\d+)\]/g,".[$1]").split(".").map(function(e){return/^\[(\d+)\]$/.test(e)?parseInt(e.substring(1,e.length-1)):e})});t.set=function(e,t,n){if(e){if(!Object.prototype.hasOwnProperty.call(e,t)){for(var i=r(t),o=e,a=0;a<i.length-1;++a){var s=i[a];o[s]||(o[s]="string"==typeof i[a+1]?{}:[]),o=o[s]}return o[i[i.length-1]]=n,e}e[t]=n}},t.unset=function(e,t){if(e){if(!Object.prototype.hasOwnProperty.call(e,t)){for(var n=r(t),i=e,o=0;o<n.length-1;++o){var a=n[o];if(!i[a])return;i=i[a]}return delete i[n[n.length-1]],e}delete e[t]}}},function(e,t){var r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.VWSStates=t.VWSEvent=t.VWSState=void 0,function(e){e.UNINIT="UNINIT",e.CLOSED="CLOSED",e.INIT_LOGGING_IN="INIT_LOGGING_IN",e.INIT_LOGGED_IN="INIT_LOGGED_IN",e.INIT_LOGIN_FAIL="INIT_LOGIN_FAIL",e.INIT_WATCH_PENDING="INIT_WATCH_PENDING",e.INIT_WATCH_FAIL="INIT_WATCH_FAIL",e.INIT_WATCH_SUCCESS="INIT_WATCH_SUCCESS",e.PAUSED="PAUSED",e.ABNORMAL_WATCH_STATUS="ABNORMAL_WATCH_STATUS",e.REBUILD_LOGGING_IN="REBUILD_LOGGING_IN",e.REBUILD_LOGGED_IN="REBUILD_LOGGED_IN",e.REBUILD_LOGIN_FAIL="REBUILD_LOGIN_FAIL",e.REBUILD_WATCH_PENDING="REBUILD_WATCH_PENDING",e.REBUILD_WATCH_FAIL="REBUILD_WATCH_FAIL",e.REBUILD_WATCH_SUCCESS="REBUILD_WATCH_SUCCESS"}(n=t.VWSState||(t.VWSState={})),function(e){e.CLOSE="close",e.LOGIN_START="loginStart",e.LOGIN_FAIL="loginFail",e.LOGIN_SUCCESS="loginSuccess",e.INIT_WATCH_START="initWatchStart",e.INIT_WATCH_FAIL="initWatchFail",e.INIT_WATCH_SUCCESS="initWatchSuccess",e.WS_DISCONNECTED="wsDisconnected",e.WS_CONNECTED="wsConnected",e.REBUILD_WATCH_START="rebuildWatchStart",e.REBUILD_WATCH_FAIL="rebuildWatchFail",e.REBUILD_WATCH_SUCCESS="rebuildWatchSuccess",e.NEED_REBUILD_WATCH="needRebuildWatch"}(i=t.VWSEvent||(t.VWSEvent={}));var o={accept:i.CLOSE,to:n.CLOSED},a={accept:i.WS_DISCONNECTED,to:n.CLOSED},s={accept:i.WS_DISCONNECTED,to:n.PAUSED};t.VWSStates=((r={})[n.UNINIT]={transitions:[{accept:i.LOGIN_START,to:n.INIT_LOGGING_IN},a,o]},r[n.CLOSED]={transitions:[o]},r[n.INIT_LOGGING_IN]={transitions:[{accept:i.LOGIN_FAIL,to:n.INIT_LOGIN_FAIL},{accept:i.LOGIN_SUCCESS,to:n.INIT_LOGGED_IN},a,o]},r[n.INIT_LOGIN_FAIL]={transitions:[{accept:i.LOGIN_START,to:n.INIT_LOGGING_IN},a,o]},r[n.INIT_LOGGED_IN]={transitions:[{accept:i.INIT_WATCH_START,to:n.INIT_WATCH_PENDING},a,o]},r[n.INIT_WATCH_PENDING]={transitions:[{accept:i.INIT_WATCH_FAIL,to:n.INIT_WATCH_FAIL},{accept:i.INIT_WATCH_SUCCESS,to:n.INIT_WATCH_SUCCESS},a,o]},r[n.INIT_WATCH_FAIL]={transitions:[{accept:i.LOGIN_START,to:n.INIT_LOGGING_IN},a,o]},r[n.INIT_WATCH_SUCCESS]={transitions:[{accept:i.WS_DISCONNECTED,to:n.PAUSED},{accept:i.NEED_REBUILD_WATCH,to:n.ABNORMAL_WATCH_STATUS},s,o]},r[n.PAUSED]={transitions:[{accept:i.LOGIN_START,to:n.REBUILD_LOGGING_IN},s,o]},r[n.ABNORMAL_WATCH_STATUS]={transitions:[{accept:i.LOGIN_START,to:n.REBUILD_LOGGING_IN},s,o]},r[n.REBUILD_LOGGING_IN]={transitions:[{accept:i.LOGIN_FAIL,to:n.REBUILD_LOGIN_FAIL},{accept:i.LOGIN_SUCCESS,to:n.REBUILD_LOGGED_IN},s,o]},r[n.REBUILD_LOGIN_FAIL]={transitions:[{accept:i.LOGIN_START,to:n.REBUILD_LOGGING_IN},s,o]},r[n.REBUILD_LOGGED_IN]={transitions:[{accept:i.REBUILD_WATCH_START,to:n.REBUILD_WATCH_PENDING},s,o]},r[n.REBUILD_WATCH_PENDING]={transitions:[{accept:i.REBUILD_WATCH_FAIL,to:n.REBUILD_WATCH_FAIL},{accept:i.REBUILD_WATCH_SUCCESS,to:n.REBUILD_WATCH_SUCCESS},s,o]},r[n.REBUILD_WATCH_FAIL]={transitions:[{accept:i.LOGIN_START,to:n.REBUILD_LOGGING_IN},s,o]},r[n.REBUILD_WATCH_SUCCESS]={transitions:[{accept:i.NEED_REBUILD_WATCH,to:n.ABNORMAL_WATCH_STATUS},s,o]},r)},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RealtimeListener=void 0;var r=function(){return function(e){this.close=e.close,this.onChange=e.onChange,this.onError=e.onError,e.debug&&Object.defineProperty(this,"virtualClient",{get:function(){return e.virtualClient}})}}();t.RealtimeListener=r},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Snapshot=void 0;var r=function(){return function(e){var t=e.id,r=e.docChanges,n=e.docs,i=e.type,o=(e.EJSON,e.requestId),a=e.watchId;Object.defineProperties(this,{id:{value:t,writable:!1,enumerable:!0},docChanges:{value:r,writable:!1,enumerable:!0},docs:{value:n,writable:!1,enumerable:!0},type:{value:i,writable:!1,enumerable:!0}}),this.requestId=o,this.watchId=a}}();t.Snapshot=r},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getWSCloseError=t.CLOSE_EVENT_CODE=t.CLOSE_EVENT_CODE_INFO=void 0;var n=r(2),i=r(5);t.CLOSE_EVENT_CODE_INFO={1000:{code:1e3,name:"Normal Closure",description:"Normal closure; the connection successfully completed whatever purpose for which it was created."},1001:{code:1001,name:"Going Away",description:"The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection."},1002:{code:1002,name:"Protocol Error",description:"The endpoint is terminating the connection due to a protocol error."},1003:{code:1003,name:"Unsupported Data",description:"The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data)."},1005:{code:1005,name:"No Status Received",description:"Indicates that no status code was provided even though one was expected."},1006:{code:1006,name:"Abnormal Closure",description:"Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected."},1007:{code:1007,name:"Invalid frame payload data",description:"The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message)."},1008:{code:1008,name:"Policy Violation",description:"The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable."},1009:{code:1009,name:"Message too big",description:"The endpoint is terminating the connection because a data frame was received that is too large."},1010:{code:1010,name:"Missing Extension",description:"The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't."},1011:{code:1011,name:"Internal Error",description:"The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request."},1012:{code:1012,name:"Service Restart",description:"The server is terminating the connection because it is restarting."},1013:{code:1013,name:"Try Again Later",description:"The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients."},1014:{code:1014,name:"Bad Gateway",description:"The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code."},1015:{code:1015,name:"TLS Handshake",description:"Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified)."},3000:{code:3e3,name:"Reconnect WebSocket",description:"The client is terminating the connection because it wants to reconnect"},3001:{code:3001,name:"No Realtime Listeners",description:"The client is terminating the connection because no more realtime listeners exist"},3002:{code:3002,name:"Heartbeat Ping Error",description:"The client is terminating the connection due to its failure in sending heartbeat messages"},3003:{code:3003,name:"Heartbeat Pong Timeout Error",description:"The client is terminating the connection because no heartbeat response is received from the server"},3004:{code:3004,name:"Client Reconnect on Server Upgrade",description:"The client is terminating the connection in response to server upgrade"},3050:{code:3050,name:"Server Close Unauthenticated Idle Connection",description:"The server is terminating the connection because the connection is idle and not authenticated"},3051:{code:3051,name:"Server Upgrade",description:"The server is terminating the connection because it is upgrading"},3052:{code:3052,name:"Server Requires Authentication",description:"The server is terminating the connection because it has not received authentication message as the connection's first message"}},function(e){e[e.NormalClosure=1e3]="NormalClosure",e[e.GoingAway=1001]="GoingAway",e[e.ProtocolError=1002]="ProtocolError",e[e.UnsupportedData=1003]="UnsupportedData",e[e.NoStatusReceived=1005]="NoStatusReceived",e[e.AbnormalClosure=1006]="AbnormalClosure",e[e.InvalidFramePayloadData=1007]="InvalidFramePayloadData",e[e.PolicyViolation=1008]="PolicyViolation",e[e.MessageTooBig=1009]="MessageTooBig",e[e.MissingExtension=1010]="MissingExtension",e[e.InternalError=1011]="InternalError",e[e.ServiceRestart=1012]="ServiceRestart",e[e.TryAgainLater=1013]="TryAgainLater",e[e.BadGateway=1014]="BadGateway",e[e.TLSHandshake=1015]="TLSHandshake",e[e.ReconnectWebSocket=3e3]="ReconnectWebSocket",e[e.NoRealtimeListeners=3001]="NoRealtimeListeners",e[e.HeartbeatPingError=3002]="HeartbeatPingError",e[e.HeartbeatPongTimeoutError=3003]="HeartbeatPongTimeoutError",e[e.ReconnectOnServerUpgrade=3004]="ReconnectOnServerUpgrade",e[e.UnauthenticatedIdleConnection=3050]="UnauthenticatedIdleConnection",e[e.ServerUpgrade=3051]="ServerUpgrade",e[e.AuthenticationRequired=3052]="AuthenticationRequired"}(t.CLOSE_EVENT_CODE||(t.CLOSE_EVENT_CODE={})),t.getWSCloseError=function(e,r){var o=t.CLOSE_EVENT_CODE_INFO[e],a=o?o.name+", code "+e+", reason "+(r||o.description):"code "+e;return new n.CloudSDKError({errCode:i.ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED,errMsg:a})}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getDocumentReferenceClass=void 0;var n=r(0),i=r(9),o=r(20),a=r(10),s=r(2),u=r(3),c=r(6),l=r(5),f=r(60);t.getDocumentReferenceClass=function(e){return function(){function t(t,r){var i=this;if(this.watch=function(t){return u.assertType(t,{onChange:"function",onError:"function"}),e.serviceContext.ws||(e.serviceContext.ws=new f.RealtimeWebSocketClient({serviceContext:e.serviceContext})),e.serviceContext.ws.watch(n.__assign(n.__assign({},t),{envId:e.database.config.env||e.serviceContext.env,collectionName:i.collection.collectionName,query:JSON.stringify({_id:i._id}),queryType:o.QUERY_TYPE.DOC,reportAPIName:"cloud.db.document.watch"}))},this.collection=t,this._id=r,null===r||void 0===r)throw new s.CloudSDKError({errCode:l.ERR_CODE.SDK_API_PARAMETER_TYPE_ERROR,errMsg:"docId must not be null or undefined"});Object.defineProperties(this,{_field:{enumerable:!1,configurable:!1,writable:!0}}),this._field={}}return t.prototype.field=function(e){return u.assertRequiredParam(e,"object","field"),u.assertType(e,"object","field"),this._field=e,this},t.prototype.get=function(t){var r=this,u={apiStartTime:+new Date};var l=i.hasAPICallback(t),f=new Promise(function(t,i){return n.__awaiter(r,void 0,void 0,function(){var l,f,d;return n.__generator(this,function(_){switch(_.label){case 0:return _.trys.push([0,2,3,4]),l=this._id,[4,o.queryDocument({env:e.database.config.env,collectionName:r.collection.collectionName,query:e.engine.QuerySerializer.encode({_id:r._id}),options:{projection:e.engine.ProjectionSerializer.encode(r._field)},queryType:o.QUERY_TYPE.DOC,instanceContext:e,timing:u})];case 1:if(!(f=_.sent()).list||!f.list.length)throw new Error("cannot find document with _id "+l+", please make sure that the document exists and you have the corresponding access permission");return t({data:f.list[0],errMsg:a.apiSuccessMsg("document.get")}),[3,4];case 2:return d=_.sent(),i(s.returnAsFinalCloudSDKError(d,"document.get")),[3,4];case 3:return c.reportAPISpeed(n.__assign(n.__assign({},u),{apiEndTime:+new Date,apiName:"cloud.db.document.get"})),[7];case 4:return[2]}})})});if(!l)return f;f.then(function(e){i.invokeSuccessCompleteCallbacks("document.get",t,e)}).catch(function(e){i.invokeFailCompleteCallbacks("document.get",t,e)})},t.prototype.set=function(t){var r=this,l={apiStartTime:+new Date};var f=i.hasAPICallback(t),d=new Promise(function(i,f){return n.__awaiter(r,void 0,void 0,function(){var d,_;return n.__generator(this,function(p){switch(p.label){case 0:return p.trys.push([0,2,3,4]),u.assertType(t,{data:"object"}),u.assertObjectNotEmpty({name:"options.data",target:t.data}),[4,o.setDocument({env:e.database.config.env,collectionName:r.collection.collectionName,_id:r._id,data:e.engine.encodeInternalDataType(t.data),options:{},instanceContext:e,timing:l})];case 1:return d=p.sent(),i({_id:d._id,errMsg:a.apiSuccessMsg("document.set"),stats:{updated:d.updated,created:d.created}}),[3,4];case 2:return _=p.sent(),f(s.returnAsFinalCloudSDKError(_,"document.set")),[3,4];case 3:return c.reportAPISpeed(n.__assign(n.__assign({},l),{apiEndTime:+new Date,apiName:"cloud.db.document.set"})),[7];case 4:return[2]}})})});if(!f)return d;d.then(function(e){i.invokeSuccessCompleteCallbacks("document.set",t,e)}).catch(function(e){i.invokeFailCompleteCallbacks("document.set",t,e)})},t.prototype.update=function(t){var r=this,l={apiStartTime:+new Date};var f=i.hasAPICallback(t),d=new Promise(function(i,f){return n.__awaiter(r,void 0,void 0,function(){var d,_;return n.__generator(this,function(p){switch(p.label){case 0:return p.trys.push([0,2,3,4]),u.assertType(t,{data:"object"}),u.assertObjectNotEmpty({name:"options.data",target:t.data}),[4,o.updateDocument({env:e.database.config.env,collectionName:r.collection.collectionName,query:e.engine.QuerySerializer.encode({_id:r._id}),data:e.engine.UpdateSerializer.encode(t.data),queryType:o.QUERY_TYPE.DOC,options:{multi:!1,merge:!1},instanceContext:e,timing:l})];case 1:return d=p.sent(),i({stats:{updated:d.updated},errMsg:a.apiSuccessMsg("document.update")}),[3,4];case 2:return _=p.sent(),f(s.returnAsFinalCloudSDKError(_,"document.update")),[3,4];case 3:return c.reportAPISpeed(n.__assign(n.__assign({},l),{apiEndTime:+new Date,apiName:"cloud.db.document.update"})),[7];case 4:return[2]}})})});if(!f)return d;d.then(function(e){i.invokeSuccessCompleteCallbacks("document.update",t,e)}).catch(function(e){i.invokeFailCompleteCallbacks("document.update",t,e)})},t.prototype.remove=function(t){var r=this,u={apiStartTime:+new Date};var l=i.hasAPICallback(t),f=new Promise(function(t,i){return n.__awaiter(r,void 0,void 0,function(){var l,f,d;return n.__generator(this,function(_){switch(_.label){case 0:return _.trys.push([0,2,3,4]),l=this._id,[4,o.removeDocument({env:e.database.config.env,collectionName:r.collection.collectionName,query:e.engine.QuerySerializer.encode({_id:r._id}),queryType:o.QUERY_TYPE.DOC,options:{},instanceContext:e,timing:u})];case 1:if(0===(f=_.sent()).removed)throw new Error("cannot remove document with _id "+l+", please make sure that the document exists and you have the corresponding Write permission");return t({stats:{removed:f.removed||0},errMsg:a.apiSuccessMsg("document.remove")}),[3,4];case 2:return d=_.sent(),i(s.returnAsFinalCloudSDKError(d,"document.remove")),[3,4];case 3:return c.reportAPISpeed(n.__assign(n.__assign({},u),{apiEndTime:+new Date,apiName:"cloud.db.document.remove"})),[7];case 4:return[2]}})})});if(!l)return f;f.then(function(e){i.invokeSuccessCompleteCallbacks("document.remove",t,e)}).catch(function(e){i.invokeFailCompleteCallbacks("document.remove",t,e)})},t.prototype.toJSON=function(){},t}()}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.RegExp=t.regExp=void 0;var n=r(7),i=r(3);t.regExp=function(e){return new o(e)};var o=function(){function e(e){i.assertType(e,{regexp:"string"},"RegExp options"),e.options&&i.assertType(e.options,"string"),this.regexp=e.regexp,this.options=e.options||""}return Object.defineProperty(e.prototype,"_internalType",{get:function(){return n.SYMBOL_REGEXP},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{$regex:this.regexp,$options:this.options}},e}();t.RegExp=o},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getEngine=t.ENGINES=void 0;var n,i=r(148);!function(e){e[e.DEFAULT=0]="DEFAULT"}(n=t.ENGINES||(t.ENGINES={})),t.getEngine=function(e){return void 0===e&&(e=n.DEFAULT),i}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);n.__exportStar(r(57),t),n.__exportStar(r(21),t),n.__exportStar(r(149),t)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);n.__exportStar(r(36),t),n.__exportStar(r(150),t),n.__exportStar(r(151),t),n.__exportStar(r(152),t),n.__exportStar(r(66),t),n.__exportStar(r(18),t)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateSerializer=void 0;var n=r(1),i=r(35),o=r(21),a=r(18),s=r(36),u=function(){function e(){}return e.encode=function(e){return c(e)},e}();t.UpdateSerializer=u;var c=function(e){return l(e)},l=function(e){var t=a.flattenQueryObject(e),r={};for(var u in t){var c=t[u];if(i.isUpdateCommand(c)){var l=o.operatorToString(c.operator);switch(r[l]||(r[l]={}),c.operator){case i.UPDATE_COMMANDS_LITERAL.SET:case i.UPDATE_COMMANDS_LITERAL.INC:case i.UPDATE_COMMANDS_LITERAL.MUL:case i.UPDATE_COMMANDS_LITERAL.MIN:case i.UPDATE_COMMANDS_LITERAL.MAX:case i.UPDATE_COMMANDS_LITERAL.RENAME:case i.UPDATE_COMMANDS_LITERAL.BIT:r[l][u]=a.encodeInternalDataType(c.operands[0]);break;case i.UPDATE_COMMANDS_LITERAL.REMOVE:r[l][u]="";break;case i.UPDATE_COMMANDS_LITERAL.PUSH:var f=void 0;f=1===c.operands.length&&n.isObject(c.operands[0])?{$each:c.operands[0].each.map(a.encodeInternalDataType),$position:c.operands[0].position,$slice:c.operands[0].slice,$sort:c.operands[0].sort}:{$each:c.operands.map(a.encodeInternalDataType)},r[l][u]=f;break;case i.UPDATE_COMMANDS_LITERAL.UNSHIFT:f={$each:c.operands.map(a.encodeInternalDataType),$position:0};r[l][u]=f;break;case i.UPDATE_COMMANDS_LITERAL.POP:r[l][u]=1;break;case i.UPDATE_COMMANDS_LITERAL.SHIFT:r[l][u]=-1;break;case i.UPDATE_COMMANDS_LITERAL.ADD_TO_SET:r[l][u]=n.isObject(c.operands[0])&&c.operands[0].each?{$each:c.operands[0].each}:c.operands[0];break;case i.UPDATE_COMMANDS_LITERAL.PULL:r[l][u]=s.QuerySerializer.encode(c.operands[0]);break;case i.UPDATE_COMMANDS_LITERAL.PULL_ALL:default:r[l][u]=a.encodeInternalDataType(c.operands[0])}}else r.$set||(r.$set={}),r.$set[u]=a.encodeInternalDataType(c)}return r}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectionSerializer=void 0;var n=r(55),i=r(1),o=r(21),a=r(18),s=function(){function e(){}return e.encode=function(t){return(new e).encodeProjection(t)},e.prototype.encodeProjection=function(e){return n.isProjectionCommand(e)?this.encodeProjectionCommand(e):"object"===i.getType(e)?this.encodeProjectionObject(e):e},e.prototype.encodeProjectionCommand=function(e){var t,r=o.operatorToString(e.operator);switch(e.operator){case n.PROJECTION_COMMANDS_LITERAL.SLICE:default:return(t={})[r]=e.operands[0],t}},e.prototype.encodeProjectionObject=function(e){var t=a.flattenQueryObject(e);for(var r in t)!0===t[r]||1===t[r]?t[r]=1:!1===t[r]||0===t[r]?t[r]=0:n.isProjectionCommand(t[r])?t[r]=this.encodeProjectionCommand(t[r]):delete t[r];return t},e}();t.ProjectionSerializer=s},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Decoder=void 0;var n=r(0),i=r(1),o=r(18),a=function(){function e(){}return e.decode=function(t){return(new e).decodeData(t)},e.prototype.decodeData=function(e){var t=this;switch(i.getType(e)){case"object":return this.decodeObject(e);case"array":return e.map(function(e){if(i.isObject(e)){var r=o.decodeInternalDataType(e);return r!==e?r:t.decodeObject(e)}return e});default:return e}},e.prototype.decodeObject=function(e){var t=n.__assign({},e);for(var r in t){var a=t[r];switch(i.getType(a)){case"object":var s=o.decodeInternalDataType(a);t[r]=s!==a?s:this.decodeObject(t[r]);break;case"array":(s=this.decodeData(a))!==a&&(t[r]=s);break;default:continue}}return t},e}();t.Decoder=a},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerService=t.UTILS_SERVICE_NAME=void 0;var n=r(154);t.UTILS_SERVICE_NAME="utils",t.registerService=function(e){e.registerService(function(e){var r={name:t.UTILS_SERVICE_NAME,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,get debug(){return e.debug}};return{name:t.UTILS_SERVICE_NAME,context:r,getAPIs:n.getAPIs.bind(null,r)}}(e))}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getAPIs=void 0;var n=r(155),i=r(156);t.getAPIs=function(e){return{CloudID:n.default(e),CDN:i.default(e)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(27);t.default=function(e){var t=function(){function e(e){this._internalType=n.SYMBOL_CLOUD_ID,this.cloudID=e,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}})}return e.prototype.toJSON=function(){return this.cloudID},e.prototype.toString=function(){return this.cloudID},e}();return function(e){return new t(e)}}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(27);t.default=function(e){var t=function(){function e(e){this._internalType=n.SYMBOL_CDN,this.target=e,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}})}return e.prototype.toString=function(){return JSON.stringify({target:this.target})},e}();return function(e){return new t(e)}}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.clientConfigDefaults=t.serverConfigurable=void 0,t.serverConfigurable={db_doc_size_limit:524288,db_realtime_ping_interval:15e3,db_realtime_pong_wait_timeout:15e3,db_realtime_query_event_cache_timeout:18e4,upload_max_file_size:20971520,get_temp_file_url_max_requests:50,call_function_poll_max_retry:10,call_function_max_req_data_size:5242880,call_function_client_poll_timeout:15e3,call_function_valid_start_retry_gap:6e4,call_container_poll_max_retry:10,call_container_client_poll_timeout:15e3,call_container_valid_start_retry_gap:6e4,call_container_max_req_data_size:5242880,call_container_use_private_http:0},t.clientConfigDefaults={REALTIME_DB_MAX_RECONNECT:5,REALTIME_DB_WS_RECONNECT_INTERVAL:5e3,REALTIME_DB_TOTAL_CONNECTION_TIMEOUT:1/0},t.default=t.serverConfigurable},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getServiceMarketAPI=void 0;var n=r(0),i=r(9),o=r(8),a=r(37),s=r(159),u=r(160),c=function(e){return i.hasAPICallback(e)?l(e):o.isDevTools()&&!e.async?s.invokeService(e):u.invokeService(e)},l=function(e){(o.isDevTools()&&!e.async?s.invokeService(e):u.invokeService(e)).then(function(t){i.invokeSuccessCompleteCallbacks("invokeService",e,t)}).catch(function(t){i.invokeFailCompleteCallbacks("invokeService",e,t)})},f=function(e){return i.hasAPICallback(e)?d(e):u.getAsyncResult(e)},d=function(e){u.getAsyncResult(e).then(function(t){i.invokeSuccessCompleteCallbacks("getAsyncResult",e,t)}).catch(function(t){i.invokeFailCompleteCallbacks("getAsyncResult",e,t)})};t.getServiceMarketAPI=function(e){void 0===e&&(e={});var t=e.sdk;return{invokeService:function(e){return c(n.__assign(n.__assign({},e),{sdk:t}))},getAsyncResult:function(e){return f(n.__assign(n.__assign({},e),{sdk:t}))},CDN:a.CDN}}},function(e,t,r){var n=this;Object.defineProperty(t,"__esModule",{value:!0}),t.invokeService=void 0;var i=r(0),o=r(37),a=r(67);t.invokeService=function(e){return i.__awaiter(n,void 0,void 0,function(){var t,r,n,s,u,c,l,f,d,_,p,h;return i.__generator(this,function(i){switch(i.label){case 0:if(i.trys.push([0,3,,4]),!e.service||!e.api)throw new Error("field 'service' and 'api' must be provided");return t=new WeakMap,r=[],e.data&&JSON.stringify(e.data,function(n,i){return i&&i.symbol===o.CDNObjectSymbol?void r.push(new Promise(function(r,n){var a={appType:301,fileType:20303,fileKey:"file_"+Math.random()},s=i;switch(function(e){return Object.prototype.toString.call(e).slice(8,-1)}(s.options)){case"Object":if(!s.options.filePath)throw new Error("filePath must be provided");a.filePath=s.options.filePath;break;default:a.fileData=s.options}r(o.uploadToCommonCDN(a,e.sdk).then(function(e){t.set(i,e.fileUrl)}))})):i}),[4,Promise.all(r)];case 1:return i.sent(),n=JSON.stringify(e.data,function(e,r){return r&&r.symbol===o.CDNObjectSymbol&&t.has(r)?t.get(r):r}),[4,a.invokeOperateWXData({apiName:"webapi_servicemarket_jsapi_comm",reqData:{service_id:e.service,api_name:e.api,data:n,consume_type:e.consumeType,consume_appid:e.consumeAppid,client_msg_id:Math.random()+"_"+Date.now(),version:1}},e.sdk)];case 2:!(s=i.sent()).data&&s.rawData&&(s.data=JSON.parse(s.rawData)),u=s.data,wxConsole.info("[servicemarket] raw response",u),c=void 0,l=void 0,f=void 0;try{c=(d=u).request_id,0===d.errcode?l=JSON.parse(d.data):(p="invokeService:fail "+d.errcode+" "+d.errmsg+" (requestId: "+c+")",(f=new Error(p)).errCode=d.errcode,f.errMsg=p,f.requestId=c)}catch(e){p="invokeService:fail inner protocol parse failed (requestId: "+(c||"empty")+")",(f=new Error(p)).errCode=-1,f.errMsg=p,f.requestId=c}if(f)throw f;return[2,{errMsg:"invokeService:ok",data:l,requestId:c}];case 3:throw _=i.sent(),p="invokeService:fail ",_&&_.errMsg&&_.err_code?(p+=_.errMsg,(h=new Error(p+"(err_code "+_.err_code+")")).errCode=_.err_code,h):_&&_.errMsg&&_.errCode?_:new Error("invokeService:fail "+_);case 4:return[2]}})})}},function(e,t,r){var n=this;Object.defineProperty(t,"__esModule",{value:!0}),t.getAsyncResult=t.invokeService=void 0;var i,o=r(0),a=r(161),s=r(11),u=r(2),c=r(8),l=r(162),f=r(37),d=r(67),_="invokeService",p=50,h=2,E=2,g=60,m=2e4;!function(e){e[e.InvalidRequestId=14]="InvalidRequestId"}(i||(i={}));var S=function(e){var t=new Date;return t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()+" "+e},v=function(e){return e.join("->")};t.invokeService=function(e){return o.__awaiter(n,void 0,void 0,function(){function t(t,r,n){return o.__awaiter(this,void 0,void 0,function(){return o.__generator(this,function(i){return[2,new Promise(function(i,f){var y=[S("start")],T=function(e,t,r){var n=function(t){e.push(S("app "+t))};return s.onAppVisibilityChange(n),{resolve:function(e){s.offAppVisibilityChange(n),t(e)},reject:function(e){s.offAppVisibilityChange(n),r(e)}}}(y,i,f),A=T.resolve,C=T.reject;!function t(r){return o.__awaiter(this,void 0,void 0,function(){var n,i,f,p,h,E,y,T,A,C,O,I,R,N,w,b,D,L,M,P,U,B,x,k=this;return o.__generator(this,function(G){switch(G.label){case 0:n=r.param,i=r.data,f=r.callID,p=r.scene,h=r.retryReason,E=r.tryCount,y=r.trace,T=r.systemErrorRetry,A=r.timeoutErrorRetry,C=r.resolve,O=r.reject,I={service_id:n.service,api_name:n.api,data:p===a.Scene.CALL?i:void 0,consume_type:e.consumeType,consume_appid:e.consumeAppid,client_msg_id:Math.random()+"_"+Date.now(),version:2,call_id:f,scene:p,retry_reason:h},R=!1,N=!1,w=function(){clearTimeout(D),N=!0},b=+new Date,D=setTimeout(function(){return o.__awaiter(k,void 0,void 0,function(){var e;return o.__generator(this,function(n){switch(n.label){case 0:return e=m,+new Date-b>e?[4,s.sleep()]:[3,2];case 1:if(n.sent(),N)return[2];n.label=2;case 2:return!c.isDevTools()&&+new Date-b>g?(y.push(S("timeout, exceed max retry gap")),[2,O(u.returnAsFinalCloudSDKError({errCode:l.ERR_CODE.SM_POLL_RESULT_EXPIRED,errMsg:"timeout for retry, cannot retry fetching the result anymore (callId: "+f+") (trace: "+v(y)+")"},_))]):(R=!0,r.timeoutErrorRetry>0?(y.push(S("timeout, retry")),t(o.__assign(o.__assign({},r),{scene:p,retryReason:a.RetryReason.Timeout,tryCount:E-1,timeoutErrorRetry:A-1}))):(y.push(S("timeout, abort")),O(u.returnAsFinalCloudSDKError({errCode:l.ERR_CODE.SM_EXCEED_MAX_TIMEOUT_POLL_RETRY,errMsg:l.ERR_MSG.SM_EXCEED_MAX_TIMEOUT_POLL_RETRY+" (callId: "+f+") (trace: "+v(y)+")"},_))),[2])}})})},m),G.label=1;case 1:return G.trys.push([1,3,,4]),[4,d.invokeOperateWXData({apiName:"webapi_servicemarket_jsapi_comm",reqData:I},e.sdk)];case 2:!(L=G.sent()).data&&L.rawData&&(L.data=JSON.parse(L.rawData));try{if(R)return[2];if(w(),!(M=L.data)&&L.rawData)try{M=JSON.parse(L.rawData)}catch(e){}if(!M)return y.push(S("empty resp")),[2,O(u.returnAsFinalCloudSDKError({errCode:l.ERR_CODE.SM_EMPTY_CALL_RESULT,errMsg:l.ERR_MSG.SM_EMPTY_CALL_RESULT},_))];if(M.scene!==a.Scene.PreResp){if(M.scene===a.Scene.FinalResp){if(0!==M.errcode)return(P=u.returnAsFinalCloudSDKError({errCode:l.ERR_CODE.SM_PROVIDER_EXECUTION_ERROR,errMsg:"requestID "+M.request_id+", error message "+(M.provider_errmsg||"unknown")+" (callid "+f+")"},_)).requestID=M.request_id,[2,O(P)];U=M.data;try{U=JSON.parse(U)}catch(e){}return[2,C({result:U,requestID:M.request_id})]}return y.push(S("unexpected scene")),[2,O(u.returnAsFinalCloudSDKError({errCode:l.ERR_CODE.SM_UNKNOWN_SCENE,errMsg:"unknown scene "+M.scene+" (callId: "+f+") (trace: "+v(y)+")"},_))]}if(!(E>=0))return y.push(S("too many polls, abort")),[2,O(u.returnAsFinalCloudSDKError({errCode:l.ERR_CODE.SM_EXCEED_MAX_POLL_RETRY,errMsg:l.ERR_MSG.SM_EXCEED_MAX_POLL_RETRY+" (callId: "+f+") (trace: "+v(y)+")"},_))];y.push(S("normal poll")),t(o.__assign(o.__assign({},r),{scene:a.Scene.POLL,retryReason:a.RetryReason.None,tryCount:E-1}))}catch(e){O(u.returnAsFinalCloudSDKError({errCode:l.ERR_CODE.SM_POLL_ERROR,errMsg:"polling catch error: "+e+" (callId: "+f+")"},_))}return[3,4];case 3:return B=G.sent(),R?[2]:(w(),x=B instanceof Error?B:JSON.stringify(B),B&&B.operateWXDataFail&&T>0?(y.push(S("system error ("+x+"), retry")),t(o.__assign(o.__assign({},r),{scene:p,retryReason:a.RetryReason.SysErr,tryCount:E-1,systemErrorRetry:T-1}))):(y.push(S("system error ("+x+"), abort")),O(u.returnAsFinalCloudSDKError(x+" (callId: "+f+") (trace: "+v(y)+")",_))),[3,4]);case 4:return[2]}})})}({param:t,data:r,callID:n,scene:a.Scene.CALL,retryReason:a.RetryReason.None,tryCount:p,systemErrorRetry:h,timeoutErrorRetry:E,trace:y,resolve:A,reject:C})})]})})}var r,n,i,y,T,A,C,O,I,R,N,w,b,D;return o.__generator(this,function(o){switch(o.label){case 0:if(o.trys.push([0,6,,7]),!e.service||!e.api)throw new Error("field 'service' and 'api' must be provided");return r=new WeakMap,n=[],e.data&&JSON.stringify(e.data,function(t,i){return i&&i.symbol===f.CDNObjectSymbol?void n.push(new Promise(function(t,n){var o={appType:301,fileType:20303,fileKey:"file_"+Math.random()},a=i;switch(function(e){return Object.prototype.toString.call(e).slice(8,-1)}(a.options)){case"Object":if(!a.options.filePath)throw new Error("filePath must be provided");o.filePath=a.options.filePath;break;default:o.fileData=a.options}t(f.uploadToCommonCDN(o,e.sdk).then(function(e){r.set(i,e.fileUrl)}))})):i}),[4,Promise.all(n)];case 1:return o.sent(),i=JSON.stringify(e.data,function(e,t){return t&&t.symbol===f.CDNObjectSymbol&&r.has(t)?r.get(t):t}),y=Math.random()+"_"+Date.now(),e.async?[3,3]:[4,t(e,i,y)];case 2:return T=o.sent(),A=T.result,C=T.requestID,[2,{errMsg:"invokeService:ok",data:A,requestId:C}];case 3:return O={service_id:e.service,api_name:e.api,data:i,consume_type:e.consumeType,consume_appid:e.consumeAppid,client_msg_id:Math.random()+"_"+Date.now(),version:2,call_id:y,scene:a.Scene.CALL,retry_reason:a.RetryReason.None,req_type:a.ReqType.LongAsync},[4,d.invokeOperateWXData({apiName:"webapi_servicemarket_jsapi_comm",reqData:O},e.sdk)];case 4:if(!(I=o.sent()).data&&I.rawData&&(I.data=JSON.parse(I.rawData)),wxConsole.log("longAsync result",I),(R=I.data).scene===a.Scene.FinalResp&&0===R.errcode)return[2,{errMsg:"invokeService:ok",requestId:R.request_id}];throw(N=u.returnAsFinalCloudSDKError({errCode:l.ERR_CODE.SM_SYSTEM_ERROR,errMsg:"requestID "+R.request_id+", error message "+(R.errmsg||"unknown")+" (callid "+y+")"},_)).requestID=R.request_id,N;case 5:return[3,7];case 6:throw w=o.sent(),b="invokeService:fail ",w&&w.errMsg&&w.err_code?(b+=w.errMsg,(D=new Error(b+"(err_code "+w.err_code+")")).errCode=w.err_code,D):w&&w.errMsg&&w.errCode?w:new Error("invokeService:fail "+w);case 7:return[2]}})})},t.getAsyncResult=function(e){return o.__awaiter(this,void 0,void 0,function(){var t,r,n;return o.__generator(this,function(i){switch(i.label){case 0:return[4,d.invokeOperateWXData({apiName:"webapi_servicemarket_jsapi_retrieve",reqData:{request_id:e.requestId}},e.sdk)];case 1:if(!(t=i.sent()).data&&t.rawData&&(t.data=JSON.parse(t.rawData)),wxConsole.log("getAsyncResult resp",t),0===(r=t.data).errcode)return r.provider_errmsg?[2,{errCode:0,errMsg:"getAsyncResult:fail provider execution error",status:r.status,providerErrMsg:r.provider_errmsg,requestId:r.request_id}]:[2,{errCode:0,errMsg:"getAsyncResult:ok",data:JSON.parse(r.data),status:r.status,requestId:r.request_id}];throw(n=new Error("getAsyncResult:fail requestID "+r.request_id+", error message "+(r.errmsg||"unknown"))).errCode=r.errcode,n.errMsg=r.errmsg,n}})})}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ReqType=t.RetryReason=t.Scene=void 0,function(e){e[e.CALL=1]="CALL",e[e.POLL=2]="POLL",e[e.PreResp=3]="PreResp",e[e.FinalResp=4]="FinalResp"}(t.Scene||(t.Scene={})),function(e){e[e.None=0]="None",e[e.SysErr=1]="SysErr",e[e.Timeout=2]="Timeout"}(t.RetryReason||(t.RetryReason={})),function(e){e[e.Sync=0]="Sync",e[e.LongAsync=2]="LongAsync"}(t.ReqType||(t.ReqType={}))},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ERR_MSG=t.ERR_CODE=void 0,t.ERR_CODE={SM_EXCEED_MAX_TIMEOUT_POLL_RETRY:100,SM_EMPTY_CALL_RESULT:101,SM_EXCEED_MAX_POLL_RETRY:102,SM_PROVIDER_EXECUTION_ERROR:103,SM_POLL_RESULT_EXPIRED:104,SM_EMPTY_POLL_RESULT_BASE_RESP:105,SM_POLL_RESULT_BASE_RESP_RET_ABNORMAL:106,SM_UNKNOWN_SCENE:107,SM_SYSTEM_ERROR:108},t.ERR_MSG={SM_EXCEED_MAX_TIMEOUT_POLL_RETRY:"exceed max timeout retry",SM_EMPTY_CALL_RESULT:"empty call result",SM_EXCEED_MAX_POLL_RETRY:"exceed max poll retry",SM_PROVIDER_EXECUTION_ERROR:"provider execution error",SM_POLL_RESULT_EXPIRED:"poll result expired",SM_EMPTY_POLL_RESULT_BASE_RESP:"empty poll result base resp",SM_POLL_RESULT_BASE_RESP_RET_ABNORMAL:"poll result base resp ret abnormal",SM_UNKNOWN_SCENE:"unknown scene",SM_SYSTEM_ERROR:"system error"}},function(e,t,r){"use strict";var n;r.r(t);var i=new Uint8Array(16);function o(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(i)}var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var s=function(e){return"string"==typeof e&&a.test(e)},u=[],c=0;c<256;++c)u.push((c+256).toString(16).substr(1));var l,f,d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase();if(!s(r))throw TypeError("Stringified UUID is invalid");return r},_=0,p=0;var h=function(e,t,r){var n=t&&r||0,i=t||new Array(16),a=(e=e||{}).node||l,s=void 0!==e.clockseq?e.clockseq:f;if(null==a||null==s){var u=e.random||(e.rng||o)();null==a&&(a=l=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==s&&(s=f=16383&(u[6]<<8|u[7]))}var c=void 0!==e.msecs?e.msecs:Date.now(),h=void 0!==e.nsecs?e.nsecs:p+1,E=c-_+(h-p)/1e4;if(E<0&&void 0===e.clockseq&&(s=s+1&16383),(E<0||c>_)&&void 0===e.nsecs&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_=c,p=h,f=s;var g=(1e4*(268435455&(c+=122192928e5))+h)%4294967296;i[n++]=g>>>24&255,i[n++]=g>>>16&255,i[n++]=g>>>8&255,i[n++]=255&g;var m=c/4294967296*1e4&268435455;i[n++]=m>>>8&255,i[n++]=255&m,i[n++]=m>>>24&15|16,i[n++]=m>>>16&255,i[n++]=s>>>8|128,i[n++]=255&s;for(var S=0;S<6;++S)i[n+S]=a[S];return t||d(i)};var E=function(e){if(!s(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r};var g=function(e,t,r){function n(e,n,i,o){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof n&&(n=E(n)),16!==n.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var a=new Uint8Array(16+e.length);if(a.set(n),a.set(e,n.length),(a=r(a))[6]=15&a[6]|t,a[8]=63&a[8]|128,i){o=o||0;for(var s=0;s<16;++s)i[o+s]=a[s];return i}return d(a)}try{n.name=e}catch(e){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n};function m(e){return 14+(e+64>>>9<<4)+1}function S(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function v(e,t,r,n,i,o){return S(function(e,t){return e<<t|e>>>32-t}(S(S(t,e),S(n,o)),i),r)}function y(e,t,r,n,i,o,a){return v(t&r|~t&n,e,t,i,o,a)}function T(e,t,r,n,i,o,a){return v(t&n|r&~n,e,t,i,o,a)}function A(e,t,r,n,i,o,a){return v(t^r^n,e,t,i,o,a)}function C(e,t,r,n,i,o,a){return v(r^(t|~n),e,t,i,o,a)}var O=g("v3",48,function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){for(var t=[],r=32*e.length,n=0;n<r;n+=8){var i=e[n>>5]>>>n%32&255,o=parseInt("0123456789abcdef".charAt(i>>>4&15)+"0123456789abcdef".charAt(15&i),16);t.push(o)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[m(t)-1]=t;for(var r=1732584193,n=-271733879,i=-1732584194,o=271733878,a=0;a<e.length;a+=16){var s=r,u=n,c=i,l=o;r=y(r,n,i,o,e[a],7,-680876936),o=y(o,r,n,i,e[a+1],12,-389564586),i=y(i,o,r,n,e[a+2],17,606105819),n=y(n,i,o,r,e[a+3],22,-1044525330),r=y(r,n,i,o,e[a+4],7,-176418897),o=y(o,r,n,i,e[a+5],12,1200080426),i=y(i,o,r,n,e[a+6],17,-1473231341),n=y(n,i,o,r,e[a+7],22,-45705983),r=y(r,n,i,o,e[a+8],7,1770035416),o=y(o,r,n,i,e[a+9],12,-1958414417),i=y(i,o,r,n,e[a+10],17,-42063),n=y(n,i,o,r,e[a+11],22,-1990404162),r=y(r,n,i,o,e[a+12],7,1804603682),o=y(o,r,n,i,e[a+13],12,-40341101),i=y(i,o,r,n,e[a+14],17,-1502002290),n=y(n,i,o,r,e[a+15],22,1236535329),r=T(r,n,i,o,e[a+1],5,-165796510),o=T(o,r,n,i,e[a+6],9,-1069501632),i=T(i,o,r,n,e[a+11],14,643717713),n=T(n,i,o,r,e[a],20,-373897302),r=T(r,n,i,o,e[a+5],5,-701558691),o=T(o,r,n,i,e[a+10],9,38016083),i=T(i,o,r,n,e[a+15],14,-660478335),n=T(n,i,o,r,e[a+4],20,-405537848),r=T(r,n,i,o,e[a+9],5,568446438),o=T(o,r,n,i,e[a+14],9,-1019803690),i=T(i,o,r,n,e[a+3],14,-187363961),n=T(n,i,o,r,e[a+8],20,1163531501),r=T(r,n,i,o,e[a+13],5,-1444681467),o=T(o,r,n,i,e[a+2],9,-51403784),i=T(i,o,r,n,e[a+7],14,1735328473),n=T(n,i,o,r,e[a+12],20,-1926607734),r=A(r,n,i,o,e[a+5],4,-378558),o=A(o,r,n,i,e[a+8],11,-2022574463),i=A(i,o,r,n,e[a+11],16,1839030562),n=A(n,i,o,r,e[a+14],23,-35309556),r=A(r,n,i,o,e[a+1],4,-1530992060),o=A(o,r,n,i,e[a+4],11,1272893353),i=A(i,o,r,n,e[a+7],16,-155497632),n=A(n,i,o,r,e[a+10],23,-1094730640),r=A(r,n,i,o,e[a+13],4,681279174),o=A(o,r,n,i,e[a],11,-358537222),i=A(i,o,r,n,e[a+3],16,-722521979),n=A(n,i,o,r,e[a+6],23,76029189),r=A(r,n,i,o,e[a+9],4,-640364487),o=A(o,r,n,i,e[a+12],11,-421815835),i=A(i,o,r,n,e[a+15],16,530742520),n=A(n,i,o,r,e[a+2],23,-995338651),r=C(r,n,i,o,e[a],6,-198630844),o=C(o,r,n,i,e[a+7],10,1126891415),i=C(i,o,r,n,e[a+14],15,-1416354905),n=C(n,i,o,r,e[a+5],21,-57434055),r=C(r,n,i,o,e[a+12],6,1700485571),o=C(o,r,n,i,e[a+3],10,-1894986606),i=C(i,o,r,n,e[a+10],15,-1051523),n=C(n,i,o,r,e[a+1],21,-2054922799),r=C(r,n,i,o,e[a+8],6,1873313359),o=C(o,r,n,i,e[a+15],10,-30611744),i=C(i,o,r,n,e[a+6],15,-1560198380),n=C(n,i,o,r,e[a+13],21,1309151649),r=C(r,n,i,o,e[a+4],6,-145523070),o=C(o,r,n,i,e[a+11],10,-1120210379),i=C(i,o,r,n,e[a+2],15,718787259),n=C(n,i,o,r,e[a+9],21,-343485551),r=S(r,s),n=S(n,u),i=S(i,c),o=S(o,l)}return[r,n,i,o]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(m(t)),n=0;n<t;n+=8)r[n>>5]|=(255&e[n/8])<<n%32;return r}(e),8*e.length))});var I=function(e,t,r){var n=(e=e||{}).random||(e.rng||o)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return d(n)};function R(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:return t^r^n;case 2:return t&r^t&n^r&n;case 3:return t^r^n}}function N(e,t){return e<<t|e>>>32-t}var w=g("v5",80,function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var n=unescape(encodeURIComponent(e));e=[];for(var i=0;i<n.length;++i)e.push(n.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var o=e.length/4+2,a=Math.ceil(o/16),s=new Array(a),u=0;u<a;++u){for(var c=new Uint32Array(16),l=0;l<16;++l)c[l]=e[64*u+4*l]<<24|e[64*u+4*l+1]<<16|e[64*u+4*l+2]<<8|e[64*u+4*l+3];s[u]=c}s[a-1][14]=8*(e.length-1)/Math.pow(2,32),s[a-1][14]=Math.floor(s[a-1][14]),s[a-1][15]=8*(e.length-1)&4294967295;for(var f=0;f<a;++f){for(var d=new Uint32Array(80),_=0;_<16;++_)d[_]=s[f][_];for(var p=16;p<80;++p)d[p]=N(d[p-3]^d[p-8]^d[p-14]^d[p-16],1);for(var h=r[0],E=r[1],g=r[2],m=r[3],S=r[4],v=0;v<80;++v){var y=Math.floor(v/20),T=N(h,5)+R(y,E,g,m)+S+t[y]+d[v]>>>0;S=m,m=g,g=N(E,30)>>>0,E=h,h=T}r[0]=r[0]+h>>>0,r[1]=r[1]+E>>>0,r[2]=r[2]+g>>>0,r[3]=r[3]+m>>>0,r[4]=r[4]+S>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]});var b=function(e){if(!s(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)};r.d(t,"v1",function(){return h}),r.d(t,"v3",function(){return O}),r.d(t,"v4",function(){return I}),r.d(t,"v5",function(){return w}),r.d(t,"NIL",function(){return"00000000-0000-0000-0000-000000000000"}),r.d(t,"version",function(){return b}),r.d(t,"validate",function(){return s}),r.d(t,"stringify",function(){return d}),r.d(t,"parse",function(){return E})},function(e,t,r){"use strict";r.r(t);var n=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},i=r(68),o="object"==typeof self&&self&&self.Object===Object&&self,a=i.a||o||Function("return this")(),s=function(){return a.Date.now()},u=a.Symbol,c=Object.prototype,l=c.hasOwnProperty,f=c.toString,d=u?u.toStringTag:void 0;var _=function(e){var t=l.call(e,d),r=e[d];try{e[d]=void 0;var n=!0}catch(e){}var i=f.call(e);return n&&(t?e[d]=r:delete e[d]),i},p=Object.prototype.toString;var h=function(e){return p.call(e)},E="[object Null]",g="[object Undefined]",m=u?u.toStringTag:void 0;var S=function(e){return null==e?void 0===e?g:E:m&&m in Object(e)?_(e):h(e)};var v=function(e){return null!=e&&"object"==typeof e},y="[object Symbol]";var T=function(e){return"symbol"==typeof e||v(e)&&S(e)==y},A=NaN,C=/^\s+|\s+$/g,O=/^[-+]0x[0-9a-f]+$/i,I=/^0b[01]+$/i,R=/^0o[0-7]+$/i,N=parseInt;var w=function(e){if("number"==typeof e)return e;if(T(e))return A;if(n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(C,"");var r=I.test(e);return r||R.test(e)?N(e.slice(2),r?2:8):O.test(e)?A:+e},b="Expected a function",D=Math.max,L=Math.min;t.default=function(e,t,r){var i,o,a,u,c,l,f=0,d=!1,_=!1,p=!0;if("function"!=typeof e)throw new TypeError(b);function h(t){var r=i,n=o;return i=o=void 0,f=t,u=e.apply(n,r)}function E(e){var r=e-l;return void 0===l||r>=t||r<0||_&&e-f>=a}function g(){var e=s();if(E(e))return m(e);c=setTimeout(g,function(e){var r=t-(e-l);return _?L(r,a-(e-f)):r}(e))}function m(e){return c=void 0,p&&i?h(e):(i=o=void 0,u)}function S(){var e=s(),r=E(e);if(i=arguments,o=this,l=e,r){if(void 0===c)return function(e){return f=e,c=setTimeout(g,t),d?h(e):u}(l);if(_)return c=setTimeout(g,t),h(l)}return void 0===c&&(c=setTimeout(g,t)),u}return t=w(t)||0,n(r)&&(d=!!r.leading,a=(_="maxWait"in r)?D(w(r.maxWait)||0,t):a,p="trailing"in r?!!r.trailing:p),S.cancel=function(){void 0!==c&&clearTimeout(c),f=0,i=l=o=c=void 0},S.flush=function(){return void 0===c?u:m(s())},S}}]));